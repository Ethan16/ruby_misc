<logentry
   revision="270995">
<author>fxw</author>
<date>2016-09-03T07:31:11.127525Z</date>
</logentry>
<logentry
   revision="270966">
<author>fxw</author>
<date>2016-09-03T03:20:52.954493Z</date>
</logentry>
<logentry
   revision="270946">
<author>lcy</author>
<date>2016-09-03T01:35:54.441266Z</date>
</logentry>
<logentry
   revision="270868">
<author>dongxia</author>
<date>2016-09-02T06:29:42.003665Z</date>
</logentry>
<logentry
   revision="270855">
<author>lcy</author>
<date>2016-09-02T03:29:32.668266Z</date>
</logentry>
<logentry
   revision="270811">
<author>dongxia</author>
<date>2016-09-02T00:59:24.237099Z</date>
</logentry>
<logentry
   revision="270801">
<author>dongxia</author>
<date>2016-09-01T13:41:05.198490Z</date>
</logentry>
<logentry
   revision="270800">
<author>dongxia</author>
<date>2016-09-01T13:34:59.306550Z</date>
</logentry>
<logentry
   revision="270794">
<author>chendan</author>
<date>2016-09-01T12:48:46.295011Z</date>
</logentry>
<logentry
   revision="270778">
<author>chendan</author>
<date>2016-09-01T11:48:17.188003Z</date>
</logentry>
<logentry
   revision="270759">
<author>chendan</author>
<date>2016-09-01T09:49:35.759593Z</date>
</logentry>
<logentry
   revision="270724">
<author>fxw</author>
<date>2016-09-01T08:09:15.203754Z</date>
</logentry>
<logentry
   revision="270584">
<author>fxw</author>
<date>2016-08-31T03:08:05.585701Z</date>
</logentry>
<logentry
   revision="270557">
<author>fxw</author>
<date>2016-08-31T00:53:47.407502Z</date>
</logentry>
<logentry
   revision="270453">
<author>dongxia</author>
<date>2016-08-30T06:30:08.535053Z</date>
</logentry>
<logentry
   revision="270452">
<author>yangwei</author>
<date>2016-08-30T06:30:07.168667Z</date>
</logentry>
<logentry
   revision="270352">
<author>dongxia</author>
<date>2016-08-29T08:43:49.055084Z</date>
</logentry>
<logentry
   revision="270306">
<author>fxw</author>
<date>2016-08-29T03:54:06.258664Z</date>
</logentry>
<logentry
   revision="270156">
<author>fxw</author>
<date>2016-08-26T09:57:36.705839Z</date>
</logentry>
<logentry
   revision="270154">
<author>fxw</author>
<date>2016-08-26T09:29:05.591025Z</date>
</logentry>
<logentry
   revision="270995">
<author>fxw</author>
<date>2016-09-03T07:31:11.127525Z</date>
<msg>noreview
更新VDC镜像
</msg>
</logentry>
<logentry
   revision="270966">
<author>fxw</author>
<date>2016-09-03T03:20:52.954493Z</date>
<msg>noreview
更新VDC镜像</msg>
</logentry>
<logentry
   revision="270946">
<author>lcy</author>
<date>2016-09-03T01:35:54.441266Z</date>
<msg>reviewid: 23593
review by zjy
Bug id: 6446
问题分析：TD6446,【需求】一体机修改网口顺序
问题出现的根源：
无
改动说明：
增加对华硕板载网卡的支持
自测：
打包验证。</msg>
</logentry>
<logentry
   revision="270868">
<author>dongxia</author>
<date>2016-09-02T06:29:42.003665Z</date>
<msg>reviewid:23565
bugid:7289
问题分析：
脚本优化
改动说明：
1.当前主机可访问共享存储时，get_clustervm_deal_host()优先返回当前主机，提高性能。
2.处理vs脚本vs_quick_lookup.sh调用失败的情况 
自测：
vmp4.9 200.201.136.106 admin/admin123.
对于共享存储选择访问节点使用的是当前主机节点
2、vs脚本vs_quick_lookup.sh处理失败，有日志
write_log ${G_CHECK_DEBUG_LOG} "vs_quick_lookup.sh \"${VM_DIR}/${VM_IMG}\" error! strerror=[${VS_HOST_LIST}]"
write_log ${G_CHECK_RESULT_FILE} "[VS_MISS] VMID:${VMID} HOST: UNKNOWN ${VM_DIR}/${VM_IMG}"</msg>
</logentry>
<logentry
   revision="270855">
<author>lcy</author>
<date>2016-09-02T03:29:32.668266Z</date>
<msg>reviewid: 23553
review by fxw
Bug id: 5510
问题分析：TD7215,【历史遗留】更新模板的时候要求输入管理员密码 [转后台处理吧]
问题出现的根源：
无
改动说明：
在模板更新和自动更新接口上增加密码的参数，并且对密码进行校验
自测：
自测通过。
4.9.00_B
build 2016-08-02 01:30:59
1. 输入错误的密码，提示密码错误
2. 输入正确的密码，可以进行更新操作</msg>
</logentry>
<logentry
   revision="270811">
<author>dongxia</author>
<date>2016-09-02T00:59:24.237099Z</date>
<msg>reviewid:23513
bugid:7190
问题分析：
问题：
同时进行2个磁盘检查任务，后一个任务可能会覆盖掉前一个任务的部分日志，导致日志的输入结果不正确。
分析： 
1、每次磁盘检查的任务进行时会先对结果目录下的文件进行初始化包括结果文件，上次任务没有退出还在解析结果的时候下一次任务
开始又将结果文件初始化了，导致上次的结果有误
改动说明：
bug7185修改进度问题，这里将结果目录的初始化任务也加入到加锁后执行的操作中，保证不在两个任务同时进行的时候清除结果
自测：
vmp4.9
200.201.136.106 admin/admin123.
1、选择磁盘文件扫描操作
2、上次操作结束之前再进行一个扫描任务
3、查看两次操作结果
4、修改前，两次结果不一样，前一次结果不完全；修改后：两次结果一致检测出所有异常虚拟机</msg>
</logentry>
<logentry
   revision="270801">
<author>dongxia</author>
<date>2016-09-01T13:41:05.198490Z</date>
<msg>reviewid:23506
bugid:7048
问题分析：
  问题：
  1、主控无法访问的ISCSI存储上的虚拟机磁盘损坏无法检测到
  2、存在磁盘异构的时候，个人盘损坏的虚拟机无法检测到
  分析：
  1、检测磁盘时生成磁盘路径的使用的是get_vm_dir_by_vmid.pl脚本没有获得路径的时候VM_HOST默认使用主控节点
  导致不能被主控访问的磁盘上的路径主控节点就不能读取
  2、磁盘异构情况下，get_vm_dir_by_vmid.pl获得的是系统盘的路径，磁盘异构后个人盘路径和系统盘不一样此时不能检测个人盘的情况
改动说明：
  1、修改vm_image_check.sh 中get_one_vm函数，添加函数get_clustervm_deal_host根据路径查找能够访问的正确节点
  2、get_one_vm函数中，读取配置对于该虚拟机的所有ide如果存储位置和系统存储cfstorage不同的，就生成该ide的存储路径
  再查找能够正确访问该路径的节点，对该路径下的磁盘进行检测
自测：
vmp4.9 200.201.136.116 admin/admin123.
主控不能访问存储的虚拟机磁盘检测
1、新建虚拟机test，存储位置为主控不能访问的存储
2、人为损坏个人盘
3、磁盘检测查看检测结果，修改前:该虚拟机不能被检测到；修改后：该虚拟机能被检测到

磁盘异构情况磁盘检测：
1、新建虚拟机test1,系统盘在虚拟存储，个人盘在其他存储
2、新建虚拟机test2,系统盘在其他存储，个人盘在虚拟存储
3、新建虚拟机test3,系统盘在主控本地，个人盘在主控不能访问的存储
4、新建虚拟机test4,系统盘在主控不能访问的存储，个人盘在从节点本地
5、损坏个人盘，磁盘检测，修改前：上述情况的虚拟机不能检测到，修改后：上述虚拟机能检测到</msg>
</logentry>
<logentry
   revision="270800">
<author>dongxia</author>
<date>2016-09-01T13:34:59.306550Z</date>
<msg>reviewid:23510
bugid:7185
问题分析：
问题：磁盘检查任务，前台显示完成但是结束时间为空，操作描述为空，过一段时间结束时间描述才会更新显示
分析：磁盘检查任务显示进度的时候根据检测完成的虚拟机个数和总的个数对比以表示进度，但是对所有虚拟机检测后
还有解析检测结果的操作，按照上述的进度显示，还没有解析就给前台返回了进度100导致上述问题
改动说明：
 修改VAPI/Cluater.pm中的qcow2_check中API的进度显示，解析结果之前进度只到98等待解析完成进程结束才真正完成
自测：
200.201.136.116 admin/admin123.
选择磁盘扫描，查看前台操作日志，显示完成后查看结束时间不为空（操作真正结束）</msg>
</logentry>
<logentry
   revision="270794">
<author>chendan</author>
<date>2016-09-01T12:48:46.295011Z</date>
<msg>reviewid: 23524
review by hx/zsb
Bug id:  7215
【历史遗留】更新模板的时候要求输入管理员密码
改动说明：
       1.增加密码输入框，需要后台进行校验
       2.将  “但是会导致派生虚拟机系统盘的数据（包括用户自行安装的软件、用户设置和系统磁盘的全部数据）丢失。” 标红</msg>
</logentry>
<logentry
   revision="270778">
<author>chendan</author>
<date>2016-09-01T11:48:17.188003Z</date>
<msg>reviewid: 23537
review by jcy
Bug id:  7079
【回收站】磁盘扩容，在清理异地备份会提示将备份放入回收站中，此处回收站与实际的回收站功能不一致
改动说明：
       1.删除异地备份数据，请扩容磁盘后，尽快重新备份，保障数据安全！
       2.保存异地备份数据一个星期，可在一个星期内联系深信服技术支持进行数据恢复！

     </msg>
</logentry>
<logentry
   revision="270759">
<author>chendan</author>
<date>2016-09-01T09:49:35.759593Z</date>
<msg>reviewid: 23527
review by jcy
Bug id:  7047
【UI】虚拟机页面，部分虚拟机“更多操作”中没有“删除”按钮
改动说明：
       【UI】虚拟机页面，部分虚拟机“更多操作”中没有“删除”按钮

     </msg>
</logentry>
<logentry
   revision="270724">
<author>fxw</author>
<date>2016-09-01T08:09:15.203754Z</date>
<msg>noreview
根据vmp的场景，优化下内存回收时间策略。</msg>
</logentry>
<logentry
   revision="270584">
<author>fxw</author>
<date>2016-08-31T03:08:05.585701Z</date>
<msg>reviewid 23430
bugid 7080
说明 
1.nbd驱动的bug，有一个异常流程在操作nbd-&gt;queue_head队列时没有加锁互斥，出问题的时候，刚好进入这个异常流程引发宕机。
2.此问题之前的版本一直都存在，需要两个特殊流程对nbd-&gt;queue_head队列的操作刚好碰到一起时，才会出现，所以问题出现概率很低。
3.问题具体原因如下：
(1)nbd驱动处理block请求的流程如下：
nbd_ioctl()
|-__nbd_ioctl()
      |-case NBD_DO_IT:
                |-nbd_do_it()
                        |-nbd_read_stat()
                                |-nbd_find_request()
                                        |-spin_lock(&amp;nbd-&gt;queue_lock);
                                        |-list_del_init(&amp;req-&gt;queuelist); #这里对nbd-&gt;queue_head节点的删除操作有锁保护
                                        |-spin_unlock(&amp;nbd-&gt;queue_lock);
(2)当nbd因为网络异常而断开连接时，会进入ioctl NBD_CLEAR_SOCK异常处理流程，代码流程如下：
nbd_ioctl()
|-__nbd_ioctl()
        |-case NBD_CLEAR_SOCK:
                |-nbd_clear_que()
                        |-list_del_init(&amp;req-&gt;queuelist); #这里对nbd-&gt;queue_head节点的删除操作没有锁保护
(3)当上面两个流程并发执行时，由于流程2在操作nbd-&gt;queue_head链表时没有加锁互斥，导致对此链表进行了并发操作，使得req-&gt;queuelist的指针错乱，最后触发断言检查错误。具体流程如下：
nbd_end_request()
|-__blk_end_request_all()
        |-__blk_end_bidi_request()
                |-blk_finish_request()
                        |-BUG_ON(blk_queued_rq(req));                   #这里检查出req的队列指针有问题，就直接宕机
修改：
加锁
测试：
无</msg>
</logentry>
<logentry
   revision="270557">
<author>fxw</author>
<date>2016-08-31T00:53:47.407502Z</date>
<msg>noreview
去掉无用日志</msg>
</logentry>
<logentry
   revision="270453">
<author>dongxia</author>
<date>2016-08-30T06:30:08.535053Z</date>
<msg>reviewid:23364
bugid: 4543
问题分析：
 问题：
   转化为模板过程中，因为预加载个人盘会将个人盘的信息添加到配置中，加载之后再删除配置，
 中间强制退出之后会导致配置中个人盘的信息没有清除，再次操作就会出现问题
 分析：
   预加载个人盘过程中添加配置信息后，需要开启虚拟机再关闭虚拟机完成后才会清除配置中个人盘的信息；
 而开机到关机的过程需要中间等待一段时间，如果这段时间内操作终止就会导致后面回滚配置的操作没有进行
 所以将回滚配置操作提前，在开机完成之后就将虚拟机配置中的个人盘信息清除；
改动说明：
第一次修改：
  1、修改了VTP::QemuDerive::preload_personal_disk 将其中删除配置中个人盘信息的操作提前到虚拟机开启成功之后
  2、修改VTP::QemuDerive::rollback_personal_disk中清理个人盘delete_personal_disk的位置，在虚拟机templateid回滚回vmid
结果：如果强制退出在perload_personal_disk中删除配置操作之前，个人盘信息还是会残留
第二次修改：
  1、不改变perload_personal_disk中删除配置的逻辑，修改rollback_personal_disk，在其中添加上执行删除个人盘配置操作的函数出错就要个人盘和配置信息一块删除
  之后操作，避免因为删除个人盘出错报出异常而导致vmid没有回滚，虚拟机转模板失败但是虚拟机的id是模板id的情况
自测：
  200.200.139.120 admin/sanfor123
  1、虚拟机转化为模板，中间开启虚拟机操作成功后，强制断掉，查看配置，虚拟机类型
  修改前：
  虚拟机配置：
  ide0:xxxx:vm-disk-1.qcow2,cache=directsync,preallocate=off,forecast=enable,cache_size=256,size=1G
  ide1:xxxx:preload_disk.qcow2,cache=directsync,preallocate=off,forecast=enable,cache_size=256,size=1G
  的磁盘信息；
  操作日志：转化模板失败；删除残留的用于预加载的个人数据盘镜像失败！
  再次开机或者更新模板，操作失败
  修改后：
  虚拟机配置：不含preload_disk.qcow2的配置项
  操作日志：转化模板失败；删除残留的用于预加载的个人数据盘镜像失败！
  再次开机或者更新模板，操作成功</msg>
</logentry>
<logentry
   revision="270452">
<author>yangwei</author>
<date>2016-08-30T06:30:07.168667Z</date>
<msg>reviewid 23343
bugid 6858
说明 部署派生虚拟机报错“无效的序列号类型”
修改：
1、使用缓存的序列号要校验数据完整性
2、无效的序列号类型die的时候die出当时的序列号类型
测试：
上库后自动化测试。</msg>
</logentry>
<logentry
   revision="270352">
<author>dongxia</author>
<date>2016-08-29T08:43:49.055084Z</date>
<msg>reviewid: 23301
bugid: 6727

问题分析：添加nvme磁盘的支持
改动说明：
在VTP::Storage::DiskPlugin中
添加get_nvme_disk_status和get_nvme_disk_info函数，处理nvme相关操作
disk_list_parse读取磁盘信息时增加get_nvme_disk_info，读取nvme磁盘的信息
get_disk_state增加对nvme磁盘的处理
自测：
环境vmp4.9 
200.200.101.15 admin/admin123.
1、添加存储，点击发现磁盘，查看本地磁盘中是否有nvme磁盘 ---存在切在线
2、添加nvme存储——添加成功
3、在nvme存储上新建虚拟机——成功
4、备份虚拟机——成功
5、迁移虚拟机——成功</msg>
</logentry>
<logentry
   revision="270306">
<author>fxw</author>
<date>2016-08-29T03:54:06.258664Z</date>
<msg>noreview
需要把RECALIM_INTERVAL_TIME=7200改为RECALIM_INTERVAL_TIME=3600，因为vdi场景下内存的波动比较大，因此需要将回收时间缩短为1小时。 by lifan</msg>
</logentry>
<logentry
   revision="270156">
<author>fxw</author>
<date>2016-08-26T09:57:36.705839Z</date>
<msg>noreview
fsb更新usb重定向库</msg>
</logentry>
<logentry
   revision="270154">
<author>fxw</author>
<date>2016-08-26T09:29:05.591025Z</date>
<msg>noreview
更新zyj提供的qcow2工具，这个是v6版本

changelog：
qcow2-dump更新：

V 0.01: 
    1. L1/L2 table索引表表项unaligned和invalid检查；
    2. refcount table引用计数表表项unaligned和invalid检查；
    3. -o选项支持元数据分开检查: 引用计数表/索引表；
    4. -s选项支持检查指定快照元数据: active|inactive|all|id/name；
    5. 检查统计信息输出，包括：全局统计信息/单项统计信息；
    6. 支持三种输出模式：check/error/dump
       -m check: 只输出结果，镜像是否损坏；
       -m error: 上面的输出 + 如果有错误，出错位置；
       -m dump: dump输出，输出所有元数据及检查结果；
    7. dump模式支持索引表项的flags输出(qcow2_entry_flags): QCOW_OFLAG_COPIED/QCOW_OFLAG_ZERO/QCOW_OFLAG_COMPRESSED；
    8. L2表表项输出时，输出虚拟磁盘的对应偏移(qcow2_vdisk_offset)：vdisk offset；
    9. -d color: 支持以彩色醒目输出；

V 0.02: 
    1. 增加引用计数检查及统计，包括：引用计数错误/引用计数泄漏；

V 0.03: 
    1. usage中给出命令行参数的使用案例；
    2. qcow2镜像检查的结果增加qcow2 file status的类型，全部类型包括：S_FLAG/S_CORRUPT/S_WRONG/S_LEAK/S_GOOD；
    3. 元数据输出优化：只有在二级元数据有输出时, 才输出上一级元数据的信息(qcow2_entry_print)；
    4. 隐藏的小功能：-p选项，支持对未打过快照的qcow2镜像数据分配规律的检查(preallocation: metadata/full分配模式)；
    5. 代码整理，比之前简洁；

V 0.04: 
    1. 引用计数检查增加支持refcount bits特性(从qemu-2.3版本开始支持)；
    2. qcow2 header输出中增加backing file项；

V 0.05: 
    1. 增加检查qcow2镜像分配模式(preallocation: off/metadata/full)的功能；
    2. qcow2 header部分需要注意的输出项彩色醒目输出；

V 0.06: 
    1. 增加引用计数错误/泄漏修复功能(功能不完善：只能修复refcount table表项与L1/L2 table表项不存在unaligned和invalid的情况,
       并且不支持refcount block重建--qemu-2.0及以下版本也不支持refcount block重建)；
    2. 增加检查引用计数与QCOW_OFLAG_COPIED标记是否冲突并修复的功能；
    3. 增加快照回滚功能：主要用于active snapshot的L1/L2表损坏, 而inactive snapshotL1/L2表完好的情况(这种情况下qemu-img不好使，
       因为使用原生qemu-img回滚快照要进行元数据overlap检查, 可能检查通不过，需要修改qemu代码跳过元数据overlap检查)；
    4. 增加设置/清除qcow2头部incompatible_features标志的功能(使用hexedit手动清除qcow2头部corrupt标志, 操作不方便)；
    5. 损坏镜像是否可修复提示；

TODO：
    1. 引用计数错误修复功能增加支持refcount block重建(qemu-2.0及以下版本也不支持refcount block重建)；</msg>
</logentry>
<logentry
   revision="270120">
<author>chendan</author>
<date>2016-08-26T06:36:18.750905Z</date>
<msg>noreview spice接口数据测试，直接在浏览器控制台查看结果
     </msg>
</logentry>
<logentry
   revision="270030">
<author>chendan</author>
<date>2016-08-25T12:40:12.563335Z</date>
<msg>reviewid: 23043
review by lsh
Bug id: 6741
【体验性bug】在新建分组选择虚拟机时，待选择虚拟机列表中虚拟机的图标与实际虚拟机图标不一致
改动说明：
     根据虚拟机状态和logo  id区分不同的图片


     </msg>
</logentry>
<logentry
   revision="269958">
<author>vs</author>
<date>2016-08-25T06:46:27.414402Z</date>
<msg>vs提交tar 13064
noreview</msg>
</logentry>
<logentry
   revision="269899">
<author>dongxia</author>
<date>2016-08-25T01:18:33.498559Z</date>
<msg>reviewid: 23010
bugid: 6726
问题分析：

 合入HCI5.1分阶段自动升级修改 风险控制策略及相关修改

修改记录：
reviewid 21992
Reviewed by: lbc
BUG ID: null
问题分析：将sp包的自动升级数量进行限制，如第1/2/3周分别每天升级10/100/all台（讨论后单位定位集群），并且限制自动升级时间段，如限制为早晨0-8点自动更新，其他时间手动更新。
  方案：1.下载升级包之前本地对服务器发送下载请求，服务器进行该包的升级量和时间点的校验
   2.升级之前本地对服务器发送升级请求，服务器进行升级的校验
改动说明：1.在 95autoupdate.sh 中去掉了无关代码，新增了对升级主机类型的判断
   2.在 update_resource.sh 中
   2.1 在分析下载列表之后，下载升级包前向服务器发送下载请求
   2.2 在下载到升级包之后，进行升级前向服务器发送升级请求；
   2.3 删除了上报信息中对弱密码类型的检测，因为该检测会受环境中的用户数而比较耗时，考虑到在升级中上报的弱密码信息没什么实用价值，并且在大集群环境用户比较多的时候所消耗的时长会影响到程序的运行，所以删掉

reviewid 22284
Reviewed by: jyz
BUG ID: 5978
问题分析：在VMP环境下，获取到的服务器的ip后回加空格进行返回，导致访问由升级服务器ip合成的路径失败，从而造成VMP环境下升级失败
改动说明：修改update_resource.sh中对有服务器ip的合成路径的处理

reviewid 22249
Reviewed by: jyz
BUG ID: 5977
问题分析：单主机进行升级之后，未将存放其升级标记的文件清掉
改动说明：在update_resource.sh中单主机进行升级之后，将存放其升级标记的文件清掉

reviewid 22615
Reviewed by: jyz
BUG ID: 6342
问题分析：离线主机的集群触发自动升级，应该限制不让升级存在离线主机的集群
改动说明：
   在95autoupdate.sh中，增加了集群中主机是否存在离线的节点，若不存在，则终止升级
   在update_resource.sh中，实现了判断集群中是否有离线的节点


reviewid 22751
Reviewed by: lbc
BUG ID: 6102
问题分析：集群环境自动升级名称带括号的补丁失败
改动说明：在update_resource.sh中对右括号的升级包名进行转义


reviewid 22960
Reviewed by: jyz
BUG ID: 6102
问题分析：因为对包名转义之后，在集群环境中，可通过scp将包名下发给集群中各个从节点，而引发了单主机环境下升级的包名变为转义后的名字，导致单主机升级带括号的包名失败
改动说明：在 update_resource.sh 中将对包名的转义放在判断为集群环境的逻辑中进行 

自测：
环境：
4.9.00_B
build 2016-08-15 19:36:23
步骤：
按照《分阶段自动升级原理及测试方法详解.doc》
执行自动升级脚本，查看升级结果是否生效——ok
升级数量限制测试，超过升级数量，升级失败fail : you are limited to download——ok</msg>
</logentry>
<logentry
   revision="269804">
<author>fxw</author>
<date>2016-08-24T06:35:50.999116Z</date>
<msg>noreview
修改版本号到正式发布</msg>
</logentry>
<logentry
   revision="269798">
<author>fxw</author>
<date>2016-08-24T04:55:05.717183Z</date>
<msg>reviewid 22971
bugid 6677
reviewby dongxia
说明：win10虚拟机不会进行时钟补偿，因为没有加hv_time参数
修改：
把win10 64位加到操作系统类型列表，这样就会判断成windows系统加入hv_time
测试：
按照上面的修改进行测试。测试ok</msg>
</logentry>
<logentry
   revision="269737">
<author>chendan</author>
<date>2016-08-23T12:33:41.679826Z</date>
<msg>reviewid: 2208
review by lsh
Bug id: 1140
    【体验需求】【技术支持】【ui】新建分组，选择虚拟机可以提供全选和反选功能(vt 35061)
改动说明：
     很早之前改的一个，没有上库。
     新增加了全选的checkbox
     </msg>
</logentry>
<logentry
   revision="269734">
<author>chendan</author>
<date>2016-08-23T12:29:52.254962Z</date>
<msg>reviewid: 22938
review by lsh
Bug id: 6679
    【win10】创建win10虚拟机的时候，网卡列表只显示8139
改动说明：
     win10系统，做一个disabled属性
     </msg>
</logentry>
<logentry
   revision="269714">
<author>fxw</author>
<date>2016-08-23T11:02:12.577920Z</date>
<msg>reviewid 22925
bugid 6653
reviewby yw
说明：之前加锁是因为perl处理开机流程不完善，4.9优化了开机流程，不会有并发起qemu的问题，这个锁去掉
修改：
屏蔽qemu文件锁
测试：
编译通过</msg>
</logentry>
<logentry
   revision="269686">
<author>fxw</author>
<date>2016-08-23T07:24:12.570883Z</date>
<msg>reviewid 22893
bugid 6653
reviewby yw
说明：qemu锁的变量定义错了，导致退出前没有释放文件锁
修改：
把局部变量声明去掉
测试：
编译通过</msg>
</logentry>
<logentry
   revision="269662">
<author>dongxia</author>
<date>2016-08-23T06:14:04.071786Z</date>
<msg>reviewid: 22881
bugid: 4543
问题分析：
 问题：
   转化为模板过程中，因为预加载个人盘会将个人盘的信息添加到配置中，加载之后再删除配置，
 中间强制退出之后会导致配置中个人盘的信息没有清除，再次操作就会出现问题
 分析：
   预加载个人盘过程中添加配置信息后，需要开启虚拟机再关闭虚拟机完成后才会清除配置中个人盘的信息；
 而开机到关机的过程需要中间等待一段时间，如果这段时间内操作终止就会导致后面回滚配置的操作没有进行
 所以将回滚配置操作提前，在开机完成之后就将虚拟机配置中的个人盘信息清除；
改动说明：
  1、修改了VTP::QemuDerive::preload_personal_disk 将其中删除配置中个人盘信息的操作提前到虚拟机开启成功之后
  2、修改VTP::QemuDerive::rollback_personal_disk中清理个人盘delete_personal_disk的位置，在虚拟机templateid回滚回vmid
  之后操作，避免因为删除个人盘出错报出异常而导致vmid没有回滚，虚拟机转模板失败但是虚拟机的id是模板id的情况
自测：
  200.200.139.120 admin/sanfor123
  1、虚拟机转化为模板，中间开启虚拟机操作成功后，强制断掉，查看配置，虚拟机类型
  修改前：
  虚拟机配置：
  ide0:xxxx:vm-disk-1.qcow2,cache=directsync,preallocate=off,forecast=enable,cache_size=256,size=1G
  ide1:xxxx:preload_disk.qcow2,cache=directsync,preallocate=off,forecast=enable,cache_size=256,size=1G
  的磁盘信息；
  操作日志：转化模板失败；删除残留的用于预加载的个人数据盘镜像失败！
  虚拟机类型：模板虚拟机
  修改后：
  虚拟机配置：不含preload_disk.qcow2的配置项
  操作日志：转化模板失败；删除残留的用于预加载的个人数据盘镜像失败！
  虚拟机类型：普通虚拟机</msg>
</logentry>
<logentry
   revision="269582">
<author>vs</author>
<date>2016-08-22T10:24:55.235543Z</date>
<msg>vs提交tar 13043
noreview</msg>
</logentry>
<logentry
   revision="269576">
<author>lcy</author>
<date>2016-08-22T09:49:20.188091Z</date>
<msg>reviewid: 22845
review by fxw

Merged revision(s) 268408 from VTP/HCI5.1/Alternate/build:
reviewid: 22238
Reviewed by: lifan, jyz
BUG ID: 6058
问题分析：修改集群通信网口时，调用/sf/etc/init.d/fw.sh 存在并发执行的可能，导致iptables规则出现混乱；
引发corosync长时间无法稳定，以致/cfs也跟着无法稳定及使用。

改动说明：
1、将/sf/etc/init.d/fw.sh脚本改为加锁互斥执行。

做了哪些测试：
1、做过并发执行验证测试。
........

</msg>
</logentry>
<logentry
   revision="269279">
<author>fxw</author>
<date>2016-08-19T03:31:31.729052Z</date>
<msg>reviewid: 22672
bugid: 6446
reviewed by zjy,fxw
问题描述：合入BUG


Merged revision(s) 261327 from VTP/aSV4.6/aSV4.6_SDDC/build:

Bug id：2932
问题分析：根据IT部需求对公司自产的超微一体机 进行网卡顺序调整，确保板载网口为eth0及eth1。

改动说明：
1、增加net_rules_comm.sh文件实现超微一体机及其板载网口检测，同时实现70-persistent-net.rules生成逻辑；
2、增加nic_reorder_tool.sh文件 实现网卡顺序是否需要调整检查及生成网卡顺序调整准备文件；
3、修改fix_nic_order.sh文件 合入根据是否需要调整网口顺序，生成70-persistent-net.rules文件以控制网卡初始化；
4、修改sdn.sh的sdn_reset实现 合入根据是否需要调整网口顺序，生成70-persistent-net.rules文件以控制网卡初始化。

测试：超微一体机已执行过测试。
........
Merged revision(s) 267281 from VTP/HCI5.1/Alternate/build:
Revision: 267281
Author: zjy
Date: 2016年7月30日 9:48:49
M

Reviewed by: cys jyz
Bug id：3028
问题分析：目前HCI系统执行加插网卡后，可能会导致网口顺序错乱，以致dp的网口顺序与内核网络配置不一致 引发网络不通问题；
同时拔掉网卡后也会导致网口顺序变动，造成dp的网口顺序与内核网络配置不一致 引发网络不通问题。

改动说明：
1、引入70-persistent-net.rules文件生成逻辑，以控制文件的生成；
2、加插网卡场景，目前改动做法是将新加网口 排在原来网口顺序后面，确保原来的网络不会错乱；
3、拔掉网卡场景，若是空间的网口被拔除，会将后续的网口统一前移；
4、替换网卡场景，若替换进来网卡的网口不足，会将后续网卡前移；超过的部分会被添加到末尾；
5、修改sdn_reset 会卸载及加载目前网卡所使用的网卡驱动，而不仅仅是优化过的驱动。

做了哪些测试：
已做过基本测试，需上库做进一步验证。
----
Modified : /VTP/HCI5.1/Alternate/build/pkg/replace-root/sf/bin/net_rules_comm.sh
Modified : /VTP/HCI5.1/Alternate/build/pkg/replace-root/sf/etc/init.d/sdn.sh
</msg>
</logentry>
<logentry
   revision="269277">
<author>fxw</author>
<date>2016-08-19T03:08:57.468433Z</date>
<msg>noreview
更新文档 </msg>
</logentry>
<logentry
   revision="269262">
<author>yangwei</author>
<date>2016-08-19T01:52:38.255753Z</date>
<msg>reviewid 22645
bugid 6453
reviewby fxw
说明：升级前磁盘检查
修改（需求）：
1、在VMP升级页面添加对虚拟机的磁盘检查步骤；
2、在页面开始检查后，后台即开始对vmp所有的虚拟机磁盘进行检查
3、磁盘检查任务是可取消的
4、根据处理的虚拟机个数进行进度显示，有问题的虚拟机磁盘单独列出在任务描述中
5、如果有虚拟机磁盘检查任务，不允许执行升级。
测试：
按照上面的修改进行测试。测试ok</msg>
</logentry>
<logentry
   revision="269237">
<author>zhangfei</author>
<date>2016-08-18T13:09:33.133067Z</date>
<msg>同步到HCI5.1，此版本是在开源社区2016.2.4的基础上合并了aSV原来的提交，还修正了三个bug。
1. svn:267395 解决windows2012气泡内存不生效问题。
2. svn:268130 优化内存归还，此优化解决了卸载时概率性的蓝屏问题。 这个改动需要后台配合做相应更改。
3. SVN:269208 解决气泡内存在windows2003（r1以前版本）上驱动加载失败的问题。
备注：由于virtio库没有更新，所以现在无法编译通过。</msg>
</logentry>
<logentry
   revision="269233">
<author>dongxia</author>
<date>2016-08-18T12:42:43.089666Z</date>
<msg>reviewid: 22630
bugid: 6390
review by:wzt
问题分析：
   基于VMP4.8.02的改动提供对CCISS的支持，需要将改动合入最新版本
 
改动说明：
   VTP::Storage::get_dev_diskstat增加对cciss类型的处理
   VTP::DiskPlugin::disk_list_parse将磁盘信息转化为配置的信息格式是增加对cciss磁盘的信息获取 get_dev_byid增加对cciss的处理
   添加函数get_cciss_disk_info()获取cciss的信息
   get_disk_state增加扫描cciss磁盘状态
自测：
 未自测</msg>
</logentry>
<logentry
   revision="269231">
<author>fxw</author>
<date>2016-08-18T12:39:18.088371Z</date>
<msg>noreview
更新libredirect2.so by fsb</msg>
</logentry>
<logentry
   revision="269199">
<author>chendan</author>
<date>2016-08-18T09:22:04.136682Z</date>
<msg>reviewid: 22605
review by lsh
Bug id: 
    
改动说明：
     定制，给升级增加一个升级检测
     </msg>
</logentry>
<logentry
   revision="269089">
<author>chendan</author>
<date>2016-08-17T11:59:24.855442Z</date>
<msg>恢复4.9代码</msg>
</logentry>
<logentry
   revision="269019">
<author>fxw</author>
<date>2016-08-17T07:42:33.179885Z</date>
<msg>noreview
更新成正式版的版本号</msg>
</logentry>
<logentry
   revision="269016">
<author>vs</author>
<date>2016-08-17T07:35:39.709733Z</date>
<msg>问题描述： 
	  没加入glusterfs的主机不能删除
BUG   ID: TD1555
问题原因： 
	  前端没有删除主机的代码
改动思路： 
	  合入没加入glusterfs的主机可以删除的代码
做了哪些测试： 
	  1、A主机配置单主机双副本
          2、B主机加入，复用 A的网口，不配置磁盘
	  3、关闭B主机点击删除主机成功
review id 22510, commited by smy, reviewed by yinwei, ygh</msg>
</logentry>
<logentry
   revision="269015">
<author>chendan</author>
<date>2016-08-17T07:32:28.006260Z</date>
<msg>暂时上库，稍后回退</msg>
</logentry>
<logentry
   revision="269013">
<author>fxw</author>
<date>2016-08-17T07:28:42.487018Z</date>
<msg>noreview
将新的perl代码目录加入@INC</msg>
</logentry>
<logentry
   revision="269010">
<author>lcy</author>
<date>2016-08-17T07:14:25.798245Z</date>
<msg>reviewid: 22548
review by fxw
Bug id: 6373
问题分析：TD6373，【合入】合入sfscp工具的修改，可以用相对路径拷贝目录
问题出现的根源：
无
改动说明：
无
自测：
自测通过。
支持 sfscp -r 123 root@ip:/sf/ 类型的拷贝
4.9.00_B
build 2016-08-02 01:30:59</msg>
</logentry>
<logentry
   revision="269008">
<author>ssl</author>
<date>2016-08-17T07:03:01.826871Z</date>
<msg>noreview 去掉编译警告</msg>
</logentry>
<logentry
   revision="269007">
<author>ssl</author>
<date>2016-08-17T06:59:28.522110Z</date>
<msg>noreview 
解决 虚拟化BU-TD2424，频繁切换分辨率后显示不正常的问题
原因： 销毁surface时没有清除服务端渲染的相关设置，导致服务端渲染执行异常
解决办法： 在销毁 surface 时，清楚服务端渲染相关设置；如果出现了异常，也要把异常的设置清楚</msg>
</logentry>
<logentry
   revision="269004">
<author>ssl</author>
<date>2016-08-17T06:53:03.423724Z</date>
<msg>noreview 使用 dos2unix 转换一下文件换行格式</msg>
</logentry>
<logentry
   revision="268987">
<author>yangwei</author>
<date>2016-08-17T03:35:56.686098Z</date>
<msg>reviewid: 22535
bugid 5785
reviewby fxw,lifan
说明 raidstat工具无法识别raid，显示错误。导致前台一直告警。
服务器为hp的DL580G9，raid卡是Smart Array P830i，集成raid卡 。
我们使用的raid卡工具是raidstat。
查看代码发现我们是根据lspci|grep -i "controller:"|grep -i raid命令的结果进行分析的。
VMP4.8.02升级过一次raid卡工具，客户再测试，升级到VMP4.8.02.升级后仍然有问题。
该工具上面命令的输出见下图。Raidstat进一步使用raidcli进行分析。
只有输出信息逻辑处理走到不是3ware且含有Smart时才用hpssacli，而hp客服说的是hpacucli是G7、G8系列才用这个工具。
测试：
在客户环境下使用hpssacli64是ok的</msg>
</logentry>
<logentry
   revision="268977">
<author>vs</author>
<date>2016-08-17T03:03:51.204249Z</date>
<msg>vs提交tar 12870
noreview</msg>
</logentry>
<logentry
   revision="268969">
<author>yangwei</author>
<date>2016-08-17T01:42:46.131024Z</date>
<msg>reviewid 22520
bugid 5852
reviewby fxw,hyq
说明 派生虚拟机开始的编号不对，有重复的
修改 通过vdc派生虚拟机，客户名称中包含有超过4位数字的字符，vdc会将虚拟机的名称改成以客户名结尾的名称。在第二次派生的时候，vmp会计算一个开始的编号来构成派生虚拟机的名称，原来的代码匹配模式有问题，将客户名称里面的数字进行了匹配。新的匹配方式更加严格。
测试：
测试环境
https://200.200.102.59
测试步骤：
1、新建一个虚拟机，名称为杨维test()[].-+1234，名称中含有汉字、特殊字符
2、转换为模板
3、派生2个虚拟机，虚拟机名称为模板虚拟机加后缀0001-0002，ok
4、派生2个虚拟机，虚拟机名称为模板虚拟机加后缀0003-0004，此步骤必须有，因为之前是没有派生虚拟机的，这一步是为了测试特殊字符的匹配，ok
5、删除虚拟机0004
6、派生2个虚拟机，虚拟机名称为模板虚拟机加后缀0004-0005，ok
7、将虚拟机名称，杨维test()[].-+12340004改名称为杨维test()[].-+12340004_0002
8、派生2个虚拟机，生成虚拟机名称为：杨维test()[].-+12340006至杨维test()[].-+12340007，ok
9、虚拟机最大编号为7，将编号为6的改为99，派生2个虚拟机， 生成虚拟机名称为：杨维test()[].-+12340100至杨维test()[].-+12340101，ok
10、使用不同于模板虚拟机的名称为前缀_x.【】[]（）()汉字,派生2个虚拟机，生成虚拟机名称为：_x.【】[]（）()汉字0001至_x.【】[]（）()汉字0002,ok
11、再使用上面的前缀派生两个虚拟机，生成虚拟机名称为：_x.【】[]（）()汉字0003 至 _x.【】[]（）()汉字0004，ok</msg>
</logentry>
<logentry
   revision="268835">
<author>yangwei</author>
<date>2016-08-16T01:18:30.354466Z</date>
<msg>reviewid 21951
bugid null
修改说明：修改代码中的部分日志或者强化代码
修改：
1、cfs_lock_file可以返回代码执行返回的结果
2、check_vmpsn_vm_param使用缓存数据优化
3、告警服务数据类型强制转换
4、cfs_config_path加了一条日志</msg>
</logentry>
<logentry
   revision="268777">
<author>lcy</author>
<date>2016-08-15T09:42:27.474391Z</date>
<msg>reviewid: 22409
review by fxw
Bug id: 3739
问题分析：TD3739,【acenter】acenter打开虚拟机的控制台看不到桌面 【后台继续查看原因】【疑难】
问题出现的根源：
无
改动说明：
Revision: 901
Author: dql
Date: 2015年11月23日 11:43:40
Message:
TD43121 sangfor-waf 合入


Modified : /Alternate/source/daemon/sangfor-waf/src/waf/lite_http_parser.c

自测：
打包验证</msg>
</logentry>
<logentry
   revision="268739">
<author>vs</author>
<date>2016-08-15T08:03:25.223391Z</date>
<msg>vs提交tar  12810
noreview</msg>
</logentry>
<logentry
   revision="268279">
<author>chendan</author>
<date>2016-08-09T07:24:48.053263Z</date>
<msg>reviewid: 22160
review by lsh/zsb
Bug id: 670
    【需求】【VMP】【aSV】【UI】设置自动备份高级设置处，应该增加全选复选框，主机较多时，一个个勾选比较麻烦
改动说明：
     bug[670] 将允许备份那一列用checkSelect插件替换，同时增加datachange事件，加载数据的时候就选中某些项。</msg>
</logentry>
<logentry
   revision="268271">
<author>chendan</author>
<date>2016-08-09T06:36:43.117366Z</date>
<msg>reviewid: 222161
review by zsb
Bug id: 1605
    【合入】【UI】【SDDC快速响应_bate1】任务排序把失败的排到页面最后不好查看 【谢植快20160408】
改动说明：
</msg>
</logentry>
<logentry
   revision="268266">
<author>fxw</author>
<date>2016-08-09T06:23:09.707832Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="268247">
<author>fxw</author>
<date>2016-08-09T03:12:50.884902Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="268240">
<author>fxw</author>
<date>2016-08-09T02:06:06.043177Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="268231">
<author>chendan</author>
<date>2016-08-09T01:18:38.421151Z</date>
<msg>reviewid: 21963
review by lsh
Bug id: 2756
    【虚拟机支持开机编辑】新支持的编辑项，需要告知用户，不是立即生效的；其他的编辑项都是立即生效的【预发布后修改】
改动说明：
    解决此问题有两种方案：1.在用户提交表单的时候，直接对比数据。（否定，因为在新增一些硬件以及删除的硬件的过程中，一些记录数据的变量名称是会改变的）
                  2.根据每个需要对比的配置的动作来记录配置是否有修改</msg>
</logentry>
<logentry
   revision="268229">
<author>chendan</author>
<date>2016-08-09T01:14:10.890871Z</date>
<msg>reviewid: 22023
review by lsh
Bug id: 2846
 【批量修改集群通信口】修改完后，有时会一直显示网络异常【体验性】
改动说明：
    在load  store数据的时候，添加了回调的error事件</msg>
</logentry>
<logentry
   revision="268204">
<author>vs</author>
<date>2016-08-08T12:18:14.434547Z</date>
<msg>更新vs tar
no review</msg>
</logentry>
<logentry
   revision="268059">
<author>fxw</author>
<date>2016-08-08T01:03:20.805857Z</date>
<msg>noreview
更新VDC镜像</msg>
</logentry>
<logentry
   revision="267982">
<author>hyq</author>
<date>2016-08-06T02:43:23.853325Z</date>
<msg>no review
更新vdc镜像</msg>
</logentry>
<logentry
   revision="267897">
<author>chendan</author>
<date>2016-08-05T04:41:17.346189Z</date>
<msg>操作系统去掉“server”选项回滚</msg>
</logentry>
<logentry
   revision="267896">
<author>panchao</author>
<date>2016-08-05T04:40:58.007227Z</date>
<msg>review id: 22031
Bug id: 5067
问题分析: 检测到有Key插入后打一条操作日志，描述信息输出Key-ID
改动说明: 当插入key，增加一个字段，当匹配到此字段时，打一条操作日志
自测: 在主机上插上一个key（acenter除外），观察前台是否有相关的操作日志</msg>
</logentry>
<logentry
   revision="267745">
<author>vs</author>
<date>2016-08-04T02:10:30.305052Z</date>
<msg>更新vs包</msg>
</logentry>
<logentry
   revision="267717">
<author>panchao</author>
<date>2016-08-03T11:32:01.119817Z</date>
<msg>review id: 21929
Bug id: 5067
问题分析: 检测到有Key插入后打一条操作日志，描述信息输出Key-ID
改动说明: 当插入key，增加一个字段，当匹配到此字段时，打一条操作日志
自测: 在主机上插上一个key（acenter除外），观察前台是否有相关的操作日志</msg>
</logentry>
<logentry
   revision="267705">
<author>fxw</author>
<date>2016-08-03T10:02:48.458619Z</date>
<msg>reviewid: 21942
Bug id: 5731
问题分析：需求变化，xp也不默认开启气泡内存
问题出现的根源：
无
改动说明：
只有win7才默认开启气泡内存
自测：
新建xp虚拟机，后台删除配置里的balloon_memory那行，前台在虚拟机详情界面查看内存回收机制是没开启的
新建win7虚拟机，重复以上步骤</msg>
</logentry>
<logentry
   revision="267696">
<author>fxw</author>
<date>2016-08-03T09:37:39.978826Z</date>
<msg>noreview
bugid: 5660
修改说明：新增了win10 64位操作系统类型</msg>
</logentry>
<logentry
   revision="267681">
<author>lcy</author>
<date>2016-08-03T08:45:08.410985Z</date>
<msg>reviewid: 21924
review by fxw
Bug id: 5690
问题分析：TD5690,升级服务器IP更新
问题出现的根源：
无
改动说明：
把即将无效的IP换成有效的IP
最终保留的IP
122.121.46.26.104，113.105.88.58和222.126.229.178（同一台服务器双线IP），202.131.75.82
增加两个域名 www.sinfors.com www.sinfors.com.cn
自测：
无</msg>
</logentry>
<logentry
   revision="267669">
<author>dongxia</author>
<date>2016-08-03T07:52:52.916125Z</date>
<msg>reviewid: 21922
bugid: 5660
问题分析：
  VMP4.9 没有win10 64，只有win10 32 
  UI上增加64位的选项，选了以后当成32位处理
改动说明：
 1、修改QemuServer.pm 系统列表中增加Win1064、Microsoft Windows 10 64;
 2、修改VAPI\Cluster.pm get_cpu_count接口中操作系统列表 增加Win1064
 3、修改 VMInfo.pm 和 VAPI/VDCInterface.pm在处理win10时增加对win1064的同时处理
自测：
VMP4.9
1.新建虚拟机win1064
2.选择操作系统类型 Microsoft Windows10 (64位)————新建成功
3.编辑虚拟机Win1064，显示操作系统Microsoft Windows10 (64位)————ok
4.查看虚拟机详情，显示操作系统 Microsoft Windows10 (64位)————ok</msg>
</logentry>
<logentry
   revision="267668">
<author>chendan</author>
<date>2016-08-03T07:46:25.146736Z</date>
<msg>reviewid: 21886
review by lsh/tsy
Bug id: 5660
 先简单处理，UI上增加64位的选项，选了以后当成32位处理
改动说明：
    [5660] 新建、编辑、查看虚拟机详情，要求增加win10 64位操作系统-----（表面增加win1064，实质新建出来的还是32位系统。）</msg>
</logentry>
<logentry
   revision="267620">
<author>chendan</author>
<date>2016-08-03T02:18:51.987117Z</date>
<msg>reviewid: 21886
review by jcy
Bug id: 5644
【vmp4.9】标准版无key的vmp加入acenter，acenter不授权，vmp侧的序列号页面的提示信息不正确
改动说明：
    添加授权为无时的提示信息</msg>
</logentry>
<logentry
   revision="267514">
<author>hyq</author>
<date>2016-08-02T10:50:07.128989Z</date>
<msg>reviewid : 21658
bug id : 4940
问题描述 : 之前为了测试，把初始化网口信息状态注释了，没有添加回来，会导致dclone(NULL)失败，
改动说明 : 去掉注释</msg>
</logentry>
<logentry
   revision="267494">
<author>fxw</author>
<date>2016-08-02T08:26:54.684597Z</date>
<msg>noreview
加个日志</msg>
</logentry>
<logentry
   revision="267479">
<author>lcy</author>
<date>2016-08-02T06:57:18.291777Z</date>
<msg>reviewid: 21832
Bug id: 5604
问题分析：TD5604,【SDDC稳定包】一款宝德的2U设备，全新安装后配置ip不生效-合入SDDC改动【合入】
问题出现的根源：
无
改动说明：
无
自测：
无</msg>
</logentry>
<logentry
   revision="267474">
<author>hyq</author>
<date>2016-08-02T06:40:27.746210Z</date>
<msg>reviewid : 21830
bug id : 53458
问题描述 : td5458 : 虚拟机迁移代理到从节点执行立即返回没有等待任务完成,函数调用有使用完整包路径，
改动说明 : 去掉多余的打印日志，添加上函数调用包路径，read_task_status 在迁移过程中调用,read_task_log删除文件夹调用（老接口已不再使用）
测试场景 : 新建虚拟机在从节点的本地存储上，迁移虚拟机到共享存储，不迁移运行位置</msg>
</logentry>
<logentry
   revision="267453">
<author>lcy</author>
<date>2016-08-01T10:13:38.089094Z</date>
<msg>reviewid: 21717
review by fxw
Bug id: 5510
问题分析：TD5510,【老功能】集群IP遗留在上一个通信网口没有清掉
问题出现的根源：
特殊场景下，对于集群IP，有可能会遗留在上一个网口没有清除掉
改动说明：
把这两种场景都考虑到
修改VLAN，删除VLAN的时候，不能只靠rem vlan口来实现
因为假如有虚拟交换机在的话，这个操作会跳过的。就有可能导致集群IP残留在上一个网口
自测：
自测通过。
4.9.00_B
build 2016-07-30 01:32:10
1. VMP配置了集群IP，集群通信网口eth0配置了VLAN 200，后台查看，只有一个:0网口
   新建一个虚拟交换机，连接了集群通信口eth0，并且配置了VLAN200
   编辑eth0,把VLAN 200 换成VLAN 100，后台查看只有一个:0网口，并且网口是eth0.100:0
2. VMP配置了集群IP，集群通信网口eth0配置了VLAN 200,后台查看，只有一个:0网口，并且是eth0.200:0
   新建一个虚拟交换机，连接了集群通信口eth0，并且配置了VLAN200
   激活虚拟交换机（把一台主控普通虚拟机连接这个虚拟交换机，并且启动虚拟机即可） 后台有vswid:0 的网口，并且配置了IP
   删除eth0的VLAN 200  后台只有一个eth0:0 网口</msg>
</logentry>
<logentry
   revision="267432">
<author>lcy</author>
<date>2016-08-01T09:05:06.192958Z</date>
<msg>reviewid: 21798
review by fxw
Bug id: 5342
问题分析：TD5342,【升级场景】【批量开机】从vdc批量开机，主机还存在较多可配置内存，vm却开机失败，提示可配置内存为0
问题出现的根源：
VDC开机的时候是并发的单个开机
在判断可配置内存的时候，只要进入到starting状态都会认为是占用了系统的内存，会提前预留。
这就会有一个问题，就是刚好所有的待开机的虚拟机都进入了starting状态，并且刚好都一起去判断剩余可配置内存
结果就一起认为内存不足，导致失败。
改动说明：
vm_start函数里面，针对函数check_memory_permission的调用加一个本地锁限制。
在一台主机内存，每次都只有一个进程进入到计算check_memory_permission
假如开的虚拟机很多，那么前面的虚拟机进入到计算可配置内存的虚拟机都会因为配置内存不足而失败，并且退出starting状态
后面的虚拟机进入计算可配置内存的时候，就可以计算到有内存剩余，就可以开机成功了
本次改动只对普通虚拟机起作用，对于集群虚拟机，starting状态在外层已经设置了，不起作用。集群虚拟机有选主机机制，内存可以充分使用。
自测：
4.9.00_B
build 2016-07-31 01:31:31
自测通过</msg>
</logentry>
<logentry
   revision="267431">
<author>lcy</author>
<date>2016-08-01T08:56:32.936943Z</date>
<msg>reviewid: 21810
review by hyq
Bug id: 2930
问题分析：TD2930,【beta】【开机编辑】存在开机未生效的配置，自动备份功能不能使用
问题出现的根源：
之前针对自动备份做了优化，导致前面的修改失效了，现在重新把错误信息打印到日志里面。
自测：
4.9.00_B
build 2016-07-31 01:31:31
自测通过</msg>
</logentry>
<logentry
   revision="267427">
<author>dongxia</author>
<date>2016-08-01T08:01:57.703144Z</date>
<msg>reviewid: 21801
bugid: 3927
问题原因：
  问题：
   1.派生虚拟机vm1系统盘在存储S1上，个人盘在存储S2上，首次备份vm1到存储S3上
   2.vm1产生增量后，再次备份，检查结果——备份失败,磁盘大小获取失败；希望结果——备份成功
  原因：
   之前没有考虑磁盘异构的情况，导致备份时候使用路径同为虚拟机的存储路径，对于异构的磁盘的路径获取错误而磁盘大小读取失败
改动说明：
  修改QemuBackRecovery.pm 中is_disk_resized函数，在对比备份位置磁盘大小时候的统一获取一次路径的方式，对于每个磁盘都获取一次路径再读取大小
自测：
环境：
VMP4.9
200.200.101.94 admin/admin123.
1.派生虚拟机，设置系统盘在存储101.94_local存储，个人盘在iscsi存储
2.首次备份虚拟机到101.59_local存储上
3.增量备份虚拟机，检查结果
4.修改之前——》备份失败，获取磁盘大小失败；修改之后——》备份成功</msg>
</logentry>
<logentry
   revision="267346">
<author>fxw</author>
<date>2016-07-30T10:15:04.936904Z</date>
<msg>reviewid 21783
bugid 3875
reviewby lcy
问题描述：临时状态机制有bug，导致判断出错
修改：获取临时状态多试几次
测试：部署正常，不会出现Bug描述现象</msg>
</logentry>
<logentry
   revision="267344">
<author>yangwei</author>
<date>2016-07-30T10:10:09.369828Z</date>
<msg>reviewid 21780
bugid 5544
reviewby fxw
修改：恢复出厂设置清除vls配置文件
测试：打包验证</msg>
</logentry>
<logentry
   revision="267318">
<author>fxw</author>
<date>2016-07-30T08:12:39.005205Z</date>
<msg>noreview
去掉调试日志</msg>
</logentry>
<logentry
   revision="267299">
<author>lcy</author>
<date>2016-07-30T05:02:19.358248Z</date>
<msg>reviewid: 19154
review by fxw
Bug id: 1296
问题分析：TD1296,【bug】【技术支持】【兖矿集团----田爽QQ517456756】【VMP4.8.00_B】free -h cached 占用了109G内存，平台内存123G， 导致拷贝数据慢了，只有2MB/S
问题出现的根源：
无
改动说明：
增加一个定时扫描脚本，每5分钟扫描一次，假如发现有scp，sfscp cp进程，那么清理对应的文件的cache
自测：
4.9.00_B
build 2016-07-29 01:31:05
自测通过</msg>
</logentry>
<logentry
   revision="267285">
<author>fxw</author>
<date>2016-07-30T02:21:41.539577Z</date>
<msg>noreview
更新VDC镜像</msg>
</logentry>
<logentry
   revision="267279">
<author>vs</author>
<date>2016-07-30T01:24:08.431241Z</date>
<msg>noreview
更新vs包</msg>
</logentry>
<logentry
   revision="267240">
<author>fxw</author>
<date>2016-07-29T09:32:58.801021Z</date>
<msg>noreview
去掉多余的日志</msg>
</logentry>
<logentry
   revision="267213">
<author>lcy</author>
<date>2016-07-29T07:24:42.297024Z</date>
<msg>reviewid: 21717
review by fxw
Bug id: 5510
问题分析：TD5510,【老功能】集群IP遗留在上一个通信网口没有清掉
问题出现的根源：
特殊场景下，对于集群IP，有可能会遗留在上一个网口没有清除掉
改动说明：
把这两种场景都考虑到
修改VLAN，删除VLAN的时候，不能只靠rem vlan口来实现
因为假如有虚拟交换机在的话，这个操作会跳过的。就有可能导致集群IP残留在上一个网口
自测：
自测通过。
4.9.00_B
build 2016-07-23 01:32:00
1. VMP配置了集群IP，集群通信网口eth0配置了VLAN 200，后台查看，只有一个:0网口
   新建一个虚拟交换机，连接了集群通信口eth0，并且配置了VLAN200
   编辑eth0,把VLAN 200 换成VLAN 100，后台查看只有一个:0网口，并且网口是eth0.100:0
2. VMP配置了集群IP，集群通信网口eth0配置了VLAN 200,后台查看，只有一个:0网口，并且是eth0.200:0
   新建一个虚拟交换机，连接了集群通信口eth0，并且配置了VLAN200
   激活虚拟交换机（把一台主控普通虚拟机连接这个虚拟交换机，并且启动虚拟机即可） 后台有vswid:0 的网口，并且配置了IP
   删除eth0的VLAN 200  后台只有一个eth0:0 网口</msg>
</logentry>
<logentry
   revision="267190">
<author>vs</author>
<date>2016-07-29T04:41:30.094274Z</date>
<msg>提交vs2.2r2最新tar包</msg>
</logentry>
<logentry
   revision="267173">
<author>chendan</author>
<date>2016-07-29T03:02:36.171195Z</date>
<msg>reviewid: 21670
review by lsh
Bug id: 5276
[5276] [vmp4.9]acenter恢复出厂再次接入acenter，会出现2个vmp
改动说明：
    添加一个样式</msg>
</logentry>
<logentry
   revision="267167">
<author>chendan</author>
<date>2016-07-29T02:28:45.550440Z</date>
<msg>reviewid: 21670
review by lsh
Bug id: 5276
[5276] [vmp4.9]acenter恢复出厂再次接入acenter，会出现2个vmp
改动说明：
  在恢复默认配置的时候，如果是acenter环境，给与用户提示，非acenter环境不提示</msg>
</logentry>
<logentry
   revision="267164">
<author>chendan</author>
<date>2016-07-29T02:21:38.168815Z</date>
<msg>reviewid: 21703
review by jcy
Bug id: 4909
回收站提示语
改动说明：
  改成 ‘有部分虚拟机的存留时间大于修改后的保留时间’</msg>
</logentry>
<logentry
   revision="267160">
<author>lcy</author>
<date>2016-07-29T02:07:00.256224Z</date>
<msg>reviewid: 21702
review by fxw
Bug id: 5483
问题分析：TD5483,【虚拟机无法选择运行位置】在VMP控制台为虚拟机指定运行位置，下拉框一直在转圈圈
问题出现的根源：
后台cpu利用率返回了-1，前台不能解释
改动说明：
把后台的CPU利用率返回为string的形式 即"-1" "0.8"
自测：
自测通过。
4.9.00_B
build 2016-07-23 01:32:00
构造CPU利用率为100%
前台新建虚拟机，点击运行位置，不会出现下拉框一直在转圈。F12抓包，可以看到返回的信息为"-1"而不是-1</msg>
</logentry>
<logentry
   revision="267159">
<author>fxw</author>
<date>2016-07-29T02:04:21.630542Z</date>
<msg>reviewid : 21701
bug id : 5246
问题描述 : raid卡正常，但是有告警
问题原因 : 磁盘状态是Ready，不在白名单里面
改动说明 : 把Ready加入白名单
自测：误报的环境修改代码后没有新增告警</msg>
</logentry>
<logentry
   revision="267142">
<author>hyq</author>
<date>2016-07-28T13:35:43.243837Z</date>
<msg>reviewid : 21694
bug id : 5458
问题描述 : td 5458 : 【虚拟机迁移】关机状态虚拟机跨存储不跨主机迁移，很大可能会出现虚拟机迁移的process进度直接为100，但是实际上虚拟机还没有迁移完成的情况
问题原因 : 获取虚拟机状态不对，导致等待迁移任务失败，不再等待，有错误日志，没有抛出异常
改动说明 : 获取任务状态需要判断任务是否在本机，不在本机则代理到远程主机获取</msg>
</logentry>
<logentry
   revision="267129">
<author>qifei</author>
<date>2016-07-28T13:05:53.769530Z</date>
<msg>by wyq.判断是否是一体机。通过vs_sn -f判断是否是一体机。返回结果成功就是，不成功就不是</msg>
</logentry>
<logentry
   revision="267126">
<author>fxw</author>
<date>2016-07-28T12:40:26.793133Z</date>
<msg>reviewid : 21693
bug id : 3528
问题描述 : 默认开启全局备份，提升体验性
改动说明 : 修改备份配置默认值
自测：
后台删除/cfs/backup.ini，到备份管理界面，发现备份是开启的
修改备份策略，保存，备份还是开启的</msg>
</logentry>
<logentry
   revision="267114">
<author>vs</author>
<date>2016-07-28T11:07:08.967681Z</date>
<msg>问题描述： 
	问题描述：当前授权被回收，进行虚拟机开机操作，提示不够合理
BUG   ID: 5387
问题原因： 
	版本更换，提示需要更新
改动思路： 
	特别指出非acenter用户才需要插拔磁盘
做了哪些测试： 
	未测试
review id 21668, commited by ygh, reviewed by lzj</msg>
</logentry>
<logentry
   revision="267097">
<author>yangwei</author>
<date>2016-07-28T09:23:00.087814Z</date>
<msg>reviewid: 21676
bugid: 5199
reviewby: fxw
说明：
开机后登陆前台页面，需要等五分钟才可以进去。
修改：
1、开机就更新序列好的版本信息
2、修改缓存脚本，主从节点都执行更新
3、修改开机脚本的名称
测试：
重启服务器，重启后立即登陆前台，可以正常登陆。</msg>
</logentry>
<logentry
   revision="267093">
<author>vs</author>
<date>2016-07-28T09:12:35.941726Z</date>
<msg>更新VS包
no review</msg>
</logentry>
<logentry
   revision="267069">
<author>chendan</author>
<date>2016-07-28T07:16:04.355301Z</date>
<msg>reviewid: 21653
review by jcy/lsh
Bug id: 4940
合入HCI“网口掉线”告警
改动说明：
  增加 主机网口掉线，测试联调通过</msg>
</logentry>
<logentry
   revision="267053">
<author>chendan</author>
<date>2016-07-28T04:46:09.566466Z</date>
<msg>reviewid: 21640
review by xzk
Bug id: 5405
【vmp4.9】本地存储和外置存储页面的圆饼图显示分成了两行，见附件
改动说明：
  tooltip格式化</msg>
</logentry>
<logentry
   revision="267052">
<author>chendan</author>
<date>2016-07-28T04:42:55.551826Z</date>
<msg>reviewid: 21643
review by xzk
Bug id: 5432
[回收站]清空回收站写错成清除回收站，如附件
改动说明：
   除——&gt;空</msg>
</logentry>
<logentry
   revision="267045">
<author>fxw</author>
<date>2016-07-28T03:40:09.271110Z</date>
<msg>noreview:
bugid: 1296
修改说明：上库开源工具，可用于释放指定文件的cache
自测：自测通过，详见TD备注
</msg>
</logentry>
<logentry
   revision="267013">
<author>hyq</author>
<date>2016-07-28T01:24:28.446993Z</date>
<msg>reviewid : 21524
bug id : 5196
问题描述 : 多个相同拷贝任务同时执行导致失败
改动说明 : 对拷贝任务进行加锁</msg>
</logentry>
<logentry
   revision="267012">
<author>hyq</author>
<date>2016-07-28T01:11:49.786073Z</date>
<msg>reviewid : 21481
bug id : 4940
问题描述 : 合入HCI“网口掉线”告警
改动说明 : 添加 “网口掉线” 告警项和网口上线告警项
测试场景 : 在虚拟vmp环境上测试，
管理通信网口掉线告警，上线恢复
普通网口掉线告警，上线恢复
聚合网口的子网口掉线告警，上线恢复
网口禁用不告警
网口掉线告警只针对物理网口，不针对聚合网口这种逻辑网口</msg>
</logentry>
<logentry
   revision="266988">
<author>vs</author>
<date>2016-07-27T09:59:42.160760Z</date>
<msg>问题描述： 
	[vmp4.9]vmp不支持集群内部分主机进行初始化，所以授权不足时方案二应该禁掉
BUG   ID: 5277
问题原因： 
	版本不同导致需求变化
改动思路： 
	去掉现在不可用的选项
做了哪些测试： 
	未测试，如果需要，我可以找xzk知道下测试
review id 21623, commited by ygh, reviewed by fxw</msg>
</logentry>
<logentry
   revision="266963">
<author>lcy</author>
<date>2016-07-27T06:16:13.237994Z</date>
<msg>reviewid: 21617
review by fxw
Bug id: 5363
问题分析：TD5363,【升级场景】专有模式加密个人盘win7虚拟机（RC7）启动失败，VDI提示不正确
问题出现的根源：
VDC客户端是根据err_code和errmsg判断返回错误信息的，其中err_code返回有点问题
改动说明：
开机过程中，假如可以获取到spice，那么err_code是spice,否则保持为start
开机完成自后，err_code都是spice，无论是否能够获取到spice信息，获取不到，spice_info会有虚拟机的状态
自测：
自测通过。
4.9.00_B
build 2016-07-22 16:05:25
与lys联调通过</msg>
</logentry>
<logentry
   revision="266900">
<author>chendan</author>
<date>2016-07-26T11:59:47.293362Z</date>
<msg>[定义了变量没有使用导致打包不过。删掉重新上库。]</msg>
</logentry>
<logentry
   revision="266815">
<author>fxw</author>
<date>2016-07-26T04:06:52.457042Z</date>
<msg>noreview
bugid: 5321
改动说明：合入HCI 4587.
修改系统时间后，switch_today_log这个脚本会删除当前today目录的日志
自测：
无</msg>
</logentry>
<logentry
   revision="266813">
<author>hyq</author>
<date>2016-07-26T03:47:19.053823Z</date>
<msg>reviewid : 21458
bug id : 5203
问题描述 : td5203 : 后台服务static_arp_cache_add.pl不停重启，日志报错
改动说明 : 修改代码逻辑错误，添加IP冲突告警后改动引发，脚本漏测</msg>
</logentry>
<logentry
   revision="266809">
<author>chendan</author>
<date>2016-07-26T03:38:12.921238Z</date>
<msg>reviewid: 21554
review by lsh/tsy/hx
Bug id: 4639
 2.在对连接虚拟数进行编辑的时候，连接虚拟数编辑的列表 '连接编辑数显示错误'
改动说明：
</msg>
</logentry>
<logentry
   revision="266804">
<author>hyq</author>
<date>2016-07-26T03:17:49.906924Z</date>
<msg>reviewid : 21552
reviewed by : lifan
bug id : 5110
问题描述 : td5110,在E5 26xx v4系列cpu的设备上运行，系统启动就宕机
改动说明 : 用copy_to_user()函数写用户数据，避免宕机风险</msg>
</logentry>
<logentry
   revision="266802">
<author>vs</author>
<date>2016-07-26T03:13:34.436282Z</date>
<msg>更新VS包
no review</msg>
</logentry>
<logentry
   revision="266747">
<author>lcy</author>
<date>2016-07-25T12:04:28.396732Z</date>
<msg>reviewid: 21523
review by fxw
Bug id: 4892
问题分析：TD4892,【连接资源慢】打开资源界面，点击资源连接到打开windows启用界面需要23秒
问题出现的根源：
无
改动说明：
当关机状态下去请求连接的时候，VMP发起请求去开机的时候，就立即去查询spice信息，有信息了，就返回。
因为有可能任务还没有结束，其实上spice信息就可以拿到的。
自测：
自测通过。
4.9.00_B
build 2016-07-22 16:05:25
与lys联调通过，时间得到优化，效果明显。</msg>
</logentry>
<logentry
   revision="266744">
<author>chendan</author>
<date>2016-07-25T11:39:45.173945Z</date>
<msg>reviewid: 21529
review by jcy
Bug id: 2669
【需求】【技术支持】【BBS】“重启后自动还原”功能解释不准确
改动说明：
   还原后将会把非个人磁盘的数据恢复到虚拟机模版的最终状态，包括运行数据与快照信息都将丢失</msg>
</logentry>
<logentry
   revision="266693">
<author>hyq</author>
<date>2016-07-25T07:35:34.545506Z</date>
<msg>noreview
升级新的VDC镜像</msg>
</logentry>
<logentry
   revision="266689">
<author>lcy</author>
<date>2016-07-25T06:28:05.164188Z</date>
<msg>reviewid: 21361
review by hyq
Bug id: 4910
问题分析：TD4910,【HA】批量关闭虚拟机，部分虚拟机又被HA拉起
问题出现的根源：
当调用stopall关闭的虚拟机很多的时候，有些虚拟机会出现关闭超时，调用完kill之后到设置为off之间这段时间有时候会达到几秒
在这段时间，没有stoping的话，vtprgm会检测到虚拟机异常，然后把虚拟机当成异常拉起
改动说明：
在kill到设置为off的这段代码前后加上stoping，HA服务判断到stoping，是不会拉起虚拟机的
因为电源状态和实际状态之间不是原子操作获取，所以可能造成获取的时候存在差异。
所以，在后面实际判断到两者不一致，有异常出现的话，再对比一次。
自测：
自测通过。
4.9.00_B
build 2016-07-23 01:32:00

在八台主机的集群上测试三次，关闭200台虚拟机，没有问题，测试通过。</msg>
</logentry>
<logentry
   revision="266580">
<author>gwl</author>
<date>2016-07-23T07:17:19.299363Z</date>
<msg>reviewid: 21441
bug id: 5186
问题分析：见bug
改动说明：检查主控在线时，仍然从报表获取数据（提升性能），检查主控离线时，跨主机调用脚本获取报表数据。
自测：从hci5.1合入，未自测，代码和hci一致，直接回归测试。</msg>
</logentry>
<logentry
   revision="266532">
<author>hyq</author>
<date>2016-07-22T08:14:04.543000Z</date>
<msg>reviewid : 21399
bug id : 2570
问题描述 : td2570 : 【bug】【BBS】【虚拟机】新建虚拟机，内核数限制，UI与提示框所列数值不一致
改动说明 : 检查虚拟机可配置的虚拟机最大核数用序列号提供的核数，不再检查物理机支持的最大核数</msg>
</logentry>
<logentry
   revision="266529">
<author>qifei</author>
<date>2016-07-22T07:39:39.599227Z</date>
<msg>TD1831 修改cpuinfo信息，加空格显示异常的问题</msg>
</logentry>
<logentry
   revision="266522">
<author>chendan</author>
<date>2016-07-22T07:15:09.910682Z</date>
<msg>reviewid: 21406
review by lsh
Bug id: 5139
【vmp4.9】任务列表改变“对象”列宽的时候，后面的列不动，改变“动作”列宽的时候，后面的列宽动，看着不统一
改动说明：
   调正一下任务列表的宽度。给每一个td都增加了width.体验性会好一些</msg>
</logentry>
<logentry
   revision="266516">
<author>chendan</author>
<date>2016-07-22T06:54:16.466521Z</date>
<msg>reviewid: 21356
review by zsb
Bug id: 4909
【告警】[异常处理]告警配置文件丢失，有几项没有默认值。
改动说明：
   将直接用dom赋值的代码修改为jquery.val() 赋值</msg>
</logentry>
<logentry
   revision="266491">
<author>lcy</author>
<date>2016-07-22T03:15:41.568199Z</date>
<msg>reviewid: 21395
review by fxw
Bug id: 4856
问题分析：TD4856，上海的升级服务器更换了IP了，IP由原来的117.135.133.36改成121.46.26.104
问题出现的根源：
无
改动说明：
无
自测：
无</msg>
</logentry>
<logentry
   revision="266482">
<author>lcy</author>
<date>2016-07-22T02:49:28.274512Z</date>
<msg>reviewid: 21392
review by fxw
Bug id: 5103
问题分析：TD5103,【VMP返回状态缺失】VMP返回状态没有了reset和suspend
问题出现的根源：
当虚拟机正在重启的时候，客户端请求连接，客户端那边需要VMP返回reset状态
改动说明：
接口加上reset状态的返回信息
自测：
自测通过。
4.9.00_B
build 2016-07-21 01:34:34
与lys联调通过
后台直接执行API接口，vtpsh get /VAPIMain/VDCInterface/Getspiceinfo -vmid 3819748801174 可以成功执行</msg>
</logentry>
<logentry
   revision="266480">
<author>yangwei</author>
<date>2016-07-22T02:29:59.882842Z</date>
<msg>reviewid 21393
bugid 4787
reviewby lcy
说明 前台返回序列号版本全局变量
修改：
前台修改序列号更新版本信息；
每五分钟主控更新一次
测试：
返回正确的版本信息。
通过工具修改版本的需要在主控手动执行/sf/bin/vmp_authinfo_update.pl
或者等待五分钟更新数据测试。</msg>
</logentry>
<logentry
   revision="266453">
<author>fxw</author>
<date>2016-07-22T01:33:11.911561Z</date>
<msg>Merged revision(s) 266407 from 
bugid: 
VTP/aSV4.6/aSV4.5_SDDC/src/app/vtp-qemu-kvm/qemu-2.2.1/block/gluster.c:
noreview:5137
问题描述： 
    vs的文件size元数据修改为实时刷新，为减少qemu扩大镜像时的刷元数据次数，参考sffs的做法，每次扩大以128M为单位，保证镜像文件追加写的速度。
BUG   ID: 4846
问题原因： 
    vs的文件size元数据修改为实时刷新，为减少qemu扩大镜像时的刷元数据次数，参考sffs的做法，每次扩大以128M为单位，保证镜像文件追加写的速度。
改动思路： 
    参考sffs的做法，每次扩大以128M为单位
做了哪些测试： 
    zyj编译了二进制qemu文件验证过

###其他版本需要合入
........
</msg>
</logentry>
<logentry
   revision="266446">
<author>fxw</author>
<date>2016-07-22T01:01:27.972904Z</date>
<msg>noreview:
bugid : 4380
修改说明：这个bug SDDC也没有设备和场景验证，而且VMP没有把U盘插到服务器的使用场景，先回滚掉。</msg>
</logentry>
<logentry
   revision="266409">
<author>lcy</author>
<date>2016-07-21T11:54:47.879050Z</date>
<msg>reviewid: 21361
review by fxw
Bug id: 4910
问题分析：TD4910,【HA】批量关闭虚拟机，部分虚拟机又被HA拉起
问题出现的根源：
当调用stopall关闭的虚拟机很多的时候，有些虚拟机会出现关闭超时，调用完kill之后到设置为off之间这段时间有时候会达到几秒
在这段时间，没有stoping的话，vtprgm会检测到虚拟机异常，然后把虚拟机当成异常拉起
改动说明：
在kill到设置为off的这段代码前后加上stoping，HA服务判断到stoping，是不会拉起虚拟机的
自测：
自测通过。
4.9.00_B
build 2016-07-21 01:34:34
通过修改vtpvm脚本，强制构造这种场景 调用完kill之后到设置为off的时间间隔，sleep 60秒
gdb虚拟机进程
调用stopall接口，关闭虚拟机
在以前的版本中，HA服务在关闭虚拟机出现超时之后，一会就检测到虚拟机异常，并且拉起虚拟机
修改过后，HA服务检测到虚拟机在stoping状态，忽略这台虚拟机，不认为是异常状态
在IP最小的节点看log，可以看到这种log。
2016-07-22 01:25:47.585786 info [sfvt_vtprgm] 8555 vtprgm:384 power of vm (2820680923532) is on, temp status of vm (2820680923532) is stoping!</msg>
</logentry>
<logentry
   revision="266404">
<author>chendan</author>
<date>2016-07-21T11:19:09.698075Z</date>
<msg>去掉一个样式</msg>
</logentry>
<logentry
   revision="266402">
<author>chendan</author>
<date>2016-07-21T11:11:22.316794Z</date>
<msg>reviewid: 21356
review by zsb
Bug id: 4909
描述有点问题
改动说明：
   </msg>
</logentry>
<logentry
   revision="266285">
<author>hyq</author>
<date>2016-07-21T07:39:23.945237Z</date>
<msg>reviewid : 21353
reviewed by : lifan
bug id : 5110
问题描述 : 在E5 26xx v4系列cpu的设备上运行，系统启动就宕机。
改动说明 : 在E5 V4 cpu上内核启动宕机。在 fs/exec.c 文件中的generator_hash_key()使用了memcpy()函数来拷贝用户空间的数据，导致宕机。目前修改是：用copy_from_user()函数来替换memcpy()函数。</msg>
</logentry>
<logentry
   revision="266270">
<author>fxw</author>
<date>2016-07-21T06:33:54.867778Z</date>
<msg>noreview
升级新的VDC镜像</msg>
</logentry>
<logentry
   revision="266261">
<author>chendan</author>
<date>2016-07-21T04:00:02.802963Z</date>
<msg>reviewid: 21340
review by lsh
Bug id: 4556
【acenter】【UI】加入acenter，但是使用硬件key的授权，页面描述有问题
改动说明：
   </msg>
</logentry>
<logentry
   revision="266248">
<author>chendan</author>
<date>2016-07-21T03:12:25.919083Z</date>
<msg>reviewid: 21334
review by hjh
Bug id: 3140
VMP整个都有的问题，改变表格大小head被选中，体验性不好
改动说明：
   css 控制不让用户选中</msg>
</logentry>
<logentry
   revision="266245">
<author>lcy</author>
<date>2016-07-21T03:09:14.715252Z</date>
<msg>reviewid: 21337
review by fxw
Bug id: 1296
问题分析：TD1296,【bug】【技术支持】【兖矿集团----田爽QQ517456756】【VMP4.8.00_B】free -h cached 占用了109G内存，平台内存123G， 导致拷贝数据慢了，只有2MB/S
问题出现的根源：
无
改动说明：
注释掉这个脚本，立即退出。先不做处理。
自测：
自测通过。
4.9.00_B
build 2016-07-15 13:34:16
直接执行脚本，exit 0
Sangfor:VMP/host-0cc47a42a1be /sf/etc/cron.d/fiveminly.d # bash -x ./13clear_cache.sh 
+ exit 0</msg>
</logentry>
<logentry
   revision="266242">
<author>chendan</author>
<date>2016-07-21T02:55:39.395313Z</date>
<msg>reviewid: 21324
review by lsh
Bug id: 3734
【UI】虚拟机控制台当没有安装vm_tools的时候，将 提醒去掉【体验性】
改动说明：
去掉   检测到虚拟机未安装虚拟机性能优化工具  这个提示</msg>
</logentry>
<logentry
   revision="266231">
<author>lcy</author>
<date>2016-07-21T01:24:55.163518Z</date>
<msg>reviewid: 21335
review by fxw
Bug id: 3519
问题分析：TD3519,【4.9处理】【发布测试项】修改普通管理员的密码提示，vdc关联的密码需要修改
问题出现的根源：
无
改动说明：
改一个字
自测：
自测通过。</msg>
</logentry>
<logentry
   revision="266226">
<author>fxw</author>
<date>2016-07-21T01:00:02.534047Z</date>
<msg>noreview
bugid: 1601
修改说明：跟HCI的USB映射不一样，不需要合入这个修改，回滚</msg>
</logentry>
<logentry
   revision="266225">
<author>fxw</author>
<date>2016-07-21T00:57:47.519842Z</date>
<msg>noreview
bugid :4390
修改说明：合入HCI的修改无法解决问题，代码回滚</msg>
</logentry>
<logentry
   revision="266191">
<author>hyq</author>
<date>2016-07-20T10:45:59.412912Z</date>
<msg>reviewid : 21319
bug id : 4982
问题描述 : 代码默认返回值缺少
改动说明 : 加上主机内存，cpu，电子邮件存储告警项的默认配置，
        调整代码的各个告警项的顺序与页面一致
        设置虚拟机报表异常告警默认不开启</msg>
</logentry>
<logentry
   revision="266187">
<author>lcy</author>
<date>2016-07-20T10:39:24.858453Z</date>
<msg>reviewid: 21329
review by fxw
Bug id: 4938
问题分析：TD4938,【虚拟机】从VDC批量启动200台虚拟机，结果10台没有启动，也没有日志。
问题出现的根源：
check_running判断虚拟机是否正在运行不严谨，有可能误判。因为其判断到的进程ID是qemu的daemon进程，有可能，执行qemu命令超时后，父进程退出，daemon进程初始化完设备之后，就会向父进程发送一个管道信号，如果父进程提前被杀死，那么daemon进程也会退出，导致一个问题，普通虚拟机启动会显示成功的日志，但是没有起来。集群虚拟机没有日志也没有起来。
改动说明：
启动虚拟机的时候，当出现执行命令失败后，判断虚拟机是否运行的时候，加上电源状态为on的判断。
自测：
自测通过。</msg>
</logentry>
<logentry
   revision="266163">
<author>chendan</author>
<date>2016-07-20T08:49:19.129039Z</date>
<msg>reviewid: 21316
review by jcy
Bug id: 3448
【VMP4.9处理】【优先级低】【vmp】【UI】大显示屏看vmp的ui底部界面很别扭【体验性】
改动说明：
问题1.登录VMP  footer在大屏上悬在屏幕中间  《合入HCI的代码》
问题2： 克隆虚拟机，存储位置的类型稍微 改变 一下在显示在页面</msg>
</logentry>
<logentry
   revision="266123">
<author>chendan</author>
<date>2016-07-20T03:27:46.401989Z</date>
<msg>reviewid: 21286
review by jcy
Bug id: 5011
[UI]vma导入成功，页面布局混乱，如附件[低优先级]
改动说明：
    成功导入，返回的页面信息比较长，table没有使用word-break,所以溢出了。

 
  + 
 
  + word-wrap 和 word-break: word-wrap：break-word不支持 长串英文字符换行，在&lt;p&gt;&lt;div&gt;中，长串单词整体被移到下一行，如果一行不够，单词截断。


 
  +                                                        在table中是没有作用的。
 
  +                          word-break: break-all为了解决长串字符而生，会直接将单词截断。 
</msg>
</logentry>
<logentry
   revision="266035">
<author>vs</author>
<date>2016-07-19T12:13:27.720843Z</date>
<msg>替换旧包</msg>
</logentry>
<logentry
   revision="266011">
<author>chendan</author>
<date>2016-07-19T09:55:09.276590Z</date>
<msg>reviewid: 21278
review by lsh
Bug id: 4926
【部署】部署失败误报存储空间不足。
改动说明：
    1. 在部署模版的时候，diskSubmitList 里面存储的是本模版的一些属性值，删除的这段代码将
‘个人数据磁盘’的预分配比例以及分配方式  重新给了模版的。相当于改变了模版本身的值。
导致submit数据错误，部署失败。
2. 删除 变量me,没有用到了。</msg>
</logentry>
<logentry
   revision="265978">
<author>chendan</author>
<date>2016-07-19T07:10:12.655778Z</date>
<msg>reviewid: 21215
review by lsh
Bug id: 4787
【ui】标准版不支持重要虚拟机选项，不允许勾选
改动说明：
    标准版不支持重要虚拟机选项，不允许勾选 
    后台返回1或者2，1表示标准版，2表示企业版（说是VMP只有这两种状态）</msg>
</logentry>
<logentry
   revision="265962">
<author>chendan</author>
<date>2016-07-19T03:40:55.314693Z</date>
<msg>reviewid: 21204
review by lsh
Bug id: 21220
【acenter】acenter打开虚拟机的控制台看不到桌面  【后台继续查看原因】
改动说明：
    url没有增加pathname字段
修改方法： 通过判断location.pathname中是否包含'cluster-'来替换url</msg>
</logentry>
<logentry
   revision="265960">
<author>lcy</author>
<date>2016-07-19T03:39:36.606948Z</date>
<msg>reviewid: 21254
review by yangwei
Bug id: 4787
问题分析：TD4787,【ui】标准版不支持重要虚拟机选项，不允许勾选
问题出现的根源：
配合UI的修改，后台多返回一个字段
改动说明：
用yw的后台改动上库。modify by yw
自测：
chendan联调通过。</msg>
</logentry>
<logentry
   revision="265885">
<author>lcy</author>
<date>2016-07-18T10:56:49.547505Z</date>
<msg>reviewid: 21238
revie by hyq
Bug id: 4945
问题分析：TD4945,【vt】vdc关机后盒子没有返回到资源界面（vmp返回值问题）
问题出现的根源：
当虚拟机关闭的情况下，spice信息的少了一个normal字段
改动说明：
加上normal字段的默认值
自测：
4.9.00_B
build 2016-07-16 01:35:06
自测通过。</msg>
</logentry>
<logentry
   revision="265831">
<author>fxw</author>
<date>2016-07-18T03:43:40.835610Z</date>
<msg>Merged revision(s) 265726 from VTP/VMP_for_adesk/VMP4.8R1/Trunk:
noreview
bugid：4673
修改说明：关闭读缓存

........
</msg>
</logentry>
<logentry
   revision="265812">
<author>chendan</author>
<date>2016-07-18T02:16:50.558700Z</date>
<msg>[人行三次定制] 先还原注释</msg>
</logentry>
<logentry
   revision="265793">
<author>lcy</author>
<date>2016-07-16T10:08:09.144295Z</date>
<msg>reviewid: 21212
review by fxw
Bug id: 3863
问题分析：TD3863,【优先级低】vmp上的配置生效日志，描述信息需要优化，看不懂【体验性】
问题出现的根源：
描述不太清楚
改动说明：
把描述为改为   更新虚拟机（xxxx）的未生效配置
把动作修改为 更新配置
自测：
4.9.00_B
build 2016-07-15 13:34:16
自测通过。</msg>
</logentry>
<logentry
   revision="265787">
<author>fxw</author>
<date>2016-07-16T08:46:58.290469Z</date>
<msg>reviewid : 21209
bug id : 4801
问题描述 : qemu调用初始化授权服务的接口，有可能会启动授权服务，继承文件锁，一直不释放
改动说明 : 把初始化的接口提前
自测：
虚拟机启动成功</msg>
</logentry>
<logentry
   revision="265786">
<author>dongxia</author>
<date>2016-07-16T08:16:07.322054Z</date>
<msg>reviewid:21207
bugid:4019
问题分析：
  问题：
  1.虚拟机有个人磁盘，且启用了磁盘加密，虚拟机上安装了老版本的agent程序，vdc上是新版本的agent程序
  2.开启虚拟机，让agent自动更新，查看虚拟机运行情况
 期望结果：虚拟机agent更新后重启成功
 实际结果：虚拟机agent更新后，会重启虚拟机，但是虚拟机变成关闭状态
 原因：
   加密个人盘的虚拟机因为第一次没有成功安装使id为ide，之后agent程序更新，重启后id变为virtio
   但是保存的个人盘的密码的id仍为之前的ide导致重启开机时使用新id找不到相对应的passwd，报错个人盘密码缺失 
 改动说明：
   修改QemuServer.pm中的config_to_command函数，对于个人盘密码的获取过程，在开启前hash_pwd不为空的情况下
   如果能够通过id获取密码就继续，如果不能通过id获取密码则先获取目前拥有的密码，之后再在
   VTP::Tools::check_vdisk_passwd中校验密码的正确与否
自测：
  环境VMP4.9.00_B VDI4.9
  100.100.1.43 admin/sangfor123
  非必现：
   1、创建个人盘加密的虚拟机
   2、安装与VDC上版本不同的agent程序
   3、通过VDC控制开机，agent程序自动更新，重启————修改前部分虚拟机存在重启失败，修改后重启成功
  必现：
   1、创建个人盘加密的虚拟机
   2、安装agent程序
   3、通过虚拟机卸载agent程序
   4、重启-----修改之前虚拟机关闭，重启不成功，修改后虚拟机重启成功</msg>
</logentry>
<logentry
   revision="265776">
<author>lcy</author>
<date>2016-07-16T06:17:51.834711Z</date>
<msg>reviewid: 21203
review by fxw
Bug id: 1214
问题分析：TD1214,【5月1号前解决】【南山医院】【VDI4.8】虚拟机重启慢，界面会卡十几秒
问题出现的根源：
界面之所以会卡主10几秒，是因为前一个qemu主线程在等待第一个03restart.pl进程退出
而第一个03restart.pl之所以不退出是因为重置集群虚拟机的时候，第二个03restart.pl没有发送异步管道消息通知第一个退出
导致第一个03restart.pl一直在等待，知道超时
改动说明：
把重置虚拟机的时候open镜像的操作注释掉
自测：
4.9.00_B
build 2016-07-14 01:36:34
自测通过。</msg>
</logentry>
<logentry
   revision="265775">
<author>lcy</author>
<date>2016-07-16T03:51:23.763475Z</date>
<msg>reviewid: 21203
review by fxw
Bug id: 1214
问题分析：TD1214,【5月1号前解决】【南山医院】【VDI4.8】虚拟机重启慢，界面会卡十几秒
问题出现的根源：
界面之所以会卡主10几秒，是因为前一个qemu主线程在等待第一个03restart.pl进程退出
而第一个03restart.pl之所以不退出是因为重置集群虚拟机的时候，第二个03restart.pl没有发送异步管道消息通知第一个退出
导致第一个03restart.pl一直在等待，知道超时
改动说明：
无论是集群还是普通虚拟机，都要发送让第一个03restart.pl退出的信号，加快重置时间。
对比之前的重置速度有了很大的提高，理想情况下，前台界面不会长时间卡主，只会有1到2秒的卡顿。
自测：
4.9.00_B
build 2016-07-14 01:36:34
自测通过。</msg>
</logentry>
<logentry
   revision="265774">
<author>chendan</author>
<date>2016-07-16T03:45:29.402491Z</date>
<msg>reviewid: 21204
review by ...
Bug id: 4639
【虚拟交换机】【UI】点击虚拟机个数切换虚拟交换机的时候列表显示和提交的数据有问题
改动说明：
    如bug【4639】描述，UI少传递一个VLAN ID给后台导致后台把VLAN ID删掉了。
 在做 虚拟连接数 的编辑的时候，增加上VLAN ID 的传递</msg>
</logentry>
<logentry
   revision="265769">
<author>chendan</author>
<date>2016-07-16T03:07:00.405094Z</date>
<msg>reviewid: 21200
review by tsy
Bug id: 4882
【UI】右上角的告警信息，点击读取之后，弹出的框太长，看不完
改动说明：
     给alarm增加一个只属于alarm的样式，固定高度500px，增加滚动条</msg>
</logentry>
<logentry
   revision="265765">
<author>chendan</author>
<date>2016-07-16T02:24:49.532614Z</date>
<msg>
reviewid: 21201
review by tsy
Bug id: 4781
检查前端代码里的URL路径是否规范
改动说明：
    由于url前边多出了一个空格导致aCenter走代理路径走不通
去掉空格，全局搜索总共在3个文件中发现了8处。
关键字分别是： R_ajax.ajax   若干
                    ' /    3
                     url  没有了
</msg>
</logentry>
<logentry
   revision="265764">
<author>chendan</author>
<date>2016-07-16T02:00:10.377125Z</date>
<msg>reviewid: 21200
review by tsy
Bug id: 4882
【UI】右上角的告警信息，点击读取之后，弹出的框太长，看不完
改动说明：
     给alarm增加一个只属于alarm的样式，固定高度500px，增加滚动条</msg>
</logentry>
<logentry
   revision="265751">
<author>vs</author>
<date>2016-07-15T09:17:29.576004Z</date>
<msg>解决：adesk试用版，拿不到试用时间（有可能是过期），没必要报错，影响用户体验</msg>
</logentry>
<logentry
   revision="265749">
<author>chendan</author>
<date>2016-07-15T09:07:09.102457Z</date>
<msg>reviewid: 21192
review by jcy
Bug id: 4885
【回收站】回收站描述信息不准确
改动说明：
     ...</msg>
</logentry>
<logentry
   revision="265744">
<author>chendan</author>
<date>2016-07-15T08:43:25.848887Z</date>
<msg>reviewid: 21188
review by tsy
Bug id: 4620
【ui】集群通信口不允许禁用
改动说明：
     集群通信口和聚合网口一样，不允许禁用</msg>
</logentry>
<logentry
   revision="265743">
<author>chendan</author>
<date>2016-07-15T08:35:16.196112Z</date>
<msg>reviewid: 21169
review by lsh/tsy
Bug id: 4845
【气泡内存】新建win10,xp,VDC虚拟机默认不开启气泡内存
改动说明：
         1. 新建win10,xp,VDC虚拟机默认不开启气泡内存
         2. 操作系统去掉 server选项
         3. 后台没有气泡内存的话，只有win7系统默认是启用的
         4 提示用户win10和XP系统不建议开启气泡内存

去掉正则表达式的括号</msg>
</logentry>
<logentry
   revision="265738">
<author>ssl</author>
<date>2016-07-15T07:32:55.352467Z</date>
<msg>解决bug[2657]放PPT过程中某页流量过高的问题，原因是走了流，但流销毁时会恢复最后一帧，恢复时写死禁止走有损导致，修改方法是允许走有损。测试方法是ecprop 35 1开启图像压缩类型日志，验证原ppt测试页面还有没有quic类型图像</msg>
</logentry>
<logentry
   revision="265737">
<author>fxw</author>
<date>2016-07-15T07:30:35.025129Z</date>
<msg>noreview
解决ls访问sffs目录很慢的问题。
是因为
alias ls='ls -F --color=auto'
上面--color=auto参数导致，加上这个参数后就会对每个目录执行lstat</msg>
</logentry>
<logentry
   revision="265733">
<author>lcy</author>
<date>2016-07-15T07:16:56.778271Z</date>
<msg>reviewid: 21182
review by fxw
Bug id: 4852
问题分析：TD4852,【趋势图】虚拟机总内存趋势图有时候有有时候没有。[非必现]【低优先级】
问题出现的根源：
后台的内存数据中含有小数，返回给前台的数据是小数字符串，导致前台识别不了，绘图不了
改动说明：
把内存数据强制转为int，再返回
自测：
4.9.00_B
build 2016-07-15 01:26:15
自测通过。</msg>
</logentry>
<logentry
   revision="265724">
<author>fxw</author>
<date>2016-07-15T06:31:33.702431Z</date>
<msg>reviewid: 21179
Bug id: 4275
问题分析： 关闭ksm可以提高性能，解决音频杂音的问题
改动说明：
开启气泡内存的时候关闭ksm
如果没有气泡内存的配置，win7默认开启气泡内存，xp，win10，vdc默认关闭
自测:
开启气泡内存，检查qemu启动参数，发现ksm被关闭
关闭气泡内存，检查qemu启动参数，发现ksm被开启
设置成重要虚拟机，检查qemu启动参数，发现ksm关闭</msg>
</logentry>
<logentry
   revision="265715">
<author>lcy</author>
<date>2016-07-15T03:50:26.196086Z</date>
<msg>reviewid: 21173
review by fxw
Bug id: 4860
问题分析：TD4860，【遗留】把虚拟机的报表数据的超时时间导致告警的时间修改为30分钟
问题出现的根源：
无
改动说明：
对比guest机传递的数据和uptime之间相差超过30分钟，就认为有异常
自测:
4.9.00_B
build 2016-07-14 01:36:34
自测通过。</msg>
</logentry>
<logentry
   revision="265710">
<author>chendan</author>
<date>2016-07-15T03:22:40.069733Z</date>
<msg>reviewid: 21169
review by lsh/tsy
Bug id: 4845
【气泡内存】新建win10,xp,VDC虚拟机默认不开启气泡内存
改动说明：
         1. 新建win10,xp,VDC虚拟机默认不开启气泡内存
         2. 操作系统去掉 server选项
         3. 后台没有气泡内存的话，只有win7系统默认是启用的
         4 提示用户win10和XP系统不建议开启气泡内存</msg>
</logentry>
<logentry
   revision="265709">
<author>dongxia</author>
<date>2016-07-15T02:43:30.685088Z</date>
<msg>reviewid:21136
bugid:4387
问题分析：
  存在问题：
  1、主机名均备注()[]{}()[]{}@|.-_ 
  2、12、13、14三台主机，虚拟机win7的vs存储在12/13上，运行14从节点上。从节点14的存储口down掉
 期望结果：从节点vs存储网口down掉，5分钟后HA成功
 实际结果：15分钟后才被拉起，而且操作日志没有具体原因 
改动说明：
修改:replace-root/sf/cluster/sbin/cluvmadm.pm中的cluvm_opera_clvm函数，考虑双引号内部存在双引号的情况添加转义
wuyangyang(吴扬扬) 14:28:29
/usr/bin/ssh -o StrictHostKeyChecking=no root@172.28.102.113 USERNAME='admin@vtp' VTPCLIENTIP='200.200.166.111'   "/sf/bin/vtpvm 5882090732866 start -l 1 -b 1 -m "VM failover: VM node(172.28.102.114()[]{}()[]{}@|._-+) is offline. " -c '1' -t HA"
wuyangyang(吴扬扬) 14:29:00
第一个 命令 后面那几个 双引号 是有问题 的
双引号的转义存在问题
自测：
环境：VMP4.9 
命令执行成功</msg>
</logentry>
<logentry
   revision="265702">
<author>lcy</author>
<date>2016-07-15T01:39:19.724017Z</date>
<msg>reviewid: 21161
review by fxw
Bug id: 4851
问题分析：TD4851，4.9版本adesk上访问开启的虚拟机接入速度比4.8sp慢
问题出现的根源：
4.9相对于4.8用了新的接口连接虚拟机，新的接口的处理方法需要客户端发起两次请求
第一次是发起连接，第二次是发起读取数据。处理逻辑变得复杂，VMP和客户端处理起来都复杂了，导致时间变长
改动说明：
对原有的核心函数进行修改，原来获取spice信息和IP信息分为两次脚本的调用，假如是对端的，需要两次ssh调用
还有，perl脚本调用初始化时间比较长
因此，用一个新的获取数据的接口代替原有的流程，不用ssh代理，直接是转发URL执行，加快获取的时间
自测:
4.9.00_B
build 2016-07-14 01:36:34
与lys联调通过，最后连接的时间与4.8相差无几。</msg>
</logentry>
<logentry
   revision="265701">
<author>panchao</author>
<date>2016-07-15T01:36:33.692206Z</date>
<msg>review id: 21122
Bug id: 4347
问题分析: 每个告警的虚拟机每10分钟打一个告警日志，太频繁
改动说明: 修改虚拟机内存、CPU温度及主机的swap的告警默认值为30分钟
自测: 自测通过</msg>
</logentry>
<logentry
   revision="265700">
<author>dongxia</author>
<date>2016-07-15T01:24:54.626801Z</date>
<msg>reviewid:21158
bugid:4390
问题分析：
   日志分区满了，需要支持开机等操作，目前是直接挂了，虚拟机开不起来。
改动说明：
   合入td3983改动，修改RPCEnvironment.pm  修改日志和异常报出方式，写入active文件失败不报错，不影响流程
自测：
   环境wmp4.9 200.201.136.102
   打满日志分区，然后执行开机操作，替换代码前失败，替换后能开机成功</msg>
</logentry>
<logentry
   revision="265666">
<author>lcy</author>
<date>2016-07-14T11:56:17.190055Z</date>
<msg>reviewid: 21148
review by fxw
Bug id: 4843
问题分析：TD4843,【开机编辑】VDC连接虚拟机的时候会修改虚拟机的名字，需要处理一下这种场景
问题出现的根源：
VDC连接虚拟机的时候会修改虚拟机的name
改动说明：
针对name进行特殊处理，以conf配置为准
自测:
4.9.00_B
build 2016-07-14 01:36:34
自测通过。</msg>
</logentry>
<logentry
   revision="265661">
<author>chendan</author>
<date>2016-07-14T10:47:53.001334Z</date>
<msg>reviewid: 21130
review by hjh/jcy
Bug id: 3140
【优先级低】【UI】【体验】新建虚拟机的时候，存储名字想看全很费劲【体验性】【还没改，弄错了】
改动说明：
         增加resizeable插件</msg>
</logentry>
<logentry
   revision="265654">
<author>fxw</author>
<date>2016-07-14T09:37:45.574336Z</date>
<msg>noreview
增加一个打包时自动更新vs tar包的脚步，没有加执行权限</msg>
</logentry>
<logentry
   revision="265643">
<author>fxw</author>
<date>2016-07-14T08:54:50.600549Z</date>
<msg>noreview
增加一个打包时自动更新vs tar包的脚本</msg>
</logentry>
<logentry
   revision="265634">
<author>yangwei</author>
<date>2016-07-14T07:54:40.824180Z</date>
<msg>reviewid 21124
bugid null
review by lcy
说明：修改函数的my_die使用</msg>
</logentry>
<logentry
   revision="265631">
<author>chendan</author>
<date>2016-07-14T07:35:27.250435Z</date>
<msg>reviewid: 21118
review by lsh
Bug id: 3389
[bug 3067] 【4.9处理】【回收站】【遗留】虚拟机类型排序不了
改动说明：
         虚拟机类型排序，相同类型的虚拟机放在一起</msg>
</logentry>
<logentry
   revision="265602">
<author>chendan</author>
<date>2016-07-14T02:21:45.822228Z</date>
<msg>reviewid: 21105
review by xzk/hjh
Bug id: 3313
[bug 3067] 【bug】【磁盘扩容】扩容同时添加磁盘，有备份虚拟机取消删除备份和快照，已添加磁盘大小变为NaN
改动说明：
          与快哥交流后，得知恢复取消后回滚的只是 “扩容的磁盘”，所以新增加的大小还是原来的数值。 修改方案， ||上一个原有的磁盘大小</msg>
</logentry>
<logentry
   revision="265582">
<author>chendan</author>
<date>2016-07-13T11:55:46.857720Z</date>
<msg>reviewid: 21102
review by lsh,hjh
Bug id: 3067
[bug 3067] 【UI】使用访客登陆虚拟机控制台，无法查看，但是没有提示
改动说明：
          对于访客来说，点击 “控制台”时，给出警告提醒，“没有权限操作”
          修改有两点：1.更多-&gt;详情 页面的控制台
                      2.虚拟机页面的控制台</msg>
</logentry>
<logentry
   revision="265570">
<author>lcy</author>
<date>2016-07-13T10:16:36.531820Z</date>
<msg>reviewid: 21091
review by fxw
Bug id: 1214
问题分析：TD1214,【5月1号前解决】【南山医院】【VDI4.8】虚拟机重启慢，界面会卡十几秒
问题出现的根源：
很多复杂的原因导致的重启速度变慢，现在修改一些导致的变慢的问题
改动说明：
1. 新增一个 /sf/etc/hook.d/kvm/restart.d/目录，提供给虚拟机重启回调
2. /sf/etc/hook.d/kvm/restart.d/ 目前只有一个回调文件 03restart.sh
3. 删除原来/sf/etc/hook.d/kvm/start.d/的 03restart.sh和04md5_check.sh文件
对于03restart.sh实际上是移动到 restart.d目录，
04md5_check.sh是对于快虚的虚拟机有效，目前平台已经没有快虚了，所以保留着也没有用
4. qemu重置回调的时候，不调用stop.d和start.d了，直接调用restart.d，因为stop.d的调用要花掉3秒，实际上什么事情都没有做
5. 默认不开启预加载磁盘元数据的功能，把标记文件修改为preload_qcow2_cache.enable 存在该文件就代表开启，不存在就代表不开启
自测:
4.9.00_B
build 2016-07-13 01:36:11
编译通过。
自测通过。
先优化上面描述的这一些，后面继续优化其他的方面。</msg>
</logentry>
<logentry
   revision="265569">
<author>hyq</author>
<date>2016-07-13T10:15:54.975526Z</date>
<msg>reviewid : 21098
bug id : 4795
问题描述 : td4795: 禁用网口后编辑网口IP，时间较长
改动说明 : 修改等待网口Up状态的时间改为3秒</msg>
</logentry>
<logentry
   revision="265561">
<author>chendan</author>
<date>2016-07-13T09:37:22.651674Z</date>
<msg>[4556] 【acenter】【UI】加入acenter，但是使用硬件key的授权，页面描述有问题</msg>
</logentry>
<logentry
   revision="265559">
<author>hyq</author>
<date>2016-07-13T09:34:40.014059Z</date>
<msg>reviewid : 1086
bug id : 4788
问题描述 : IP冲突告警提示：聚合网口不是用户配置的名称
改动说明 : 传入网口名称而非网口ID,因为聚合网口名称与ID不一致</msg>
</logentry>
<logentry
   revision="265552">
<author>fxw</author>
<date>2016-07-13T09:24:39.059402Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="265545">
<author>hyq</author>
<date>2016-07-13T08:53:58.592658Z</date>
<msg>reviewid : 21070
bug id : 4760
问题描述 : 检查网口IP冲突时过滤集群IP，集群IP做特殊处理,不然会多出一条网口IP冲突告警
测试 : 后台重启告警服务使告警生效 /sf/etc/init.d/vtpalertd restart</msg>
</logentry>
<logentry
   revision="265516">
<author>qifei</author>
<date>2016-07-13T07:47:17.075190Z</date>
<msg>by wyq 获取已经使用的CPU核数。</msg>
</logentry>
<logentry
   revision="265472">
<author>vs</author>
<date>2016-07-13T02:44:37.230767Z</date>
<msg>合入遗漏的代码VMOperate.pm
Revision: 261846
Author: vs
Date: 2016年6月8日 15:30:01
Message:
放开页面对新建删除虚拟机等操作的限制
noview
----
Modified : /VTP/VMP_for_adesk/VMP4.8R1/Trunk/source/app/vtp-manager/VTP/VAPI/VMOperate.pm
Modified : /VTP/VMP_for_adesk/VMP4.8R1/Trunk/source/app/vtp-manager/VTP/VAPI/Clustervm.pm
Modified : /VTP/VMP_for_adesk/VMP4.8R1/Trunk/source/app/vtp-manager/VTP/VAPI/Cluster.pm
Modified : /VTP/VMP_for_adesk/VMP4.8R1/Trunk/source/app/vtp-manager/VTP/VAPI/Restore.pm
Modified : /VTP/VMP_for_adesk/VMP4.8R1/Trunk/source/app/vtp-storage/VTP/VAPI/Storage/Vtpconfig.pm


问题描述： 
	放开VS在VS网络异常的时候，对新建，删除虚拟机等的限制
BUG   ID: null
问题原因： 
	在VS网络异常时，原来做的规避手段
改动思路： 
	放开限制
做了哪些测试： 
	描述做完改动后，做了哪些测试验证
review id 17176, commited by wzl, reviewed by lzj</msg>
</logentry>
<logentry
   revision="265465">
<author>hyq</author>
<date>2016-07-13T01:25:03.559806Z</date>
<msg>Merged revision(s) 262448 from VTP/VMP_for_adesk/VMP4.8R1/Trunk:
no review
bug id : 3709
问题描述 : 从vmp4.6升级上来，序列号过期没告警
改动说明 : 代码中如果检测到配置中没有提前告警时间，则设置为30天
........
</msg>
</logentry>
<logentry
   revision="265455">
<author>vs</author>
<date>2016-07-12T13:42:27.358166Z</date>
<msg>手动合入 
hci asv4.5sddc revision(258307)
问题原因： 
	两种不同的编码导致页面显示乱码
改动思路： 
	都改成utf-8
做了哪些测试： 
	再pyb环境测试通过

pyb再提个bug到时候再代码审查其他地方
reviewid 18345, commited by gexy, reviewed by wugeng</msg>
</logentry>
<logentry
   revision="265453">
<author>dongxia</author>
<date>2016-07-12T13:25:44.352870Z</date>
<msg>reviewid: 21050
bugid: 4931
问题分析：
 存在问题：1.使用非admin的管理员登录，然后克隆一台虚拟机，勾选上克隆后虚拟机自动启动 
 【期望结果】
1.克隆成功之后，虚拟机能够启动成功
【实际结果】
1.克隆之后，虚拟机没有启动，为关机状态；

改动说明：
不用加skiplock 非root用户无权限
另外克隆操作过程中并未对克隆出来的vm加锁，
只锁了虚拟机名称，开机时加锁没问题

自测：
环境：vmp4.9
200.200.101.94 tt/admin123. -----&gt;非admin的管理员账号
1、选择虚拟机克隆操作
2、勾选克隆完成后自动启动
3、查看执行结果--------&gt;替换前克隆完毕不启动，替换代码之后克隆完成克隆出的虚拟机自动启动</msg>
</logentry>
<logentry
   revision="265452">
<author>hyq</author>
<date>2016-07-12T13:13:00.824857Z</date>
<msg>no review
合入代码有冲突，覆盖了原来的代码</msg>
</logentry>
<logentry
   revision="265450">
<author>lcy</author>
<date>2016-07-12T13:05:23.593388Z</date>
<msg>reviewid: 21053
review by fxw
Bug id: 3403
问题分析：TD3403, VMP环境 新建一个1024G的虚拟磁盘（预分配）失败
问题出现的根源：
在处理磁盘 disk size的时候。没有考虑单位为T的情况
改动说明：
加上单位T的处理
自测:
4.8.02
build 2016-07-12 10:39:45
编译通过。
自测通过。</msg>
</logentry>
<logentry
   revision="265449">
<author>hyq</author>
<date>2016-07-12T13:00:26.315984Z</date>
<msg>reviewid : 19593
bug id : 3024,3044
问题描述 : td3024,3044 批量设置管理通信网口没检查IP冲突问题，与vdc IP冲突没告警问题
改动说明 : 

1）修复聚合口删除后，配置冲突IP在该聚合口后检测失效的bug

2）所有配置IP的检测放在配置生效前，包括创建、编辑聚合网口，编辑普通物理网口，编辑集群IP

3）过滤掉没有配置IP的网口的告警检测

4）修复批量配置管理通信网口没有IP冲突检测的问题，这是通过第2点做到</msg>
</logentry>
<logentry
   revision="265444">
<author>vs</author>
<date>2016-07-12T12:37:10.261783Z</date>
<msg>Merged revision(s) 262427 from VTP/aSV4.6/VMP4.7:
说明：新需求，write-cache 不关闭off
问题描述： 
	VMP4.8 有些缓存是人工开启的，升级后需要保证这些缓存仍然是开启可用的。
BUG   ID: 2545
问题原因： 
	需求
改动思路： 
&lt;1&gt;vs1.0  或vs1.1  或vs1.2    重启前不作任何操作，重启后将raw格式转为lvm格式（其他地方保证格式转换）
&lt;2&gt;vs2.1.0或vs2.1.1或vs2.2.1  重启前，如果wcache.json为空，且wcc-enable是on，则off掉wcc-enable和write-cache；如果wcache.json不为空，则不作任何操作；重启后，不作任何操作
&lt;3&gt;vs2.2.2                    重启前，不作任何操作；重启后，不作任何操作
做了哪些测试： 
	模拟vs版本为1.0/1.1/1.2或.1.0/2.1.1/2.2.1/2.2.2等进行测试

review id: 19711 review by lzj
........</msg>
</logentry>
<logentry
   revision="265440">
<author>hyq</author>
<date>2016-07-12T12:21:47.090623Z</date>
<msg>no review
合入代码有冲突</msg>
</logentry>
<logentry
   revision="265438">
<author>vs</author>
<date>2016-07-12T12:17:21.708902Z</date>
<msg>回退代码，感觉有坑
Merged revision(s) 265432 from VTP/VMP_for_adesk/VMP4.9/Trunk:
Merged revision(s) 261490 from VTP/VMP_for_adesk/VMP4.8R1/Trunk:
Merged revision(s) 254042 from VTP/aSV4.6/VMP4.7:
问题描述： 
        【功能异常】【adesk】[48大集群]多台主机添加到vs时，提示虚拟存储网络配置失败（非必现）[确认]
BUG   ID: 684
问题原因： 
        ip冲突检测串行执行，过于耗时，48台需要3min左右
改动思路： 
        并发执行
做了哪些测试： 
        1，大集群待验证时间。
    2，设置冲突ip,正常告警提示
review id 16864, commited by ljf, reviewed by gwl
........

........

........
</msg>
</logentry>
<logentry
   revision="265432">
<author>vs</author>
<date>2016-07-12T11:44:03.111989Z</date>
<msg>Merged revision(s) 261490 from VTP/VMP_for_adesk/VMP4.8R1/Trunk:
Merged revision(s) 254042 from VTP/aSV4.6/VMP4.7:
问题描述： 
        【功能异常】【adesk】[48大集群]多台主机添加到vs时，提示虚拟存储网络配置失败（非必现）[确认]
BUG   ID: 684
问题原因： 
        ip冲突检测串行执行，过于耗时，48台需要3min左右
改动思路： 
        并发执行
做了哪些测试： 
        1，大集群待验证时间。
    2，设置冲突ip,正常告警提示
review id 16864, commited by ljf, reviewed by gwl
........

........
</msg>
</logentry>
<logentry
   revision="265424">
<author>lcy</author>
<date>2016-07-12T11:26:51.642409Z</date>
<msg>reviewid: 21041
review by fxw
Bug id: 4720
问题分析：TD4720,【批量修改集群通信口】仅设置通信口的掩码，报错有问题
问题出现的根源：
Tools.pm不能直接用my_die,需要加上包名
VTP::Exception::my_die
改动说明：
加上包名VTP::Exception::my_die
自测:
4.9.00_B
build 2016-07-12 01:36:05
自测通过。</msg>
</logentry>
<logentry
   revision="265421">
<author>dongxia</author>
<date>2016-07-12T11:12:29.516869Z</date>
<msg>reviewid:21012
bugid:2689
问题分析：
   问题：1.从vdc控制台选择5台虚拟机，点击删除。2.在vmp上查看虚拟机是否删除成功
   期望：虚拟机删除成功
   实际：虚拟机删除失败 
   原因分析：
   这台删除的虚拟机是先操作了删除，再操作的关闭虚拟机，因为获取关闭虚拟机upid失败，vdc此时又立刻发送一个删除请求
   而vmp不能保证先发的请求先执行。
改动说明：
vmp提供一个直接删除虚拟机的接口，在VMOperate.pm中的destroy_vm删除虚拟机接口中，添加一个参数forcedel，默认值为0，可选。
当设置为1时将执行强行删除
当有虚拟机删除时处于开机状态时，如果设置了此值将会先关闭电源再执行删除操作 
1、可以保证整个操作的流程不因网络和任务调度问题失败
2、减少VDC向vmp发请求数量，提升删除虚拟机的速度
自测：
环境：VMP4.9 200.200.72.16 admin/sangfor123
1、开启虚拟机
2、调用删除接口，设置forcedel为1，查看删除结果----------&gt;会自动执行关门电源再删除
3、调用删除接口，设置forcedel为0/或默认。查看删除结果---------&gt;删除失败，虚拟机当前状态不允许删除</msg>
</logentry>
<logentry
   revision="265420">
<author>hyq</author>
<date>2016-07-12T11:08:01.432917Z</date>
<msg>no review
忽略参数tpl_node,该参数在加载配置后从配置获取</msg>
</logentry>
<logentry
   revision="265411">
<author>hyq</author>
<date>2016-07-12T10:49:52.243454Z</date>
<msg>reviewid : 18330
bugid : 2517
问题描述 : td2517 : vds一体机，接上键盘，按键control+alt_delete，主机重启</msg>
</logentry>
<logentry
   revision="265398">
<author>hyq</author>
<date>2016-07-12T08:57:22.996829Z</date>
<msg>no review
自动备份脚本移动到5分钟执行一次目录
相关改动记录在
svn://200.200.0.10/vt/vt/VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk/build/pkg/replace-root/sf/etc/cron.d/fiveminly.d/16auto_vm_backup
</msg>
</logentry>
<logentry
   revision="265397">
<author>hyq</author>
<date>2016-07-12T08:54:12.934087Z</date>
<msg>Merged revision(s) 265167-265343 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
no review
【富士康-2016052301】自动备份过程中冒出手动备份的报错。如附件
........
no review
编辑策略加锁
........
no review
取消执行备份策略成功，误判为失败。
........
no review
bugid:3888
问题分析：QemuBackRecovery.pm中的check_image_valid检查磁盘是否完整的时候
使用qemu-img时为了避免208错误，没有使用修复选项-r leaks，导致如果磁盘
只是因为leaks的原因也会报错为磁盘损坏
改动说明：修改了QemuBackRecovery.pm中的check_image_valid函数，对于使用qemu-img check 后因为是leaks返回的错误码3进行屏蔽
........
no review
bugid:3888
改动说明：使用run_command中之前的参数ignore_exit_code设置返回值为3时忽略报错


........
Revision: 264967
Author: fxw
Date: 2016年7月8日 16:22:34
Message:
noreview
bugid: 4548
说明：执行可靠性断电故障后，出现LBA问题
修改说明：预分配磁盘前1M数据清零，改成实际写入1M的0数据，不用置零标志
预分配/动态分配置了zero，表示L2指向的一簇数据未分配，会导致重新分配。
自测：
创建一台虚拟机，两块盘，一个预分配，一个预分配置零。
检查日志，发现没有COPIED ZERO的日志

----
Modified : /VTP/VMP_for_adesk/VMP4.8R1/Trunk/source/app/vtp-common/Tools.pm

Revision: 265291
Author: dongxia
Date: 2016年7月12日 10:06:45
Message:
no review
bugid:3888
改动说明：使用run_command中之前的参数ignore_exit_code设置返回值为3时忽略报错


----
Modified : /VTP/VMP_for_adesk/VMP4.8R1/Trunk/source/app/vtp-qemu-server/VTP/QemuBackRecovery.pm


........
</msg>
</logentry>
<logentry
   revision="265396">
<author>hyq</author>
<date>2016-07-12T08:53:01.464223Z</date>
<msg>Merged revision(s) 265044-265054 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
noreview: 
BUG ID: 4487
问题分析:
备份日志里的取消 执行备份策略，不生效。

改动说明：
备份日志里的取消 执行备份策略，不生效。

做了哪些测试：
jshint ok
自测 ok
........
noreview: 
BUG ID: 4487
问题分析:
备份日志里的取消 执行备份策略，不生效。

改动说明：
备份日志里的取消 执行备份策略，不生效。

做了哪些测试：
jshint ok
自测 ok
........
noreview: 
BUG ID: 4535
问题分析:
bug4535，问题1，去掉新增备份策略窗口的提示

改动说明：
bug4535，问题1，去掉新增备份策略窗口的提示

做了哪些测试：
jshint ok
自测 ok
........
noreview: 
BUG ID: 4535
问题分析:
bug4535，问题3，执行备份策略，失败虚拟机较多时，需有滚动条

改动说明：
bug4535，问题3，执行备份策略，失败虚拟机较多时，需有滚动条

做了哪些测试：
jshint ok
自测 ok
........
noreview: 
BUG ID: 4493
问题分析:
bug4493，备份日志页面，高级搜索功能未实现 

改动说明：
bug4493，备份日志页面，高级搜索功能未实现 

做了哪些测试：
jshint ok
自测 ok
........
</msg>
</logentry>
<logentry
   revision="265394">
<author>hyq</author>
<date>2016-07-12T08:51:44.997514Z</date>
<msg>Merged revision(s) 264034 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
no review
提示有问题，去掉退出码提示
........
</msg>
</logentry>
<logentry
   revision="265393">
<author>hyq</author>
<date>2016-07-12T08:49:55.836555Z</date>
<msg>Merged revision(s) 263952 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
no review
修复由同一个模板派生的虚拟机同时备份，后面的派生虚拟机备份失败的问题
........
</msg>
</logentry>
<logentry
   revision="265388">
<author>hyq</author>
<date>2016-07-12T08:43:39.257293Z</date>
<msg>Merged revision(s) 263889 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
noreview
BUG ID: 4184
问题描述：
【富士康-2016052301】预估备份时间时，/cfs/storage_speed中字段的值为负数时，重置为默认值5M/s进行估算[增强容错-低优先级]
改动说明：
从配置文件中读出来的数据，进行一次简单的校验，判断速度是否大于0


........
</msg>
</logentry>
<logentry
   revision="265387">
<author>hyq</author>
<date>2016-07-12T08:43:07.495765Z</date>
<msg>Merged revision(s) 263876 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
no review
提示有问题，2个改为4个
........
</msg>
</logentry>
<logentry
   revision="265386">
<author>hyq</author>
<date>2016-07-12T08:42:07.091891Z</date>
<msg>Merged revision(s) 263799 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
noreview
描述文件去掉注意两个字
........
</msg>
</logentry>
<logentry
   revision="265385">
<author>hyq</author>
<date>2016-07-12T08:41:04.524491Z</date>
<msg>Merged revision(s) 263646, 263668 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
集群虚拟机备份api不支持background参数，

........
no review
存储锁放开到4个
........
</msg>
</logentry>
<logentry
   revision="265384">
<author>hyq</author>
<date>2016-07-12T08:39:31.811000Z</date>
<msg>Merged revision(s) 263566-263591 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
noreview
描述漏了几个字
........
noreview
bugid: 4082
Merged revision(s) 263565 from VTP/VMP_for_adesk/VMP4.9/Trunk:
reviewid: 20363
review by htq
Bug id: 4059
问题分析：UI传过来的账号密码是加密的，但是后台没有解密。34200 vmp合入sddc引发的bug，sddc在34620,34750 又修改好了，这个没有合入。
改动说明：
合入34620,34750
自测：
暂时没有4.9的环境，改动较简单，上库后测试
........

........
更新vs包
noreview
........
noreview
调试工具更新到0.03版
........
noreview
多了一个%号，清掉告警
........
noreview
svn 的自动merge漏了两行没合
bugid：750
说明：客户主机502天没有关机了， 所以我们的任务启动时间都是很长的了。超过了我们16进制的时间长度。 
改动：合入TD750 里面记录的asv的修改 
测试：待打包测试
........
noreview
bugid：750
说明：客户主机502天没有关机了， 所以我们的任务启动时间都是很长的了。超过了我们16进制的时间长度。 
改动：合入出错，多改了一个8
测试：待打包测试


........
noreview: 
BUG ID: null
问题分析:
改动说明：
编辑备份策略时，预估时间时需要把策略id下发

做了哪些测试：

........
noreview
编辑时候UI需要把policyid传递到后台
后台针对policyid进行特殊处理，检查是否有相同时间的备份的时候，才不会有问题
........
</msg>
</logentry>
<logentry
   revision="265383">
<author>hyq</author>
<date>2016-07-12T08:38:12.205220Z</date>
<msg>Merged revision(s) 263549 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
noreview
1. 备份时间预测的修改点
把数据机的总的备份数据量修改一下，改为2G+增加的天数*0.2G
2. API增加一个对已有的备份策略的检查，发现存在同一时间备份的，在前台给出提示
........
</msg>
</logentry>
<logentry
   revision="265382">
<author>hyq</author>
<date>2016-07-12T08:37:34.643651Z</date>
<msg>Merged revision(s) 263545 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
noreview
后台返回的提示信息字段是warning
UI修改一下字段的名字
........
</msg>
</logentry>
<logentry
   revision="265381">
<author>hyq</author>
<date>2016-07-12T08:36:56.178901Z</date>
<msg>Merged revision(s) 263531 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
noreview: 
BUG ID: null
问题分析:
改动说明：
添加备份策略时，默认不选择哪天备份。

做了哪些测试：

........
</msg>
</logentry>
<logentry
   revision="265380">
<author>hyq</author>
<date>2016-07-12T08:36:16.897665Z</date>
<msg>Merged revision(s) 263527 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
noreview: 
BUG ID: null
问题分析:
改动说明：
添加备份策略时，检查用户配置的备份持续时间，下发参数加上starttime，并且后台有额外信息返回时需要显示。

做了哪些测试：

........
</msg>
</logentry>
<logentry
   revision="265379">
<author>lcy</author>
<date>2016-07-12T08:35:32.506075Z</date>
<msg>reviewid: 21028
review by fxw
Bug id: 4712
问题分析：TD4712,【回收站】【优化】重复还原虚拟机，失败的日志会有一个字段丢失,处理一下
问题出现的根源：
重复还原的时候，读取不到回收站虚拟机的配置信息，后面没有判断配置是否为空，
导致发现没有主机可以访问这个虚拟机，打印日志那个对象会为空
改动说明：
1. 判断配置是否为空，如果为空，直接die
自测:
4.9.00_B
build 2016-07-12 01:36:05
自测通过。</msg>
</logentry>
<logentry
   revision="265377">
<author>hyq</author>
<date>2016-07-12T08:30:51.481480Z</date>
<msg>Merged revision(s) 263407 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
no review
放开主机IO队列到4个
........
</msg>
</logentry>
<logentry
   revision="265376">
<author>hyq</author>
<date>2016-07-12T08:28:31.087444Z</date>
<msg>Merged revision(s) 263404 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
no review
执行备份策略可取消
........
</msg>
</logentry>
<logentry
   revision="265363">
<author>hyq</author>
<date>2016-07-12T07:57:08.861812Z</date>
<msg>Merged revision(s) 263366 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
noreview
前台传递的name参数没有用的，所以API把name参数去掉
........
</msg>
</logentry>
<logentry
   revision="265362">
<author>hyq</author>
<date>2016-07-12T07:56:17.843997Z</date>
<msg>Merged revision(s) 263365 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
noreview: 
BUG ID: null
问题分析:
改动说明：
添加备份策略时，检查用户配置的备份持续时间是否足够，并给出提示

做了哪些测试：

........
</msg>
</logentry>
<logentry
   revision="265361">
<author>hyq</author>
<date>2016-07-12T07:55:31.470447Z</date>
<msg>Merged revision(s) 263360 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
noreview
备份时间预测，与UI协调好返回的数据形式，修改一下
把英文的错误信息写到翻译文件中
........
</msg>
</logentry>
<logentry
   revision="265360">
<author>hyq</author>
<date>2016-07-12T07:54:26.329648Z</date>
<msg>Merged revision(s) 263349 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
noreview
UI代码，报表服务可以显示一周和一个月的
........
</msg>
</logentry>
<logentry
   revision="265358">
<author>hyq</author>
<date>2016-07-12T07:53:26.666100Z</date>
<msg>Merged revision(s) 263348 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
noreview
修改：
1.报表服务显示一周，一个月
2.序列号放开限制为系统硬件的信息 （这一点不合入）
3.给备份策略预估备份所需的时间
........
</msg>
</logentry>
<logentry
   revision="265357">
<author>fxw</author>
<date>2016-07-12T07:51:38.185671Z</date>
<msg>noreview
脚本的单词拼错了</msg>
</logentry>
<logentry
   revision="265356">
<author>yangwei</author>
<date>2016-07-12T07:50:09.696710Z</date>
<msg>reviewid 21009
bugid 4115
reviewby fxw
说明：
使用lock_file如果锁文件是不是/tmp/host，函数失败了也不会die
修改：
根据原来的函数模板生成一个会die的函数。</msg>
</logentry>
<logentry
   revision="265355">
<author>fxw</author>
<date>2016-07-12T07:49:18.387570Z</date>
<msg>Merged revision(s) 264157-264528 from VTP/VMP_for_adesk/VMP4.8R1/Trunk:
noreview
bug id: null
问题分析：[回收站]增加修改保留时间功能
改动说明：[回收站]增加修改保留时间功能

做过哪些测试：
jshint 通过
已自测


........
noreview
问题描述：
回收站天数可以编辑的后台代码
已找fxw过了一遍代码
改动说明：
1. 配置天数放在 /cfs/system_config.ini中
2. API接口在Cluster.pm中
3. 假如读取失败或者其他原因造成的，默认会返回365天
后面还需要写一个升级脚本，创建一个默认的/cfs/system_config.ini文件
........
noreview
问题描述：
界面上删除虚拟机的时候的弹框需要和实际清除回收站的天数对应
改动说明：
从后台把信息拿回来，然后填充到界面上
........
noreview
问题描述：
【需求】回收站的自动清理时间可以编辑
改动说明：
创建一个默认的文件，提供升级用，默认的天数是30天
测试：
需要打包验证，用低版本升级到高版本会自动创建这个文件
........
</msg>
</logentry>
<logentry
   revision="265347">
<author>fxw</author>
<date>2016-07-12T07:32:27.179073Z</date>
<msg>noreview
上次加的调试日志是个半成品，现在补全</msg>
</logentry>
<logentry
   revision="265345">
<author>fxw</author>
<date>2016-07-12T07:23:02.255605Z</date>
<msg>noreview
加个调试日志</msg>
</logentry>
<logentry
   revision="265300">
<author>hyq</author>
<date>2016-07-12T03:22:49.463154Z</date>
<msg>Merged revision(s) 263342 from VTP/custom/VMP_for_adesk/VMP4.8.02/custom-foxconn-backup-report-20160624/trunk:
noreview: 
BUG ID: null
问题分析:
改动说明：
上库tyy的改动，加了备份日志的功能

做了哪些测试：

........
</msg>
</logentry>
<logentry
   revision="265296">
<author>panchao</author>
<date>2016-07-12T02:42:56.937594Z</date>
<msg>review id: 21004
Bug id: 4672
问题分析: 新建虚拟机失败！错误信息：Undefined subroutine &amp;VTP::QemuDerive::Dumper
改动说明: 由于忘记加use Data::Dumper所导致的；
自测: 自测通过，写了一个小脚本，先不添加use Data::Dumper，报了同样的错误，添加之后，正常。</msg>
</logentry>
<logentry
   revision="265287">
<author>panchao</author>
<date>2016-07-12T01:30:40.358526Z</date>
<msg>review id: 20996
Bug id: 4379
问题分析: 编辑虚拟机删除磁盘时，磁盘是备份。提示不正确
改动说明: 现提示为快照，改为备份；
自测:</msg>
</logentry>
<logentry
   revision="265272">
<author>fxw</author>
<date>2016-07-11T13:17:10.655211Z</date>
<msg>noreview
bugid: 4382
问题分析：
因为通过qemu_set_fd_handler(vs-&gt;csock, vnc_client_read, vnc_client_write, vs); 函数注册的vnc读写，在读错误的时候，会vnc_client_read-&gt;vnc_client_error-&gt;vnc_disconnect_start-&gt;设置vs-&gt;csock = -1
这个读写是在主线程上下文做的。这里就涉及到线程同步问题，当前CORE是在VCPU线程上下文做的，而VCPU线程上下文并没有检测此操作的合法性，并且没有加锁，简单点改，可以再检测一遍，但是要彻底修改，还是需要加锁，但是加锁改动是比较大的，所以还是直接检测一遍，减小概率。
自测：
无</msg>
</logentry>
<logentry
   revision="265271">
<author>panchao</author>
<date>2016-07-11T13:15:55.786803Z</date>
<msg>review id: 20989
Bug id: 4392
问题分析: aSV升级后，不重启直接回滚，临时文件未清除
改动说明: aSV升级后，不重启直接回滚，删除/boot/firmware/utmp/目录
自测:</msg>
</logentry>
<logentry
   revision="265268">
<author>fxw</author>
<date>2016-07-11T13:07:25.851909Z</date>
<msg>Merged revision(s) 262131, 262135 from VTP/aSV4.6/aSV4.6_SDDC/src/kernel:
bugid: 4380
问题分析：振德医药客户出现usb xhci引发的宕机问题，如下：
[    3.432403] BUG: unable to handle kernel NULL pointer dereference at 0000000000000010
[    3.432644] IP: [&lt;ffffffff81509e48&gt;] xhci_queue_new_dequeue_state+0x78/0x1d0

改动说明：
1、合入229.11.1 的 fix use-after-free bug in usb_hcd_unlink_urb()；
2、合入3.13-055-103-xhci-rework-cycle-bit-checking-for-new-dequeue-pointers，解决xhci宕机问题。
</msg>
</logentry>
<logentry
   revision="265221">
<author>lcy</author>
<date>2016-07-11T09:53:21.879004Z</date>
<msg>reviewid: 20954
review by fxw
Bug id: 4573
问题分析：TD4648,【开机编辑】【关联】存在未生效配置的虚拟机，不允许切换虚拟交换机,处理一下
问题出现的根源：
存在未生效的配置信息的虚拟机，不允许再次编辑。之前编辑虚拟机的接口已经做了限制。但是不知道这里也存在修改虚拟机配置的入口
改动说明：
1. 修改一下，在入口进行一次限制。
自测:
4.9.00_B
build 2016-07-07 21:57:47
自测通过。</msg>
</logentry>
<logentry
   revision="265217">
<author>panchao</author>
<date>2016-07-11T09:23:41.932673Z</date>
<msg>review id: 20946
Bug id: 3856
问题分析: waf存在受戒礼漏洞，需要禁用rc4；
改动说明: 替换sangfor_waf执行openssl s_client -connect 200.200.101.219:443 -cipher RC4 不再输出证书信息
自测:</msg>
</logentry>
<logentry
   revision="265209">
<author>lcy</author>
<date>2016-07-11T08:45:36.249559Z</date>
<msg>reviewid: 20934
review by fxw
Bug id: 4573
问题分析：TD4573,【遗留】获取虚拟交换机连接的虚拟机需要优化，原来的代码有BUG
问题出现的根源：
原来的代码处理中，有可能在计算虚拟机的个数的时候会有误判
$bridge =~ m/$netname/ 之前使用这个来判断是否有虚拟机桥接到虚拟交换机中的
$bridge 是一串这样格式的字符串 breth0 :net0_1#net2_1,09:net1 代表着某台虚拟机的网卡信息
$netname 是breth: 代表着是某个虚拟交换机的名字
改动说明：
1. 写一个函数专门format虚拟机网卡信息，把网卡信息转化为一个以虚拟机ID为索引，下一层是虚拟交换机名字的的hash
自测:
4.9.00_B
build 2016-07-07 21:57:47
自测通过。</msg>
</logentry>
<logentry
   revision="265173">
<author>lcy</author>
<date>2016-07-11T01:23:18.909895Z</date>
<msg>reviewid: 20814
review by fxw
Bug id: 4012
问题分析：TD4012,【公司上网环境】vdc上控制器页面vmp偶尔离线
问题出现的根源：
网桥的MAC地址不在其桥接的interface中导致的网络不通，引起cfs卡主，前台访问就卡顿，在VDC看来就会离线
改动说明：
1. 激活网桥的时候，无论原网桥的MAC与网口的MAC是否一致，都ip link set一次网桥的MAC
2. vtp-bridge在虚拟机开机的时候会调用，这个时候检查一下网桥的MAC是否发生了改变，保证网桥的MAC不会发生改变
自测:
4.9.00_B
build 2016-07-07 21:57:47
1. 两台虚拟机VM1，VM2，两个虚拟交换机BR1 BR2，虚拟交换机都要桥接物理网口
2. VM1 连接了BR1，VM2连接了BR2
3. VM1开机，后台查看虚拟机运行的主机，brctl show看一下虚拟交换机的ID，ifconfig 虚拟交换机的ID和其桥接的物理网口的MAC是一样的
4. 编辑VM1，连接BR2，按照步骤3检查
5. VM2开机，按照步骤3检查</msg>
</logentry>
<logentry
   revision="265014">
<author>fxw</author>
<date>2016-07-08T10:00:15.998702Z</date>
<msg>noreview
日志刷太多</msg>
</logentry>
<logentry
   revision="265011">
<author>fxw</author>
<date>2016-07-08T09:58:47.726975Z</date>
<msg>noreview
更新spice库</msg>
</logentry>
<logentry
   revision="265001">
<author>fxw</author>
<date>2016-07-08T09:25:55.207310Z</date>
<msg>noreview
日志刷太多，1个多小时8千多条</msg>
</logentry>
<logentry
   revision="264998">
<author>fxw</author>
<date>2016-07-08T09:16:37.760851Z</date>
<msg>noreview
加个调试日志</msg>
</logentry>
<logentry
   revision="264995">
<author>yangwei</author>
<date>2016-07-08T09:05:14.237062Z</date>
<msg>reviewid 20811
bugid  4115
reviewby fxw
修改：
修改脱离acenter流程。
测试：vdc vmp均未加入acenter  操作都在主控上
1、检测vmp vls客户端状况：ps axuf | grep authorize_client_notice,服务ok
2、通过vdc加入acenter，vdc vmp加入成功，acenter显示该分组
3、检测vmp vls客户端状况：ps axuf | grep authorize_client_notice,服务ok
4、在vdc脱离acenter，vdc、vmp脱离了acenter，采用硬件key授权
5、检测vmp vls客户端状况：ps axuf | grep authorize_client_notice,服务ok
6、通过vdc加入acenter，通过acneter给vmp授权，刷新vmp页面，过15s左右vmp收到授权
7、修改acneter的ip，在vdc修改acneter的ip后保存，大约1分钟vmp恢复acenter授权</msg>
</logentry>
<logentry
   revision="264989">
<author>ssl</author>
<date>2016-07-08T08:51:59.049365Z</date>
<msg>从svn://200.200.0.40/ssl/dev/Trunk/Personal-Directory/VDI4.8/spice-0.12.5/server合入
Revision: 38775
Author: xiaojun
Date: 2016年3月31日 17:22:43
Message:
已审核,gbl
合入4.8R1
【上库原因】修复一些内存泄漏问题，问题来源spice官方代码库
----
Modified : /Trunk/Personal-Directory/VDI4.8/spice-0.12.5/server/mjpeg_encoder.c
Modified : /Trunk/Personal-Directory/VDI4.8/spice-0.12.5/server/red_parse_qxl.c
Modified : /Trunk/Personal-Directory/VDI4.8/spice-0.12.5/server/red_worker.c

</msg>
</logentry>
<logentry
   revision="264865">
<author>ssl</author>
<date>2016-07-08T02:49:56.849302Z</date>
<msg>解决win10环境下视频流丢帧导致右键菜单覆盖视频区域时，有时存在显示不正常的问题</msg>
</logentry>
<logentry
   revision="264860">
<author>lcy</author>
<date>2016-07-08T02:25:32.352101Z</date>
<msg>reviewid: 20787
Bug id: 4250
review by fxw
问题分析：TD4250【虚拟机开机失败】更新虚拟机模板后，虚拟机无法开机
问题出现的根源：
模板更新之后，派生虚拟机的基镜像会发生改变，qemu-img check命令会失败。
改动说明：
把qemu-img check改成qemu-img info
自测:
4.9.00_B
build 2016-07-07 21:57:47
1. 新建一台普通虚拟机，把磁盘替换成raw格式的，开机会报磁盘格式不对
2. 新建一台虚拟机，转为模板，并且派生一台虚拟机，派生虚拟机开机，不会报磁盘格式不对
3. 更新模板，开派生虚拟机，虚拟机不会报磁盘格式不对。</msg>
</logentry>
<logentry
   revision="264818">
<author>fxw</author>
<date>2016-07-07T13:00:45.176692Z</date>
<msg>noreview
bugid 4275
reviewby lcy
说明 开启了ksm导致的虚拟机内存性能下降，内存被回收后播放视频有杂音
修改：
加参数的代码写错了，导致虚拟机启动失败
测试：
启动2G虚拟机，看到qemu有-machine mem-merge=off参数。
后台手动回收一次内存，试听优酷视频也没有杂音。
</msg>
</logentry>
<logentry
   revision="264808">
<author>fxw</author>
<date>2016-07-07T12:27:19.323988Z</date>
<msg>noreview
要返回upid，否则VDC编辑虚拟机会出错</msg>
</logentry>
<logentry
   revision="264798">
<author>fxw</author>
<date>2016-07-07T11:49:38.274469Z</date>
<msg>reviewid 20773
bugid 4275
reviewby lcy
说明 开启了ksm导致的虚拟机内存性能下降，内存被回收后播放视频有杂音
修改：
VMP4.9合入了气泡内存，关闭ksm，可以解决该问题
测试：
启动2G虚拟机，看到qemu有-machine mem-merge=off参数。
后台手动回收一次内存，试听优酷视频也没有杂音。</msg>
</logentry>
<logentry
   revision="264797">
<author>lcy</author>
<date>2016-07-07T11:49:31.555252Z</date>
<msg>reviewid: 20774
review by fxw
Bug id: 4528
问题分析：TD4528,【遗留】smbios信息没有提供主板信息，导致windows部分软件安装不了
问题出现的根源：
smbios没有主板信息，也就是type=2的信息
改动说明：
qemu2.0不支持在参数中添加type=2的信息，所以直接在seabios修改，把type=2填写上默认的信息
自测:
4.9.00_B
build 2016-06-30 01:01:36
代码编译通过</msg>
</logentry>
<logentry
   revision="264748">
<author>fxw</author>
<date>2016-07-07T07:12:53.724076Z</date>
<msg>noreview
更新vs包</msg>
</logentry>
<logentry
   revision="264706">
<author>qifei</author>
<date>2016-07-07T01:43:02.294150Z</date>
<msg>by wyq.修改原因：vs的授权数获取错了，获取的vs授权数是对象，而被直接使用了其中的一个值。</msg>
</logentry>
<logentry
   revision="264442">
<author>qifei</author>
<date>2016-07-05T10:57:51.509243Z</date>
<msg>by wyq ，需求：获取本地授权数据。合并获取cpu个数的接口为一个</msg>
</logentry>
<logentry
   revision="264438">
<author>fxw</author>
<date>2016-07-05T10:00:54.565647Z</date>
<msg>reviewid 20647
bugid 1006
review by lcy
说明： 增加读取配置失败的异常处理
测试：perl -c 检查通过，没有4.9的环境，先打包后再测试</msg>
</logentry>
<logentry
   revision="264414">
<author>fxw</author>
<date>2016-07-05T08:58:04.728687Z</date>
<msg>Merged revision(s) 264037 from VTP/VMP_for_adesk/VMP4.8R1/Trunk:
noreview
bug id: 3793
问题描述：
【界面优化】【adesk】：存在私网故障的情况下，进行更新模板操作出现更新失败，提示语存在敏感信息 
VTP::Tools::get_file_size函数可能会返回-1，外层调用这个函数的地方，没有对返回值进行判断处理
就直接使用了
改动说明：
在调用get_file_size函数外面对返回值进行判断，发现异常，直接抛出到前台
找fxw看过代码了
自测通过
........
</msg>
</logentry>
<logentry
   revision="264374">
<author>fxw</author>
<date>2016-07-05T02:21:43.267279Z</date>
<msg>Merged revision(s) 263573 from VTP/VMP_for_adesk/VMP4.8R1/Trunk:
noreview
调试工具更新到0.03版
........
</msg>
</logentry>
<logentry
   revision="264372">
<author>fxw</author>
<date>2016-07-05T02:20:31.334544Z</date>
<msg>Merged revision(s) 262449 from VTP/VMP_for_adesk/VMP4.8R1/Trunk:
no review
bug id : 3669
问题描述 : 【备份】自动备份成功，后台判断备份失败，重复备份5次,
改动说明 : 修改请求URI，去掉最前面的 '/' 符号

........
</msg>
</logentry>
<logentry
   revision="264368">
<author>fxw</author>
<date>2016-07-05T02:15:27.638575Z</date>
<msg>Merged revision(s) 262416, 262578 from VTP/VMP_for_adesk/VMP4.8R1/Trunk:
noreview
review by zxq
bug id:3668
问题描述：
当目录下的文件个数大于1024个（包括 ./ ../）的时候,创建文件目录会失败
失败了前台没有错误，还是依然把配置写到回收站里
改动说明：
提前检测一下是否可以创建目录，可以的话，把目录先创建出来，不修改原有的删除流程
........
noreview
review by fxw
bug id:3668
问题描述：
当目录下的文件个数大于1024个（包括 ./ ../）的时候,创建文件目录会失败
失败了前台没有错误，还是依然把配置写到回收站里
改动说明：
把描述
可能回收站目录已满或者虚拟机所在存储离线，请先彻底删除回收站部分虚拟机和检查存储是否异常，再次尝试。若仍然无法成功成功删除虚拟机（%s），请联系深信服技术支持。
........
</msg>
</logentry>
<logentry
   revision="264305">
<author>fxw</author>
<date>2016-07-04T09:04:16.246871Z</date>
<msg>noreview
bugid :4321
问题描述： 文件系统有内存泄露，有个存储一直挂载失败，后台反复自动挂载，内存占用就越来越高
改动说明： 老代码有笔误，导致条件判断反了，没有释放内存
自测：打包后测试</msg>
</logentry>
<logentry
   revision="264296">
<author>fxw</author>
<date>2016-07-04T08:47:57.321058Z</date>
<msg>noreview
bugid :4267
问题描述： 虚拟机备份过程中服务器宕机
改动说明： 有一个函数没有加锁
自测：打包后测试</msg>
</logentry>
<logentry
   revision="264148">
<author>fxw</author>
<date>2016-07-02T06:27:47.732754Z</date>
<msg>noreview
日志刷太多了</msg>
</logentry>
<logentry
   revision="264146">
<author>yangwei</author>
<date>2016-07-02T04:58:59.979565Z</date>
<msg>reviewid 20553
bugid 4115
reviewby fxw
说明 acenter序列号修改
修改：
1、解决vmp和acenter链接断开后，显示只剩下一天问题；
2、优化acenter和vmp连接后，vmp的序列号更新方式和速度。
测试：
打包验证</msg>
</logentry>
<logentry
   revision="264088">
<author>lcy</author>
<date>2016-07-01T10:54:34.754277Z</date>
<msg>reviewid: 20529
review by fxw
Bug id: 4247
问题分析：TD4247,【气泡内存】win10虚拟机，气泡内存默认不勾选
问题出现的根源：
无
改动说明：
1. 后台改动有，假如是升级过来的版本，虚拟机没有balloon字段的虚拟机，判断一下虚拟机的类型，假如是win10的，启动参数
是没有balloon的，前台返回值中也是，假如没有这个字段，是win10就返回0，其他的操作系统就返回1
2. 前台改动，当编辑虚拟机的时候，如果发现后台返回的字段中没有不等于1而且虚拟机的类型是win10 那么就将balloon的选项默认不选择
自测：
4.9.00_B
build 2016-06-30 01:01:36
自测通过。</msg>
</logentry>
<logentry
   revision="264084">
<author>lcy</author>
<date>2016-07-01T10:22:59.067298Z</date>
<msg>reviewid: 20521
review by fxw
Bug id: 4053
问题分析：TD4053，一体化关机开启后，虚拟机菜单栏重启会导致盒子关闭
问题出现的根源：
虚拟机重启过程中的状态没有判断，导致返回虚拟机启动失败的信息，VDC认为虚拟机已经关机了，所以关闭掉盒子
改动说明：
加上resetting状态的判断
自测：
4.9.00_B
build 2016-06-26 01:01:44
自测通过。
在后台替换代码，已经和whx联调通过。</msg>
</logentry>
<logentry
   revision="264067">
<author>fxw</author>
<date>2016-07-01T09:13:14.725951Z</date>
<msg>noreview
模板更新后启动会失败，先屏蔽掉</msg>
</logentry>
<logentry
   revision="264065">
<author>lcy</author>
<date>2016-07-01T09:09:39.160768Z</date>
<msg>reviewid: 20517
review hjh
Bug id: 4247
问题分析：TD4247,【气泡内存】win10虚拟机，气泡内存默认不勾选
问题出现的根源：
无
改动说明：
无
自测：
4.9.00_B
build 2016-06-30 01:01:36
自测通过。</msg>
</logentry>
<logentry
   revision="264061">
<author>lcy</author>
<date>2016-07-01T08:47:40.909544Z</date>
<msg>reviewid: 20517
review by fxw
Bug id: 4135
问题分析：TD4235,【气泡内存】气泡内存回收选项前后台不一致
问题出现的根源：
之前改动的BUG引发，返回给前台的balloon_memory是一个字符，不是一个整数，导致前台显示有问题。
改动说明：
把balloon_memory字段的数值转化为整数，然后返回
自测：
4.9.00_B
build 2016-06-30 01:01:36
自测通过。</msg>
</logentry>
<logentry
   revision="263977">
<author>fxw</author>
<date>2016-06-30T10:22:54.315451Z</date>
<msg>Merged revision(s) 262176 from VTP/VMP_for_adesk/VMP4.8R1/Trunk:
noreview
BUG id: 3520
【严重】【虚拟机】通过win7模板部署2台虚拟机,其中一台磁盘丢失。[非必现]
合入lifan的修改


........
</msg>
</logentry>
<logentry
   revision="263897">
<author>lcy</author>
<date>2016-06-30T03:35:07.536900Z</date>
<msg>reviewid: 20463
review by fxw
Bug id: 3408
问题分析：TD3408,【4.9处理】【优先级低】【回收站】【设计问题】删除模板到回收站中，不要删除模板在各存储的基镜像（彻底删除再删基镜像），规避模板还原后派生虚拟机还原了也不能用的问题
问题出现的根源：
设计问题
改动说明：
模板先删除掉，不删除基镜像。后面再删除基镜像。
自测：
4.9.00_B
build 2016-06-30 01:01:36
自测通过。</msg>
</logentry>
<logentry
   revision="263874">
<author>lcy</author>
<date>2016-06-30T01:27:15.631322Z</date>
<msg>reviewid: 20454
review by fxw
Bug id: 4176
问题分析：TD4176，【改动引发】编辑虚拟机含有中文名字会报错
问题出现的根源：
VTP::Tools::hash2str函数会把参数转码，影响原有参数的值
改动说明：
拷贝一份变量传递到函数里面
自测：
4.9.00_B
build 2016-06-28 01:02:29
自测通过。</msg>
</logentry>
<logentry
   revision="263757">
<author>fxw</author>
<date>2016-06-29T03:18:55.477954Z</date>
<msg>reviewid : 20417
bug id : 4122
问题描述 : vmp4.9升级重启会将模板虚拟机自动生成另一台虚拟机，原来虚拟机的磁盘会不存在
改动说明 : 
模板虚拟机目录下面会残留配置文件，被01scanvm.pl拷贝到了/cfs，所以一个虚拟机目录对应了两个虚拟机配置文件，在前台也看到两台虚拟机。
在转换模板的时候会残留配置，修改掉这个问题。
在扫描存储虚拟机的时候如果一个虚拟机目录下面有多个conf，忽略掉，避免误导入。

测试 : 执行01scanvm.pl ，不会导入多余的配置</msg>
</logentry>
<logentry
   revision="263724">
<author>lcy</author>
<date>2016-06-29T01:19:19.942319Z</date>
<msg>reviewid: 20404
review by fxw
Bug id: 4066
问题分析：TD4066,【历史遗留】主机详情页面的网口流速的趋势图有问题
问题出现的根源：
修改完时间后，rrd的数据读不出来，会显示一个点的。F12看到返回的数据中，interval字段为负数，不正常的情况
改动说明：
合入aSV很久之前的一个改动，TD28897
自测：
4.9.00_B
build 2016-06-28 01:02:29
自测通过。</msg>
</logentry>
<logentry
   revision="263565">
<author>fxw</author>
<date>2016-06-28T01:09:05.776972Z</date>
<msg>reviewid: 20363
review by htq
Bug id: 4059
问题分析：UI传过来的账号密码是加密的，但是后台没有解密。34200 vmp合入sddc引发的bug，sddc在34620,34750 又修改好了，这个没有合入。
改动说明：
合入34620,34750
自测：
暂时没有4.9的环境，改动较简单，上库后测试</msg>
</logentry>
<logentry
   revision="263550">
<author>yangwei</author>
<date>2016-06-27T13:03:38.268341Z</date>
<msg>reviewid 20350
bugid 4060
review by fxw
说明：修改序列号返回码引发的问题
修改：
1、vmp序列号获取忽略序列号过期码
2、忽略vs序列号的114错误。
测试：
1、vmp硬件key序列号过期，前台显示正常</msg>
</logentry>
<logentry
   revision="263546">
<author>fxw</author>
<date>2016-06-27T12:53:27.660512Z</date>
<msg>reviewid: 20352
review by yw
Bug id: 4077
问题分析：客户处发现时钟变慢
改动说明：
合入35053，让虚拟机不使用hpet，这样时钟可以进行补偿
自测：
改动很小，上库后测试</msg>
</logentry>
<logentry
   revision="263525">
<author>fxw</author>
<date>2016-06-27T11:38:38.060095Z</date>
<msg>noreview
上传windbg和winhex，方便排查客户问题</msg>
</logentry>
<logentry
   revision="263352">
<author>lcy</author>
<date>2016-06-25T08:04:42.295982Z</date>
<msg>reviewid: 20308
review by hyq
Bug id: 3878
问题分析：TD3878,派生虚拟机与已有的虚拟机同名
问题出现的根源：
正则表达不对，不知道VDC那边会给派生虚拟机后面加上字符串的
改动说明：
修改一下正则表达式，假如后面有字符串的也应该认为是同一个基准名字派生的虚拟机
自测：
4.9.00_B
build 2016-06-15 01:05:28
自测通过。</msg>
</logentry>
<logentry
   revision="263351">
<author>yangwei</author>
<date>2016-06-25T07:54:45.172736Z</date>
<msg>reviewid 20299
bugid 3986
reviewby lcy
说明：
集群不稳定情况下序列号数据可能丢失
修改：
1、perl接口获取序列号如果集群不稳定将会失败
2、c接口：
vtsn_tool在集群不稳定情况下拒绝执行操作；
vtsn_server在集群不稳定下不更新数据；
获取序列号接口在集群不稳定情况下认为是序列号过期。
测试：
打包验证。</msg>
</logentry>
<logentry
   revision="263338">
<author>yangwei</author>
<date>2016-06-25T03:01:11.949769Z</date>
<msg>reviewid 20295
bugid 3902
修改：修改翻译文件</msg>
</logentry>
<logentry
   revision="263331">
<author>yangwei</author>
<date>2016-06-25T02:43:14.422552Z</date>
<msg>reviewid 20294
bugid 3139
修改： vtsn_server服务不再更新vls状态。
测试：
在集群稳定下：
1、切换acenter ip；
2、vdc修改acenter ip；
3、切换ip后，vmp在大约一分钟内恢复处于acenter授权状态。
这里需要注意：由于切换了acenter ip，会有一个状态转换过程，不是bug：
1、vmp会先失去acenter授权，前台可能看到和acenter失去连接或者显示硬件key授权信息，属于正常情况
2、vmp开始连接acenter，创建ssh连接，前台会显示加入了acenter，但是连接中断，属于正常情况
</msg>
</logentry>
<logentry
   revision="263294">
<author>fxw</author>
<date>2016-06-24T08:55:09.329257Z</date>
<msg>reviewid: 20283
review by czy
Bug id: 4384
问题分析：解决CLOSE_WAIT和LAST_ACK状态过多导致页面打不开问题
改动说明：
针对RST特殊处理关闭流程
自测：
无</msg>
</logentry>
<logentry
   revision="263265">
<author>yangwei</author>
<date>2016-06-24T03:52:26.584817Z</date>
<msg>reviewid 20267
bugid 3139
修改：
1、加了些acenter的授权相关日志
2、vdc取消授权vmp不再修改vls状态
</msg>
</logentry>
<logentry
   revision="263242">
<author>yangwei</author>
<date>2016-06-24T01:38:43.074663Z</date>
<msg>reviewid 20261
bugid 2881
reviewby fxw
说明  修改授权不足时的描述</msg>
</logentry>
<logentry
   revision="263096">
<author>fxw</author>
<date>2016-06-23T02:13:10.888085Z</date>
<msg>reviewid: 20220
review by lcy
Bug id: 1006
问题分析：VDC需要配置spice参数，改变摄像头个数
改动说明：
增加一个接口修改/cfs/VDC/kvm_spice_setting.conf，可以修改里面的所有内容
自测：
1. 执行vtpsh get /VAPIMain/VDCInterface/SpiceSetting，返回的内容和/cfs/VDC/kvm_spice_setting.conf一致
2. 执行vtpsh set /VAPIMain/VDCInterface/SpiceSetting -all '"jpeg_compress":{"type":"never","quality":"70"},"port_range":{"up_port":"5699","down_port":"5500"},"usb_num":{"usb":"13","camera":"2"},"audio_type":{"wxp":"ac97","wxp64":"ac97","win764":"hda","win10":"hda","win7":"hda"}}',/cfs/VDC/kvm_spice_setting.conf被修改
3. 执行vtpsh set /VAPIMain/VDCInterface/SpiceSetting -jpeg_compress  '{"type":"never","quality":"70"}' ，/cfs/VDC/kvm_spice_setting.conf被修改
4. /cfs/VDC/kvm_spice_setting.conf被修改后检测虚拟机参数，相应的发生了改变</msg>
</logentry>
<logentry
   revision="263019">
<author>lcy</author>
<date>2016-06-22T07:55:46.863568Z</date>
<msg>reviewid: 20199
review by fxw
Bug id: 3914
问题分析：TD3914,【虚拟机启动】虚拟机磁盘变成raw的时候，启动会导致死循环不断拉起和出core
问题出现的根源：
磁盘格式不对，虚拟机可以启动，启动过程中，出现异常，虚拟机关机。HA检测到虚拟机莫名其妙关机，又把它拉起。最终
导致不断启动虚拟机，不断产生core文件
改动说明：
VMP这边规避一下，启动的时候，判断虚拟机的磁盘格式是否正确，不正确不让其启动
自测：
4.9.00_B
build 2016-06-16 01:03:31
1. 构造一个raw的磁盘，然后后台手动替换一台虚拟机的磁盘
2. 启动虚拟机
3. 报错，磁盘格式不对</msg>
</logentry>
<logentry
   revision="263016">
<author>yangwei</author>
<date>2016-06-22T07:37:01.250891Z</date>
<msg>reviewid 20195
bugid 3902
reviewby fxw
说明 20195
修改和测试
1.vmp加入acenter，如果连接断开了需要告警
2.vmp加入了acenter，如果走的是硬件key流程，也需要对硬件key的操作进行告警
3.企业版vmp，如果没有加入acenter，key和sn是空的，也认为序列号来源是无</msg>
</logentry>
<logentry
   revision="262910">
<author>fxw</author>
<date>2016-06-21T08:28:44.195976Z</date>
<msg>noreview
合入社区改动，解决浪潮新一体机宕机问题</msg>
</logentry>
<logentry
   revision="262909">
<author>fxw</author>
<date>2016-06-21T08:26:53.664034Z</date>
<msg>noreview
要合入社区对megaraid的改动，解决浪潮的新一体机宕机问题，先上库原始文件</msg>
</logentry>
<logentry
   revision="262768">
<author>yangwei</author>
<date>2016-06-20T09:19:55.738219Z</date>
<msg>reviewid 20118
bugid 3599 3608
修改：
序列号问题修改：
1、VMP加入acenter，acenter没有给VMP授权，但VMP会沿用上次acenter曾经给VMP的授权
2、vls非法状态，可以使用30天
测试：
打包验证</msg>
</logentry>
<logentry
   revision="262694">
<author>yangwei</author>
<date>2016-06-20T01:55:59.621519Z</date>
<msg>reviewid 20104
bugid null
说明：添加rar格式压缩包解压工具</msg>
</logentry>
<logentry
   revision="262644">
<author>yangwei</author>
<date>2016-06-17T10:09:30.304073Z</date>
<msg>reviewid 20074
bugid 3599 3608
修改：
序列号问题修改：
1、VMP加入acenter，acenter没有给VMP授权，但VMP会沿用上次acenter曾经给VMP的授权
2、vls非法状态，可以使用30天
测试：
打包验证</msg>
</logentry>
<logentry
   revision="262614">
<author>ljb</author>
<date>2016-06-17T07:23:43.900080Z</date>
<msg>reviewid 20069
bug TD:  3715
reviewed by : fxw
改动说明：vdc与vmp的连接状态检测api helloworld 去掉protected 字段，由apache处理
测试： perl -c  检测语法，语法通过。

Sangfor:VMP/host-fefcfe23cb45 /usr/share/perl5/VTP/VAPI # vtpsh get /access/helloworld 
200 OK
200 OK</msg>
</logentry>
<logentry
   revision="262592">
<author>ljb</author>
<date>2016-06-17T04:29:34.367872Z</date>
<msg>reviewid 20062
bug TD:  3531
reviewed by : fxw
改动说明： 删除判断的时候，如果检测虚拟机目录下有qcow2就不删除文件夹了。 但是新功能虚拟机目录添加了prload_disk.qcwo2 文件，导致备份恢复的时候不删除原有目录，导致残留
测试： 1、perl -c 检测语法，语法oK。
     2、模板备份恢复到备份位置，成功。 且没有残留</msg>
</logentry>
<logentry
   revision="262588">
<author>ljb</author>
<date>2016-06-17T03:20:00.330616Z</date>
<msg>reviewid 20059
bug TD:  3531
reviewed by : hyq
改动说明： 删除判断的时候，如果检测虚拟机目录下有qcow2就不删除文件夹了。 但是新功能虚拟机目录添加了prload_disk.qcwo2 文件，导致备份恢复的时候不删除原有目录，导致残留
测试： 1、perl -c 检测语法，语法oK。
     2、模板备份恢复到备份位置，成功。 且没有残留</msg>
</logentry>
<logentry
   revision="262485">
<author>fxw</author>
<date>2016-06-16T07:25:43.899015Z</date>
<msg>Merged revision(s) 262385 from VTP/aSV4.6/VMP4.7:
noreview
问题分析：fork_worker的修改，之前吧子进程的stdout重定向到nul了，导致vtpsh调用时，会获取不到标准输出（有些代码需要用vtpsh的标准输出）
修改方法：判断是vtpsh调用的话，就报表stdout的重定向。
测试： sddc已经验证通过，代码与vmp相同。
........
</msg>
</logentry>
<logentry
   revision="262472">
<author>lcy</author>
<date>2016-06-16T06:27:49.668956Z</date>
<msg>reviewid: 19993
review by fxw
Bug id: 908
问题分析：TD908,【bug】【kvm core】【adesk】出现虚拟机异常重启，出core问题 20160323【疑难】
问题出现的根源：
get_qmp_greeting这个函数获取的qemu的版本数据格式有误，导致后面的发送到客户端的版本号解释的函数出问题
改动说明：
不再动态获取版本号，qemu的版本号是固定的，直接把版本号填写为静态数据返回。
自测：
4.9.00_B
build 2016-06-16 01:03:31
1. 虚拟机可以开机
2. 开机的虚拟机可以正常运行
3. 虚拟机可以内部关机，内部重启，外部关机，外部重置，外部关闭电源
4. 跑测试脚本没有问题。</msg>
</logentry>
<logentry
   revision="262466">
<author>ljb</author>
<date>2016-06-16T05:03:33.221992Z</date>
<msg>reviewid 20012
bug TD:  3572
reviewed by : gwl
改动说明： 增加一个参数控制返回式json,还是hash
测试： perl -c 检查语法，语法OK</msg>
</logentry>
<logentry
   revision="262460">
<author>qifei</author>
<date>2016-06-16T03:45:09.845364Z</date>
<msg>by wyq 解决问题：save_acenter和conn.pl竞争导致VMP无法加入aCenter。解决方案：save_acenter加入aCenter的时候和conn.pl读取隧道是否建立的时候加锁，避免conn.pl把隧道断开了</msg>
</logentry>
<logentry
   revision="262433">
<author>ljb</author>
<date>2016-06-15T12:31:06.202904Z</date>
<msg>reviewid 19989
bug TD:  3647
reviewed by : fxw
改动说明：【体验】虚拟机的内存和CPU告警太多，感觉没啥用，改成默认不告警如果用redis获取内容失败，就走原有的流程。 
测试： perl -c  检查语法，语法OK。 
     后台删除rm /cfs/alert.conf ， 页面默认不勾选虚拟机内存和CPU告警</msg>
</logentry>
<logentry
   revision="262426">
<author>ljb</author>
<date>2016-06-15T11:38:45.844233Z</date>
<msg>reviewid 19985
bug TD:  3572
reviewed by : yangwei
改动说明： 用redis获取的序列号内容有可能为空，但是start API 里面没有对这个做处理导致程序异常。 如果用redis获取内容失败，就走原有的流程。 
测试： perl -c 检查语法，语法OK</msg>
</logentry>
<logentry
   revision="262411">
<author>ljb</author>
<date>2016-06-15T09:21:41.025231Z</date>
<msg>reviewid 19961
bug TD:  3538
reviewed by : lcy
改动说明： 后台调用派生虚拟机API的时候，优化提示
测试： 1、perl -c 检查语法通过。 
     2、批量编辑HA虚拟机， 主控上的本地虚拟机， 从节点上的本地虚拟机， 添加磁盘， 编辑CPU， 内存等成功。
     3、批量编辑一台虚拟机，磁盘，内存，CPU都成功。</msg>
</logentry>
<logentry
   revision="262351">
<author>fxw</author>
<date>2016-06-15T03:57:18.224748Z</date>
<msg>Merged revision(s) 261826, 261850, 261987, 262150-262151, 262174, 262202, 262271 from VTP/aSV4.6/VMP4.7:
testreviewid 19768
bug TD:  3498
reviewed by : gwl
改动说明：解决启动虚拟机的时候启动函数报错不能捕获的问题
做了哪些测试：测试： 1、perl -c 检查语法，语法OK。
     2、替换代码，重启服务，当虚拟机由于内存不够启动失败的时候，调用如下获取内容正常。 
     Sangfor:VMP/host-001e67c04243 /usr/share/perl5/VTP/Common/Task # vtpsh get /VAPIMain/VDCInterface/QueryTaskProcess -upid 'UPID:host-001e67c04243:0000D24E:503F23:575779D7:VDI客户端批量接入::admin@vtp:' -getqueuedata 1 -getusermsg 1 
200 OK
{
   "message" : "",
   "process" : "100",
   "usermsg" : [
      {
         "err_code" : "start",
         "errmsg" : "主机内存不足，无法运行虚拟机！（主机剩余内存15309M，可配置内存802M（需要预留内存给开机状态的虚拟机），当前虚拟机需要1424M）\n",
         "spice_info" : {},
         "success" : 0,
         "vmid" : "8494593732448"
      }
   ]
}

........
testreviewid 19780
bug TD:  3452
reviewed by : gwl
改动说明：当并发启动虚拟机的时候会并发写日志。 目前我们并发量在大集群范围内并发比较大。vtplogd进程挂掉 监听数为20的时候，vtplogd服务经常挂，导致页面日志不正常。 
测试验证：验证并发启动100台虚拟机，60s后继续并发启动100台，如此反复测试到550台虚拟机，读写日志正常。日志无丢失。 测试次共4次。 并没有vtplogd挂掉的情况。 
       vtplogd服务内存占用并没有提升多，内存在一个可控范围之内。

........
问题描述： 
	【组建vs】报错有错别字
BUG   ID: 3546
问题原因： 
	"创卷任务失败" 提示信息容易引起误会，即“创建任务失败”
改动思路： 
        改为“创建卷任务失败”
做了哪些测试： 
	
no review
........
noreview
修改cpan的安装脚本：优先选择Build方式安装，如果没有则用make方式安装
自测通过
........
noreview
从sddc合入的代码有点问题，回滚回去
........
noreview
bug id: 3294
VDI4.9:访问关机状态虚拟机资源失败时提示不够详细
问题分析：失败时，未正常捕获错误信息
          另外，由于失败信息是raise扔出的，需要转字符串才能hash2str，否则报错，导致写入queue失败，查询就得不到相关信息。
自测说明：和ssl同事联调通过


noview
针对集群规模，专项分析各种参数，作完备的调整（
http://200.200.102.240/wiki/%E5%A4%A7%E8%A7%84%E6%A8%A1%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%82%E6%95%B0%E8%B0%83%E6%95%B4
）
........
noreview
添加ProcessManager.pm类
本意是作为vtpdaemon使用，考虑改动引发，先不改vtpaemon，这个类还是要上库放着。

其它服务在压力过大时，可以考虑使用这个类，比如vtplogd，和虚拟机状态服务，凡是通过ipc的perl服务都可以用这个加快处理效率。
........
noreview
ProcessManager.pm完善
Task/TaskManager.pm规范代码
........
</msg>
</logentry>
<logentry
   revision="262349">
<author>lcy</author>
<date>2016-06-15T03:34:46.809061Z</date>
<msg>reviewid: 19941
review by fxw
Bug id: 3641
问题分析：TD3641,【开机编辑】处理一下编辑数据过期的问题和修改读写配置的方法
问题出现的根源：
多个页面打开编辑容易出现数据过期的问题，从而引发很多未知的错误，提前检查编辑数据是否存在过期的可能
如果发现编辑数据过期了，提示用户刷新页面重新编辑。
之前的写配置的函数write_ini_sf有可能出现写失败的情况，为了减少失败的概率，用VTP::Tools::write_ini_conf这个函数代替
VMP系统中很多配置文件都有用这个函数写cfs的配置信息，函数可靠性强。
改动说明：
限制只有修改admin账户的时候才会提示修改VDC控制器的密码的。
自测：
4.9.00_B
build 2016-06-15 01:05:28
自测通过。</msg>
</logentry>
<logentry
   revision="262339">
<author>lcy</author>
<date>2016-06-15T01:35:17.847655Z</date>
<msg>reviewid：19922
review by fxw
bug id: 3602
改动说明：
有一个改动是要回滚的，所以合入回滚
Merged revision(s) 261844 from VTP/VMP_for_adesk/VMP4.8R1/Trunk:
no review
bug id : 3420
问题描述 : 【删除虚拟机】删除vs上的虚拟机成功，但是后台残留配置
改动说明 : 页面不再能进行分组迁移操作，先回滚。4.9版本改
........</msg>
</logentry>
<logentry
   revision="262336">
<author>fxw</author>
<date>2016-06-15T01:24:48.661993Z</date>
<msg>noreview
更新vs包</msg>
</logentry>
<logentry
   revision="262335">
<author>fxw</author>
<date>2016-06-15T01:17:40.638775Z</date>
<msg>Merged revision(s) 261279, 261723, 261725-261726, 261731, 261779 from VTP/aSV4.6/VMP4.7:
noreview
支持关闭API的cache缓存
顺便合入了一点sddc的改动。
........
noreview
添加cpan安装
........
noreview
添加cpan安装
........
noreview
添加cpan安装
........
noreview
添加cpan安装
........
noreview
添加cpan安装
........
</msg>
</logentry>
<logentry
   revision="262276">
<author>lcy</author>
<date>2016-06-14T09:41:18.551422Z</date>
<msg>reviewid: 19904
review by hjh
Bug id: 3167
问题分析：TD3167,【需求】修改VMP密码的时候，提示一下需要到VDC修改控制器的密码
问题出现的根源：
无
改动说明：
限制只有修改admin账户的时候才会提示修改VDC控制器的密码的。
自测：
4.9.00_B
build 2016-06-14 11:35:09
自测通过。</msg>
</logentry>
<logentry
   revision="262270">
<author>ljb</author>
<date>2016-06-14T09:17:10.647679Z</date>
<msg>reviewid 19899
bug TD:  3497
reviewed by : fxw
改动说明： 后台调用派生虚拟机API的时候，优化提示
测试：  1、perl -c  检查语法，语法通。
     2、导入aSV5.0.01 build 2016-04-19 21:18:56这个版本的win7 redhat7到VMP4.8成功。 
     3、将VMP虚拟机导出到本地，然后再导入VMP系统，成功创建虚拟机。 
     4、导入aSV3.7的vma,成功创建虚拟机。</msg>
</logentry>
<logentry
   revision="262244">
<author>lcy</author>
<date>2016-06-14T08:05:40.533369Z</date>
<msg>reviewid: 19891
review by fxw
Bug id: 3602
问题分析：TD3602,【合入】合入VMP4.8R1的VMP部分的改动
合入VMP4.8R1，具体的TD有：
3061
3330
3057
3500
3523
3529
3522
3452
3525
3582

Merged revision(s) 261562, 261743, 261804, 261830, 261835, 261976, 261981, 261984, 262013, 262039, 262074, 262092, 262130 from VTP/VMP_for_adesk/VMP4.8R1/Trunk:
noreview BUG ID: [3061]
问题分析：在没有配置集群IP的情况下，主控掉线，无法登陆从节点

改动说明：如果是主控并且主控不在线，那么就不需要弹窗提示

做了哪些测试：
1.jshint通过
2.自测通过
........
noreview
增加调试工具
........
no review
bugid：3420
【删除虚拟机】删除vs上的虚拟机成功，但是后台残留配置
........
review id : no review
bug id : 3057
问题描述 :【mac绑定】【北京利尔高温】静态mac绑定，导致集群之间通信有问题--hjs回归失败
集群主机显示都是在线，但数据没有同步的情况，已经设置为静态arp, 需要再次检测绑定的静态arp是否正确，不正确则删除
添加的时候判断arp-reply回包与配置是否一致，一致才添加
........
noreview
bugid: 3500
改动说明：批量关机的时候有几台虚拟机90s内都没有IO导致误判，实际可以正常关闭。
90s改长到10分钟，异常检测周期也由30s改大到2分钟。心跳检测超时也由1分钟改成2分钟。


........
noreview
bug id:3523
【4.8R1发布测试项】在vmp上第二次部署虚拟机失败
问题描述：
该问题出现的原因是，把虚拟机的名字当做正则匹配的模式传递到在正则表达式中，
然而虚拟机名字含有一些特殊字符，正则表达式当做了模式字符处理，出现表达式异常

........
noreview
bugid: 3529
说明：vtpsh代理执行其它节点的虚拟机操作，print UPID的时候告警，误判为执行操作出错。暂时先过滤这个告警
........
noreview
bugid: 3522
bug描述：虚拟机挂起失败
说明：qemu启动参数太长,/proc/$pid/cmdline显示不完，导致没有匹配到-bios参数。
将bios参数放到前面解决该问题
........
reviewid no
bug TD:  3452
reviewed by : lcy
改动说明：【集群】集群中重启某台子节点，关闭虚拟机的过程，部分虚拟机又被异常拉起
测试验证：
1、perl -c 检查语法，语法OK。 
2、主机A上启动HA虚拟机和非ＨＡ虚拟机，执行  vtpsh --nooutput create /nodes/localhost/stopall，主机A上的虚拟机都关闭。 
3、关闭主机，虚拟机关闭后不启动虚拟机
........
no review
bug id : 3525
问题描述 : 模板更新，之后进行接入独享桌面，进行新建文件操作
改动说明 : 更新拷贝模板每3分钟检查一次虚拟机是否被拉起，如果被拉起抛出异常
........
no review
bug id : 3525
问题描述 : 模板更新，之后进行接入独享桌面，进行新建文件操作
改动说明 : HA检查过程中忽略处于临时状态的虚拟机
........
no review
dmesg 日志缓存大小改为4M
........
no review 
bug id : 3581
问题描述 : 一个自动备份策略，虚拟机备份了两次
改动说明 : 从aSV4.2 合入 revision 237030
........</msg>
</logentry>
<logentry
   revision="262204">
<author>qifei</author>
<date>2016-06-14T04:56:33.033457Z</date>
<msg>reviewid: 19865
review by yangwei
Bug id: null
问题分析：增加一个接口，获取CPU核数和CPU颗数的最低限制
改动：
增加一个接口，获取CPU核数和CPU颗数的最低限制
自测：
对比ui调用和后台命令结果是否相同</msg>
</logentry>
<logentry
   revision="262190">
<author>lcy</author>
<date>2016-06-14T03:16:08.645003Z</date>
<msg>reviewid:19744
review by fxw
把VMP4.8R1的回收站合入到VMP4.9

Merged revision(s) 261478 from VTP/VMP_for_adesk/VMP4.8R1/Trunk:
Merged revision(s) 261374-261477 from VTP/VMP4.7/Personal/lcy/recyclebin/Trunk:
Merged revision(s) 261198 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
noreview
Merged revision(s) 46537 from VTP/VMP4.1/Alternate/src/app/vtp-manager/www/new_webui:
reviewid: 10442
reviewd by: lsh
改动说明：1、回收站加入彻底删除和清除功能
........
Merged revision(s) 46505 from VTP/VMP4.1/Alternate/src/app/vtp-manager/www/new_webui:
reviewid: 10423
reviewd by: lsh
改动说明：1、回收站列表
........


........

........
Merged revision(s) 261201 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
noreview
Merged revision(s) 46539 from VTP/VMP4.1/Alternate/src/app:
reviewid 10441
Reviewed by: wyy
BUG ID: null
问题分析: 回收站功能代码上库
做了哪些测试：1、基本功能可用，异常未考虑
........

........

........
Merged revision(s) 261206 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
noreview
perl -c把错误处理一下
可以正常启动apace

........

........
Merged revision(s) 261208 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
noreview

Merged revision(s) 46555 from VTP/VMP4.1/Alternate/src/app/vtp-manager/www/new_webui:
reviewid: 10448
reviewd by: lsh
改动说明：1、回收站中删除设备和清除回收站操作加上提示
........

........

........
Merged revision(s) 261214 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 46595 from VTP/VMP4.1/Alternate/src/app:
reviewid 10473
Reviewed by: wyy
BUG ID: null
问题分析: 回收站功能代码完善
做了哪些测试：1、考虑部分异常
........

........

........
Merged revision(s) 261215 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
noreview
修改一下perl -c不通过的地方
........

........
Merged revision(s) 261218 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 46637 from VTP/VMP4.1/Alternate/src/app:
reviewid 10505
Reviewed by: wyy
BUG ID: null
问题分析: 回收站功能代码完善
做了哪些测试：1、处理备份
2、处理派生虚拟机
3、处理lost状态虚拟机
........

........

........
Merged revision(s) 261226 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 46639 from VTP/VMP4.1/Alternate/build:
reviewid 10506
Reviewed by: wyy
BUG ID: null
问题分析: 回收站自动清理脚本
做了哪些测试：1、自动清理脚本
........

........

........
Merged revision(s) 261227 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 46673 from VTP/VMP4.1/Alternate/build:
reviewid 10518
Reviewed by: wzt
BUG ID: null
问题分析: 自动清理回收站脚本只在主控上执行
做了哪些测试：自测ok
........

........

........
Merged revision(s) 261229 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 46677 from VTP/VMP4.1/Alternate/src/app:
reviewid 10520
Reviewed by: wyy
BUG ID: 30005、29991、3007
问题分析: 1、bug-30005：批量还原和删除遇到失败，后面的不会执行
2、bug-29991：派生虚拟机的镜像文件不存在，不可以还原
3、bug-30007：虚拟机在从节点上还原没有反应
做了哪些测试：测试通过
........

........

........
Merged revision(s) 261230 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 46709 from VTP/VMP4.1/Alternate/src/app:
reviewid 10541
Reviewed by: wyy
BUG ID: 29992
问题分析: 回收站里面的虚拟机如果存储丢失或者不可访问：彻底删除不报错，把错误信息当作描述打到日志就可以了
做了哪些测试：测试通过
........

........

........
Merged revision(s) 261231 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 46757 from VTP/VMP4.1/Alternate/src/app/vtp-manager/www/new_webui:
reviewid: 10548
reviewd by: zhangxin
改动说明：1、回收站行高修改
........

........

........
Merged revision(s) 261232 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 46781 from VTP/VMP4.1/Alternate/src/app:
reviewid 10557
Reviewed by: wyy
BUG ID: 30026/29992/30009
问题分析: bug-30026 同名网络设备还原失败，提示不要带上&amp;&amp;sangfor...&amp;&amp;这个分组名字
bug-29992 进入回收站后删除虚拟机所用的存储，无法彻底删除
bug-30009 用户通过存储管理页面把虚拟机放在回收站的磁盘删除了，还原要报错
做了哪些测试：测试通过
........

........

........
Merged revision(s) 261233 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 46790 from VTP/VMP4.1/Alternate/src/app:
reviewid 10565
Reviewed by: wyy
BUG ID: 30040
问题分析: 回收站的设备没有显示描述字段：描述字段使用的是remark字段
做了哪些测试：测试通过
........

........

........
Merged revision(s) 261238 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
noreivew
VMP没有虚拟机直接映射裸磁盘的功能，把一些相关的代码注释掉。
........

........
Merged revision(s) 261240 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
noreview
UI
解决回收站页面看不到描述信息的问题
........

........
Merged revision(s) 261242 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 46813 from VTP/VMP4.1/Alternate/src/app:
reviewid 10582

30018 【拓扑图编辑】回收站页面，建议默认可以按照删除时间排序。其他字段最好也可以提供排序功能
........

........

........
Merged revision(s) 261244 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 46821 from VTP/VMP4.1/Alternate/src/app:
reviewid 10596
Reviewed by: wyy
BUG ID: 30063
问题分析: 所占空间为0的虚拟机还原后，没有提示、日志等任何信息，回收站列表还有记录：存储离线了
做了哪些测试：测试通过
........

........

........
Merged revision(s) 261247 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 46924 from VTP/VMP4.1/Alternate/src/app:
reviewid 10663
Reviewed by: wyy
BUG ID: 30041
问题分析: 名字太长，放入回收站失败：在放入回收站检查一下名字长度，太长了不能放入回收站
做了哪些测试：测试通过
........

........

........
Merged revision(s) 261265 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 46960 from VTP/VMP4.1/Alternate/src/app:
reviewid: 10690
reviewd by: lsh
bugid：30051
改动说明：1、回收站的虚拟机区分模板、普通和模板部署的三种类型
........

........

........
Merged revision(s) 261268 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 46965 from VTP/VMP4.1/Alternate/src/app:
reviewid 10691
Reviewed by：zxq
BUGID: 30051
问题分析：回收站，虚拟机类型分为普通、模板、派生虚拟机
改动：回收站，虚拟机类型分为普通、模板、派生虚拟机
测试：联调ok
........

........

........
Merged revision(s) 261284 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
noreview
修改一下页面，和aSV类型的提示。删除虚拟机，默认放入回收站，checkbox点击之后，才会彻底删除。
........

........
Merged revision(s) 261286 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 47250 from VTP/VMP4.1/Alternate/src/app:
reviewid : 10796 
reviewed by : zxq
BUG ID : [30063]
问题分析:   所占空间为0的虚拟机还原后，没有提示、日志等任何信息，回收站列表还有记录
改动说明：  在还原的时候对所储存的存储进行判断，如果不可访问，则提示错误
........

........

........
Merged revision(s) 261292 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 47257 from VTP/VMP4.1/Alternate/src/app:
reviewid: 10800
reviewd by: lsh
bugid：30186
改动说明：1、在虚拟机和虚拟网络处添加回收站入口
........

........

........
Merged revision(s) 261294 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 47269 from VTP/VMP4.1/Alternate/src/app:
reviewid: 10814
reviewd by: lsh
bugid：30190
改动说明：1、回收站增加一列显示彻底删除时间
........

........

........
Merged revision(s) 261296 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 47280 from VTP/VMP4.1/Alternate/src/app:
reviewid 10819
Reviewed by: wyy
BUG ID: 30190
问题分析:回收站加一列信息，剩余多少天会被删除
做了哪些测试：联调通过
........

........

........
Merged revision(s) 261298 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 47295 from VTP/VMP4.1/Alternate/src/app:
reviewid 10838
Reviewed by: wyy
BUG ID: 30159
问题分析: 放入回收站的虚拟机名字长度限制与虚拟机列表不一致
做了哪些测试：自测ok
........

........

........
Merged revision(s) 261299 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 47330 from VTP/VMP4.1/Alternate/src/app:
reviewid: 10856
reviewd by: lsh
bugid：
改动说明：1、拓扑图新建网络设备时，在reset时也得有条件检查，2、回收站tab改用tabs组件实现
........

........

........
Merged revision(s) 261300 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 47374 from VTP/VMP4.1/Alternate/src/app:
reviewid: 10879
reviewd by: lsh
bugid：
改动说明：1、回收站新增三种类型
........

........

........
Merged revision(s) 261308 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 47398 from VTP/VMP4.1/Alternate/src/app:
reviewid 10889
Reviewed by：zxq
BUGID: 30149
问题分析：虚拟机，虚拟机网络设备，只有主机离线的不允许删除。存储离线的可以删除，存储加回来后，支持还原。
改动：虚拟机，虚拟机网络设备，只有主机离线的不允许删除。
      存储离线的可以删除，存储加回来后，支持还原。此时由于删除的时候没有移动磁盘，原存储目录磁盘还在，还原时不需要移动磁盘。
      还原时，检查同名，判断id是否相同。
测试：测试：2台主机的环境，iptables离线共享存储。
      共享存储上测虚拟机可以删除，存储加回来后，可以还原。
      从节点离线，从节点上的虚拟机不能删除（彻底删除、或者放入回收站都不让）。
........

........

........
Merged revision(s) 261312 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 47545 from VTP/VMP4.1/Alternate/src/app:
reviewid: 10972
reviewd by: jcy
bugid：30361
改动说明：1、修改ie10下回收站无法进入问题
........

........

........
Merged revision(s) 261315 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 47560 from VTP/VMP4.1/Alternate/src/app:
reviewid 10985

30378 【拓扑图编辑】回收站存留时间字段的值，建议删除改为彻底删除
........

........

........
Merged revision(s) 261316 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 47573 from VTP/VMP4.1/Alternate/src/app:
reviewid: 11000
reviewd by: hlc
bug id: [30379]
改动说明：
bug30379,回收站页面的表格，“残留时间”列加上自定义的排序算法

........

........

........
Merged revision(s) 261317 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 47590 from VTP/VMP4.1/Alternate/src/app:
reviewid 11011
Reviewed by：zxq
BUGID: 30397
问题分析：虚拟机、虚拟网络设备，放入回收站时，如果存储已经被删除，判断节点是否能访问存储时，要把代码eval起来，否则由于存储不存在会die掉
改动：虚拟机、虚拟网络设备，放入回收站时，如果存储已经被删除，判断节点是否能访问存储时，要把代码eval起来，否则由于存储不存在会die掉
测试：共享存储上ha虚拟机
      共享存储上非ha虚拟机，删掉存储后，可以放入回收站
........

........

........
Merged revision(s) 261338 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 47430 from VTP/VMP4.1/Alternate/build:
reviewid 10916
Reviewed by: wyy
BUG ID: 30278
问题分析: 交换机、路由、边界放入回收站
做了哪些测试：自测ok
........

........

........
Merged revision(s) 261341 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 47449 from VTP/VMP4.1/Alternate/src/app:
reviewid 10930
Reviewed by: wyy
BUG ID: 30278
问题分析: 路由还原时不打修改运行位置的日志
虚拟机回收站目录改变
做了哪些测试：自测ok
........

........

........
Merged revision(s) 261344 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 47569 from VTP/VMP4.1/Alternate/src/app:
reviewid 10996
Reviewed by: wyy
BUG ID: 30278
问题分析: 交换机、路由、边界放入回收站:移动文件位置
做了哪些测试：编译通过
........

........

........
Merged revision(s) 261366 from VTP/aSV4.6/VMP4.6/Personal/recycle/Trunk:
Merged revision(s) 47577 from VTP/VMP4.1/Alternate/src/app:
reviewid 11004
Reviewed by: wyy
BUG ID: 30278
问题分析: 删除多余代码
做了哪些测试：自测ok
........

........

........
Merged revision(s) 47723 from VTP/VMP4.1/Alternate/src/app:
reviewid 11121
Reviewed by: wyy
BUG ID: 30389
问题分析: 主机拆分后重新组建，要处理回收站的配置
做了哪些测试：自测ok
........

........
Merged revision(s) 47735 from VTP/VMP4.1/Alternate/src/app:
reviewid: 11127
reviewd by: lsh
bug id: [30378]
改动说明：
bug30378,回收站页面“彻底删除”列显示不完整

........

........
Merged revision(s) 47814 from VTP/VMP4.1/Alternate/src/app:
reviewid 11180
Reviewed by：zxq
BUGID: 30149
问题分析：删除虚拟机到回收站，磁盘移动到delete目录后，在判断一下目的目录在不在。目录不在的话，同样认为没有移动磁盘。
改动：报表获取存储是否在线，有时候不准。所以在移动完磁盘后在判断一下。
测试：存储，在线离线都能删除成功.存储恢复后，都能还原成功
........

........
Merged revision(s) 47902 from VTP/VMP4.1/Alternate/build:
reviewid 11232
Reviewed by: wyy
BUG ID: 30446
问题分析:  回收站在凌晨0点时候，显示的删除时间由“1小时”变成了“23小时”，但实际在几分钟内就删除了
做了哪些测试：时间显示正确
........

........
noreview
调整一下回收站的界面
........
noreview
调整一下删除弹框的字体。
........
noreview
界面修改，修改清理回收站的时间长度为30天
........
Merged revision(s) 47981 from VTP/VMP4.1/Alternate/src/app:
reviewid 11300
Reviewed by：zxq
BUGID:29703
问题分析：回收站，名称中间带空格的虚拟机、虚拟网络设备还原失败
改动：回收站，名称中间带空格的虚拟机、虚拟网络设备还原失败
测试：名称带空格的虚拟机、虚拟网络设备，删除还原，尝试了几次都能成功。
      删除物理出口、交换机、路由器，然后还原，都能成功。
........

........
Merged revision(s) 48053 from VTP/VMP4.1/Alternate/src/app:
reviewid 11342
Reviewed by：zxq
BUGID:30681
问题分析：用glob处理。如果目录用单引号引起来，处理没有空格的有问题。如果用单引号不引起来，处理有空格的有问题。改成使用opendir。
改动：用glob处理。如果目录用单引号引起来，处理没有空格的有问题。如果用单引号不引起来，处理有空格的有问题。改成使用opendir。
测试：虚拟机、虚拟网络设备不论名称是否带有空格，都可以删除、还原成功
........

........
Merged revision(s) 47749 from VTP/VMP4.1/Alternate/src/app:
reviewid: 11134
reviewd by: jcy
bugid：30426
改动说明：1、回收站还原加个提示
........

........
Merged revision(s) 48085 from VTP/VMP4.1/Alternate/src/app:
reviewid 11354
Reviewed by：zxq
BUGID: 30695
问题分析：分组名称为中文的，虚拟机删除后，还原会新建一个乱码分组，还原到里面 
改动：原因是，删除时，转码了两次，写到配置中，中文成了乱码
测试：删除还原分组名是中文和不是中文的虚拟机，都正常
........

........
noreview
修改导航栏的删除为彻底删除
........
noreview
默认把diskremain设置为1
........

........

</msg>
</logentry>
<logentry
   revision="262180">
<author>lcy</author>
<date>2016-06-14T02:04:16.256724Z</date>
<msg>reviewid: 19874
review by fxw
Bug id: 1296
问题分析：TD1296,【bug】【技术支持】【兖矿集团----田爽QQ517456756】【VMP4.8.00_B】free -h cached 占用了109G内存，平台内存123G， 导致拷贝数据慢了，只有2MB/S
问题出现的根源：
无
改动说明：
增加一个定时扫描脚本，每5分钟扫描一次，假如发现有scp, sfscp, cp进程，那么清理cache
自测：
4.9.00_B
build 2016-06-01 00:52:13
自测通过。</msg>
</logentry>
<logentry
   revision="262114">
<author>yangwei</author>
<date>2016-06-13T06:33:32.953780Z</date>
<msg>reviewid 19850
bugid 2067
说明 重启主机识别不了key的问题，改为重启3分钟内每隔10s刷新序列号。
测试
重启集群前台能够很快识别到key。</msg>
</logentry>
<logentry
   revision="262104">
<author>ljb</author>
<date>2016-06-13T02:39:31.115877Z</date>
<msg>reviewid 19844
bug TD:  3235
reviewed by : fxw
改动说明： 后台调用派生虚拟机API的时候，优化提示
测试： perl -c 语法通。 
     1、虚拟机为处于模板关机状态，提示： 模板（ljb）不是关机状态，请确保模板关机后重试！</msg>
</logentry>
<logentry
   revision="262073">
<author>ljb</author>
<date>2016-06-12T10:52:02.967509Z</date>
<msg>reviewid 19838
bug TD:  3452
reviewed by : hyq
改动说明： 增加一个超时机制；并且检查虚拟机的状态，如果虚拟机不是running状态就退出。防止子进程一直不退出，死循环。
测试： perl -c  语法通过。 </msg>
</logentry>
<logentry
   revision="262049">
<author>fxw</author>
<date>2016-06-12T09:14:22.191775Z</date>
<msg>noreview
更新spice库</msg>
</logentry>
<logentry
   revision="262042">
<author>lcy</author>
<date>2016-06-12T08:59:02.588801Z</date>
<msg>reviewid: 19831
review by fxw
Bug id: 3255
问题分析：TD3255,【批量修改集群通信口】批量修改集群通信口，提交页面所选择的网口被聚合，提交有问题
问题出现的根源：
这是聚合网口编辑遗留的问题。
打开多个编辑网口的页面，然后点开编辑网口，但是不提交，在另外的页面把这个网口给聚合，就会有这种问题
改动说明：
编辑网口的时候，假如判断到这个网口已经成为了聚合网口的成员网口了，就不允许再次配置IP信息。
自测：
4.9.00_B
build 2016-06-01 00:52:13
自测通过。</msg>
</logentry>
<logentry
   revision="262026">
<author>fxw</author>
<date>2016-06-12T07:03:55.079738Z</date>
<msg>noreview
加回内核日志</msg>
</logentry>
<logentry
   revision="262006">
<author>fxw</author>
<date>2016-06-12T03:15:30.940478Z</date>
<msg>noreview
更新spice库</msg>
</logentry>
<logentry
   revision="261919">
<author>hyq</author>
<date>2016-06-08T09:46:38.540019Z</date>
<msg>no review
bug id : 3420
问题描述 : 【删除虚拟机】删除vs上的虚拟机成功，但是后台残留配置，
代码未通过测试，已确认是自动化的问题，回滚，并修改几个在调试中发现的未定义变量的问题</msg>
</logentry>
<logentry
   revision="261800">
<author>hyq</author>
<date>2016-06-07T13:44:40.582669Z</date>
<msg>no review
bugid: 3420
改动说明：删除vs上的虚拟机成功，但是后台残留配置
自测：自测无残留</msg>
</logentry>
<logentry
   revision="261758">
<author>hyq</author>
<date>2016-06-07T11:06:37.822474Z</date>
<msg>reviewid : 19732
bug id : 3309
问题描述 : td3309 : 【vdi】用pc接入vdi，个人盘只有1G容量，还有39G未分配
改动说明 : 如果虚拟机配置里磁盘没有序列号，才加上序列号，已经存在的不添加
测试场景 : 后台查看虚拟机开机进程，ps auxf | grep $vmid | grep "serial=" --color=auto</msg>
</logentry>
<logentry
   revision="261695">
<author>ssl</author>
<date>2016-06-07T03:31:28.915000Z</date>
<msg> by  ccm
合入解决 VDI4.8_TD41826_国联人寿 虚拟机异常的问题 </msg>
</logentry>
<logentry
   revision="261693">
<author>ssl</author>
<date>2016-06-07T03:28:36.392944Z</date>
<msg>by csh
提交体验得分初步实现（还需要优化头部带的时间戳字节），以及是否启用woc</msg>
</logentry>
<logentry
   revision="261687">
<author>fxw</author>
<date>2016-06-07T02:59:15.164433Z</date>
<msg>noreview
bugid: 3463
改动说明：替SSL上库
原32修改为1，因为队列长度已经修改为2048了，已经足够存放了。这里如果还为32，则几帧画面可能就会消耗完40多M的缓存，这时又没有SPICE_RING_PUSH，就会导致qxl驱动认为ring是空的，而触发OOM操作。</msg>
</logentry>
<logentry
   revision="261632">
<author>yangwei</author>
<date>2016-06-06T12:08:33.802132Z</date>
<msg>reviewid 19707
review by lcy
bugid 3157
说明：无效的vs序列号授权数返回-1
测试：没有acenter授权，接入acenter但是没有授权或者过期，vtsn_tool -V返回-1</msg>
</logentry>
<logentry
   revision="261596">
<author>hjh</author>
<date>2016-06-06T08:53:39.691315Z</date>
<msg>reviewid: 19697
review by: lcy
BUG ID: [3330]
问题分析：虚拟机的光驱启动参数有问题导致虚拟机开机失败

改动说明：创建虚拟机时如果“磁盘”+“光驱”数量&gt;=4，那么就不能再新增光驱了

做了哪些测试：
1.jshint通过
2.自测通过</msg>
</logentry>
<logentry
   revision="261581">
<author>ssl</author>
<date>2016-06-06T07:56:19.245877Z</date>
<msg>修正解决TD【2979】代码错误</msg>
</logentry>
<logentry
   revision="261575">
<author>yangwei</author>
<date>2016-06-06T06:58:37.805283Z</date>
<msg>reviewid 19687
bugid 3359
review by fxw
说明 在执行任务过滤的时候，采用匹配的方式进行过滤，如果过滤备份虚拟机也会把恢复备份虚拟机过滤进去。
修改 只过滤相同的过滤类型
测试
多次同时对同一个虚拟机备份和批量备份，备份和恢复。虚拟机可以正常处理各种环节，能正常开机</msg>
</logentry>
<logentry
   revision="261572">
<author>fxw</author>
<date>2016-06-06T06:50:10.168311Z</date>
<msg>SSL上库 TD【2979】，解决spice-server在播放高度非16倍数的yuv视频时，存在读源数据越界，可能引发读异常的问题，解决方法是转换时，最后一块非16行高度按实际的高度拷贝源数据。测试方法：需用郑宇做的专用测试工具在虚拟机内播放视频测试</msg>
</logentry>
<logentry
   revision="261550">
<author>yangwei</author>
<date>2016-06-05T09:57:24.588232Z</date>
<msg>reviewid 19685
bugid 3308
review by fxw
说明  只有成功编辑虚拟机才会打日志</msg>
</logentry>
<logentry
   revision="261548">
<author>yangwei</author>
<date>2016-06-05T08:04:41.695120Z</date>
<msg>reviewid 19684
bugid 2067
review by fxw
说明 带key主机重启前台仍可以注册序列号问题
修改 注册序列判断带key主机是否在线</msg>
</logentry>
<logentry
   revision="261543">
<author>yangwei</author>
<date>2016-06-05T05:45:08.822245Z</date>
<msg>reviewid 19682
bugid null
review by fxw
说明：
如果A主机重启，A主机有key，因为序列号工具比corosync先启动，corosync会将A主机更新的序列号的数据覆盖掉。导致过一点时间才显示key在线。</msg>
</logentry>
<logentry
   revision="261529">
<author>hjh</author>
<date>2016-06-04T09:30:40.014673Z</date>
<msg>reviewid: 19683
reviewd by: gwl
BUG ID: [3077]
问题分析：【UI】win10的磁盘分配方式默认是动态分配，但是下拉框里面没有

改动说明：win10的磁盘分配方式默认改为精简分配

做了哪些测试：
1.jshint通过
2.自测通过</msg>
</logentry>
<logentry
   revision="261494">
<author>yangwei</author>
<date>2016-06-04T06:43:58.279188Z</date>
<msg>reviewid 19680
bugid 3157
说明：回滚代码，vs序列号由vs保证。</msg>
</logentry>
<logentry
   revision="261350">
<author>hyq</author>
<date>2016-06-03T09:01:23.043776Z</date>
<msg>reviewid : 19638
bug id : 3019
问题描述 :  虚拟机转换成模板前删除光驱
改动说明 : 转换成模板删除光驱，出错恢复</msg>
</logentry>
<logentry
   revision="261228">
<author>yangwei</author>
<date>2016-06-02T11:43:46.661168Z</date>
<msg>reviewid 19491
bugid 3157
review by fxw
说明： VS的cpu核数授权不够，在VS上的虚拟机也可以开机
测试：
再授权不足或者没有授权无法开vs的虚拟机</msg>
</logentry>
<logentry
   revision="261141">
<author>fxw</author>
<date>2016-06-02T04:02:21.253122Z</date>
<msg>noreview
更新VS</msg>
</logentry>
<logentry
   revision="261140">
<author>fxw</author>
<date>2016-06-02T04:01:18.161635Z</date>
<msg>Merged revision(s) 261066, 261074, 261091, 261113, 261126 from VTP/aSV4.6/VMP4.7:
noreview
get_all_vmdisks_size里变量判断报错，应该先判断是否是undef，而不是直接引用
........
reviewid: 19542
bug id: 2702
问题分析：
另外还发现cfs_update并发失败的情况，查到是内核somaxconn设置为默认值128，导致pmxcfs在使用libqb服务端listen时，backlog最大设置128
那么支持的并发请求只能小于128了，超过则connect失败，所以需要改大backlog以支持并发connect，
具体修改方法是：修改libqb，支持用户设定backlog，修改pmxcfs server，设定backlog 1000


另外考虑以后并发大了之后，由于pmxcfs设置的ipc server是单线程事件循环，这就会使得处理request时占用线程时间， 导致处理connect较慢，
尝试修改pmxcfs在accept之后，处理msg时，改为线程池的方式，这样可以支持更多并发connect（因为提升了connect的处理能力，可以加快释放backlog list）
实践结果证明：线程池方式可行。

另外，① 测试过pmxcfs的ipc处理时间，均在1ms以内，在一定的并发范围内， 可以忽略单线程处理能力对connect的影响
      ② 测试过1000个cfs_update的并发请求， 多次试验，不再出现connect失败

综合以上测试和分析，当前处理方案为： 只修改connect的限制，设定backlog到1000， 如果后续还发现cfs_update有并发瓶颈（可能在HCI5.1的多用户场景会有），可以尝试把线程池方式加上
可能会多消耗一点cpu，据测试时的观察，并发1000时，内存16MB左右，cpu占用率可能有飙到100%（正常时为%0） ，持续时间不长，单主机，估计要对集群下的pmxcfs查看下cpu消耗了，实在不行就降低server线程的优先级，至少处理一次request的时间还比较短。

自测说明：
个人单机环境自测通过
........
reviewid: 19542
bug id: 2702
问题分析：
另外还发现cfs_update并发失败的情况，查到是内核somaxconn设置为默认值128，导致pmxcfs在使用libqb服务端listen时，backlog最大设置128
那么支持的并发请求只能小于128了，超过则connect失败，所以需要改大backlog以支持并发connect，
具体修改方法是：修改libqb，支持用户设定backlog，修改pmxcfs server，设定backlog 1000


另外考虑以后并发大了之后，由于pmxcfs设置的ipc server是单线程事件循环，这就会使得处理request时占用线程时间， 导致处理connect较慢，
尝试修改pmxcfs在accept之后，处理msg时，改为线程池的方式，这样可以支持更多并发connect（因为提升了connect的处理能力，可以加快释放backlog list）
实践结果证明：线程池方式可行。

另外，① 测试过pmxcfs的ipc处理时间，均在1ms以内，在一定的并发范围内， 可以忽略单线程处理能力对connect的影响
      ② 测试过1000个cfs_update的并发请求， 多次试验，不再出现connect失败

综合以上测试和分析，当前处理方案为： 只修改connect的限制，设定backlog到1000， 如果后续还发现cfs_update有并发瓶颈（可能在HCI5.1的多用户场景会有），可以尝试把线程池方式加上
可能会多消耗一点cpu，据测试时的观察，并发1000时，内存16MB左右，cpu占用率可能有飙到100%（正常时为%0） ，持续时间不长，单主机，估计要对集群下的pmxcfs查看下cpu消耗了，实在不行就降低server线程的优先级，至少处理一次request的时间还比较短。

自测说明：
个人单机环境自测通过
........
reviewid: 19542
bug id: 2702
问题分析：
针对2702的修改，和sddc同步一次代码
........
noreview
和sddc同步一次代码
........
</msg>
</logentry>
<logentry
   revision="261139">
<author>fxw</author>
<date>2016-06-02T03:49:12.187209Z</date>
<msg>noreview
SSL要用，还原镜像</msg>
</logentry>
<logentry
   revision="261120">
<author>fxw</author>
<date>2016-06-02T02:13:51.739635Z</date>
<msg>noreview
调试工具更新版本</msg>
</logentry>
<logentry
   revision="261109">
<author>fxw</author>
<date>2016-06-02T00:17:52.024480Z</date>
<msg>noreview
替VS上库
bugid：无
改动说明：合入SDDC 的VS修改，读取文件的公共函数没有将字符串转为utf-8格式，查看其它(vt)调用from_json的地方发现都是使用了{utf8 =&gt; 1}的参数，grep了使用该函数的地方， 只有两个，其中一个只是读取英文字符串，所以不会有乱码
</msg>
</logentry>
<logentry
   revision="261108">
<author>fxw</author>
<date>2016-06-02T00:10:00.511113Z</date>
<msg>noreview
bugid: 3363
改动说明：目前只针对cpu signature为0x000306e4的设备做microcode升级。这样既解决了0x50蓝屏问题，也能避免cpu频率异常问题。
自测：无
</msg>
</logentry>
<logentry
   revision="261007">
<author>fxw</author>
<date>2016-05-31T12:33:35.195062Z</date>
<msg>noreview
从VMP4.8R1少合了代码</msg>
</logentry>
<logentry
   revision="260991">
<author>fxw</author>
<date>2016-05-31T11:42:23.506874Z</date>
<msg>noreview
bugid: 1006
改动说明：
1. 将spice配置改成json格式存储，方便后续的接口开发
2. 给win10增加声卡类型
</msg>
</logentry>
<logentry
   revision="260947">
<author>hjh</author>
<date>2016-05-31T07:43:41.757770Z</date>
<msg>reviewid: 19496
reviewd by:  lcy
BUG ID: [3191]
问题分析：【编辑虚拟机】虚拟机网卡本来有两张的，但是点击编辑只显示一张

改动说明：做一个是否新增的判断

做了哪些测试：
1.jshint通过
2.自测通过</msg>
</logentry>
<logentry
   revision="260936">
<author>fxw</author>
<date>2016-05-31T03:17:34.939873Z</date>
<msg>noreview
上库调试工具</msg>
</logentry>
<logentry
   revision="260926">
<author>fxw</author>
<date>2016-05-31T01:03:34.817504Z</date>
<msg>noreview
加一个内存性能测试的日志</msg>
</logentry>
<logentry
   revision="260911">
<author>hjh</author>
<date>2016-05-30T12:11:20.651555Z</date>
<msg>reviewid: 19474
reviewd by:  fxw
BUG ID: [2953]
问题分析：【需求】【UI】acenter需求VMP界面修改

改动说明：
1.快要过期时，头部提示文字改为：{0}天后序列号将会过期。会影响您的正常使用，请插入USB-KEY或申请序列号授权。
2.当有 is_acentered 字段但 sn_src 不等于 2 时，头部提示文字：当前序列号授权异常，会影响您的正常使用，请尽快修复。
3.显示授权来源。
4.当连接上 acenter 时，显示“脱离acenter”按钮

做了哪些测试：
1.jshint通过
2.自测通过</msg>
</logentry>
<logentry
   revision="260891">
<author>lcy</author>
<date>2016-05-30T09:31:38.752520Z</date>
<msg>reviewid: 19457
review by hjh
TD3167,【需求】修改VMP密码的时候，提示一下需要到VDC修改控制器的密码
新需求
修改VMP密码的时候，提示用户需要同步修改一下VDC连接的VMP控制器的密码。
自测通过</msg>
</logentry>
<logentry
   revision="260887">
<author>yangwei</author>
<date>2016-05-30T09:05:07.014446Z</date>
<msg>reviewid 19454
bugid 2881
reviewby fxw
说明：修改添加主机cpu授权不足描述</msg>
</logentry>
<logentry
   revision="260885">
<author>fxw</author>
<date>2016-05-30T08:47:43.359527Z</date>
<msg>noreview
加写重要信息的日志</msg>
</logentry>
<logentry
   revision="260884">
<author>yangwei</author>
<date>2016-05-30T08:46:54.075488Z</date>
<msg>reviewid 19453
bugid 3139
reviewby fxw
说明：
【aCenter】aCenter变更网口IP后，vdc侧配置同步aCenter的IP变更，aCenter侧多加了一模一样的一条vmp服务器记录
分析：
脱离acenter，VMP仍然保存之前的hardid。
测试：
vmp加入acenter，修改acenter ip，在vdc修改acenterip重新接入到acenter，acenter没有多余的vmp记录，acenter也可以链接到vdc和vmp。</msg>
</logentry>
<logentry
   revision="260787">
<author>fxw</author>
<date>2016-05-28T10:01:56.527888Z</date>
<msg>noreview
bugid: 1006
改动说明：
1. kvm_spice_setting.conf位置移到/cfs/VDC下面
2. 增加摄像头参数camera_num
3. 重构了spice参数解析的代码
自测：
1. 获取虚拟机参数正常
2. 升级脚本执行正常</msg>
</logentry>
<logentry
   revision="260783">
<author>lcy</author>
<date>2016-05-28T09:43:43.999909Z</date>
<msg>reviewid: 19412
review by fxw
Bug id: 3143
问题分析：TD3143,【虚拟机导出】导出虚拟机的时候，出现进度条150%，预计时间为-2秒
问题出现的根源：
对返回给前台的数据没有做检查
改动说明：
假如判断到数据不合法，检查一下，并且设置为合法值
自测：
4.9.00_B
build 2016-05-28 00:57:28
自测通过。</msg>
</logentry>
<logentry
   revision="260769">
<author>lcy</author>
<date>2016-05-28T08:23:13.358126Z</date>
<msg>reviewid: 19403
review by fxw
Bug id: 2697
问题分析：TD2697，【合入】【需求】建议导入、克隆虚拟机要在这个虚拟机的日志里加一条导入、克隆虚拟机的日志，不然过了很久都不知道虚拟机怎么来的
改动：
克隆虚拟机，VMA导入虚拟机，新建的虚拟机都有一条日志。
自测：
4.9.00_B
build 2016-05-28 00:57:28
自测通过。</msg>
</logentry>
<logentry
   revision="260767">
<author>yangwei</author>
<date>2016-05-28T08:10:43.568343Z</date>
<msg>reviewid 19397
bugid 3132
review by fxw
说明 添加主机计算cpu数混乱
修改 使用vtsn_tool -g检查集群的cpu数量</msg>
</logentry>
<logentry
   revision="260761">
<author>fxw</author>
<date>2016-05-28T07:20:52.743198Z</date>
<msg>noreview
bugid: 3030
改动说明：回收条件调整，可回收内存超过虚拟机配置内存10%（之前是虚拟机占用物理内存的10%），或者超过256M（之前是1G）就进行回收</msg>
</logentry>
<logentry
   revision="260758">
<author>yangwei</author>
<date>2016-05-28T06:24:25.589124Z</date>
<msg>reviewid 19392
review by fxw
bugid 3051
说明 删除节点清理acenter序列号
测试：
被删除节点没有acenter信息。
打包验证</msg>
</logentry>
<logentry
   revision="260749">
<author>fxw</author>
<date>2016-05-28T03:13:26.838320Z</date>
<msg>noreview
更新VS</msg>
</logentry>
<logentry
   revision="260748">
<author>fxw</author>
<date>2016-05-28T03:12:27.100315Z</date>
<msg>Merged revision(s) 260094, 260209, 260425, 260454, 260640, 260720 from VTP/aSV4.6/VMP4.7:
noreview
新接口的修改，还在联调，改动大，不好替换代码，先上库打包
........
noreview
没加makefile
........
noreview
1.cfs_update 单个进程作请求合并
2.去掉部分刷屏日志
3.新接口有逻辑问题
4.去掉apache client限制，按默认的来
........
noreview
没加makefile
........
noreview
1.去掉vdcinterface的调试日志
2.修改fork_worker的print重定向，逻辑自测通过
3.去掉redis的一些调试日志
4.去掉tools中部分刷屏调试日志
5.改写proxy_handle，本地主机的就不要使用http去代理执行了，自测通过
........
noreview
1.去掉部分调试用的代码
2.修改查询log时，由于编码问题导致的log error
  修改日志接口，对utf8编码的返回值进行encode
3.修改proxy_handler的本机返回值，以前是http返回utf8，本机也作一次decode
  以防止编码问题导致改动引发。
........
</msg>
</logentry>
<logentry
   revision="260746">
<author>lcy</author>
<date>2016-05-28T03:03:01.812456Z</date>
<msg>reviewid: 19380
review by fxw
Bug id: 1121
问题分析：TD1121,【错误提示问题】批量备份虚拟机连接超时显示的错误信息是‘剩余空间不足’
问题出现的根源：
SSH连接远程主机，获取存储大小的时候超时了。这个时候应该给UI返回连接超时，需要重试的提示，但是错误信息
没有及时传到最外层的函数调用中，导致错误信息中途被截获并且修改了
改动说明：
获取远程主机的存储大小出错了，提示连接超时，并且重试
自测：
4.9.00_B
build 2016-05-28 00:57:28
自测通过。</msg>
</logentry>
<logentry
   revision="260743">
<author>fxw</author>
<date>2016-05-28T02:45:52.892090Z</date>
<msg>noreview
参数个数的计算有问题</msg>
</logentry>
<logentry
   revision="260735">
<author>yangwei</author>
<date>2016-05-28T01:51:17.789132Z</date>
<msg>reviewid 19373
reviewby fxw
bugid 2953
说明：
添加序列号来源
修改
序列号来源0无，1usb，2acenter
测试：
标准版返回0，企业版返回1或者2；
加入acenter企业版，acenter有效返回2无效返回1.
未加入acenter企业版，返回1</msg>
</logentry>
<logentry
   revision="260734">
<author>fxw</author>
<date>2016-05-28T01:23:46.165925Z</date>
<msg>noreview
把VDI48.qcow2做成空文件，减少包的体积。等有4.9 qcow2在替换回来</msg>
</logentry>
<logentry
   revision="260718">
<author>lcy</author>
<date>2016-05-27T10:09:42.314652Z</date>
<msg>review id:19336
review by fxw
【需求】虚拟机内部关机也要打一个操作日志
主要修改点：
1. qemu针对UI发起的关机和关闭虚拟机电源进行判断处理，回调01vmstop叫笨蛋额时候，传递stop_outside的参数
2. 01vmstop脚本假如判断到参数不为stop_outside，即是内部关机，打印一条日志在前台。</msg>
</logentry>
<logentry
   revision="260698">
<author>fxw</author>
<date>2016-05-27T07:55:05.247387Z</date>
<msg>noreview
sfd_send_file.sh 增加指定分区的参数</msg>
</logentry>
<logentry
   revision="260696">
<author>fxw</author>
<date>2016-05-27T07:41:24.110426Z</date>
<msg>noreview
改动说明：加一个调试开关，修改可配置内存为虚拟机内存的80%
说明：开关/sf/cfg/memory_free
自测：
1. 测试虚拟机可以正常开机
2. 主机详情界面的可配置内存增加</msg>
</logentry>
<logentry
   revision="260680">
<author>fxw</author>
<date>2016-05-27T04:58:22.795994Z</date>
<msg>noreview
增加调试工具：把文件传入虚拟机磁盘镜像的第一个分区，需要虚拟机关机，分区的文件系统格式是NTFS</msg>
</logentry>
<logentry
   revision="260678">
<author>lcy</author>
<date>2016-05-27T04:36:16.833020Z</date>
<msg>review id:19320
review by lsh
【需求】页面加入禁用fastio功能。
主要修改点：
新增和编辑虚拟机的调试选项，多一个选择框。
新增虚拟机的时候，该框是属于禁用状态的。
编辑虚拟机的时候，如果虚拟机安装了virtio，这个框才是可以编辑，否则也是禁用状态的。因为只有安装了virtio才能选择是否要使用fastio。
派生的时候，以模板为准</msg>
</logentry>
<logentry
   revision="260675">
<author>qifei</author>
<date>2016-05-27T03:46:59.438764Z</date>
<msg>revision 19338
给acenter添加强制升级功能,在overview的version字段多加一行显示当前环境是否可升级。</msg>
</logentry>
<logentry
   revision="260667">
<author>hyq</author>
<date>2016-05-27T02:47:04.391319Z</date>
<msg>reviewid : 19332
bug id : 3072
问题描述 : td3072 : 【优先级低】【bug】派生虚拟机的存储被删导致无法更新模板
改动说明 : 已经不存在的存储不做检查</msg>
</logentry>
<logentry
   revision="260652">
<author>fxw</author>
<date>2016-05-27T01:36:31.765665Z</date>
<msg>noreview
Merged revision(s) 239819, 239921, 240371, 242685 from VTP/aSV4.2/Branchs/aSV4.2_SDDC_Discard/src/app/openssh:
reviewid: 13053
reviewd by: czy
bugid: 31800
问题原因：
文件系统分配的块改为1MB，在平常复制文件时，非directio操作要先清掉这1MB的数据，写0，然后再真正写入需要写入的数据。这样写一次文件就会有2次io。
改动说明：
1.修改tolocal函数，在调用cp前，先创建一个同名文件并清除该文件的标记，然后在修改后恢复该标记
2.修改后本地拷贝时，两边都是sf文件系统时可以避免进行两次io
........
reviewid: 13115
reviewd by: czy
bugid: null
问题原因：
打包编译openssh时会出现找不到头文件的问题
改动说明：
1.在makefile.in中CPPFLAGS增加-I$(INCDIR)
2.运行configure重新生成makefile
........
reviewid 13228
BUG ID: 32443
问题分析：之前一个改动将Makefile的prefix路径改了，sfscp里面用了prefix路径去查找ssh程序，导致ssh找不到。
改动说明：回滚之前的改动
做了哪些测试：1.未修改前用svn上代码编译，sfscp跨主机拷贝报错
2.修改后，在编译后执行sfscp测试通过
........
reviewid 13845
Reviewed by :czy
BUG ID :32982
问题分析：备份虚拟机到共享目录拷贝磁盘失败
改动说明：sfscp拷贝文件到共享目录权限不足导致拷贝失败
做了哪些测试:
测试备份到共享目录
........
</msg>
</logentry>
<logentry
   revision="260618">
<author>hyq</author>
<date>2016-05-26T11:56:12.002163Z</date>
<msg>reviewid : 19298
bug id : null
问题描述 : 函数tpl_check_storage移到QemuDerive中没有去掉原来调用的函数包名</msg>
</logentry>
<logentry
   revision="260616">
<author>hyq</author>
<date>2016-05-26T11:55:33.654130Z</date>
<msg>reviewid : 19299
bug id : 3057
问题描述 : td3057 : 【bug】【mac绑定】【北京利尔高温】静态mac绑定，导致集群之间通信有问题
问题分析 : 替换主机，替换和被替换的主机的IP是相同的因此导致保留在arp表里的静态项没有重新加载，集群通信异常
改动说明 : 主机发现其它主机掉线，则把该主机的管理通信网口的静态arp缓存清掉</msg>
</logentry>
<logentry
   revision="260607">
<author>fxw</author>
<date>2016-05-26T11:29:20.097997Z</date>
<msg>noreview
修改帮助文档”增加一个调试脚本，可以批量给多台虚拟机发送键盘信号“</msg>
</logentry>
<logentry
   revision="260606">
<author>fxw</author>
<date>2016-05-26T11:28:26.391378Z</date>
<msg>noreview
增加一个调试脚本，可以批量给多台虚拟机发送键盘信号</msg>
</logentry>
<logentry
   revision="260553">
<author>hyq</author>
<date>2016-05-26T03:47:47.515152Z</date>
<msg>reviewid : 19256
bug id : null
问题描述 : perl打印栈调试开关不放在cfs目录
因为cfs异常会导致无法调试perl脚本
可通过 执行命令  sfd_clu_hosts_do.sh touch /sf/log_stack.switch</msg>
</logentry>
<logentry
   revision="260548">
<author>lcy</author>
<date>2016-05-26T03:25:03.662026Z</date>
<msg>reviewid: 19240
review by fxw
Bug id: 2257
问题分析：TD2257,【bug】【技术支持】【vmp4.8.01】【嘉兴美可泰科技 2509815003】虚拟机的报表服务没有起来
问题出现的根源：
无
改动说明：
如果检测到虚拟机的报表信息不是来自于虚拟机内部透传的数据，在前台添加一个警告项。每个月警告一次。
虚拟机开机后，5分钟内不检查，开机超过了5分钟，开始检查，发现装了virtio，但是报表信息没有能正确获取，
则发出警告。
自测：
4.9.00_B
build 2016-0</msg>
</logentry>
<logentry
   revision="260547">
<author>lcy</author>
<date>2016-05-26T03:23:22.293512Z</date>
<msg>reviewid: 19251
review by fxw
Bug id: 2257
问题分析：TD2257,【bug】【技术支持】【vmp4.8.01】【嘉兴美可泰科技 2509815003】虚拟机的报表服务没有起来
问题出现的根源：
无
改动说明：
如果检测到虚拟机的报表信息不是来自于虚拟机内部透传的数据，在前台添加一个警告项。每个月警告一次。
虚拟机开机后，5分钟内不检查，开机超过了5分钟，开始检查，发现装了virtio，但是报表信息没有能正确获取，
则发出警告。
自测：
4.9.00_B
build 2016-05-24 00:58:18
自测通过。</msg>
</logentry>
<logentry
   revision="260542">
<author>yangwei</author>
<date>2016-05-26T02:57:04.519850Z</date>
<msg>reviewid 19248
bugid 2945
review by fxw
修改：
企业版的vmp，如果获取的授权不正确或者回收授权，仍需要将授权数据写入cfs。
测试：
打包验证。</msg>
</logentry>
<logentry
   revision="260541">
<author>fxw</author>
<date>2016-05-26T02:53:28.235485Z</date>
<msg>noreview
bugid: 2958
改动说明：把权限校验还原，acenter会用管理员帐号登陆，不需要放开权限校验
自测：在acenter环境测试：
1. 可以登陆VMP
2. 可以创建虚拟机
3. 可以修改授权
4. 可以修改VMP名称</msg>
</logentry>
<logentry
   revision="260532">
<author>fxw</author>
<date>2016-05-26T02:04:35.543865Z</date>
<msg>noreview
bugid：TD3030
改动说明：
1. 回收条件修改：如果可回收超过1G，也会回收
2. 给操作系统保留的内存减少至50M
自测：
1. 测试虚拟机内存回收通过


</msg>
</logentry>
<logentry
   revision="260520">
<author>hyq</author>
<date>2016-05-26T01:25:37.189574Z</date>
<msg>reviewid : 19241
bug id : 3052
问题描述 : td3052 : 【bug】/run分区被占满导致【广西交通职业学院测试】
改动说明 : 合入td2709, /run 修改为64M, /run/dev 修改为32M
测试 : 需要打包测试</msg>
</logentry>
<logentry
   revision="260502">
<author>twf</author>
<date>2016-05-25T10:47:20.585456Z</date>
<msg>reviewid: 19234
review by: chenlei
Bug id: null
问题分析：
重新打vmtools iso包，包含更新的win10驱动
改动说明：
1.重新打vmtools iso包，包含更新的win10驱动
自测：
脚本测试通过

</msg>
</logentry>
<logentry
   revision="260501">
<author>twf</author>
<date>2016-05-25T10:41:51.402886Z</date>
<msg>reviewid: 19233
review by: chenlei
Bug id: null
问题分析：
将驱动中Redhat标记改为Sangfor
改动说明：
1.将驱动中所有的Redhat标记改为Sangfor
2.重新编译相关驱动
自测：
在win10 32位设备管理器中查看，所有驱动名字已改为Sangfor Fastio

</msg>
</logentry>
<logentry
   revision="260481">
<author>fxw</author>
<date>2016-05-25T08:17:06.663533Z</date>
<msg>noreview
1. 合入qcow2元数据校验，默认不开启
2. 解决check -r的时候assert(0)的问题
</msg>
</logentry>
<logentry
   revision="260480">
<author>yangwei</author>
<date>2016-05-25T08:04:24.194164Z</date>
<msg>reviewid 19225
bugid 2067
reviewed by fxw
说明：修改序列号工具启动顺序
修改：
hotplugusb日志找不到socket，修改启动顺序。
检测到旧的socket会删除重新创建，不影响。
操作key失败已经在bug1585修改，会重新打开key。F0000004错误需要飞天公司处理。
测试：
打包验证。</msg>
</logentry>
<logentry
   revision="260465">
<author>fxw</author>
<date>2016-05-25T07:06:01.337113Z</date>
<msg>noreview
bugid：TD3030
改动说明：
1. 把回收虚拟机内存的阈值改成虚拟机配置内存的10%
2. 加一些调试日志
自测：
1. 测试虚拟机内存回收通过
2. 日志检查有输出

</msg>
</logentry>
<logentry
   revision="260448">
<author>fxw</author>
<date>2016-05-25T04:56:50.029150Z</date>
<msg>noreview
TD759
给Qemu启动参数增加磁盘序列号</msg>
</logentry>
<logentry
   revision="260436">
<author>hyq</author>
<date>2016-05-25T02:43:53.769994Z</date>
<msg>reviewid : 19205
bug id : 2964
问题描述 : 备份策略中只有一个虚拟机，该虚拟机所在的存储已经离线，备份过程抛出异常被捕获但不是取消操作，错误被忽略，导致UI没有任何反应
改动说明 : 除了任务取消操作异常做特殊处理外，其它错误信息打错误日志</msg>
</logentry>
<logentry
   revision="260415">
<author>fxw</author>
<date>2016-05-24T13:19:15.314703Z</date>
<msg>noreview
去掉mac默认格式，防止编辑没有换行的文件时vim默认识别成mac fileformat</msg>
</logentry>
<logentry
   revision="260412">
<author>twf</author>
<date>2016-05-24T13:01:06.828429Z</date>
<msg>reviewid: 19195
review by: chengtao
Bug id: null
问题分析：
上库Update.xml
改动说明：
上库Update.xml
自测：
脚本测试通过

</msg>
</logentry>
<logentry
   revision="260409">
<author>twf</author>
<date>2016-05-24T12:58:22.279050Z</date>
<msg>reviewid: 19191
review by: fxw
Bug id: null
问题分析：
重新打vmtools iso包，包含更新的win10驱动
改动说明：
1.重新打vmtools iso包，包含更新的win10驱动
自测：
脚本测试通过

</msg>
</logentry>
<logentry
   revision="260407">
<author>hyq</author>
<date>2016-05-24T12:54:30.262012Z</date>
<msg>reviewid : 19190
bug id : 2874
问题描述 : 【bug】【遗留】本地虚拟机克隆到共享存储之后没有主机可以编辑
改动说明 : 克隆虚拟机不克隆光驱镜像</msg>
</logentry>
<logentry
   revision="260396">
<author>twf</author>
<date>2016-05-24T12:25:27.564194Z</date>
<msg>reviewid: 19185
review by: fxw
Bug id: null
问题分析：
上库win10驱动代码及二进制文件
改动说明：
1.上库win10驱动代码及二进制文件
2.win10代码为redhat原版代码，未合入我们自己的改动
自测：
ssl有测试</msg>
</logentry>
<logentry
   revision="260377">
<author>lcy</author>
<date>2016-05-24T11:07:45.335460Z</date>
<msg>reviewid: 19154
review by fxw
Bug id: 1296
问题分析：TD1296,【bug】【技术支持】【兖矿集团----田爽QQ517456756】【VMP4.8.00_B】free -h cached 占用了109G内存，平台内存123G， 导致拷贝数据慢了，只有2MB/S
问题出现的根源：
无
改动说明：
增加一个定时扫描脚本，每5分钟扫描一次，假如发现有scp进程，那么清理cache
自测：
4.9.00_B
build 2016-05-24 00:58:18
自测通过。</msg>
</logentry>
<logentry
   revision="260374">
<author>hyq</author>
<date>2016-05-24T11:03:53.596834Z</date>
<msg>reviewid : 19162
bug id : 1419
问题描述 : 被添加的主机管理通信网口网段与本地的主机管理通信网口不在同一网段添加后显示离线，
改动说明 : 添加的过程检查远程主机的管理通信网口IP是否与本主机管理通信网口在同一个网段</msg>
</logentry>
<logentry
   revision="260258">
<author>lcy</author>
<date>2016-05-24T01:12:09.756503Z</date>
<msg>reviewid: 19092
review by fxw
Bug id: 982
问题分析：TD982，【bug】【功能异常】【asv】批量启动虚拟机(30台)有一台虚拟机未启动【疑难】
问题出现的根源：
出现那一台没有启动的原因是，读取虚拟机的conf文件内容为空引起的，然后原来的版本中对于虚拟机的conf文件内容为空是直接退出脚本的，没有进行其他的处理。
也就是说，假如集群中有多台主机，出现这种情况也只会在一台主机上启动，并且前台没有任何日志。-
改动说明：
1. 现在的修改时规避方法，在vtpvm的去检测虚拟机的有效性的时候，假如发现虚拟机的配置信息为空，那么多尝试几次。
2. 即使出现在一台主机上，很特殊的情况下发现有一台主机读取不到配置信息，也会尝试去其他主机上启动虚拟机，可以保证集群中有主机可以启动当前的虚拟机。
自测：
4.9.00_B
build 2016-05-22 00:57:17
自测通过。</msg>
</logentry>
<logentry
   revision="260215">
<author>hyq</author>
<date>2016-05-23T09:46:02.515540Z</date>
<msg>reviewid : 19105
bug id :null
reviewed by : lifan
问题描述 : 合入asv改动</msg>
</logentry>
<logentry
   revision="260199">
<author>lcy</author>
<date>2016-05-23T08:34:48.235081Z</date>
<msg>reviewid: 19096
review by hyq
Bug id: 2966
问题分析：TD2966，【开机编辑】配置的生效的时候打印一点描述成功的描述信息
问题出现的根源：
无
改动说明：
配置生效任务把描述信息打印一些，说明是虚拟机的未生效的配置生效成功。
自测：
4.9.00_B
build 2016-05-22 00:57:17
自测通过。</msg>
</logentry>
<logentry
   revision="260142">
<author>fxw</author>
<date>2016-05-23T01:26:23.132396Z</date>
<msg>noreview
TD2943
VMP的vm tools禁用自动升级，由vdc agent统一管理</msg>
</logentry>
<logentry
   revision="260139">
<author>hjh</author>
<date>2016-05-23T01:15:35.380183Z</date>
<msg>reviewid: 19040
reviewd by:  lsh
BUG ID: [2345]
问题分析：新建虚拟机，选择vdc操作系统，有四张默认网卡，再切换成非vdc，默认应该只有一张网卡

改动说明：切换成 vdc 时要改为一张网卡

做了哪些测试：
1.jshint通过
2.自测通过</msg>
</logentry>
<logentry
   revision="260106">
<author>fxw</author>
<date>2016-05-21T07:58:19.989249Z</date>
<msg>reviewid 19042
bugid 2950
reviewby fxw
说明：vls客户端改为前台模式
分析：supervisor会自动将其后台模式，导致supervisor大量的日志，因此vls客户端改为前台模式。
测试：和acenter通信正常，授权ok</msg>
</logentry>
<logentry
   revision="260098">
<author>lcy</author>
<date>2016-05-21T07:20:37.466148Z</date>
<msg>reviewid: 19038
review by fxw
Bug id: 2949
问题分析：TD2949，【批量切换集群通信口】处理一下UI提交的网口是离线的情况【特殊场景】
问题出现的根源：
切换集群通信口的时候本来是限制住不能选择未插网线的网口
但是，还是有可能UI提交的网口是未插网线的
之前的处理是，切换的时候会判断到，然后报错。
改动说明：
1. 在前面发现编辑完网口之后，检测网口状态，发现网口未插网线，直接退出，不执行了。
2. 获取旧网口状态的时候，假如发现主机数量少于前台发送的数据的主机数量，也直接退出，任务失败。【防止主机突然离线】
自测：
4.9.00_B
build 2016-05-20 00:58:59
自测通过。</msg>
</logentry>
<logentry
   revision="260093">
<author>hjh</author>
<date>2016-05-21T06:44:30.858386Z</date>
<msg>reviewid: 19030
reviewd by:  lsh
BUG ID: [2879]
问题分析：虚拟机编辑-删除掉其中一个磁盘，再新增一个磁盘，被限制了磁盘大小

改动说明：如果删除了某个磁盘，也要将它原来的限制大小干掉

做了哪些测试：
1.jshint通过
2.自测通过</msg>
</logentry>
<logentry
   revision="260083">
<author>fxw</author>
<date>2016-05-21T03:08:26.217418Z</date>
<msg>noreview
bug id : 2787
问题描述 : 【技术支持】【黑龙江监狱】【VMP4.8.00-b】iscsi存储离线
问题分析 : 存储关闭了ATS但是无法判断出来，所以无法初始化
改动说明 : 不明错误当作不支持ATS处理
自测：在客户那测试通过
----
Modified : /VTP/VMP4.7/Trunk/source/drv/sffs/module/cl_lock/cl_scsi.c

</msg>
</logentry>
<logentry
   revision="260065">
<author>fxw</author>
<date>2016-05-21T02:07:00.503934Z</date>
<msg>noreview
1. 后台日志的信息有误
2. 丰富操作日志错误信息</msg>
</logentry>
<logentry
   revision="260055">
<author>fxw</author>
<date>2016-05-21T01:26:03.714225Z</date>
<msg>noreview
合入代码的时候多合了一个=head，导致语法错误</msg>
</logentry>
<logentry
   revision="260038">
<author>hjh</author>
<date>2016-05-20T09:31:22.342992Z</date>
<msg>reviewid: 18998
reviewd by:  lsh
BUG ID: [691]
问题分析：【虚拟网络】查看虚拟机，连接网口显示的网卡的数字显示成连续的数字

改动说明：修改显示方式

做了哪些测试：
1.jshint通过
2.自测通过</msg>
</logentry>
<logentry
   revision="260028">
<author>lcy</author>
<date>2016-05-20T09:02:24.394020Z</date>
<msg>reviewid: 18987
review by hyq
Bug id: 2930
问题分析：TD2930,【开机编辑】存在开机未生效的配置，自动备份功能不能使用
问题出现的根源：
自动备份和手动备份的外层接口不一样
改动说明：
针对自动备份进行限制
自测：
4.9.00_B
build 2016-05-17 14:33:48
自测通过。</msg>
</logentry>
<logentry
   revision="260016">
<author>hyq</author>
<date>2016-05-20T07:47:48.273082Z</date>
<msg>reviewid : 18981
bugid :
问题描述: 函数没引用包名-改动引发</msg>
</logentry>
<logentry
   revision="260003">
<author>hjh</author>
<date>2016-05-20T07:11:11.818260Z</date>
<msg>reviewid: 18965
reviewd by:  jcy
BUG ID: [2872]
问题分析：【虚拟网络】列表上加上些许提示语

改动说明：
1.“连接到物理网络状态”一列加个“可编辑”提示
2.“自定义配置网口”弹窗中“连接的物理网口”一列加个“可编辑”提示
3.“新增虚拟交换机”中“自定义”选项加上提示

做了哪些测试：
1.jshint通过
2.自测通过</msg>
</logentry>
<logentry
   revision="259988">
<author>hjh</author>
<date>2016-05-20T03:35:47.330182Z</date>
<msg>reviewid: 18961
reviewd by:  lsh
BUG ID: [2285]
问题分析：【任务列表】日志的详细信息描述支持\n换行

改动说明：
修改渲染方法

做了哪些测试：
1.jshint通过
2.自测通过</msg>
</logentry>
<logentry
   revision="259983">
<author>yangwei</author>
<date>2016-05-20T03:10:44.880520Z</date>
<msg>reviewid 18959
bugid 1647
说明：修改vs授权返回，如果加入acenter，断开连接30天返回0
测试：打包验证</msg>
</logentry>
<logentry
   revision="259970">
<author>fxw</author>
<date>2016-05-20T02:18:50.032720Z</date>
<msg>noreview
更新调试工具</msg>
</logentry>
<logentry
   revision="259969">
<author>fxw</author>
<date>2016-05-20T02:14:59.043824Z</date>
<msg>noreview
更新调试工具</msg>
</logentry>
<logentry
   revision="259967">
<author>fxw</author>
<date>2016-05-20T02:10:32.691172Z</date>
<msg>noreview
TD2943
VMP的vm tools禁用自动升级，由vdc agent统一管理</msg>
</logentry>
<logentry
   revision="259966">
<author>fxw</author>
<date>2016-05-20T02:06:07.667580Z</date>
<msg>noreview
更新vs</msg>
</logentry>
<logentry
   revision="259960">
<author>fxw</author>
<date>2016-05-20T01:51:10.389474Z</date>
<msg>noreview
Merged revision(s) 259573 from VTP/aSV4.6/VMP4.7:
Merged revision(s) 254073, 254226, 254237 from VTP/VMP4.7/Trunk:
noreview
增加win10 32位的操作系统类型
........
reviewid : 16925
bug id : 35166
问题描述 : 【虚拟机】perl后台放开创建win10虚拟机限制【需求】
改动说明 : 【虚拟机】perl后台放开创建win10虚拟机限制,启动参数同win7一致
测试场景 : 创建win10虚拟机，并开机成功，启动参数与win7一致
........
reviewid : 16930
bug id : 35166
问题描述 : 【虚拟机】perl后台放开创建win10虚拟机限制【需求】
改动说明 : td35166 : 漏掉一处改动

........

........
</msg>
</logentry>
<logentry
   revision="259959">
<author>fxw</author>
<date>2016-05-20T01:48:36.475849Z</date>
<msg>noreiew
Merged revision(s) 259810-259815 from VTP/aSV4.6/VMP4.7:
noreiew
正对VDC客户端接入作优化：
将所有请求合并，只提供一个接入操作，支持批量
另外修改了新API框架，以后可以在这个框架下写作新代码。

........
noreiew
正对VDC客户端接入作优化：
将所有请求合并，只提供一个接入操作，支持批量
另外修改了新API框架，以后可以在这个框架下写作新代码。

Makefile有点问题

........
noreiew
正对VDC客户端接入作优化：
将所有请求合并，只提供一个接入操作，支持批量
另外修改了新API框架，以后可以在这个框架下写作新代码。

Makefile有点问题

........
noreiew
正对VDC客户端接入作优化：
将所有请求合并，只提供一个接入操作，支持批量
另外修改了新API框架，以后可以在这个框架下写作新代码。

Makefile有点问题

........
</msg>
</logentry>
<logentry
   revision="259957">
<author>fxw</author>
<date>2016-05-20T01:40:52.598759Z</date>
<msg>noreview
合入缺文件，回滚重新合入</msg>
</logentry>
<logentry
   revision="259956">
<author>fxw</author>
<date>2016-05-20T01:37:56.857935Z</date>
<msg>noreiew
Merged revision(s) 259810-259815 from VTP/aSV4.6/VMP4.7:
noreiew
正对VDC客户端接入作优化：
将所有请求合并，只提供一个接入操作，支持批量
另外修改了新API框架，以后可以在这个框架下写作新代码。

........
noreiew
正对VDC客户端接入作优化：
将所有请求合并，只提供一个接入操作，支持批量
另外修改了新API框架，以后可以在这个框架下写作新代码。

Makefile有点问题

........
noreiew
正对VDC客户端接入作优化：
将所有请求合并，只提供一个接入操作，支持批量
另外修改了新API框架，以后可以在这个框架下写作新代码。

Makefile有点问题

........
noreiew
正对VDC客户端接入作优化：
将所有请求合并，只提供一个接入操作，支持批量
另外修改了新API框架，以后可以在这个框架下写作新代码。

Makefile有点问题

........
</msg>
</logentry>
<logentry
   revision="259954">
<author>fxw</author>
<date>2016-05-20T01:30:02.519585Z</date>
<msg>noreview
Merged revision(s) 258965, 259558, 259560, 259575 from VTP/aSV4.6/VMP4.7:
reviewid: 18515
bug id: 
问题分析：cacher计算时间差值时，可能计算到负值，此时不应sleep，而实际代码却没注意这一点，导致sleep很久不更新cache，
 从而使得redis一直获取不到从节点的内存数据，所以排除了这个节点，虚拟机就只在其它节点启动了

改动说明：判断cost_time，负值就不要sleep，从头开始获取
........
noreview
Bug id: 2431
问题分析：开机优化：还原模式的虚拟机在关机时，直接关闭电源。
改动说明：在虚拟机关机API里，判断虚拟机如果是还原模式，则直接走关闭电源的流程。
自测：在ssl的大集群自测通过。
打包后，再次验证回归
........
noreview
bug id: 2717
问题分析：[adesk]中文版本出现英文提示
改动说明：合入翻译
自测：未自测，上库后再找vs测试验证下。
........
noreview
bug id: 2765
改动说明：win10 升级崩溃问题
........
</msg>
</logentry>
<logentry
   revision="259953">
<author>qifei</author>
<date>2016-05-20T01:25:34.073741Z</date>
<msg>by wyq 重复定义了</msg>
</logentry>
<logentry
   revision="259952">
<author>fxw</author>
<date>2016-05-20T01:24:16.718161Z</date>
<msg>noreview
Merged revision(s) 258402, 258424, 258427, 258799, 258858, 258910, 258912 from VTP/aSV4.6/VMP4.7:
noreview
修改两个问题：
1.大内存虚拟机无法启动，原因是，主机内存100G，虚拟机内存60G，
在判断主机内存是否足够时，会把虚拟机的60G计算到运行虚拟机内存
导致判断主机可配置内存剩下40G，从而不能启动虚拟机。

2.并发开机时，计算cluster.vmid.starting状态的虚拟机，是在每一台主机
都计算了所有cluster.vmid.starting状态的虚拟机内存，有点冗余重复
改为按照主机占整个集群所有主机总内存的配比来分配cluster.vmid.starting状态的
虚拟机，上库后，批量开机试试


自测：
针对改动的函数作单元测试，在所有调用函数的地方，搜集参数，并构造相同单元
测试代码去验证

#!/usr/bin/perl
use strict;
use warnings;
use feature "state";

use VTP::QemuServer;
use Data::Dumper;
use VTP::Tools;

sub print_result {
    my ($tip, $code) = @_;
    state $test_count = 0;
    $test_count++;
    print "[=========test $test_count]", $tip, "\n";
    eval {
        print Dumper(&amp;$code()), "\n\n\n";
    };
    if ($@) {
        print $@."\n\n";
    }
}
sub test_get_running_vms_memory {
    my ($vmid, $host_memRatio) = @_;
    print_result(
        "get_running_vms_memory()",
        sub {
            return VTP::QemuServer::get_running_vms_memory();
        }
    );
    print_result(
        "get_running_vms_memory(host_memRatio = $host_memRatio)",
        sub {
            my $param = {
                host_memRatio =&gt; $host_memRatio,
            };
            return VTP::QemuServer::get_running_vms_memory($param);
        }
    );
}

sub test_get_remain_memory{
    my ($vmid) = @_;
    print_result(
        "get_remain_memory",
        sub {
            return VTP::QemuServer::get_remain_memory();
        }
    );
    print_result(
        "get_remain_memory(param)",
        sub {
            my $param = {
                vmid =&gt; $vmid,
                cluster_memTotal =&gt; 60*1024,
                oversize =&gt; 0,
            };
            return VTP::QemuServer::get_remain_memory($param);
        }
    );
}

sub test_check_memory_permission {
    my ($vmid) = @_;
    my $conf = VTP::QemuServer::load_config($vmid);
    print_result(
        "check_memory_permission(is_vm_important)",
        sub {
            my $param = {
                vmmemory =&gt; $conf-&gt;{memory},
                vmid =&gt; $vmid,
                is_vm_important =&gt; $conf-&gt;{ schedopt }
            };
            return VTP::QemuServer::check_memory_permission($param);
        }
    );
    print_result(
        "check_memory_permission",
        sub {
            my $param = {
                vmmemory =&gt; $conf-&gt;{memory},
                vmid =&gt; $vmid,
            };
            return VTP::QemuServer::check_memory_permission($param);
        }
    );
    print_result(
        "check_memory_permission(cluster_memTotal)",
        sub {
            my $param = {
                vmmemory =&gt; $conf-&gt;{memory},
                vmid =&gt; $vmid,
                cluster_memTotal =&gt; 60*1024,
            };
            return VTP::QemuServer::check_memory_permission($param);
        }
    );
}

sub test_get_cvm_nodes {
    my ($vmid) = @_;
    my $conf = VTP::QemuServer::load_config($vmid);
    print_result(
        "get_cvm_nodes",
        sub {
            return VTP::Tools::get_cvm_nodes( $vmid, undef, undef, 'checknet', undef, undef, 1 );
        }
    );
}

test_get_running_vms_memory(@ARGV);
test_get_remain_memory(@ARGV);
test_check_memory_permission(@ARGV);
test_get_cvm_nodes(@ARGV);

........
noreview
修改两个问题：
1.大内存虚拟机无法启动，原因是，主机内存100G，虚拟机内存60G，
在判断主机内存是否足够时，会把虚拟机的60G计算到运行虚拟机内存
导致判断主机可配置内存剩下40G，从而不能启动虚拟机。

2.并发开机时，计算cluster.vmid.starting状态的虚拟机，是在每一台主机
都计算了所有cluster.vmid.starting状态的虚拟机内存，有点冗余重复
改为按照主机占整个集群所有主机总内存的配比来分配cluster.vmid.starting状态的
虚拟机，上库后，批量开机试试


自测：
针对改动的函数作单元测试，在所有调用函数的地方，搜集参数，并构造相同单元
测试代码去验证
........
reviewid: 18400
bug id: 2531
问题分析：本地虚拟机没有被排除
改动说明：不指定排除cluster虚拟机，本地虚拟机也一起排除
自测：测试回归失败的原环境自测通过
........
reviewid: 18446 改动说明：合入SDDC_4.6的改动

Merged revision(s) 256748 from svn://200.200.0.10/vt/vt/VTP/aSV4.6/aSV4.5_SDDC/src/app/vtp-manager/www/new_webui/src/home/mod-common/vs : 
reviewid: 17662 reviewd by: jcy bug id: [1695] 改动说明：【UI】【adesk】2主机但是只有一个主机有磁盘可以配置数据盘，修改磁盘类型后可以点下一步 0430

Merged revision(s) 257238-257788 from svn://200.200.0.10/vt/vt/VTP/aSV4.6/aSV4.5_SDDC/src/app/vtp-manager/www/new_webui/src/home/mod-common/vs :
Revision: 257788
Author: xzk
Date: 2016年5月3日 10:19:46
Message:
reviewid: 18101 reviewd by: hjh bug id: [2321] 改动说明：【体验问题】【asv】设置主机间网络方式,存储通信部署方式文字应该更加学术
----
Modified : /VTP/aSV4.6/aSV4.5_SDDC/src/app/vtp-manager/www/new_webui/src/home/mod-common/vs/replacehost/replaceHost.js
Modified : /VTP/aSV4.6/aSV4.5_SDDC/src/app/vtp-manager/www/new_webui/src/home/mod-common/vs/setiface/commWays.tpl
Modified : /VTP/aSV4.6/aSV4.5_SDDC/src/app/vtp-manager/www/new_webui/src/home/mod-common/vs/setiface/setHostIface.js
Modified : /VTP/aSV4.6/aSV4.5_SDDC/src/app/vtp-manager/www/new_webui/src/i18n/main/i18n-en.js

Revision: 257764
Author: xzk
Date: 2016年5月2日 16:03:25
Message:
reviewid: 18087 reviewd by: lsh bug id: [2179] 改动说明：【功能异常】【adesk】【asv】授权不足，提示只能选择部分主机，但是不勾选主机，也通过了序列号检查
----
Modified : /VTP/aSV4.6/aSV4.5_SDDC/src/app/vtp-manager/www/new_webui/src/home/mod-common/vs/add/addDisk.js

Revision: 257741
Author: xzk
Date: 2016年4月30日 14:45:05
Message:
reviewid: 18068 reviewd by: jcy bug id: [1695] 改动说明：【UI-VS】【adesk】2主机但是只有一个主机有磁盘可以配置数据盘，修改磁盘类型后可以点下一步 20160420 0430
----
Modified : /VTP/aSV4.6/aSV4.5_SDDC/src/app/vtp-manager/www/new_webui/src/home/mod-common/vs/hostdisk/hostDisk.js
Modified : /VTP/aSV4.6/aSV4.5_SDDC/src/app/vtp-manager/www/new_webui/src/home/mod-common/vs/init/initVs.js

Revision: 257720
Author: xzk
Date: 2016年4月29日 17:50:48
Message:
reviewid: 18063 reviewd by: jcy bug id: [2213] 改动说明：【功能异常】【asv】VS授权足够，扩容后添加磁盘，只能用默认磁盘类型，若改变磁盘类型无法添加 20160428
----
Modified : /VTP/aSV4.6/aSV4.5_SDDC/src/app/vtp-manager/www/new_webui/src/home/mod-common/vs/hostdisk/hostDisk.js

Revision: 257718
Author: xzk
Date: 2016年4月29日 17:35:09
Message:
reviewid: 18059 reviewd by: jcy bug id: [2249] 改动说明：【功能异常】【asv】【adesk】VS序列号从授权足够变成序列号不合法，添加磁盘，页面虽然报错VS序列号检查失败，但是依然能添加磁盘
----
Modified : /VTP/aSV4.6/aSV4.5_SDDC/src/app/vtp-manager/www/new_webui/src/home/mod-common/vs/add/addDisk.js
Modified : /VTP/aSV4.6/aSV4.5_SDDC/src/app/vtp-manager/www/new_webui/src/home/mod-common/vs/sethost/authorized.js

Revision: 257572
Author: xzk
Date: 2016年4月28日 17:17:27
Message:
reviewid: 18002 reviewd by: lsh bug id: [2179] 改动说明：【功能异常】【adesk】【asv】授权不足，提示只能选择部分主机，但是不勾选主机，也能点击确定
----
Modified : /VTP/aSV4.6/aSV4.5_SDDC/src/app/vtp-manager/www/new_webui/src/home/mod-common/vs/sethost/sethost.js

Revision: 257238
Author: xzk
Date: 2016年4月26日 16:14:11
Message:
reviewid: 17880 reviewd by: jcy bug id: [1634] 改动说明：【UI问题】【asv】替换主机页面，CPU核数错误，附图 0430 ---建议转ued处理
----
Modified : /VTP/aSV4.6/aSV4.5_SDDC/src/app/vtp-manager/www/new_webui/src/home/mod-common/vs/replacehost/replaceStep4.tpl






........
问题描述： 
	合入asv序列号相关改动
BUG   ID: xxxxx 或 null(对应非bug改动)
问题原因： 
	描述造成问题的的根源是什么
改动思路： 
	【需求改进】【asv】HCI的单主机支持可以干掉，减少一些额外的支持情况，但aDesk要保留 20160428 0430----BUG 2155
    【功能异常】【asv】asv，VS授权不足时扩容成功 0430---BUG 2237
做了哪些测试： 
	描述做完改动后，做了哪些测试验证
review id 18448, commited by ljf, reviewed by wzl, wugeng
........
noreview
对大内存虚拟机的改动，有语法问题，修改下
........
reviewid: 14737 reviewd by: lsh bug id: [2112] 改动说明：【UI问题】【adesk】替换主机页面错乱，附图
........
</msg>
</logentry>
<logentry
   revision="259948">
<author>fxw</author>
<date>2016-05-20T01:15:46.831209Z</date>
<msg>noreview
Merged revision(s) 257946, 257966, 258189 from VTP/aSV4.6/VMP4.7:
reviewid:  18194
Bug id: 2391
问题分析: 老代码留下的坑，遍历的时候没有过滤掉.和..目录
改动说明: 过滤掉

自测：升级后看集群日志即可，有遇到类似问题，已经修改过一次
........
reviewid:  18201
Bug id: 2277
问题分析:  初步排查是vtplogd使用个frontier
模块，listen时，设定的backlog太小，而我们平台开启了
防syn flooding攻击，而人数多了之后，查询日志的操作变得频繁，后台统计过
1分钟最大的时候，能刷1000次查询请求，有的查询，耗时几百毫秒
而syn flooding是tcp3次握手的时候，发出syn请求并发数，查询操作多了以后就
很容易出现并发超过backlog的大小，导致内核才去防攻击策略，从而导致
其它连接connect timeout或者refused，然后有个定时脚本也在检查vtplogd是否
能处理请求，如果发现出错，就会重启vtplogd。

改动说明: 把listen参数（即backlog）放大，默认是5，改为20

自测：使用测试脚本，连续发起查询请求，会出现一样的timeout错误
在修改代码之前，出现timeout很多，修改之后，测试脚本里也只出现少数几条，应该能勉强扛得住了。
升级新包后，再组织大家打开日志页面查看一下
........
reviewid: 18279
bug id: 2453
问题分析：
1.log_with_task写入的操作日志并没有和upid关联，导致查询upid状态时，本来应该从数据库读取到进度，反而成为了读取失败
就走了读取upid文件及判断pid状态来分析的流程
2.判断upid是否running时，没有忽略z进程，导致进程一直存在，在后台应该是共性问题

改动说明：1.log那个夸了主机，如果要关联，就需要把当前节点的upid传入到目标节点，需要加API参数，改动影响较大
2.判断upid是否running时，过滤掉z进程即可

自测：修改之前，必现。修改之后，不会阻塞，自测通过。
........
</msg>
</logentry>
<logentry
   revision="259943">
<author>fxw</author>
<date>2016-05-20T01:12:15.412306Z</date>
<msg>noreview
Merged revision(s) 257921-257936 from VTP/aSV4.6/VMP4.7:
reviewid: 18076
Bug id：2181
问题分析：串行改为了并行，不能反馈完成进度
改动说明：在批量迁移的接口里查询所有upid，等待完成再退出
自测：自测通过
........
revewid 18185
bugid null
reviewby fxw
说明：acenter序列号修改
修改：如果vls客户端的授权信息无效则不将无效的数据写入到cfs。针对场景：切换主控后vmp和acenter连接不上
测试：打包验证
........
Insecure dependency in sprintf while running with -T switch
删除虚拟机时，发现上述错误，修改后无错。后来尝试重现，没有出现
可能和某些虚拟机有关系，暂时不管了，代码有问题，-T模式下，
直接在系统调用里写变量是不安全的，应该用参数形式
........
noreview
去掉无用日志
........
noreview
还是把load_config里的cfs_update加回来
在SDDC大集群发现去掉cfs_update后发生不少bug
........
</msg>
</logentry>
<logentry
   revision="259929">
<author>hjh</author>
<date>2016-05-19T12:35:33.390497Z</date>
<msg>reviewid: 18934
reviewd by:  xzk
BUG ID: [2019]
问题分析：实体机页面物理主机主控要显示在第一个位置

改动说明：
如果是主控，则放第一个位置

做了哪些测试：
1.jshint通过
2.自测通过</msg>
</logentry>
<logentry
   revision="259915">
<author>hjh</author>
<date>2016-05-19T11:53:05.622753Z</date>
<msg>reviewid: 18930
reviewd by:  lsh
BUG ID: [2063]
问题分析：【日期与时间】界面在1080P分辨率下，没有居中

改动说明：
修改Html模板以及样式使之居中

做了哪些测试：
1.jshint通过
2.自测通过</msg>
</logentry>
<logentry
   revision="259901">
<author>hjh</author>
<date>2016-05-19T09:31:57.053264Z</date>
<msg>reviewid: 18925
reviewd by:  jcy
BUG ID: [1081]
问题分析：【告警设置】序列号过期提醒未勾选，需要屏蔽掉天数输入框

改动说明：
漏掉初始化的时候也要设置一下，加上去

做了哪些测试：
1.jshint通过
2.自测通过</msg>
</logentry>
<logentry
   revision="259898">
<author>hjh</author>
<date>2016-05-19T09:11:58.063693Z</date>
<msg>reviewid: 18920
reviewd by:  lsh
BUG ID: [1081]
问题分析：【告警设置】序列号过期提醒未勾选，需要屏蔽掉天数输入框

改动说明：
序列号过期处绑定上勾选可用，不勾选禁用的事件

做了哪些测试：
1.jshint通过
2.自测通过</msg>
</logentry>
<logentry
   revision="259864">
<author>hjh</author>
<date>2016-05-19T06:41:45.540460Z</date>
<msg>reviewid: 18905
reviewd by:  jcy
bug id: [692]
问题分析：【告警设置】手动输入的数据，前面加0未做处理

改动说明：
提交前对这些数字进行处理，去掉前面的 0

做了哪些测试：
1.jshint通过
2.自测通过</msg>
</logentry>
<logentry
   revision="259846">
<author>fxw</author>
<date>2016-05-19T02:59:12.677293Z</date>
<msg>noreview
更改文档</msg>
</logentry>
<logentry
   revision="259844">
<author>yangwei</author>
<date>2016-05-19T02:56:13.646776Z</date>
<msg>reviewid 18887
bugid 1647
说明：如果acenter序列号不合法，使用硬件key的流程
测试：打包验证</msg>
</logentry>
<logentry
   revision="259841">
<author>hyq</author>
<date>2016-05-19T02:52:40.979256Z</date>
<msg>reviewid : 18886
bug id : 1118
问题描述 : 使用了不兼容的光模块,加载驱动没添加参数allow_unsupported_sfp = 1
改动说明 : 驱动参数allow_unsupported_sfp默认设置为1</msg>
</logentry>
<logentry
   revision="259839">
<author>hyq</author>
<date>2016-05-19T02:43:38.989606Z</date>
<msg>reviewid : 18882
bug id : 1118
问题描述 : null
改动说明 : 添加内核原生文件</msg>
</logentry>
<logentry
   revision="259824">
<author>hyq</author>
<date>2016-05-19T01:27:01.393157Z</date>
<msg>reviewid : 18877
bug id : null
问题 : 修改重组IP分片最大内存阈值</msg>
</logentry>
<logentry
   revision="259788">
<author>hjh</author>
<date>2016-05-18T09:35:34.547504Z</date>
<msg>reviewid: 18836
reviewd by:  jcy
bug id: [671]
问题分析：新增虚拟机-虚拟存储列表数量多时不好查找
问题原因：原有功能BUG
改动说明：加一列显示序号

做了哪些测试：
1.jshint通过
2.自测通过</msg>
</logentry>
<logentry
   revision="259782">
<author>lcy</author>
<date>2016-05-18T09:15:28.335518Z</date>
<msg>reviewid: 18845
review by hyq
Bug id: 2848
问题分析：TD2848,【批量修改集群通信口】单主机批量修改集群通信口，日志显示成功了，实际上失败了
问题出现的根源：
没有传递强制修改网关的参数
改动说明：
加上强制修改网关的参数force=1
解释upid的时候，应该把错误信息参数设置为1
自测：
4.9.00_B
build 2016-05-18 00:56:15
自测通过。</msg>
</logentry>
<logentry
   revision="259771">
<author>lcy</author>
<date>2016-05-18T08:13:05.976744Z</date>
<msg>reviewid: 18834
review by hyq
Bug id: 2812
问题分析：TD2812,【开机编辑】重置虚拟机有两条配置生效的日志
问题出现的根源：
API接口和system_reset都打印了一条日志。
改动说明：
1. 把API接口alive_reser提前
2. 处理一下stop，shutdown的时候内部关机的一些问题。因为kvm进程会等待01vmstop脚本退出才真正退出，所以不能直接在01vmstop后面进行配置生效的操作
目前的处理方法是，针对内部重启，fork一个子进程，成为daemon进程来实现配置生效的操作。
自测：
4.9.00_B
build 2016-05-18 00:56:15
自测通过。
##文件编码不一样，分来两个review
reviewid: 18833
Bug id: 2812
问题分析：TD2812,【开机编辑】重置虚拟机有两条配置生效的日志
问题出现的根源：
API接口和system_reset都打印了一条日志。
改动说明：
1. 把API接口alive_reser提前
2. 处理一下stop，shutdown的时候内部关机的一些问题。因为kvm进程会等待01vmstop脚本退出才真正退出，所以不能直接在01vmstop后面进行配置生效的操作
目前的处理方法是，针对内部重启，fork一个子进程，成为daemon进程来实现配置生效的操作。
自测：
4.9.00_B
build 2016-05-18 00:56:15
自测通过。</msg>
</logentry>
<logentry
   revision="259752">
<author>hjh</author>
<date>2016-05-18T06:31:37.048521Z</date>
<msg>reviewid: 18808
reviewd by:  lsh
bug id: [6]
问题分析：虚拟存储页面，显示百分比分成了两行
问题原因：原有功能BUG
改动说明：修改显示方式

做了哪些测试：
1.jshint通过
2.自测通过</msg>
</logentry>
<logentry
   revision="259744">
<author>lcy</author>
<date>2016-05-18T03:07:23.161645Z</date>
<msg>reviewid: 18815
review by hyq
Bug id: 2928
问题分析：TD2928，【开机编辑】磁盘写缓存需要处理一下
问题出现的根源：
之前修改磁盘写缓存没有生成alive文件，应该生成alive文件
改动说明：
1. 解释磁盘的时候，应该多加写缓存的开启和大小的判断
自测：
4.9.00_B
build 2016-05-18 00:56:15
自测通过。</msg>
</logentry>
<logentry
   revision="259743">
<author>hyq</author>
<date>2016-05-18T03:00:16.125328Z</date>
<msg>reviewid : 18813
bug id : 1355
问题描述 : td1355 : 【bug】利用模板部署虚拟机失败（报错：拷贝预加载个人盘失败）
问题分析 : 实际情况是存储不足导致抛出异常，没有创建template/$vmid目录，但预加载个人盘流程默认该目录是创建了的，抛出异常把原来的异常覆盖
改动说明 : 把个人盘预加载放到流程最后</msg>
</logentry>
<logentry
   revision="259686">
<author>lcy</author>
<date>2016-05-17T11:19:32.491309Z</date>
<msg>reviewid: 18785
review bu hyq
Bug id: 2802
问题分析：TD2802，【开机编辑】需要处理一下开机编辑完之后，在虚拟机内部安装或卸载virtio的问题
问题出现的根源：
开机编辑之后，虚拟机内部安装virtio，这个时候guest会通知host机修改配置文件。
改动说明：
1. 在guest通知host修改虚拟机的配置文件的时候，判断一下虚拟机是否存在开机编辑的信息
2. 如果存在开机编辑的配置信息，那么把开机编辑的配置信息也修改为和conf配置一致
自测：
4.9.00_B
build 2016-05-15 00:57:14
自测通过。</msg>
</logentry>
<logentry
   revision="259668">
<author>hyq</author>
<date>2016-05-17T09:15:27.745633Z</date>
<msg>reviewid: 18779
bug id : null 
问题描述 : 整理模板更新的代码，把更新模板检查存储的代码从qemuserver.pm 移动到qemuderive.pm
自测 场景 : 更新没问题</msg>
</logentry>
<logentry
   revision="259662">
<author>hyq</author>
<date>2016-05-17T08:49:44.212935Z</date>
<msg>reviewid : 18773
bug id : null
reviewed by : lifan
问题描述 : 内核启动参数添加 acpi_pad.disable=1.
</msg>
</logentry>
<logentry
   revision="259621">
<author>lcy</author>
<date>2016-05-17T03:29:43.896513Z</date>
<msg>reviewid: 18758
review by hyq
Bug id: 2755
问题分析：TD2755,【开机编辑】针对vritio磁盘需要转换一下
问题出现的根源：
安装了virtio，从配置里面读取的文件信息会把ide转为virtio，在开机编辑的情况下，界面提交的数据还是ide，所以会误以为增加了配置文件没有的设备信息
改动说明：
1. 对virtio进行转换，转为ide类型的可以，再与编辑参数进行对比
2. 增加几条日志
3. 对之前的日志增加%s占位符，因为ldebug被修改过了，没有占位符，后面的变量显示不出来。
自测：
4.9.00_B
build 2016-05-06 01:02:07
自测通过。</msg>
</logentry>
<logentry
   revision="259572">
<author>hyq</author>
<date>2016-05-16T12:27:07.756027Z</date>
<msg>reviewid : 18744
bug id : 546
问题描述 : td546 : 【bug】[备份]自动备份最大值13，后台调用api可达到13以上。【转VMP4.9】
改动说明 : 备份策略最大个数后台限制为12个</msg>
</logentry>
<logentry
   revision="259571">
<author>fxw</author>
<date>2016-05-16T12:25:02.414069Z</date>
<msg>noreview
VMP不支持中英文切换</msg>
</logentry>
<logentry
   revision="259569">
<author>fxw</author>
<date>2016-05-16T12:21:45.568879Z</date>
<msg>noreview
少了个括号</msg>
</logentry>
<logentry
   revision="259568">
<author>yangwei</author>
<date>2016-05-16T12:17:51.508670Z</date>
<msg>reviewid 18745
bugid 1627
reviewby fxw
说明：acenter更新
修改：
1、只有在acenter授权ok的时候才设置为企业版
2、如果加入了acenter，且属于标准版，则序列号走老流程
测试：打包验证</msg>
</logentry>
<logentry
   revision="259564">
<author>fxw</author>
<date>2016-05-16T12:07:30.200003Z</date>
<msg>noreview
新增文件</msg>
</logentry>
<logentry
   revision="259552">
<author>fxw</author>
<date>2016-05-16T11:14:08.582866Z</date>
<msg>noreview
开启签名检查</msg>
</logentry>
<logentry
   revision="259551">
<author>fxw</author>
<date>2016-05-16T11:10:28.300934Z</date>
<msg>noreview
更新 vm tools iso</msg>
</logentry>
<logentry
   revision="259548">
<author>fxw</author>
<date>2016-05-16T11:07:12.660650Z</date>
<msg>Merged revision(s) 259454 from VTP/VMP_for_adesk/VMP4.8R2/Trunk:
noreview :
bug id : 1603
问题描述 : td1603:【SDDC快速响应_beta23】【老功能】w2003安装fastIO，再次弹出兼容性告警的问题
改动说明 : SangforPrivilegeElevateClient.dll需要拷贝到windows\bin、windows\bin\fastio\bin和windows\bin\fastio\ModulesUpdate目录下。
          Installer、SangforModulesUpdateServer、SangforPrivilegeElevateService、SangforUpdateServer四个exe拷贝到
          windows\bin\fastio\ModulesUpdate目录下
          以上五个文件上次上传时没有签名，现在签名后重新上传。
          
........
</msg>
</logentry>
<logentry
   revision="259547">
<author>lcy</author>
<date>2016-05-16T11:02:35.404291Z</date>
<msg>reviewid: 18728
review by fxw
Bug id: 2733
问题分析：TD2733,【设置集群通信口】【基本功能】设置集群通信口失败
问题出现的根源：
设置集群通信口，分为两大步骤，编辑网口和切换网口。编辑网口会down和up网口一次。切换网口的ethtool可能获取到网口的状态为没有插网线
改动说明：
在切换网口之前，弄一个循环判断一下即将要切换的网口的状态信息，大概25秒来判断。只有网口状态是插了网线再让其往下走。
因为从界面发过来的网口都是在线状态的。
自测：
4.9.00_B
build 2016-05-10 00:58:28
自测通过。</msg>
</logentry>
<logentry
   revision="259542">
<author>fxw</author>
<date>2016-05-16T10:04:02.861703Z</date>
<msg>noreview
上库工具，可以导出qcow2的元数据</msg>
</logentry>
<logentry
   revision="259481">
<author>hyq</author>
<date>2016-05-16T03:57:42.093438Z</date>
<msg>reviewid : 18686
bug id : 1125
问题描述 : 【SDDC快速响应】关闭ats，存储多路径模式要改为主备模式
改动说明 : 合入td762改动</msg>
</logentry>
<logentry
   revision="259352">
<author>fxw</author>
<date>2016-05-14T03:30:55.135646Z</date>
<msg>noreview
更新vm tools iso</msg>
</logentry>
<logentry
   revision="259329">
<author>fxw</author>
<date>2016-05-14T01:33:43.559662Z</date>
<msg>noreview
先屏蔽签名检查</msg>
</logentry>
<logentry
   revision="259267">
<author>hyq</author>
<date>2016-05-13T08:29:23.490182Z</date>
<msg>reviewid : 18610
bug id : null
问题描述 : 文件Diagmon.pm没加入Makefile</msg>
</logentry>
<logentry
   revision="259131">
<author>fxw</author>
<date>2016-05-12T12:00:33.143191Z</date>
<msg>noreviewnoreview
把中文》改成&gt;
</msg>
</logentry>
<logentry
   revision="259128">
<author>fxw</author>
<date>2016-05-12T11:56:15.133853Z</date>
<msg>noreview
Merged revision(s) 257919-259010 from VTP/VMP_for_adesk/VMP4.8R2/Trunk:
noreview :
bug id : 1603
问题描述 : td1603: 【SDDC快速响应_beta23】【老功能】w2003安装fastIO，再次弹出兼容性告警的问题
改动说明 :  原因是告警对话框的标题变成"软件安装"了，原来是以"硬件安装"作为对话框标题关键字来hook并且模拟点击的。 
........
noreview :
bug id : 1603
问题描述 : td1603:【SDDC快速响应_beta23】【老功能】w2003安装fastIO，再次弹出兼容性告警的问题
改动说明 : 编译VMP4.8R2\source\app\vtp-windows-modules-update\windows_build\windows_build_2008后上传，用于打包
........
noreview :
bug id : 1603
问题描述 : td1603:【SDDC快速响应_beta23】【老功能】w2003安装fastIO，再次弹出兼容性告警的问题
改动说明 : SangforPrivilegeElevateClient.dll需要拷贝到windows\bin、windows\bin\fastio\bin和windows\bin\fastio\ModulesUpdate目录下。
          Installer、SangforModulesUpdateServer、SangforPrivilegeElevateService、SangforUpdateServer四个exe拷贝到
          windows\bin\fastio\ModulesUpdate目录下
........
noreview :
bug id : 1603
问题描述 : td1603:【SDDC快速响应_beta23】【老功能】w2003安装fastIO，再次弹出兼容性告警的问题
改动说明 : 修正DriveVolume.h和DriveVolume.cpp找不到包含文件的问题。编译VMP4.8R2\source\app\p2v\windows\p2v.sln 生成SangforVMSTools.exe，然后签名。
备注：其他文本文件变动属于自动日期修改，具体信息请查看文件变动。
          
........
noreview :
bug id : 759
问题描述 : td759:【合入】【技术支持】aDesk用户的ip-guard软件无法读取硬盘序列号问题----ok
改动说明 : 1.替换了virtio_stor.c文件，该文件从此地址Checkout： svn://200.200.0.10/vt/vt/Personal/liqiang/
          2.WinLH.inx,WinNET.inx,WinXP.inx文件添加了注册表项：HKR, "Parameters", "IDESNCompat", %REG_DWORD%, 0x00000001
            因为此合并需要添加一个注册表项，通过inf文件来添加，而此项目inf文件是由inx在build时生成的。
          3.将生成的文件签名，并且拷贝到VMP4.8R2\source\app\p2v\windows\bin\fastio\viostor。
          4.要想获得序列号，还需后台在启动虚拟机时给虚拟磁盘指定序列号。
测试：在windows7,x86和x64系统中分别手动替换viostor驱动，运行获取磁盘序列号的驱动后，获取到了后台指定的序列号。
........
</msg>
</logentry>
<logentry
   revision="259125">
<author>qifei</author>
<date>2016-05-12T11:54:43.298917Z</date>
<msg>revision 18555

修改overview的version字段，显示补丁包版本信息
补上漏掉的ui代码
之前放通的不需要cookie验证的接口需要重新验证</msg>
</logentry>
<logentry
   revision="259031">
<author>fxw</author>
<date>2016-05-12T06:26:30.519176Z</date>
<msg>noreview
qemu的malloc换成tcmalloc，以减少内存碎片问题：
1. gperftools升级，2.4-&gt;2.5
2. spice不链接tcmalloc
3. qemu链接tcmalloc</msg>
</logentry>
<logentry
   revision="258982">
<author>qifei</author>
<date>2016-05-12T01:32:50.412239Z</date>
<msg>by wyq vdc那边的配置文件有点问题，名称给错了，同步改一下</msg>
</logentry>
<logentry
   revision="258821">
<author>qifei</author>
<date>2016-05-10T12:06:44.870363Z</date>
<msg>by wyq 授权host/vmp/vs数据</msg>
</logentry>
<logentry
   revision="258503">
<author>qifei</author>
<date>2016-05-10T07:58:51.270123Z</date>
<msg>by wyq 
【修改原因(bug号)】TD-2432【aCenter】vmp侧的aCenter配置文件中的密码明文保存（低级问题！）
【如何修改】原本是没有存该密码的，属于误存，在退出aCenter的时候只保存退出的标志，不保存其它信息
【测试建议】加入aCenter后，退出aCenter</msg>
</logentry>
<logentry
   revision="258356">
<author>lcy</author>
<date>2016-05-09T01:13:07.527047Z</date>
<msg>reviewid: 18353
review by fxw
Bug id: 1586
问题分析：TD1586，【需求】【技术支持】【徐增反馈----徐增】【VMP4.8】用思科的服务器vlan0问题，导致软件VDC不通----ok --UI
新需求，VLAN支持0
自测：
4.9.00_B
build 2016-05-06 01:02:07
自测通过。
新需求，需要按照之前的补丁包流程测试。现在只进行了简单的测试。还要打包验证。</msg>
</logentry>
<logentry
   revision="258355">
<author>lcy</author>
<date>2016-05-09T01:12:07.224248Z</date>
<msg>reviewid: 18353
review by fxw
Bug id: 1586
问题分析：TD1586，【需求】【技术支持】【徐增反馈----徐增】【VMP4.8】用思科的服务器vlan0问题，导致软件VDC不通----ok
新需求，VLAN支持0
自测：
4.9.00_B
build 2016-05-06 01:02:07
自测通过。
新需求，需要按照之前的补丁包流程测试。现在只进行了简单的测试。还要打包验证。</msg>
</logentry>
<logentry
   revision="258298">
<author>hyq</author>
<date>2016-05-07T07:21:56.078398Z</date>
<msg>reviewid : 18340
bug id : 2534
问题描述 : 编辑网口清除IP配置报错【改动引发】
改动说明 : 添加判断，如果新下发的配置不存在IP则不检测IP冲突</msg>
</logentry>
<logentry
   revision="258290">
<author>hyq</author>
<date>2016-05-07T06:13:42.448492Z</date>
<msg>reviewid : 18330
bugid : 2517
问题描述 : td2517 : vds一体机，接上键盘，按键control+alt_delete，主机重启
改动说明 : 上传原生文件</msg>
</logentry>
<logentry
   revision="258268">
<author>lcy</author>
<date>2016-05-07T02:38:03.765066Z</date>
<msg>reviewid: 18320
review by fxw
Bug id: 1458
问题分析：TD1458，【bug】【模板更新】镜像mv失败后，直接退出,不用cp
问题出现的根源：
VS中mv失败也代表cp会失败，不用尝试cp了。
改动说明：
mv失败，直接退出脚本。
自测：
4.9.00_B
build 2016-05-06 01:02:07
自测通过。
脚本语法没有问题，通过修改返回值，测试，假如mv失败，会直接退出脚本。
前台也会打印详细的检查存储是否异常的日志。</msg>
</logentry>
<logentry
   revision="258263">
<author>lcy</author>
<date>2016-05-07T02:08:15.552154Z</date>
<msg>reviewid: 18318
review by fxw
Bug id: 2403
问题分析：TD2403，恢复出厂的设置的时候备份一下集群通信口
问题出现的根源：
假如集群通信口没有备份，刚好eth0没有配置IP，那么恢复出厂设置之后，eth0会默认当做集群通信口，这个时候eth0又没有IP
pmxcfs服务会起不来，会引发一系列异常。导致服务器异常，无法访问
改动说明：
恢复出厂设置的时候，把集群通信口也备份一下。重启之后，就可以恢复集群通信口。
自测：
4.9.00_B
build 2016-05-06 01:02:07
自测通过。</msg>
</logentry>
<logentry
   revision="258233">
<author>hyq</author>
<date>2016-05-06T10:08:46.914799Z</date>
<msg>reviewid : 18310
bug id : 1932
问题描述 : 派生虚拟机可能存在镜像不存在的情况，删除快照失败就默认镜像不存在，有问题
改动说明 : 是否抛异常判断是否为镜像不存在的情况</msg>
</logentry>
<logentry
   revision="258213">
<author>lcy</author>
<date>2016-05-06T08:58:44.415936Z</date>
<msg>reviewid: 18296
review by fxw
Bug id: null
多写了一个空格
自测：
4.9.00_B
build 2016-05-06 01:02:07
自测通过。</msg>
</logentry>
<logentry
   revision="258212">
<author>hyq</author>
<date>2016-05-06T08:45:19.387901Z</date>
<msg>reviewid : 18293
bug id : 682
问题描述 : adesk一体机添加额外内存不再检查可启动虚拟机个数
改动说明 : Product.pm 添加各类型号的一体机的内存配置
QemuServer.pm获取主机内存配置并于一体机内存标配比较</msg>
</logentry>
<logentry
   revision="258152">
<author>lcy</author>
<date>2016-05-06T02:05:20.805071Z</date>
<msg>reviewid: 18259
review by fxw
Bug id: 2247
问题分析：TD2247,【bug】【UI】【虚拟交换机】虚拟交换机的名字设置为0，会导致一系列异常
问题出现的根源：
0是一个很特殊的字符串，虚拟交换机的名字禁用0
改动说明：
对虚拟交换机名字进行一个额外的校验，不能为0
自测：
4.9.00_B
build 2016-05-06 01:02:07
自测通过。</msg>
</logentry>
<logentry
   revision="258051">
<author>lcy</author>
<date>2016-05-05T09:48:58.664383Z</date>
<msg>reviewid: 18232
review by fxw
Bug id: 2383
问题分析：TD2383，【bug】【设置主机间通信网口】UI对聚合网口进行限制 --UI
问题出现的根源：
之前没有限制聚合网口，聚合网口还是可以选择的。
改动说明：
1. 把聚合网口在设置主机间通信网口中禁用掉
2. 修改一下提示信息，让提示更加合理。
自测：
4.9.00_B
build 2016-05-03 19:38:24
自测通过。</msg>
</logentry>
<logentry
   revision="258046">
<author>lcy</author>
<date>2016-05-05T09:30:57.513791Z</date>
<msg>reviewid: 18223
review by fxw
Bug id: 2289
问题分析：TD2289，【bug】【设置主机间通信网口】针对每一个主机操作都打印成功失败的日志，并且把相关的描述写清楚
问题出现的根源：
日志应该清楚详细
改动说明：
把IP修改前后的信息打印出来，针对每一个操作都打印一条log。修改IP，切换通信口。
自测：
4.9.00_B
build 2016-05-03 19:38:24
自测通过。</msg>
</logentry>
<logentry
   revision="258004">
<author>hyq</author>
<date>2016-05-05T04:01:13.678746Z</date>
<msg>reviewid : 18154
bug id : 2294
问题描述 : 【网口IP冲突】网口down掉arping该网口的ip，网关回包导致误报IP冲突
改动说明 : 网口down掉的话不做处理。
DoAlert.pm 
获取网络设备配置的IP从ifaces_config获取，减少一次配置的读取
Arp.pm 
获取网络设备的IP配置过滤掉down掉的网口
修改变量定义的名称
Cluster.pm
增加IP冲突检测，API头部的IP冲突检测有局限性，如果配置的IP网段原先不存在，将检测不出来
并把设置集群IP任务改为同步，可以弹出错误提示信息
Nodes.pm
增加普通网口的IP冲突检测机制，通过弹框提示
批量修改的没有提示，在告警里有提示，有延迟</msg>
</logentry>
<logentry
   revision="257938">
<author>lcy</author>
<date>2016-05-04T09:05:22.806352Z</date>
<msg>reviewid: 18186
review by fxw
Bug id: 2264
问题分析：TD2264，【设置主机间通信口】对网口的VLAN ID提前检测
问题出现的根源：
VLAN ID不一致肯定是会导致主机间网络不通，需要提前检测出来。
改动说明：
在API里面提前检测VLAN ID不一致的情况。
自测：
自测通过。
1. 批量修改集群通信口，把主机间的VLAN ID设置为不一致
2. 确认后，会返回提前检测到VLAN不一致。</msg>
</logentry>
<logentry
   revision="257931">
<author>yangwei</author>
<date>2016-05-04T08:38:29.537708Z</date>
<msg>revewid 18185
bugid null
reviewby fxw
说明：acenter序列号修改
修改：如果vls客户端的授权信息无效则不将无效的数据写入到cfs。针对场景：切换主控后vmp和acenter连接不上
测试：打包验证</msg>
</logentry>
<logentry
   revision="257914">
<author>qifei</author>
<date>2016-05-04T07:36:16.146083Z</date>
<msg>revision 18175
补上漏掉的rwini脚本，给download_ssu.sh转码后重新上库</msg>
</logentry>
<logentry
   revision="257910">
<author>lcy</author>
<date>2016-05-04T07:16:51.276817Z</date>
<msg>reviewid: 18171
review by fxw
Bug id: 2299
问题分析：TD2299，【静态路由】小问题合集1（不超过5条） --UI
问题出现的根源：
体验不好。
改动说明：
1. 添加聚合网口，多一个弹出框，说明静态路由受影响。
2. 主机详情页面的导航栏中把静态路由设置的按钮和高级设置的按钮换一下
自测：
自测通过。</msg>
</logentry>
<logentry
   revision="257908">
<author>lcy</author>
<date>2016-05-04T07:03:22.655535Z</date>
<msg>reviewid: 18167
review by fxw
Bug id: 2375
问题分析：TD2375,【静态路由】聚合网口可配置跟其他普通网口同名，导致都有静态路由的页面看起来很怪 --UI
问题出现的根源：
聚合网口和物理网口有重名，需要特别标注
改动说明：
加一个[聚合网口]的标签，体验更好，加一个tips
自测：
自测通过。</msg>
</logentry>
<logentry
   revision="257907">
<author>lcy</author>
<date>2016-05-04T07:02:49.992030Z</date>
<msg>reviewid: 18162
review by fxw
Bug id: 2375
问题分析：TD2375,【静态路由】聚合网口可配置跟其他普通网口同名，导致都有静态路由的页面看起来很怪
问题出现的根源：
聚合网口和物理网口有重名，需要特别标注
改动说明：
加一个[聚合网口]的标签，体验更好
自测：
自测通过。</msg>
</logentry>
<logentry
   revision="257888">
<author>fxw</author>
<date>2016-05-04T03:45:01.180966Z</date>
<msg>Merged revision(s) 257429 from VTP/aSV4.6/VMP4.7:
问题描述： 
	【功能异常】【adesk】试用版时插入授权不足的key后，试用过期，这与新需求不符 20160427 0430
BUG   ID: 2108
问题原因： 
	试用版在QemuServer.pm有特殊的判断，没有考虑到,需要添加缓冲期内仍然可用的条件
改动思路： 
	增加判断
做了哪些测试： 
	替换QemuServer.pm文件，试用版过期允许开机
review id 17959, commited by ljf, reviewed by wzl, wugeng
........
</msg>
</logentry>
<logentry
   revision="257883">
<author>fxw</author>
<date>2016-05-04T03:00:22.869086Z</date>
<msg>noreview
4.8R1还没改完，验证，先删掉</msg>
</logentry>
<logentry
   revision="257882">
<author>fxw</author>
<date>2016-05-04T02:56:04.454172Z</date>
<msg>noreview
合入 VMP4.8R1修改：
Revision: 257272
Author: vs
Date: 2016年4月26日 19:10:04
Message:
问题描述： 
	合入asv----vs序列号正式版由可用变为不可用，缓冲30天可用 asv开vm添加序列号验证限制
BUG   ID: 1600  1423
问题原因： 
	描述造成问题的的根源是什么
改动思路： 
	描述解决这个问题的修改思路
做了哪些测试： 
	描述做完改动后，做了哪些测试验证
review id 17889, commited by ljf, reviewed by yinxin, wugeng
----
Modified : /VTP/aSV4.6/VMP4.7/source/app/vtp-common/VMPSN.pm
Modified : /VTP/aSV4.6/VMP4.7/source/app/vtp-manager/VTP/VAPI/Cluster.pm
Modified : /VTP/aSV4.6/VMP4.7/source/app/vtp-manager/www/new_webui/src/home/mod-common/header/enterprise.js
Modified : /VTP/aSV4.6/VMP4.7/source/app/vtp-manager/www/new_webui/src/home/mod-setting/serial/index.css
Modified : /VTP/aSV4.6/VMP4.7/source/app/vtp-manager/www/new_webui/src/home/mod-setting/serial/index.js

</msg>
</logentry>
<logentry
   revision="257873">
<author>lcy</author>
<date>2016-05-04T02:18:11.320402Z</date>
<msg>reviewid: 18132
review by fxw
Bug id: 2274
问题分析：TD2274，【静态路由】删除静态路由需要弹确认框，不能直接就删掉了 --UI
问题出现的根源：
防止勿删
改动说明：
删除的时候加一个确认按钮
自测：
本地测试通过，还要打包验证。</msg>
</logentry>
<logentry
   revision="257864">
<author>lcy</author>
<date>2016-05-04T01:46:16.596690Z</date>
<msg>reviewid: 18155
review by fxw
Bug id: 2358
问题分析：TD2358,【静态路由需求】解决网口的网段和静态路由的网段相同的问题
问题出现的根源：
网口的IP有可能存在了和静态路由一样的网段，需要检查判断
改动说明：
更新静态路由的脚本进行判断即可。
自测：
自测通过。</msg>
</logentry>
<logentry
   revision="257859">
<author>fxw</author>
<date>2016-05-04T01:19:18.249292Z</date>
<msg>noreview
Merged revision(s) 256767, 256772, 256839, 256899, 257127, 257142, 257212, 257290, 257292, 257397, 257837 from VTP/aSV4.6/VMP4.7:
reviewid:  17669
Bug id: 1660
问题分析: 主控断电后，从节点web页面登录，大部分页面加载不正常或者无法显示虚拟机列表
改动说明: 让Cache.pm支持自动切换

自测：无。
........
reviewid:  17673
Bug id: 1989
问题分析: PLOG改进打印子进程号，之前打印的是父进程号
改动说明: 设置ID

自测：已经在大集群测试。
........
noreview
wtd上库的代码有问题，修改一下，不知道对不对，等人回来再看看，先打包通过再说
........
reviewid:  17729 
Bug id: 
问题分析: PLOG改进打印子进程号，之前打印的是父进程号
改动说明: 设置ID

自测：已经在大集群测试。
........
noreview
加可执行权限
........
noreview
增加api错误格式说明的文档
........
修正usb通道出现断言的错误
........
noreview 增加清理虚拟机临时状态的机制修改
Author: gwl
Date: 2016年4月26日 20:01:00
Message:
noreview 补充vmstatus的修改
Bug id: 1727
问题分析: 
以前的清理机制是每个主机只负责自己的临时状态，有局限性，在其它主机设置临时状态的话，这个状态就不会被清理

改动说明: 
修改临时状态清理机制，选择hostid字符串序最大的主机来执行清理操作，而其它主机只需要上报自己需要保存哪些临时状态即可
另外也有临时状态稳固机制，不担心掉了状态或者出现什么临界情况。

自测：
1.两个主机分别创建自己及其它主机上的临时状态，并占用lock文件
  ---------临时文件不会删除
2.手动创建"/cfs/vm_tmp_status/flag_dir/";目录下的临时文件
  ---------会被删除
3.调用接口创建临时状态，不调用清理临时状态的接口
  ---------会被删除
4.删除/cfs/vm_tmp_status/flag_valid/目录
  ---------会重新生成
  ---------/cfs/vm_tmp_status/flag_valid/目录下的文件会更新
用于测试的脚本：
#!/usr/bin/perl
use strict;
use warnings;
use VTP::VAPI::VMStatus;

my $vmid = shift;
my $status = shift;
my $host = shift;
my $s = shift // 2;
my $close_fh = shift;

my $fh = VTP::VAPI::VMStatus::set_vm_flag_status( $vmid, $status, $host );

while ($s &gt; 0) {
    sleep(1);
    $s--;
}

VTP::VAPI::VMStatus::clear_vm_flag_status($fh, $vmid, $status, $host) if $close_fh &amp;&amp; $fh;
close($fh);
----
Modified : /VTP/aSV4.6/aSV4.5_SDDC/src/app/vtp-manager/VTP/VAPI/VMStatus.pm


........
reviewid:  17879 
Bug id: 2054
问题分析: 集群虚拟机都启动在了两个主机上，其他30几个主机上没启动虚拟机
改动说明: 获取到的主控是错的。。。。先试下这样修改是否覆盖全了，要不行就加hook.d回调重启，但不想重启

自测：已经在大集群测试部分。
........
reviewid: 17943
Bug id：2169
问题分析：并发开机的时候，固定并发量是13个task，对于小规模集群，这个灵敏度太高了，会直接导致13台虚拟机可能启动在同一台主机
改动说明：修改并发数，根据主机个数来确定，主机数&lt;13时，并发数=主机数；主机数&gt;=13时，并发数=13
自测：代码简单，perl -c通过，执行新家的代码，获取了正确的主机数。
........
reviewid: 18133
Bug id: 1727
问题分析: 
主机离线的时候，没有更新flag_valid目录，导致误判状态文件有效，从而一直不清理状态文件

改动说明: 判断一下离线主机

自测：原环境自测通过
........
</msg>
</logentry>
<logentry
   revision="257833">
<author>lcy</author>
<date>2016-05-03T09:43:25.213295Z</date>
<msg>reviewid: 18128
review by jcy
Bug id: 2314
问题分析：TD2314，【老功能】切换集群通信口之后，网络异常--在UI对单台主机切换集群通信口进行屏蔽
问题出现的根源：
切换集群通信口的时候，子节点会短暂离线。这个时候子节点认为自己已经离线了，所以集群IP
会自动设置在字节点上，在浏览器上访问集群IP会访问到子节点上。这个问题一直都存在。
根源是：集群IP会在集群稳定的状态下，自动设置。设置的标准是，主控在线，设置在主控上
主控不在线，则选择一个子节点设置上，
改动说明：
因为VMP4.9已经做了批量切换集群通信口的功能，所以单独针对每一台机器切换集群通信口的界面入口
可以屏蔽掉。
自测：
本地调试通过。还要打包验证。</msg>
</logentry>
<logentry
   revision="257816">
<author>lcy</author>
<date>2016-05-03T07:48:07.958273Z</date>
<msg>reviewid: 18116
review by fxw
Bug id: 2335
问题分析：TD2335,【静态路由需求】界面显示静态路由表的时候，加上网口和VLAN
问题出现的根源：
原有的界面显示体验不太好，不知道该静态路由配置在了哪个网口
改动说明：
增加静态路由界面的网口和VLAN信息的显示，提升体验
自测：
静态路由配置在eth1网口上，界面显示是eth1
静态路由配置在eth1.100上，界面显示是eth1 vlan为100
静态路由配置在sf_bond0上，界面显示是该聚合网口的名字
静态路由配置在sf_bond0.200上，界面上显示聚合网口的名字，vlan为200
静态路由配置在网桥上，查看网桥桥接的网口，界面上显示的就是这个桥接的网口
静态路由配置在虚拟存储私网上，界面上显示是虚拟存储私网
静态路由配置的网口IP被删掉了，界面显示的网口名称为空</msg>
</logentry>
<logentry
   revision="257815">
<author>lcy</author>
<date>2016-05-03T07:46:16.533360Z</date>
<msg>reviewid: 18117
review by fxw
Bug id: 2335
问题分析：TD2335,【静态路由需求】界面显示静态路由表的时候，加上网口和VLAN
问题出现的根源：
原有的界面显示体验不太好，不知道该静态路由配置在了哪个网口
改动说明：
增加静态路由界面的网口和VLAN信息的显示，提升体验
自测：
静态路由配置在eth1网口上，界面显示是eth1
静态路由配置在eth1.100上，界面显示是eth1 vlan为100
静态路由配置在sf_bond0上，界面显示是该聚合网口的名字
静态路由配置在sf_bond0.200上，界面上显示聚合网口的名字，vlan为200
静态路由配置在网桥上，查看网桥桥接的网口，界面上显示的就是这个桥接的网口
静态路由配置在虚拟存储私网上，界面上显示是虚拟存储私网
静态路由配置的网口IP被删掉了，界面显示的网口名称为空</msg>
</logentry>
<logentry
   revision="257723">
<author>lcy</author>
<date>2016-04-29T10:00:27.992145Z</date>
<msg>reviewid: 18066
review by fxw
Bug id: 2276
问题分析：TD2276,【静态路由】编辑静态路由,操作日志的动作还是“添加静态路由”
问题出现的根源：
手抖，多一个my
改动说明：
删除这个my
自测：
编辑一条已存在的静态路由，日志是编辑静态路由</msg>
</logentry>
<logentry
   revision="257716">
<author>fxw</author>
<date>2016-04-29T09:30:38.995427Z</date>
<msg>noreview
bugid: 2280
说明：如果补丁包的version文件是在windows里面创建的，换行符跟linux不一样，会导致匹配ignore字段失败，把匹配条件放宽一些，这样升级异常更少
改动：对ignore部分匹配
测试：
1. 修改补丁包version成windows换行，可以匹配到ignore。
2. ignore改成inore，匹配不上
</msg>
</logentry>
<logentry
   revision="257711">
<author>lcy</author>
<date>2016-04-29T08:52:06.203470Z</date>
<msg>reviewid: 18051
review by fxw
Bug id: 2245
问题分析：TD2245,【设置主机间通信网口】掩码输入为0.0.0.0不合法的掩码信息的时候，提示需要优化一下
问题出现的根源：
IP地址和子网掩码没有在批量设置的接口处进行检查，分发到各个主机之后才检查，所以出现了失败日志的大量不友好的描述信息
改动说明：
提前检查IP地址和子网掩码的有效性
自测：
自测通过。</msg>
</logentry>
<logentry
   revision="257685">
<author>fxw</author>
<date>2016-04-29T06:34:29.561483Z</date>
<msg>noreview
TD5
更改报错信息</msg>
</logentry>
<logentry
   revision="257672">
<author>fxw</author>
<date>2016-04-29T03:41:26.421697Z</date>
<msg>noreview
合入257375代码有问题，多了一个括号
qemuserver。pm的修改也被回滚了。</msg>
</logentry>
<logentry
   revision="257645">
<author>fxw</author>
<date>2016-04-29T02:09:40.610977Z</date>
<msg>noreview
更新vs包</msg>
</logentry>
<logentry
   revision="257639">
<author>lcy</author>
<date>2016-04-29T01:37:50.043556Z</date>
<msg>reviewid: 18023
review by fxw
Bug id: null
问题分析：新需求】模板部署出来的虚拟机的系统盘支持编辑磁盘大小，UI代码
改动说明：
注释一行多出来的代码
自测：
新功能，打包验证</msg>
</logentry>
<logentry
   revision="257569">
<author>lcy</author>
<date>2016-04-28T08:47:20.997820Z</date>
<msg>reviewid: 17999
review by fxw
Bug id: null
问题分析：新需求】模板部署出来的虚拟机的系统盘支持编辑磁盘大小，UI代码
改动说明：
无
自测：
新功能，打包验证</msg>
</logentry>
<logentry
   revision="257565">
<author>lcy</author>
<date>2016-04-28T08:36:27.249253Z</date>
<msg>reviewid: 17995
review by fxw
Bug id: null
问题分析：【新需求】VMP虚拟机的大部分配置信息支持开机编辑，重启生效，后台代码
改动说明：
还有一个reviewId 17996
无
自测：
新功能，打包验证</msg>
</logentry>
<logentry
   revision="257564">
<author>lcy</author>
<date>2016-04-28T08:31:22.023620Z</date>
<msg>reviewid: 17997
review by fxw
Bug id: null
问题分析：【新需求】VMP虚拟机的大部分配置信息支持开机编辑，重启生效，UI代码
改动说明：
无
自测：
新功能，打包验证</msg>
</logentry>
<logentry
   revision="257542">
<author>fxw</author>
<date>2016-04-28T03:53:50.350801Z</date>
<msg>noreview
bugid TD2144
改动：合入aSV修改：raid卡告警报错，提示识别不了raid卡
说明：HP的raid卡用hpssacli来处理
测试：无</msg>
</logentry>
<logentry
   revision="257530">
<author>fxw</author>
<date>2016-04-28T03:07:14.847459Z</date>
<msg>noreview
bugid：750
说明：客户主机502天没有关机了， 所以我们的任务启动时间都是很长的了。超过了我们16进制的时间长度。 
改动：合入出错，多改了一个8
测试：待打包测试</msg>
</logentry>
<logentry
   revision="257524">
<author>hyq</author>
<date>2016-04-28T02:37:11.684345Z</date>
<msg>reviewid : 17986
bug id  ; null
问题描述 : 放开派生虚拟机磁盘扩容限制
改动说明 : null</msg>
</logentry>
<logentry
   revision="257514">
<author>hyq</author>
<date>2016-04-28T01:46:02.618670Z</date>
<msg>reviewid : 17941
bug id : null
问题描述 : 如果普通网口的IP与局域网内其它IP也冲突那么产生告警
改动说明 ; NULL</msg>
</logentry>
<logentry
   revision="257396">
<author>fxw</author>
<date>2016-04-27T09:48:31.934778Z</date>
<msg>noreview
合入常用命令的perl接口</msg>
</logentry>
<logentry
   revision="257386">
<author>fxw</author>
<date>2016-04-27T08:50:22.367706Z</date>
<msg>Merged revision(s) 255981 from VTP/aSV4.5_SDDC/Alternate/src/kernel:
noreview Merged revision(s) 255792, 255931 from VTP/aSV4.6/aSV4.5_SDDC:
review id 17360
Reviewed by: lifan
BUG ID: null
问题分析：
改动说明：为了解决集群中多个USB映射到同一个虚拟机，导致主机宕机的问题，新增内核文件/driver/base/core.c
做了哪些测试：
........
review id 13370
Reviewed by: lifan
BUG ID: 1158
问题分析：USB设备添加的流程中device_add(),在遍历获取当前设备对象kobject的父设备时，设备被从挂接的kset链表上释放移除了，导致在获取自旋锁时对非法地址的访问。
做了哪些测试：
在172.28.102.25，172.28.102.26，172.28.102.27集群主机插入15个USB，映射到172.28.102.25主机的虚拟机。
在172.28.102.25，172.28.102.26，172.28.102.27三台集群主机上更换内核，反复掉电重启虚拟机，对虚拟机上
的U盘进行映射和解映射测试，问题未出现。
........

........
</msg>
</logentry>
<logentry
   revision="257385">
<author>fxw</author>
<date>2016-04-27T08:47:12.612398Z</date>
<msg>noreview
bugid 1601
合入aSV修改：重启一个插了多个u盘的虚拟机导致设备宕机
先上库原始文件</msg>
</logentry>
<logentry
   revision="257375">
<author>fxw</author>
<date>2016-04-27T08:05:30.105477Z</date>
<msg>noreview
bugid：750
说明：客户主机502天没有关机了， 所以我们的任务启动时间都是很长的了。超过了我们16进制的时间长度。 
改动：合入TD750 里面记录的asv的修改 
测试：待打包测试</msg>
</logentry>
<logentry
   revision="257364">
<author>fxw</author>
<date>2016-04-27T07:30:05.137021Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="257361">
<author>fxw</author>
<date>2016-04-27T07:09:56.714249Z</date>
<msg>noreview
优化错误信息日志，给客户提供一些排查方向</msg>
</logentry>
<logentry
   revision="257340">
<author>yangwei</author>
<date>2016-04-27T03:16:57.118102Z</date>
<msg>reviewid 17923
bugid null
reviewby fxw
说明： 页面获取序列号接口修改
分析： 修改序列号注册调用的获取序列号接口
测试： 连接acenter，返回数据ok。</msg>
</logentry>
<logentry
   revision="257329">
<author>fxw</author>
<date>2016-04-27T02:03:13.806118Z</date>
<msg>Merged revision(s) 255393-257311 from VTP/VMP_for_adesk/VMP4.8R2/Trunk:
noreview
打日志多了一个参数，删掉
........
no review
更新日报
........
noreview 更新日报
........
noreview：更新日报
........
no review
........
noreview 日报
........
reviewid: 17229 reviewd by: lrx bug id: [376] 改动说明：【内部反馈】磁盘测速问题我们只测试64K块大小的，能否多测试几个快大小啊，1K 64K 512K 1M 这些都测试一下 
........
noreview 日报
........
问题描述： 
	命中率每次都更新时间比较长(合入改动）
BUG   ID: 1342
问题原因： 
	命中率每次都更新时间比较长
改动思路： 
	后台更新，前台直接读取，修改获取ip的方式
做了哪些测试： 
	点击虚拟存储界面时间明显减少
reviewid 17244, commited by wzl, reviewed by lzj
........
reviewid: 17247
reviewed by hlc
BUGID 1353 
问题说明：【解决方案测试】全新安装的aSV没有默认物理出口
改动说明：
       代码有问题
测试：
    测试：修改后，执行脚本可以生成默认物理出口
........
reviewid: 17250 reviewd by: lrx bug id: [1354] 改动说明：[解决方案测试]4.5发布包，全新安装后创建创建一个分组后就创建不了分组
........
reviewid: 17252 reviewd by: lsh bug id: [1362] 改动说明：翻译更新--配置数据通信口的IP池
........
reviewid: 17251
review by: hlc, wyy
Bug id：937
问题分析：
虚拟机转模板的时候，如果有做过备份，后台是会去修改相应的备份信息中的vmid，备份是可用的。

改动说明：
在check_vm_backuped中增加对备份存储是否在线进行判断，如果备份端是其他主机的local，则需要检测其他主机是否在线。
用户在转换模板时，如果备份端不在线，提示用户备份不可用；若备份端在线，则不提示备份不可用。

自测：
1.新建虚拟机，备份到共享存储S1，点击转换模板，不提示备份不可用——pass
2.将备份存储S1离线，点击转换模板，提示备份不可用——pass
3.新建虚拟机，备份到主机H1的local存储，点击转换模板，不提示备份不可用——pass
4.将主机H1离线，点击转换模板，提示备份不可用——pass
........
reviewid: 17014
bugid: td175
reviewed by: wuyy
问题说明：
oracle RAC环境下跑压力vmp前台显示内存一直占用100% -- 【可以处理】【尝试在host机上识别虚拟机操作系统类型】【体验性】
改动说明：
仅添加操作系统识别功能，有问题告警即可，不对配置做修改，用于给内存占用等报表异常问题提供依据。
通过p2v_parted命令识别操作系统类型，在虚拟机启动的时候识别一次，若配置操作系统类型与实际操作系统类型不符则告警，一天内最多告警一次。
识别原则是：能不告警尽量不告警，避免识别出错的情况下随意告警。
........
reviewid: 17256 reviewd by: lsh bug id: [1365] 改动说明：【4.5】【SDDC快速响应】【英文版】见附件就可以了
........
问题描述： 
	【功能异常】【asv】【自动化测试】配置网络，未检测网口是否up 
BUG   ID: 1256
问题原因： 
	原因：页面对网口进行了过滤检测，所以后台未对网口状态进行检查 ,现在改了为了方便自动化测试
改动思路： 
	后台增加网口状态检测
做了哪些测试： 
	2.2
	无链路聚合 
		页面禁止一个网口   ，后台设置私网不成功
		后台ifconfig down掉一个网口，后台设置私网不成功
   单链路聚合
      页面禁止一个网口   ，后台设置私网不成功
		后台ifconfig down掉一个网口，后台设置私网不成功
reviewid 17249, commited by yangyifan, reviewed by yinxin, gexy
........
reviewid: 17260 reviewd by: lsh bug id: [1069] 改动说明：数据通信口vxlan IP冲突检测修改，不检测全部了，只检测提交的数据
........
reviewid: 17253
reviewed by hlc
BUGID 862 
问题说明：升级最新包后，发现物理机启动不了，找不到aSV的启动项，失败错误码打出来。加上版本校验机制
改动说明：
       升级时，升级grub发现检查版本，发现需要升级grub才去升级
测试：替换脚本，修改当前版本号。测试ok
      打包后，再测试一下。
........
reviewid:17257 Review by:lbc Dug id:1024改动说明：在安装界面磁盘测速不准的情况下进行重测，最多5次


........
reviewid: 17263
review by: hlc, wyy
Bug id：1245
问题分析：
vxlan巨帧告警项注册的时候，设置为了默认开启（这里漏改了），当告警配置/cfs/alert.conf中没有对应的告警项时，vxlan巨帧告警将处以开启状态。
之前自测的时候是直接替换了alert.conf这个文件，将巨帧告警的active设为0，导致上述问题被掩盖而没有被发现。
而升级版本并不会去主动修改alert.conf，才将问题暴露出来。

改动说明：
重构vxlan告警生成的代码，同时将巨帧检测部分暂时注释掉，不去做巨帧检测。
后期如果需要重新开启巨帧检测，将注释取消即可。

自测：
1. 告警配置/cfs/alert.conf中不含host_vxlan_hyperframe告警项，重启告警服务，无巨帧提醒告警——pass；
2. 告警配置/cfs/alert.conf中含host_vxlan_hyperframe告警项，且active为0，重启告警服务，无巨帧提醒告警——pass；
3. 告警配置/cfs/alert.conf中含host_vxlan_hyperframe告警项，且active为1，重启告警服务，无巨帧提醒告警——pass；
4. 总之，不管配置中有没有host_vxlan_hyperframe告警项，都不告警。
........
noreview 改动列表
........
reviewid: 17264 reviewd by: lsh bug id: [809] 改动说明：虚拟设备的PLE开关显示不对
........
reviewid: 17265 reviewd by: lsh bug id: [1378] 改动说明：【4.5】【SDDC快速响应】【英文版】英文版不支持vac，需要做和vad和vaf一样的处理
........
reviewid: 17266 reviewd by: lsh bug id: [1377] 改动说明：【4.5】【SDDC快速响应】【英文版】英文版的告警的描述有问题
........
reviewid: 17267 reviewd by: lsh bug id: [1377] 改动说明：【4.5】【SDDC快速响应】【英文版】英文版的告警的描述有问题
........
noreview 合入大集群的SDDC
........
noreview 4.6大集群
........
reviewid: 17269 reviewd by: lsh bug id: [209] 改动说明：【SDDC快速响应_beta19】【4.15标准化交付】建议修改p2v包，提示客户服务端的物理出口的状态
........
reviewid: 17271 reviewd by: lsh bug id: [1380] 改动说明：存储测速默认块大小为64k不区分存储类型
........
noreview 费用记录更新
........
noreview:
改动说明：
1，ws2012被显示成ws2008.
未在环境上验证！！！
........
noreview Merged revision(s) 255693 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17339
bugid: null(hlc说翻译内容无需td号)
reviewed by: hlc
问题说明：
新增翻译，并修改原有翻译不规范的地方。
........

........
noreview
1.修改sfreportservice中的cpuid参数OP_REDUCE_GUEST_PHYSICAL_MEM为0x0000100b
让其与qemu中的相对应
2.重新p2v打包
........
Merged revision(s) 255862 from VTP/aSV4.6/aSV4.5_SDDC:
noreview TD1374 【大集群】 【aSV】热迁移虚拟机失败net_failed
问题原因是原来的迁移端口6001-6019与VNC的端口定义重合冲突了。
VNC部分规则被定义成DROP了。
在问题环境上验证通过。
........

........
Reverse Merged revision(s) 255876 from VTP/aSV4.5_SDDC/Alternate:
Merged revision(s) 255862 from VTP/aSV4.6/aSV4.5_SDDC:
noreview TD1374 【大集群】 【aSV】热迁移虚拟机失败net_failed
问题原因是原来的迁移端口6001-6019与VNC的端口定义重合冲突了。
VNC部分规则被定义成DROP了。
在问题环境上验证通过。
........

........

........
Merged revision(s) 255862 from VTP/aSV4.6/aSV4.5_SDDC:
noreview TD1374 【大集群】 【aSV】热迁移虚拟机失败net_failed
问题原因是原来的迁移端口6001-6019与VNC的端口定义重合冲突了。
VNC部分规则被定义成DROP了。
在问题环境上验证通过。
........

........
noreview Merged revision(s) 255909 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17401
bugid: td1474
reviewed by: hlc
问题说明：
【usa】翻译建议
改动说明：
修改提示信息
........

........
合入acenter的定制
revision 27398
........
noreview Merged revision(s) 255667, 255861 from VTP/aSV4.6/aSV4.5_SDDC:
review id 17321
Reviewed by :wyy
BUG ID :1420
问题分析：文件不存在的时候打日志会很多，并且不存在并不影响功能，并且编辑拓扑图会再创建。
改动说明：文件不存在直接返回
做了哪些测试:
文件不存在时：
没修改时刷日志，修改后没有刷日志，测试与之相关的一个功能正常。
........
review id 17392
Reviewed by :hlc
BUG ID :1440
问题分析：【拓扑图连线】在拓扑图添加路由器交换机等，在点击正式生效前，为这些设备添加连线，添加失败
改动说明：为了去掉日志加的一行代码，变量直接从下面拷贝的，其实是错的。
做了哪些测试:
毕现的，测试添加连线成功
........

........
noreview Merged revision(s) 255695 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17333
review by: wyy, hlc
Bug id：1411
问题分析：
【拓扑图】拓扑图连线物理出口和路由器报错连接数量达到上限(256)个。
虚拟交换机link数目统计有点问题。

改动说明：
1. 修改虚拟交换机link数目统计方法；
2. 在拓扑添加连线时，如果一端为虚拟交换机，另一端为虚拟机或者虚拟网络设备，需要开机状态才去检测虚拟交换机的link数是否超过上限。

自测：
改动仅涉及拓扑图操作，仅需验证拓扑图相关操作。
环境有限，自测时将最大连接限制数设为6来自测。

拓扑图编辑（限制数目仍然设置为6）：
1. 将7台关机状态的虚拟机（包括网络设备）连接到物理出口——连接成功，不受限制；
2. 准备几台开机状态的虚拟机（未连接任何网口），在拓扑图上将这些虚拟机连接到物理出口，
当连接到第7台时，报错“最多支持连接6个网口”；
3. 新建7个路由器，当前无开启设备连接到物理出口，只能连6个路由器，连第7个时报错；
4. 路由器、开机状态的虚拟机、开机状态的虚拟网络设备连接到物理出口的混合场景：上述三种设备占用的总连接数超过6个就会报错（一个网口占一个连接）；
5. 连接数已经达到上限（6）个，连接关机状态的虚拟机、网络设备，连接成功；
6. 连接数已经达到上限（6）个，连接开机状态的虚拟机、网络设备、路由器，连接失败；
........

........
noreview Merged revision(s) 255707 from VTP/aSV4.6/aSV4.5_SDDC:
review id 17341
Reviewed by :xhz
BUG ID :757
问题分析：[解决方案测试]【4.15标准化交付】vxlan的IP池可以设置和虚拟存储的IP同网段 -- 【罗子文20160411】
改动说明：vs采用聚合方式搭建时有问题，所以增加这种场景下的检查
做了哪些测试:
无链路聚合，设置vxlan的ip池，可以检测出来。
单交换机或者双交换机，可以检测出来（没改前是没检测）
在主机网页页面设置vxlan，检测ip冲突
........

........
noreview Merged revision(s) 255741 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17357 reviewd by: lsh  改动说明：存储测速选择块大小UI样式修改：K改为KB
........

........
noreview Merged revision(s) 255792, 255931 from VTP/aSV4.6/aSV4.5_SDDC:
review id 17360
Reviewed by: lifan
BUG ID: null
问题分析：
改动说明：为了解决集群中多个USB映射到同一个虚拟机，导致主机宕机的问题，新增内核文件/driver/base/core.c
做了哪些测试：
........
review id 13370
Reviewed by: lifan
BUG ID: 1158
问题分析：USB设备添加的流程中device_add(),在遍历获取当前设备对象kobject的父设备时，设备被从挂接的kset链表上释放移除了，导致在获取自旋锁时对非法地址的访问。
做了哪些测试：
在172.28.102.25，172.28.102.26，172.28.102.27集群主机插入15个USB，映射到172.28.102.25主机的虚拟机。
在172.28.102.25，172.28.102.26，172.28.102.27三台集群主机上更换内核，反复掉电重启虚拟机，对虚拟机上
的U盘进行映射和解映射测试，问题未出现。
........

........
noreview Merged revision(s) 255803 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17365
review by: hlc, lzw
Bug id：940
问题分析：
由于是批量操作，直接调用的现有API，操作日志也由现有API来输出，bug场景是在API调用之前抛出的异常，异常在循环内捕获。
导致无操作日志，也不报错。

改动说明：
不适用API的日志，自己打日志

自测：
构造不在集群内的派生虚拟机，恢复虚拟机，恢复失败，报错“暂时不支持恢复已不在集群内的派生虚拟机”
........

........
noreview Merged revision(s) 255812 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17374 reviewd by: lsh bug id: [937] 改动说明：模板转换为虚拟机增加是否存在备份的检测
........

........
noreview Merged revision(s) 255839 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17384 reviewd by: lsh bug id: [1461] 改动说明：磁盘支持64T原有磁盘不支持编辑预分配选项
........

........
noreview Merged revision(s) 255854 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17387
review by: wyy
Bug id：1412, 960
问题分析：
之前代码在计算默认恢复位置时，只是简单判断了虚拟机是否存在于集群内，存储是否为samba（也没有区分nfs），
导致默认恢复位置出现各种问题。

改动说明：
1. 如果备份端是samba或者nfs，将bak的status置为0；
2. 通过依次查询raw, bak的status来计算默认恢复位置。

自测：
构造环境：在存储S1上新建几台虚拟机，备份到其他存储S2，删除存储S1。

高级，存储详情的恢复页面：
1. 备份端为samba或者nfs，高级，存储详情的恢复页面查看默认恢复位置，为红色的请配置，原位置、备份位置均被置灰；
2. 备份端非samba、nfs，高级，存储详情的恢复页面查看默认恢复位置，为备份位置，原位置被置灰；

恢复页面：
3. 备份端为samba或者nfs，恢复页面查看默认恢复位置，为红色的请配置，原位置、备份位置均被置灰；
4. 备份端非samba、nfs，高级，存储详情的恢复页面查看默认恢复位置，为备份位置，原位置被置灰；
........

........
noreview Merged revision(s) 255858 from VTP/aSV4.6/aSV4.5_SDDC:
review id 17373
Reviewed by :hlc
BUG ID :1481
问题分析：将sdnagent的日志级别提高到7，可以打印debug日志。
改动说明：sdnagent是操作日志，不是定时操作，所以不会刷屏，现在sdnagent出问题基本没法查
做了哪些测试:
在设备上修改后可以打印debug日志。
需要打包后验证日志级别是不是7
........

........
noreview Merged revision(s) 255879 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17397 reviewd by: lsh bug id: [1452] 改动说明：【快速响应bate5】在非关机状态下ple应该不可勾选，虚拟设备应置灰勾选写缓存
........

........
noreview Merged revision(s) 255967 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17419
bugid: td1474
reviewed by: hlc
问题说明：
【usa】翻译建议
改动说明：
存在漏改和对齐问题
........

........
noreview Merged revision(s) 255968 from VTP/aSV4.6/aSV4.5_SDDC:
review id : 17409
commited by : tyy,
review by : lrx
BUG   ID: [1479]
问题描述： bugid1479：组建集群的向导窗口无法添加主机
问题分析： 
    添加主机与替换主机共用了一份检测
改动说明： 
    将添加主机和替换主机卡片处的检测分开
做了哪些测试： 
    无

........

........
noreview 
Revision: 255791
Author: guanlong
Date: 2016年4月12日 14:39:24
Message:
review id:17358 Review by:hlc Dug id:1024 
改动说明:
1：只有在测试到0速度时才报错，如果读写速度都为非0值，则显示测速失败，提示可能是raid的影响。
2：对于重测的情况，取多次测速的最大值作为判断依据，也就是读写速度能够是不同两次测试的速度。


----
Modified : /VTP/aSV4.6/aSV4.5_SDDC/build/pkg/replace-root/sf/bin/non_network_install.sh


........
noreview Merged revision(s) 255993 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17416 reviewd by: lsh bug id: [1515] 改动说明：【韦思捷】UI体验问题修改
........

........
noreview 标准化交付修改版本号为HCI5.0.01
........
reviewid: 17431 reviewd by: jcy bug id: [] 改动说明：更新翻译
........
noreview 大集群的版本号也加进入，避免升级失败
........
noreview Merged revision(s) 256028 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17439
Bug id：1527
问题分析：【大集群】vtpdaemon监听的端口是127.0.0.1:85，apache connect时，是localhost:85，如果localhost不是127.0.0.1就会失败
改动说明：修改apache连接vtpdaemon的ip为127.0.0.1

自测：VMP环境出现好几次，当时修改后验证通过。在本次出现问题时，也修改了，验证通过
........

........
noreview 合入最新的翻译
........
noreview Merged revision(s) 256052 from VTP/aSV4.6/aSV4.5_SDDC:
问题描述： 
	1.初始化的时候页面传下来的参数增加了字段，后台没有修改过滤
   2.检测磁盘格式化进度超时直接返回给页面了，没有回退
BUG   ID: 1528
问题原因： 
改动思路： 
	1.增加对增加字段的过滤
	2.如果发现一块盘超时。让这块盘不在做检测，让程序继续执行到最后一步的检测，在其中如果发现失败会进行回退。
做了哪些测试： 
	初始化，查看vs_disk_op_progress.sh日志 不出现对不存在的文件的检查
review id 17462, commited by yangyifan, reviewed by gexy
........

........
noreview Merged revision(s) 256061 from VTP/aSV4.6/aSV4.5_SDDC:
问题描述： 
	虚拟机平衡是打快照会卡住
BUG   ID: 1166
问题原因： 
	虚拟机平衡时会写文件，锁住文件，而打快照也需要获取锁，则会卡住
改动思路： 
	虚拟机打快照的时候检查是否在平衡，平衡则不让快照
做了哪些测试： 
	 因为代码复用，所以没有测试平衡的逻辑，
     1. 测试这个逻辑确实是打快照的逻辑。
     2. perl -c编译通过
     3. 另外告警的有测试，修改disk中磁盘文件disk_location字段，为空是告警取disk_alias字段， 不为空则去disk_name
review id 17456, commited by gexy, reviewed by wugeng
........

........
noreview Merged revision(s) 256066 from VTP/aSV4.6/aSV4.5_SDDC:
问题描述： 
	替换主机时，误把离线主机判断成在线，导致替换主机失败
BUG   ID: 1466
问题原因： 
	gluster pool list命令会返回空，具体原因是因为gluster cli与glusterd之间的连接被关闭了，所以gluster cli没取到节点信息。脚本is_vs_node_offline.sh在处理时，把返回Disconnected状态的当成offline，其它的当成online，导致上层判断出错。
改动思路： 
	1、脚本里添加unknown状态，当gluster cli返回空时，报告状态unknown
	2、页面上提示信息修改：当返回unknown状态时，提示用户重试
做了哪些测试： 
	1、验证主机在不同状态时脚本可以返回相应的online、unknown、offline状态。
	2、验证主机替换时，主机offline时可替换，unknown时提示用户重试并返回主机状态页面，online时提示旧主机仍可用
review id 17460, commited by chenzhiwei, reviewed by wugeng, gexy
........

........
noreview Merged revision(s) 255733 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17336
bugid: 测试设备跟踪系统
reviewed by: wzt
问题说明：
测试设备跟踪系统，asv上的修改
改动说明：
1.asv测试设备判断
2.测试设备id开机自动保存到/cfs/nodes/host-xxx/host.ini，方便集群查看
3.序列号接口返回测试设备信息
测试
1.创建/sf/cfg/vs/testdev 并写入设备ID；删除host.ini，重启aSV，host.ini重新生成，且testdevID有值；
2.删除/sf/cfg/vs/testdev 及 host.ini， 执行 hostconf.sh， 自动生成host.ini 且testdevID字段无值；
3./sf/cfg/vs/testdev存在但无内容，删除host.ini， 执行 hostconf.sh， 自动生成host.ini 且testdevID字段无值；
4.手动调用Tools.pm新增的函数，无逻辑问题；
5.页面抓包序列号页面，sn接口有testdevID字段及testdevURL字段返回
6.删除host.ini，手动调用Tools.pm 中的write_default_host，/sf/cfg/vs/testdev中的内容保存到了host.ini
7.与页面联调，二维码生成成功，sangfor_server_url中的测试url访问成功

........

........
noreview Merged revision(s) 255743 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17359 
reviewd by:  lsh
bug id: [] 
改动说明：
测试设备需要显示登记链接的二维码
........

........
noreview Merged revision(s) 256064 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17393
bugid: 测试设备跟踪系统
reviewed by: wzt
问题说明：
测试设备跟踪系统，添加主机流程修改
改动说明：
正式版序列号集群，不支持添加测试设备；
测试序列号集群，支持添加普通设备；
测试序列号集群，添加测试设备，需要重新申请序列号---添加完成后销毁序原测试序列号
普通集群（无正式序列号），添加测试设备，需要申请序列号---无需处理
测试
#添加删除主机
1.原集群企业版序列号，无测试设备 + 测试设备 --添加失败 --pass
2.原集群非企业版序列号，无测试设备 + 测试设备 --添加成功 pass
3.原集群非企业版序列号，有测试设备 + 测试设备 --添加成功 pass
4.原集群企业版测试序列号，有测试设备 + 测试设备 --成功，序列号清理 
5.原集群标准/测试序列号，有测试设备 + 正式设备 --成功，序列号清理 --pass
#配置丢失测试
1.恢复自动备份，勾选所有，配置不丢失 --ok
2.恢复手动备份到本地的配置，配置不丢失 --ok
3.恢复出厂设置，配置不丢失 --ok
........

........
noreview Merged revision(s) 256097 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17477
reviewed by hlc
BUGID null 
问题说明：测试设备跟踪系统，序列号服务，序列号工具相关改动
改动说明：
       1、序列号分为 测试序列号，非测试序列号。 测试序列号，不能用在非测试环境。非测试序列号，不能用在测试环境。
       2、集群中插入空key，变成试用版。可以看到keyid
测试：

序列号

1.非测试设备，插入正式key --变企业版
2.非测试设备，插入测试key --试用版，需要申请企业版序列号注册后可用；
3.测试设备，插入正式key --试用版；
4.测试设备，插入测试key --企业版； 
5.测试key，插入到非测试设备上，集群中有测试设备 --变成企业版； 
6.正式key，插入到非测试设备上，集群中有测试设备；--变成试用版；
7.测试key，插入到测试设备上，集群中有测试设备 --还是企业版；
8.正式key，插入到测试设备上，集群中有测试设备；--变成试用版；
9.测试key，集群中无测试设备； --试用版   
10.正式key，集群中无测试设备 --变成企业版；
11企业版，无key，插入测试key -- 变成试用版，版本不兼容；

11.插入两个key：已有key，则不会去读写第二个key
    1.插入两个key，有测试设备，有测试key，再插入正式key；--测试企业版序列号 ；
    2.插入两个key，有测试设备，有测试key，再插入测试key；--还是第一个测试的key序列号；
    3.插入两个key，有测试设备，有正式key，再插入测试key    --还是试用版 ；
    4.插入两个key，有测试设备，有正式key，再插入正式key    --还是试用版 
    5.插入两个key，无测试设备，有正式key，再插入测试key；--还是正式企业版 
    6.插入两个key，无测试设备，有正式key，再插入正式key；--还是第一个企业版序列号 
    7.插入两个key，无测试设备，有测试key，再插入正式key    --还是试用版 
    8.插入两个key，无测试设备，有测试key，再插入测试key    --还是试用版 

12.插入空key
    原环境免费/试用版，无key，插入空key   --试用版，可以看到keyid
    企业版，无key，插入空key           --变成试用版，可以看到keyid 
    企业版，有key，插入空key           --还是原来的企业版，     
    有空key，再插入正式key             --还是试用版，可以看到keyid 
    测试环境，有空key，插入正式key      --还是试用版，可以看到keyid 

13.正式key，插在正式环境，注册测试序列号，失败；
14.正式key，插在测试设备的环境，注册测试序列号，成功，变成企业版；
15.测试key，插在正式环境上，注册正式序列号，成功；
16.测试key，插在测试环境上，注册正式序列号，失败；



添加删除主机

1.原集群企业版序列号，无测试设备 + 测试设备 --添加失败 
2.原集群非企业版序列号，无测试设备 + 测试设备 --添加成功
3.原集群非企业版序列号，有测试设备 + 测试设备 --添加成功,序列号清理 
4.原集群企业版测试序列号，有测试设备 + 测试设备 --成功，序列号清理 
5.原集群标准/测试序列号，有测试设备 + 正式设备 --成功
........

........
noreview Merged revision(s) 256107 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17481
bugid: 测试设备跟踪系统
reviewed by: wzt
问题说明：
测试设备跟踪系统URL确定
改动说明：
1.更新测试设备跟踪系统URL
2.5分钟定时写入当前时间戳到配置
测试
1.手动执行5分钟写入时间戳脚本，时间更新
2.页面抓包查看有测试设备的环境，url生成，二维码生成；
........

........
noreview Merged revision(s) 256133 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17484 reviewd by: jcy bug id: [809] 改动说明：【SDDC快速响应_beta22】【PLE】需要在虚拟机的调试处新增开启和关闭PLE的选项 
........

........
noreview 标准化交付修改版本号为HCI5.0.01
........
noreview Merged revision(s) 256152 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17487 reviewd by: lsh bug id: [] 改动说明：序列号不支持上网行为管理的描述不对， 少了“了解”这个词
........

........
reviewid: 17491 reviewd by: lsh bug id: [] 改动说明：更新翻译
........
noreview Merged revision(s) 256191 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17499 reviewd by: lsh bug id: [] 改动说明：更新翻译
........

........
noreview
TD1595
合入aSV修改：64位WINDOWS下win32k.sys 0x50 Args:00000000000000008蓝屏。CPU BUG，加入更新CPU microcode 流程。
........
noreview Merged revision(s) 256205 from VTP/aSV4.6/aSV4.5_SDDC:
问题描述： 
	修改签名工具，支持生成设备id文件功能
BUG   ID: 1487
问题原因： 
	需求，支持生成测试设备id文件
改动思路： 
	vssn.pm添加api接口，修改签名工具，调用api生成设备id文件
做了哪些测试： 
	1，不勾选测试设备框，正常签名
    2，勾选后，可生成测试设备id文件，/sf/cfg/vs/testdev
review id 17394, commited by ljf, reviewed by wugeng, lzj
........

........
noreview Merged revision(s) 256283 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17524
reviewed by hlc
BUGID 1296
问题说明：虚拟机连接物理出口时，看到的物理出口桥接状态不对
改动说明：Merged revision(s) 256281 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17523
reviewed by hlc
BUGID 1297 
问题说明：【4.5】【SDDC快速响应_beta2】【p2v】p2v迁移到vs存储，报空间不足
改动说明：
       p2v迁移服务端存储状态都不可选时，直接报错，提示检查服务端存储状态
测试：
     修改服务端api返回的存储状态。模拟服务端存储状态都有问题场景。
     windows p2v，选择该服务端后，下一步会报错，提示检查服务端存储状态
........


       脚本有问题，导致添加主机后，集群稳定回调脚本中，通知sdnctrld成员变化的命令没有下发。sdnctrld始终认为只有之前的节点。
查询主机网口状态时，查不到新加进来主机的网口状态。
测试：
    修改后，执行脚本成功。
    之后查看物理出口状态正确
........

........
reviewid: 17526
bugid: 1627
reviewed by: fxw
说明：【新功能】【acenter】acenter集中管理平台vmp授权
分析：
测试：无需测试，acenter功能文件上库
........
noreview Merged revision(s) 256228 from VTP/aSV4.6/aSV4.5_SDDC:
问题描述： 
	新主机内存不做限制比较
BUG   ID: 无
问题原因： 
	当时理解规则出错
改动思路： 
	如果新主机内存比旧主机大很多不显示提示
做了哪些测试： 
	使用大内存的主机替换小内存的主机，页面没有显示告警图标
review id 17510, commited by gexy, reviewed by tyy
........

........
noreview Merged revision(s) 256297 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17527 reviewd by: jcy bug id: [1069] 改动说明：数据通信口vxlan IP冲突检测修改，不检测全部了，只检测提交的数据
........

........
noreview Merged revision(s) 256337 from VTP/aSV4.6/aSV4.5_SDDC:
问题描述： 
	 asv4.2升4.5,设备升级失败
BUG   ID:1622
问题原因： 
	 gluster没有加全路径
改动思路： 
	  加上全路径与调试日志
做了哪些测试： 
	  测试升级可以成功关闭卷
review id 17541, commited by smy, reviewed by wugeng, ygh
........

........
noreview Merged revision(s) 256308 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17533 reviewd by: jcy bug id: [1636] 改动说明：【虚拟机导出】假如虚拟机正在进行MD5的计算，点击详情，看不到进度
........

........
noreview Merged revision(s) 256331 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17536 reviewd by: jcy bug id: [1297] 改动说明：离线或者未激活的存储置灰不可选
........

........
noreview Merged revision(s) 256345 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17544
bugid: 测试设备跟踪系统
reviewed by: wyy
问题说明：
开机启动，配置写入失败，改成放到hostconf中写入，该脚本由集群文档回调调用
改动说明：
开机启动，配置写入失败，改成放到hostconf中写入，该脚本由集群文档回调调用
定时脚本里面加入写host.ini动作
测试
1.无host.ini，无testdev，自动生成host.ini
2.无hsot.ini，有testdev，生成host.ini 且有testdevID
3.有host.ini，无testdev，host.ini未修改
4.有host.ini，有testdev，host.ini的testdevID自动被修为testdev中的ID
........

........
noreview Merged revision(s) 256376 from VTP/aSV4.6/aSV4.5_SDDC:
问题描述： 
	【升级故障】 asv4.2 升级到新包 HCI5.0.01(20160415) 卡死，升级失败
BUG   ID: 1644
问题原因： 
	未判断写缓存是否刷完 就关闭卷
改动思路： 
	先回回退
做了哪些测试： 
	回退代码，未测试
review id:17552, commited by ygh, reviewed by lzj, wugeng
........

........
noreview Merged revision(s) 256381 from VTP/aSV4.6/aSV4.5_SDDC:
reviewed by hlc
BUGID 1646
问题说明：【标准化交付】连通性探测的目的端展示在涉及物理出口有问题
改动说明：
       判断是否是目的端，有问题。
测试：
    连通性探测，目的端是集群外的网络时，显示正确。
    目的端是集群内其他虚拟机，且只能通过物理出口连通时，显示正确。
    目的端是集群内其他虚拟机，通过普通交换机连通时，显示正确。
........

........
noreview Merged revision(s) 256484 from VTP/aSV4.6/aSV4.5_SDDC:
review id: 17575
bugid: 测试设备跟踪系统
reviewed by: wyy
问题说明：
修正shell脚本两处错误
改动说明：
对正常流程不影响，影响12小时清理序列号功能（不能定时写入最新时间）
测试
修改后，查看testdev_alive会定时更新
........

........
noreview Merged revision(s) 256310 from VTP/aSV4.6/aSV4.5_SDDC:
review id:  17534
Bug id: 1471
问题分析: 源于LINUX与北研的不一致行为
改动说明: 将行为统一

自测：手动修改测试过。
........

........
Merged revision(s) 256526 from VTP/aSV4.5_SDDC/Alternate:
noreview Merged revision(s) 256310 from VTP/aSV4.6/aSV4.5_SDDC:
review id:  17534
Bug id: 1471
问题分析: 源于LINUX与北研的不一致行为
改动说明: 将行为统一

自测：手动修改测试过。
........

........

........
noreview Merged revision(s) 256310 from VTP/aSV4.6/aSV4.5_SDDC:
review id:  17534
Bug id: 1471
问题分析: 源于LINUX与北研的不一致行为
改动说明: 将行为统一

自测：手动修改测试过。
........

........
reviewid: 17596
review by fxw
Bug id: null
问题分析：【新功能】VMP支持静态路由的配置
改动说明：
无
自测：
新功能，打包验证
........
reviewid: 17619
bugid: 1627
reviewed by: fxw
说明：【新功能】【acenter】acenter集中管理平台vmp授权
分析：1、修改authorize_client参数列表 2、修改authorize_client_notice文件命令行及调用脚本路径
3、修改vmpsn acenter标记
测试：
1、ps aux | grep auth结果为/sf/bin/authorize_client --notice_app /sf/bin/authorize_client_notice
2、标记文件分别为.vmp_acenter_flag和.vmp_acenter_conn_flag位于cfs下面
........
noreview 合入50蓝屏
........
noreview
上个合入有多余信息，回滚掉在合入
........
noreview
Merged revision(s) 256206 from VTP/VMP_for_adesk/VMP4.9/Trunk/build:
TD1595
合入aSV修改：64位WINDOWS下win32k.sys 0x50 Args:00000000000000008蓝屏。CPU BUG，加入更新CPU microcode 流程。
........

........
Merged revision(s) 255355, 255385, 255799, 256081, 256423, 256449, 256544, 256583, 256631, 256645, 256713 from VTP/aSV4.6/VMP4.7:
修改cacher在集群切换主控下的算法
........
合入齐飞给的定制，在低配置设备上，虚拟cpu信息（没错，就是欺骗领导）
........
reviewid : 17371
commited by : tyy,
review by : lrx
BUG   ID: [1389]
问题描述： bugid1389 无法替换磁盘；虚拟存储页面报脚本错误
问题分析： 
    引用文件路径错误；没有合入新代码
改动说明： 
    修改出错的地方
做了哪些测试： 
    无

........
noreview
1.vmlist的status.c解析时应该匹配换行符
2.OpLogClient.pm里serverip没有保存
3.挪动新建虚拟机时vs的检查代码，错误时要输出到操作日志
........
noreview
优化日志传递机制，减少日志写入数据量
已在SDDC版本验证，代码无差异
........
问题描述： 
	无法替换主机
BUG   ID: 暂无，到时候有就补上
问题原因： 
	代码漏合
改动思路： 
	合入代码
做了哪些测试： 
	将代码放到公司环境， vtpsh get测试通过
review id 17571, commited by gexy, reviewed by fxw
........
reviewid:  17588
Bug id: 1714
问题分析: 日志太多了
改动说明: 将之前加的调试日志移除。

自测：无。
........
reviewid:  17588
Bug id: 1714
问题分析: 日志太多了
改动说明: 将之前加的调试日志移除。

自测：无。
........
reviewid:  17617
Bug id: 1682
问题分析: vmp上批量编辑虚拟机是串行进行，应该改为并行，否则批量编辑时太耗时了
改动说明: 并发解决

自测：在aSV和VMP上替换代码测试过。
........
noreview
针对storage_check_online优化，做的单元测试及详细场景验证
发现若干问题，自测通过
........
4.6升级到4.8时 禁用掉write-cache
........

........
reviewid 17797
bugid 1627
reviewby gwl
说明：acenter授权修改
分析：1、vs授权保存到cfs，以及vs授权前台显示接口修改；2、切换主控，重新上传公钥。
测试：打包测试。
........
noreview 更新VDC
........
reviewid :
bug id : 1275
问题描述 : td1275: 【气泡内存】win7 x64的虚拟机，已安装4.8正式版的vmtools，开机，vmtools未自动升级
改动说明 : 编译并且更新了模块更新服务的二进制文件，以便打包
测试 : 上传打包后才能测试

........
reviewid :
bug id : 1275
问题描述 : td1275: 【气泡内存】win7 x64的虚拟机，已安装4.8正式版的vmtools，开机，vmtools未自动升级
改动说明 : 将打包文件签名后重新上传
测试 : 上传打包后才能测试
........
reviewid : 
bug id : 1275
问题描述 : td1275:
改动说明 : 重新编译

........
reviewid :
bug id : 1275
问题描述 : td1275: 【气泡内存】win7 x64的虚拟机，已安装4.8正式版的vmtools，开机，vmtools未自动升级
改动说明 : 上传安装包
测试 : 上传打包后才能测试
........
Merged revision(s) 253123, 253164 from VTP/aSV4.6/VMP4.7/build:
reviewid : 16518
bug id : 34772
问题描述：
集群升级时 就算存在节点没有参与升级，也检测为升级成功；原因是采用检测大版本号，还应检查升级包具体日期。目前采用大版本号和打包时间作为升级包版本信息检查。
改动说明：
1、升级包增加导出版本打包信息，由大版本号和打包时间组成；
2、升级时查询到的版本信息 也是 由大版本号和打包时间组成;
3、uapi.up文件get_status方法将返回版本号改为打包版本信息。
测试：
做过单元测试，需要打包验证。
........
reviewid : 16518
bug id : 34772
问题描述：
集群升级时 就算存在节点没有参与升级，也检测为升级成功；原因是采用检测大版本号，还应检查升级包具体日期。目前采用大版本号和打包时间作为升级包版本信息检查。
改动说明：
1、修正获取主版本失败问题。
测试：
做过单元测试，需要打包验证。
........

........
reviewid 17859
bugid null
reviewby fxw
说明：优化检测安装多个vmp脚本
测试：
直接统计卷标为vtpboot的个数，测试ok。
........
noreview
版本信息里面加入日期
........
by wyq 修改升级包路径为vmp-pkg

........
noreview :
bug id : 2082
问题描述 : td2082: 【bug】【气泡内存】升级0425的包后，vm内部提权服务异常，导致vm内部报表服务未起，vmp前台虚拟机详情页面报表数据异常
改动说明 : 将此目录revert到254344
测试 :    手动替换Installer.exe，SangforModulesUpdateServer.exe，SangforPrivilegeElevateService.exe，SangforUpdateServer.exe，SangforPrivilegeElevateClient.dll后重启，
          sfreportservice正在运行，sftoolservice没有运行，经twf确认sftoolservice正常。
........
noreview :
bug id : 2082
问题描述 : td2082: 【bug】【气泡内存】升级0425的包后，vm内部提权服务异常，导致vm内部报表服务未起，vmp前台虚拟机详情页面报表数据异常
改动说明 : 重新编译
          
测试 : 手动替换Installer.exe，SangforModulesUpdateServer.exe，SangforPrivilegeElevateService.exe，SangforUpdateServer.exe，SangforPrivilegeElevateClient.dll后重启，
          sfreportservice正在运行，sftoolservice没有运行，经twf确认sftoolservice正常。
........
noreview :
bug id : 2082
问题描述 : td2082: 【bug】【气泡内存】升级0425的包后，vm内部提权服务异常，导致vm内部报表服务未起，vmp前台虚拟机详情页面报表数据异常
改动说明 : 1.签名
          2.SangforPrivilegeElevateClient.dll拷贝到windows\bin、windows\bin\fastio\bin和windows\bin\fastio\ModulesUpdate目录下。
            Installer、SangforModulesUpdateServer、SangforPrivilegeElevateService、SangforUpdateServer四个exe拷贝到windows\bin\fastio\ModulesUpdate目录下
测试 : 手动替换Installer.exe，SangforModulesUpdateServer.exe，SangforPrivilegeElevateService.exe，SangforUpdateServer.exe，SangforPrivilegeElevateClient.dll后重启，
          sfreportservice正在运行，sftoolservice没有运行，经twf确认sftoolservice正常。
........
noreview
变量分割有问题
........
noreview :
bug id : 2082
问题描述 : td2082: 【bug】【气泡内存】升级0425的包后，vm内部提权服务异常，导致vm内部报表服务未起，vmp前台虚拟机详情页面报表数据异常
改动说明 : 更新包
        
测试 : 手动替换Installer.exe，SangforModulesUpdateServer.exe，SangforPrivilegeElevateService.exe，SangforUpdateServer.exe，SangforPrivilegeElevateClient.dll后重启，
          sfreportservice正在运行，sftoolservice没有运行，经twf确认sftoolservice正常。
........
</msg>
</logentry>
<logentry
   revision="257325">
<author>fxw</author>
<date>2016-04-27T01:42:31.724529Z</date>
<msg>noreview
bugid 896
说明：合入aSV最新的tpl_tools.sh,基于svn://200.200.0.10/vt/vt/VTP/aSV4.5_SDDC/Alternate/build/pkg/replace-root/sf/bin/tpl_tools.sh  253163
改动：
测试：
无
</msg>
</logentry>
<logentry
   revision="257312">
<author>fxw</author>
<date>2016-04-26T13:15:47.600938Z</date>
<msg>noreview
增大升级空间的判断，2G太小了，会导致校验失败</msg>
</logentry>
<logentry
   revision="257298">
<author>yangwei</author>
<date>2016-04-26T12:32:05.153889Z</date>
<msg>reviewid： 17903
bugid 1627
reviewby fxw
说明：UpInfoRequest和GrantRequest请求需要带AccessPwd参数
测试：打包验证</msg>
</logentry>
<logentry
   revision="257296">
<author>fxw</author>
<date>2016-04-26T12:26:09.031290Z</date>
<msg>noreview
版本信息加入日期</msg>
</logentry>
<logentry
   revision="257264">
<author>fxw</author>
<date>2016-04-26T10:45:18.533588Z</date>
<msg>noreview
解决cluster_task_manager脚本在网络异常时日志打印过多的问题。</msg>
</logentry>
<logentry
   revision="257247">
<author>yangwei</author>
<date>2016-04-26T09:06:50.473041Z</date>
<msg>reviewid: 17886
reviewed by fxw
BUGID 1585
问题说明：读写key失败，如果返回的错误码是 无效的句柄，就重新打开一次key，相当于做了一次key的拔插操作
改动说明：
    客户环境，一次读key，返回通信失败之后，后面读key都返回无效的句柄错误，重启ukey_proxy或者拔插key就恢复了。
    读写key失败，如果返回的错误码是 无效的句柄，就重新打开一次key，相当于做了一次key的拔插操作。
测试：
    我们的环境，替换程序之后，操作key正常。</msg>
</logentry>
<logentry
   revision="257236">
<author>yangwei</author>
<date>2016-04-26T08:05:02.408538Z</date>
<msg>reviewid 17875
bugid 1627
reviewby fxw
说明 vmp连接acenter加入acenter密码
测试：
打包测试</msg>
</logentry>
<logentry
   revision="257232">
<author>qifei</author>
<date>2016-04-26T07:45:47.629387Z</date>
<msg>by wyq 修改升级包路径为vmp-pkg
</msg>
</logentry>
<logentry
   revision="257191">
<author>yangwei</author>
<date>2016-04-26T02:32:04.273970Z</date>
<msg>reviewid 17859
bugid null
reviewby fxw
说明：优化检测安装多个vmp脚本
测试：
直接统计卷标为vtpboot的个数，测试ok。</msg>
</logentry>
<logentry
   revision="257140">
<author>fxw</author>
<date>2016-04-25T12:04:57.422735Z</date>
<msg>Merged revision(s) 256926-256931 from VTP/aSV4.6/VMP4.7:
问题描述： 
	替换主机时，误把离线主机判断成在线，导致替换主机失败
BUG   ID: 1466
问题原因： 
	gluster pool list命令会返回空，具体原因是因为gluster cli与glusterd之间的连接被关闭了，所以gluster cli没取到节点信息。脚本is_vs_node_offline.sh在处理时，把返回Disconnected状态的当成offline，其它的当成online，导致上层判断出错。
改动思路： 
	1、脚本里添加unknown状态，当gluster cli返回空时，报告状态unknown
	2、页面上提示信息修改：当返回unknown状态时，提示用户重试
做了哪些测试： 
	1、验证主机在不同状态时脚本可以返回相应的online、unknown、offline状态。
	2、验证主机替换时，主机offline时可替换，unknown时提示用户重试并返回主机状态页面，online时提示旧主机仍可用
review id 17460, commited by chenzhiwei, reviewed by wugeng, gexy
........
问题描述： 
	替换主机时，误把离线主机判断成在线，导致替换主机失败
BUG   ID: 1466
问题原因： 
	gluster pool list命令会返回空，具体原因是因为gluster cli与glusterd之间的连接被关闭了，所以gluster cli没取到节点信息。脚本is_vs_node_offline.sh在处理时，把返回Disconnected状态的当成offline，其它的当成online，导致上层判断出错。
改动思路： 
	1、脚本里添加unknown状态，当gluster cli返回空时，报告状态unknown
	2、页面上提示信息修改：当返回unknown状态时，提示用户重试
做了哪些测试： 
	1、验证主机在不同状态时脚本可以返回相应的online、unknown、offline状态。
	2、验证主机替换时，主机offline时可替换，unknown时提示用户重试并返回主机状态页面，online时提示旧主机仍可用
review id 17460, commited by chenzhiwei, reviewed by wugeng, gexy
........
</msg>
</logentry>
<logentry
   revision="257079">
<author>fxw</author>
<date>2016-04-25T06:44:27.248469Z</date>
<msg>noreview
更新VDC</msg>
</logentry>
<logentry
   revision="257053">
<author>fxw</author>
<date>2016-04-25T03:02:16.405159Z</date>
<msg>noreview
将BUG_ON改成WARN_ON</msg>
</logentry>
<logentry
   revision="257039">
<author>yangwei</author>
<date>2016-04-25T01:40:59.360625Z</date>
<msg>reviewid 17811
bugid 1627
reviewby fxw
说明：acenter授权修改
分析：1、手动切换主控，重新上传vmp公钥到acenter。
测试：打包测试。</msg>
</logentry>
<logentry
   revision="257004">
<author>yangwei</author>
<date>2016-04-23T08:56:53.216213Z</date>
<msg>reviewid 17797
bugid 1627
reviewby gwl
说明：acenter授权修改
分析：1、vs授权保存到cfs，以及vs授权前台显示接口修改；2、切换主控，重新上传公钥。
测试：打包测试。</msg>
</logentry>
<logentry
   revision="256862">
<author>fxw</author>
<date>2016-04-21T12:52:43.824849Z</date>
<msg>noreview
更新vs</msg>
</logentry>
<logentry
   revision="256860">
<author>fxw</author>
<date>2016-04-21T12:49:26.894030Z</date>
<msg>Merged revision(s) 255355, 255385, 255799, 256081, 256423, 256449, 256544, 256583, 256631, 256645, 256713 from VTP/aSV4.6/VMP4.7:
修改cacher在集群切换主控下的算法
........
合入齐飞给的定制，在低配置设备上，虚拟cpu信息（没错，就是欺骗领导）
........
reviewid : 17371
commited by : tyy,
review by : lrx
BUG   ID: [1389]
问题描述： bugid1389 无法替换磁盘；虚拟存储页面报脚本错误
问题分析： 
    引用文件路径错误；没有合入新代码
改动说明： 
    修改出错的地方
做了哪些测试： 
    无

........
noreview
1.vmlist的status.c解析时应该匹配换行符
2.OpLogClient.pm里serverip没有保存
3.挪动新建虚拟机时vs的检查代码，错误时要输出到操作日志
........
noreview
优化日志传递机制，减少日志写入数据量
已在SDDC版本验证，代码无差异
........
问题描述： 
	无法替换主机
BUG   ID: 暂无，到时候有就补上
问题原因： 
	代码漏合
改动思路： 
	合入代码
做了哪些测试： 
	将代码放到公司环境， vtpsh get测试通过
review id 17571, commited by gexy, reviewed by fxw
........
reviewid:  17588
Bug id: 1714
问题分析: 日志太多了
改动说明: 将之前加的调试日志移除。

自测：无。
........
reviewid:  17588
Bug id: 1714
问题分析: 日志太多了
改动说明: 将之前加的调试日志移除。

自测：无。
........
reviewid:  17617
Bug id: 1682
问题分析: vmp上批量编辑虚拟机是串行进行，应该改为并行，否则批量编辑时太耗时了
改动说明: 并发解决

自测：在aSV和VMP上替换代码测试过。
........
noreview
针对storage_check_online优化，做的单元测试及详细场景验证
发现若干问题，自测通过
........
4.6升级到4.8时 禁用掉write-cache
........
</msg>
</logentry>
<logentry
   revision="256858">
<author>fxw</author>
<date>2016-04-21T12:41:11.445916Z</date>
<msg>reviewid 17710
bugid 1999
说明：因为vdc agent升级过程中io太大，很多数据都缓存在写缓存中，升级完重启过程中qemu主线程会在一直刷缓存，异常重启误判将虚拟机强杀导致数据丢失
改动：主线程卡住的时候用/proc/pid/io来获取io统计，之前TD34863的修改没有完全解决问题故先删去
测试：
用gdb卡死qemu，会用到/proc/pid/io来判断。实际的bug等有环境实测</msg>
</logentry>
<logentry
   revision="256847">
<author>yangwei</author>
<date>2016-04-21T11:55:45.953909Z</date>
<msg>reviewid 17707
bugid 1627
reviewby hyq
说明：acenter无限期，连接状态，qemu显示序列号过期
分析：授权信息中，处于连接状态时，date和last_days同时为0表示永不过期，直接判断last_days有问题。
测试：永不过期acenter序列号，虚拟机开机ok</msg>
</logentry>
<logentry
   revision="256833">
<author>yangwei</author>
<date>2016-04-21T09:37:38.135189Z</date>
<msg>reviewid 17702
reviewby fxw
bugid 1627
说明：acenter断网后，授权剩余时间应该30天倒计时
分析：原来的流程请求连接acenter，如果acenter连接失败，返回的不是合法的json，程序直接die掉，未删除相应的标记。
eval数据解析，并删除相应的标记文件。
测试：断开acenter网络连接，vmp30天倒计时，测试ok。</msg>
</logentry>
<logentry
   revision="256774">
<author>fxw</author>
<date>2016-04-21T02:16:53.277733Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="256739">
<author>yangwei</author>
<date>2016-04-20T10:31:26.559067Z</date>
<msg>reviewid 17664
bugid null
reviewby hjg
说明 修改序列号标准版为8核16G，企业版限制也为8核
分析 修改需求
测试：
标准版新建8核16G虚拟机成功---ok
标准版修改虚拟机为9核失败---ok
标准版修改内存为17G失败---ok
企业版修改核数为9失败---ok
企业版32G序列号修改32Gok，修改33g失败---ok
企业版启动8核32G---ok</msg>
</logentry>
<logentry
   revision="256730">
<author>fxw</author>
<date>2016-04-20T09:16:44.869066Z</date>
<msg>noreview
增加修改后的错误信息</msg>
</logentry>
<logentry
   revision="256698">
<author>qifei</author>
<date>2016-04-20T03:30:16.437412Z</date>
<msg>revision 17645
grant字段为0，删除标记文件</msg>
</logentry>
<logentry
   revision="256669">
<author>lcy</author>
<date>2016-04-19T12:55:50.446637Z</date>
<msg>reviewid: 17634
review by fxw
Bug id: 1947
问题分析：TD1947，【批量修改集群通信口】UI显示不正常
问题出现的根源：
【新需求】VMP支持批量修改管理口IP和切换集群通信口，UI代码
改动说明：
样式冲突，修改一下样式。</msg>
</logentry>
<logentry
   revision="256633">
<author>yangwei</author>
<date>2016-04-19T08:40:10.218344Z</date>
<msg>reviewid: 17619
bugid: 1627
reviewed by: fxw
说明：【新功能】【acenter】acenter集中管理平台vmp授权
分析：1、修改authorize_client参数列表 2、修改authorize_client_notice文件命令行及调用脚本路径
3、修改vmpsn acenter标记
测试：
1、ps aux | grep auth结果为/sf/bin/authorize_client --notice_app /sf/bin/authorize_client_notice
2、标记文件分别为.vmp_acenter_flag和.vmp_acenter_conn_flag位于cfs下面</msg>
</logentry>
<logentry
   revision="256609">
<author>fxw</author>
<date>2016-04-19T04:53:17.602134Z</date>
<msg>noreview
加入新文件StaticRouter.pm</msg>
</logentry>
<logentry
   revision="256598">
<author>yangwei</author>
<date>2016-04-19T03:17:52.977594Z</date>
<msg>reviewid: 17612
bugid: 1627
reviewed by: fxw
说明：【新功能】【acenter】acenter集中管理平台vmp授权
分析：1、修改三方so路径错误 2、修改vtsn_tool 段错误 3、修改cgi路径
测试：连接acenter，vtsn_tool -i测试ok；
acenter授权ok</msg>
</logentry>
<logentry
   revision="256556">
<author>yangwei</author>
<date>2016-04-18T12:55:21.089930Z</date>
<msg>reviewid: 17599
bugid: 1627
reviewed by: fxw
说明：【新功能】【acenter】acenter集中管理平台vmp授权
分析：添加一个so文件
测试：无需测试，acenter功能文件上库</msg>
</logentry>
<logentry
   revision="256553">
<author>lcy</author>
<date>2016-04-18T12:40:51.683558Z</date>
<msg>reviewid: 17596
review by fxw
Bug id: null
问题分析：【新功能】VMP支持静态路由的配置
改动说明：
无
自测：
新功能，打包验证</msg>
</logentry>
<logentry
   revision="256541">
<author>fxw</author>
<date>2016-04-18T11:41:38.119484Z</date>
<msg>Merged revision(s) 256462 from VTP/VMP4.7/Trunk:
noreview 客户问题，读取io失败，合入社区修改
e012b78cf5bc42f20ef1a1f78383035f2293ceea
33f461e0c5d8efa21ef7e746be561fc57a1df106

........
</msg>
</logentry>
<logentry
   revision="256539">
<author>fxw</author>
<date>2016-04-18T11:39:23.681209Z</date>
<msg>noreview
删除老版本文档</msg>
</logentry>
<logentry
   revision="256522">
<author>lcy</author>
<date>2016-04-18T09:28:58.337860Z</date>
<msg>reviewid: 17587
review by fxw
Bug id: null
问题分析：【新需求】VMP支持批量修改管理口IP和切换集群通信口，UI代码
改动说明：
注释掉一些没有用的函数和变量
自测：
本地编译通过。</msg>
</logentry>
<logentry
   revision="256506">
<author>yangwei</author>
<date>2016-04-18T08:20:54.662622Z</date>
<msg>reviewid: 17581
bugid: 1627
reviewed by: fxw
说明：【新功能】【acenter】acenter集中管理平台vmp授权
分析：修改动态链接库为64位
测试：无需测试，acenter功能文件上库</msg>
</logentry>
<logentry
   revision="256491">
<author>lcy</author>
<date>2016-04-18T07:07:47.700315Z</date>
<msg>reviewid: 17577
review by fxw
Bug id: 1693
问题分析：TD1693，【老功能】为定时执行脚本为12get_node_sheet.pl增加一个文件锁
问题出现的根源：
异常情况下，get_node_sheet.pl没有锁文件，并且是定时执行脚本，一分钟执行一次，所以有可能会有多个
改动说明：
增加一个文件锁/tmp/get_node_sheet，超时时间为30s
自测：
代码语法正常，自测通过，脚本可以正常执行</msg>
</logentry>
<logentry
   revision="256486">
<author>lcy</author>
<date>2016-04-18T06:51:08.891936Z</date>
<msg>reviewid: 17308
review by jcy
Bug id: null
问题分析：【新需求】VMP支持批量修改管理口IP和切换集群通信口，UI代码
问题出现的根源：
【新需求】VMP支持批量修改管理口IP和切换集群通信口，UI代码
修改一个grid的大小，不影响功能。
改动说明：
无
自测：
新功能，打包验证</msg>
</logentry>
<logentry
   revision="256482">
<author>fxw</author>
<date>2016-04-18T06:39:28.005124Z</date>
<msg>noreview
加一条日志，删掉冗余代码</msg>
</logentry>
<logentry
   revision="256479">
<author>lcy</author>
<date>2016-04-18T06:20:31.209218Z</date>
<msg>reviewid: 17550
review by jcy
Bug id: null
问题分析：【新需求】VMP支持批量修改管理口IP和切换集群通信口，UI代码
问题出现的根源：
无
改动说明：
无
自测：
新功能，打包验证</msg>
</logentry>
<logentry
   revision="256471">
<author>yangwei</author>
<date>2016-04-18T04:30:25.836100Z</date>
<msg>reviewid: 17576
bugid: 1627
reviewed by: fxw
说明：【新功能】【acenter】acenter集中管理平台vmp授权
分析：添加cgi的apache配置文件和动态库文件
测试：无需测试，acenter功能文件上库</msg>
</logentry>
<logentry
   revision="256468">
<author>lcy</author>
<date>2016-04-18T03:23:14.757817Z</date>
<msg>reviewid: 17549
review by fxw
Bug id: null
问题分析：【新需求】VMP支持批量修改管理口IP和切换集群通信口，后台代码
问题出现的根源：
无
改动说明：
无
自测：
新功能，打包验证</msg>
</logentry>
<logentry
   revision="256290">
<author>yangwei</author>
<date>2016-04-15T07:02:28.343272Z</date>
<msg>reviewid: 17526
bugid: 1627
reviewed by: fxw
说明：【新功能】【acenter】acenter集中管理平台vmp授权
分析：
测试：无需测试，acenter功能文件上库</msg>
</logentry>
<logentry
   revision="256259">
<author>fxw</author>
<date>2016-04-15T03:27:40.021229Z</date>
<msg>noreview
添加PBL</msg>
</logentry>
<logentry
   revision="256212">
<author>fxw</author>
<date>2016-04-14T12:21:37.753797Z</date>
<msg>noreview
增加文档</msg>
</logentry>
<logentry
   revision="256210">
<author>fxw</author>
<date>2016-04-14T12:07:13.326208Z</date>
<msg>noreview
增加挂起的错误日志</msg>
</logentry>
<logentry
   revision="256209">
<author>fxw</author>
<date>2016-04-14T12:04:14.783898Z</date>
<msg>noreview
合入aCenter误删了接口的参数</msg>
</logentry>
<logentry
   revision="256206">
<author>fxw</author>
<date>2016-04-14T11:51:03.715855Z</date>
<msg>noreview
TD1595
合入aSV修改：64位WINDOWS下win32k.sys 0x50 Args:00000000000000008蓝屏。CPU BUG，加入更新CPU microcode 流程。</msg>
</logentry>
<logentry
   revision="256203">
<author>fxw</author>
<date>2016-04-14T11:29:35.419818Z</date>
<msg>BUG ID: 1592
Reviewed by: lifan
现象：
TD 35054，对vAF热迁移后再做ha，vAF虚拟机的镜像损坏。
问题原因分析：
1.sffs文件的元数据刷新机制有问题，新分配文件块后没有立即刷新元数据，如果此时存储断网，这部分新分配的文件块信息就会丢失。最后这部分又被重新分配和擦写后，就可能损坏qcow2元数据。
2.sffs文件系统的集群锁机制，在更新锁版本号这里存在逻辑上的错误，正常的设计是应该在加锁时更新版本号，但是我们的集群锁却是在解锁时更新，当主机A的存储断网时，不会走解锁流程，导致集群锁版本号没有更新，虚拟机被ha到主机B后，sffs会继续使用其旧的元数据缓存，就会导致sffs文件错乱。
改动说明：
1.sffs新分配文件块后立即刷写元数据。
2.修改sffs文件系统的集群锁机制，改为在加写锁的时候更新版本号。
测试：
上库测试</msg>
</logentry>
<logentry
   revision="256174">
<author>fxw</author>
<date>2016-04-14T08:03:53.905693Z</date>
<msg>noreview
增加部署的错误日志</msg>
</logentry>
<logentry
   revision="256157">
<author>fxw</author>
<date>2016-04-14T07:03:36.336373Z</date>
<msg>noreview
libevent库有冗余文件，md5值都一样，删掉不需要的
2e3850bad353e0e35f60527f98dd69a4  libevent-2.0.so.5
2e3850bad353e0e35f60527f98dd69a4  libevent-2.0.so.5.1.9
2e3850bad353e0e35f60527f98dd69a4  libevent2.so
07ccd2e7fe2a5469af0d8d494b09e702  libevent_core-2.0.so.5
07ccd2e7fe2a5469af0d8d494b09e702  libevent_core-2.0.so.5.1.9
07ccd2e7fe2a5469af0d8d494b09e702  libevent_core.so
54e1af0ee7d9d0f562700dc3eedcab75  libevent_extra-2.0.so.5
54e1af0ee7d9d0f562700dc3eedcab75  libevent_extra-2.0.so.5.1.9
54e1af0ee7d9d0f562700dc3eedcab75  libevent_extra.so
7e6b218bde3c2ecdd8b29541e227f758  libevent_openssl-2.0.so.5
7e6b218bde3c2ecdd8b29541e227f758  libevent_openssl-2.0.so.5.1.9
7e6b218bde3c2ecdd8b29541e227f758  libevent_openssl.so
03ca9643b65a4064a477a4abb6c93e30  libevent_pthreads-2.0.so.5
03ca9643b65a4064a477a4abb6c93e30  libevent_pthreads-2.0.so.5.1.9
03ca9643b65a4064a477a4abb6c93e30  libevent_pthreads.so</msg>
</logentry>
<logentry
   revision="256154">
<author>fxw</author>
<date>2016-04-14T06:57:00.170850Z</date>
<msg>noreview
打包脚本调用depmod的参数不正确</msg>
</logentry>
<logentry
   revision="256092">
<author>qifei</author>
<date>2016-04-14T02:09:36.141300Z</date>
<msg>revision 17478
TD 1539 定时检查脚本，维持vmp与acenter之间的隧道连接。</msg>
</logentry>
<logentry
   revision="256038">
<author>qifei</author>
<date>2016-04-13T10:51:02.793318Z</date>
<msg>revision 17449
修改makefile添加Acentermanage.pm
</msg>
</logentry>
<logentry
   revision="255940">
<author>qifei</author>
<date>2016-04-13T06:33:36.092054Z</date>
<msg>合入acenter的定制
revision 27398</msg>
</logentry>
<logentry
   revision="255823">
<author>fxw</author>
<date>2016-04-12T08:37:25.988576Z</date>
<msg>noreview
完成关机、重置电源错误日志整理</msg>
</logentry>
<logentry
   revision="255804">
<author>fxw</author>
<date>2016-04-12T07:30:48.391735Z</date>
<msg>noreview
完成开机错误日志整理</msg>
</logentry>
<logentry
   revision="255658">
<author>fxw</author>
<date>2016-04-11T08:44:52.123287Z</date>
<msg>noreview
TD1355</msg>
</logentry>
<logentry
   revision="255605">
<author>fxw</author>
<date>2016-04-11T02:30:28.948994Z</date>
<msg>noreview
整理VMP错误日志</msg>
</logentry>
<logentry
   revision="255461">
<author>fxw</author>
<date>2016-04-09T09:56:21.630687Z</date>
<msg>noreview 版本号不对，少了B</msg>
</logentry>
<logentry
   revision="255460">
<author>fxw</author>
<date>2016-04-09T09:53:59.790641Z</date>
<msg>noreview 版本号不对，少了B</msg>
</logentry>
<logentry
   revision="255442">
<author>lsh</author>
<date>2016-04-09T06:35:28.485489Z</date>
<msg>noreview: 
- 修改派生虚拟机个人盘允许编辑大小
- 合入asv的线上调试功能</msg>
</logentry>
<logentry
   revision="255441">
<author>lsh</author>
<date>2016-04-09T06:34:59.328872Z</date>
<msg>noreview: 
- 修改派生虚拟机个人盘允许编辑大小
- 合入asv的线上调试功能</msg>
</logentry>
<logentry
   revision="255366">
<author>lcy</author>
<date>2016-04-08T09:46:36.416190Z</date>
<msg>reviewid: 17228
review by fxw
Bug id: 1330
问题分析：TD1330，【后台】替换VMP后台的vim
问题出现的根源：
无
改动说明：
无
自测：
无</msg>
</logentry>
<logentry
   revision="255358">
<author>fxw</author>
<date>2016-04-08T08:55:19.187513Z</date>
<msg>noreview
合入VMP4.8R2 气泡内存修改和支持win10</msg>
</logentry>
<logentry
   revision="255329">
<author>fxw</author>
<date>2016-04-08T06:42:34.111169Z</date>
<msg>noreview 回滚针对富士康定制的sysprep修改 </msg>
</logentry>
<logentry
   revision="255305">
<author>hyq</author>
<date>2016-04-08T03:42:08.372850Z</date>
<msg>reviewid : 17208
bug id : 1312
问题描述 : 派生虚拟机个人盘支持扩容
改动说明 : 后台放开，磁盘有backing_file 才抛出异常
测试场景 : 页面编辑虚拟机个人盘大小成功并修改了配置，后台用qemu-img info vm-disk-2.qcow2发现磁盘虚拟大小被修改了</msg>
</logentry>
<logentry
   revision="255280">
<author>fxw</author>
<date>2016-04-08T02:18:47.184056Z</date>
<msg>修改版本号</msg>
</logentry>
<logentry
   revision="255278">
<author>fxw</author>
<date>2016-04-08T01:49:36.706346Z</date>
<msg>目录移动后log没了，重新从4.8R1 copy一次</msg>
</logentry>
<logentry
   revision="255244">
<author>gwl</author>
<date>2016-04-07T14:41:37.379897Z</date>
<msg>bugid：1188
添加主机失败</msg>
</logentry>
<logentry
   revision="255243">
<author>gwl</author>
<date>2016-04-07T14:26:56.725805Z</date>
<msg>bugid：1188
添加主机失败</msg>
</logentry>
<logentry
   revision="255242">
<author>gwl</author>
<date>2016-04-07T14:26:33.189910Z</date>
<msg>bugid：1188
添加主机失败</msg>
</logentry>
<logentry
   revision="255216">
<author>vs</author>
<date>2016-04-07T12:22:50.214616Z</date>
<msg>问题描述： 
	放开VS在VS网络异常的时候，对新建，删除虚拟机等的限制
BUG   ID: null
问题原因： 
	在VS网络异常时，原来做的规避手段
改动思路： 
	放开限制
做了哪些测试： 
	描述做完改动后，做了哪些测试验证
review id 17176, commited by wzl, reviewed by lzj</msg>
</logentry>
<logentry
   revision="255147">
<author>lcy</author>
<date>2016-04-07T07:01:21.109585Z</date>
<msg>reviewid: 17150
review by: gwl
Bug id：1282
问题分析：
run_command的ignore_exit_code有问题，没有正确获取退出码的值
改动说明：
my ( $exit_code ) = @_;需要加上括号
自测：
自测通过</msg>
</logentry>
<logentry
   revision="255123">
<author>gwl</author>
<date>2016-04-07T02:33:02.654372Z</date>
<msg>noreview
更新vs</msg>
</logentry>
<logentry
   revision="255116">
<author>gwl</author>
<date>2016-04-07T02:16:23.340505Z</date>
<msg>Merged revision(s) 254509 from VTP/VMP4.7/Trunk:
reviewid : 16994
bugid : null
问题描述 : 更新vdc镜像
........
</msg>
</logentry>
<logentry
   revision="254858">
<author>vs</author>
<date>2016-04-05T06:50:43.750439Z</date>
<msg>问题描述： 
	添加新的主机后，无法添加磁盘到虚拟存储中
BUG   ID: 1189
问题原因： 
	页面代码合入，后台没有合入
改动思路： 
	合入后台代码
做了哪些测试： 
	测试初始化流程， 检测完成后可以下一步
review id 17071, commited by gexy, reviewed by lzj</msg>
</logentry>
<logentry
   revision="254739">
<author>gwl</author>
<date>2016-04-01T09:07:27.532495Z</date>
<msg>noreview
更新vs</msg>
</logentry>
<logentry
   revision="254685">
<author>gwl</author>
<date>2016-04-01T00:55:32.144338Z</date>
<msg>noreview
更新vs</msg>
</logentry>
<logentry
   revision="254664">
<author>vs</author>
<date>2016-03-31T13:01:40.426008Z</date>
<msg>问题描述： add by yinxin
    【功能异常】【重要】vs初始化代码，有卡住风险
BUG   ID:680
问题原因： 
    原有逻辑只判断状态为TASK_SUCCESS和TASK_ABORT时任务是完成（失败）的，但是实际很多场景这个任务可能一直是TASK_FAIL状态，导致死循环
改动思路： 
    加入超时逻辑，使用机制保证在异常场景下不会死循环
做了哪些测试： 
    1.模拟一直返回TASK_FAILE的场景，会超时报错退出
    2.正常场景可以正常初始化</msg>
</logentry>
<logentry
   revision="254663">
<author>vs</author>
<date>2016-03-31T12:59:55.673075Z</date>
<msg>问题描述： 
	替换主机新流程合入到4.8R1版本
	
BUG   ID: 无
问题原因： 
	描述造成问题的的根源是什么
改动思路： 
	描述解决这个问题的修改思路
做了哪些测试： 
	node 编译通过
        初始化测试成功
review id 17024, commited by gexy, reviewed by wugeng, lzj</msg>
</logentry>
<logentry
   revision="254619">
<author>vs</author>
<date>2016-03-31T06:56:13.083507Z</date>
<msg>问题描述： by vs  yinxin
	【功能异常】【adesk】VMP版本的vs_check_network_same_segment.sh脚本代码不是最新，私网冲突没有校验
BUG   ID: 1025
问题原因： 
	功能没合入
改动思路： 
	由于之前的串行检测方式在大集群环境很容易超时，因此将ip地址冲突检测和ip网段冲突检测都放到并行接口中执行
做了哪些测试： 
	1.配置有网段冲突的ip，页面会报错
	2.配置没有网段冲突的ip，可以配置成功
	3.配置地址冲突的ip,页面会报错
	4.配置没有地址冲突的ip,可以配置成功
	5.由于没有大集群环境，未测试执行时间</msg>
</logentry>
<logentry
   revision="254559">
<author>gwl</author>
<date>2016-03-30T11:54:49.401764Z</date>
<msg>noreview
更新vs</msg>
</logentry>
<logentry
   revision="254556">
<author>gwl</author>
<date>2016-03-30T11:25:33.919093Z</date>
<msg>noreview
更新vs</msg>
</logentry>
<logentry
   revision="254515">
<author>gwl</author>
<date>2016-03-30T07:37:04.777989Z</date>
<msg>回滚
Revision: 252814
Author: wtd
Date: 2016年3月12日 17:05:12
Message:
reviewid: 16434 
Bug id: 35108
问题分析:
一些无关紧要的风格类问题集合
改动说明:
对回调脚本加了日志，主要是打印时间

自测：无
----
Modified : /VTP/aSV4.6/VMP4.7/build/pkg/replace-root/sf/bin/03restart.pl
Modified : /VTP/aSV4.6/VMP4.7/build/pkg/replace-root/sf/etc/hook.d/kvm/start.d/01update_tpl.sh
Modified : /VTP/aSV4.6/VMP4.7/build/pkg/replace-root/sf/etc/hook.d/kvm/start.d/02serial_proxy.sh
Modified : /VTP/aSV4.6/VMP4.7/build/pkg/replace-root/sf/etc/hook.d/kvm/start.d/03restart.sh
Modified : /VTP/aSV4.6/VMP4.7/build/pkg/replace-root/sf/etc/hook.d/kvm/start.d/04md5_check.sh

</msg>
</logentry>
<logentry
   revision="254513">
<author>gwl</author>
<date>2016-03-30T07:32:24.801501Z</date>
<msg>noreview
去掉冗余日志</msg>
</logentry>
<logentry
   revision="254479">
<author>gwl</author>
<date>2016-03-30T03:15:07.091604Z</date>
<msg>noreview
打包时，环境初始化太烦了，改一下</msg>
</logentry>
<logentry
   revision="254478">
<author>gwl</author>
<date>2016-03-30T03:14:04.670063Z</date>
<msg>noreview
打包时，环境初始化太烦了，改一下</msg>
</logentry>
<logentry
   revision="254476">
<author>gwl</author>
<date>2016-03-30T03:10:29.038014Z</date>
<msg>noreview
加执行权限</msg>
</logentry>
<logentry
   revision="254470">
<author>gwl</author>
<date>2016-03-30T02:50:54.819056Z</date>
<msg>noreview
打包时，环境初始化太烦了，改一下</msg>
</logentry>
<logentry
   revision="254468">
<author>gwl</author>
<date>2016-03-30T02:43:55.610762Z</date>
<msg>Merged revision(s) 254341-254464 from VTP/VMP4.7/Trunk:
reviewid : 16950
bug id : null
问题描述 : 升级后在/cfs/目录创建文件vdi_conf.ini并写入文本
改动说明 : 升级后在/cfs/目录创建文件vdi_conf.ini并写入文本
测试 : 执行脚本没问题，需要打包升级验证
........
noreview
更新spice库
........
noreview
调试脚本没有设置可执行属性，VMPDebug.pm没有加入Makefile
........
noreview
更新spice库
........
1.merge from VMP4.8
2.在合入到SDDC时，对比代码，发现若干可以修改的地方
........
merge from VMP4.8
........
merge from VMP4.8
........
reviewid : 16980
bug id : null
描述信息 : 更新vdc镜像
........
</msg>
</logentry>
<logentry
   revision="254458">
<author>gwl</author>
<date>2016-03-30T01:56:32.053120Z</date>
<msg>merge from VMP4.8</msg>
</logentry>
<logentry
   revision="254454">
<author>gwl</author>
<date>2016-03-30T01:36:05.091822Z</date>
<msg>merge from VMP4.8</msg>
</logentry>
<logentry
   revision="254448">
<author>gwl</author>
<date>2016-03-30T01:15:08.962272Z</date>
<msg>1.merge from VMP4.8
2.在合入到SDDC时，对比代码，发现若干可以修改的地方</msg>
</logentry>
<logentry
   revision="254042">
<author>gwl</author>
<date>2016-03-25T06:36:11.802297Z</date>
<msg>问题描述： 
        【功能异常】【adesk】[48大集群]多台主机添加到vs时，提示虚拟存储网络配置失败（非必现）[确认]
BUG   ID: 684
问题原因： 
        ip冲突检测串行执行，过于耗时，48台需要3min左右
改动思路： 
        并发执行
做了哪些测试： 
        1，大集群待验证时间。
    2，设置冲突ip,正常告警提示
review id 16864, commited by ljf, reviewed by gwl</msg>
</logentry>
<logentry
   revision="254002">
<author>gwl</author>
<date>2016-03-25T02:03:08.046013Z</date>
<msg>merge from VMP4.8</msg>
</logentry>
<logentry
   revision="253931">
<author>gwl</author>
<date>2016-03-24T08:55:03.690664Z</date>
<msg>noreview
修改两个问题：
①启动虚拟机选择节点时，如果有主机不能访问存储，将会导致die，以前的逻辑不会，改动引发的

②合入到SDDC时，对比代码发现一些有价值的改动，合入到VMP，体验性的，毫不影响功能</msg>
</logentry>
<logentry
   revision="253889">
<author>gwl</author>
<date>2016-03-24T02:49:41.113250Z</date>
<msg>Merged revision(s) 252711, 252753-252754, 252778, 252795, 252886, 252921, 252997-252998, 253018, 253099, 253108, 253110, 253176, 253230, 253756, 253764, 253766 from VTP/VMP4.7/Trunk:
reviewid: 16481
bug id : 35052
问题描述 : td35052:【邮件告警】授权还剩30天的时候可以通过邮件告警
改动说明 : 添加一个序列号剩余使用天数告警，并发送到配置邮箱
测试场景 : 通过修改触发告警时间间隔测试通过
........
reviewid : 16487
bug id :35052
问题描述: 剩余天数告警不单独作为一个告警项
改动说明:剩余条数告警和序列号过期告警合并
测试:通过修改告警间隔时间测试通过，在页面显示告警项，并能够收到邮件
........
noreview:
1、新增主机后，增加集群ip的配置
2、告警项增加序列号过期提醒
........
noreview
TD34925 SSL换了方案不需要修改，回滚并加上日志，如果以后又碰到方便排查
........
reviewid: 16509
review by fxw
Bug id: 35120
问题分析：TD35120，【模板更新】模板更新检测到磁盘存在leak泄露的话，会报错磁盘文件损坏的错误
问题出现的根源：
qemu-img check xx.qcow2的时候，假如发现镜像leak的话，会返回错误码为3，这个错误值可以忽略掉的。
改动说明：
直接在check_img_exist忽略错误值为3的返回值。
自测：
通过构造脚本，测试run_command处理返回值为3的情况，可以成功捕获到3的返回值不处理剩下的my_die的错误。
版本：
4.8.00_B
build 2016-02-26 16:41:12
自测通过。
........
【no review】1.TD40229 右键菜单颜色错误问题增加备注
2.TD41212 客户端协商给服务端缓存大小为0时导致虚拟机崩溃bug修改，spice服务端如果接受到缓存大小为0就使用默认的100M
3.TD39603 修改桌面壁纸模糊问题，explorer且带有alpha标记，在qxl驱动中会打上no lossy标记，走无损压缩
........
noreview
解决因 246618改动引发的摄像头无法使用的bug，是因为USBEndPoint结构体变了，需要重新编译libredirect2.so
........
[no review]从svn://200.200.0.40/ssl/dev/Trunk/Personal-Directory/VDI4.8/spice-0.12.5合入
（1）
Revision: 37745
Author: hhp
Date: 2016年3月15日 11:46:39
Message:
【代码审查】增加命令树内存统计时判空处理，src_bitmap如果为空就不统计
----
Modified : /Trunk/Personal-Directory/VDI4.8/spice-0.12.5/server/red_worker.c

Revision: 37738
Author: hhp
Date: 2016年3月15日 11:06:51
Message:
【代码审查】增加命令树内存统计时判空处理，和draw_copy中对bitmap处理保持一致
----
Modified : /Trunk/Personal-Directory/VDI4.8/spice-0.12.5/server/red_worker.c


（2）
TD[41297]增加服务端使用配置文件方式开关协议优化及命令打包功能，配置文件路径："/cfs/vdi_conf.ini"，没有这个文件，默认开启功能。
配置内容如下：
[opt]
srap=1
pack=1
可看到这样的日志： 
reds.c:2328:rvl_get_config: srap_opt = 0, pack_opt = 0 
red_worker.c:17188:handle_new_display_channel: srap_opt enabled 
red_channel.c:1002:red_channel_client_create: channel type = 2, pack.enable = 1 

从日志可见是否开启对应功能，验证与配置文件配置是否相符
........
noreview
VDI配置文件
SSLTD[41297]增加服务端使用配置文件方式开关协议优化及命令打包功能，配置文件路径："/cfs/vdi_conf.ini"，没有这个文件，默认开启功能。
有疑问咨询SSL陈楚明、侯海鹏
........
noreview
spice代码更新，对应更新spice库
........
noreview:
加大提示窗口宽度，规避字母被截断的问题
........
noreview
上库ssl的修改，修改以下bug
【TD41052】广域网映射慢
【TD41225】对FAT32分区表先进行压缩再发送到服务端，服务端对其解压在保留在缓存中
........
noreview
上库ssl的修改，修改以下bug
【TD41052】广域网映射慢
【TD41225】对FAT32分区表先进行压缩再发送到服务端，服务端对其解压在保留在缓存中
........
noreview
上库ssl的修改，修改以下bug
【TD41052】广域网映射慢
【TD41225】对FAT32分区表先进行压缩再发送到服务端，服务端对其解压在保留在缓存中
........
reviewid : 16639
bug id : 35131
问题描述 : td35131:主机掉线，vs存储上还原模式虚拟机开机失败
改动说明 :vs存储存在主机掉线的情况下不支持mv操作, mv 操作会失败，如果失败使用cp重试一次
测试场景 : 使用虚拟环境测试，双主机双副本，一台主机未开机，启动虚拟机能够成功,原来会失败
........
reviewid: 16777
review by: zq, lifan
Bug id：35139
问题分析：
给qemu加个文件锁，防止perl判断有问题导致多个qemu实例被启动

改动说明：
在镜像目录下面加个文件锁，对于共享存储的sffs和vs是集群锁。

自测：
在一个主机上启动虚拟机，再到另一个主机上后台执行qemu启动命令，启动失败，查看日志是open文件锁失败
........
reviewid: 16782
review by: fxw
Bug id：35135
问题分析：
合入SDDC处理qemu-img返回泄漏的误判

改动说明：
如果只是检查到镜像leak，不认为是损坏

自测：
无
........
noreview
变量名称不对
........
</msg>
</logentry>
<logentry
   revision="253860">
<author>gwl</author>
<date>2016-03-23T11:20:22.249106Z</date>
<msg>noreview
更新vs</msg>
</logentry>
<logentry
   revision="253859">
<author>gwl</author>
<date>2016-03-23T11:12:42.410050Z</date>
<msg>noreview
bugid: 35150
问题分析：
HAconfig中的bug，分数2次计算时，总是会得到-1000
改动说明:
修改逻辑错误
自测说明：
自测通过，打包再验证</msg>
</logentry>
<logentry
   revision="253774">
<author>gwl</author>
<date>2016-03-22T15:22:49.914763Z</date>
<msg>noreview
bugid: 35142
问题分析：
龚炜林 &lt;gwl&gt;, 2016/3/22:  

1.恢复虚拟机失败------恢复虚拟机时，由于对启动虚拟机的优化，设定了starting状态，在恢复时又检查了状态，导致恢复判断虚拟机不是suspend
  大多数恢复成功，说明其恢复操作过快，尚未感知到虚拟机状态变化。

2.日志回光返照---------在关闭电源时，调用了fork_work，会写日志的。而open redis时出现错误，导致一开始的时候，关闭电源出现失败日志
但是并未阻止fork_worker执行关闭电源的代码，从而引起虚拟机正常关闭之后，又改写了日志。logid都一样，就覆盖了之前的失败日志。

vtprgm在集群升级重启时，拉起异常虚拟机无限制，导致一下并发启动1000个
资源竞争，很容易失败，且有一定几率导致主机内存不足而挂掉。
改动说明：

1.增加判断虚拟机正在starting，则不用判断suspend
2.vtprgm里增加排队机制

自测说明：
自测通过，打包再验证</msg>
</logentry>
<logentry
   revision="253630">
<author>gwl</author>
<date>2016-03-21T13:17:49.010444Z</date>
<msg>noreview

登陆时不判断vs是否准备好，否则可能vs一旦异常，则不能登陆前台
导致客户其它急救操作也干不了</msg>
</logentry>
<logentry
   revision="253598">
<author>wtd</author>
<date>2016-03-21T09:47:10.591726Z</date>
<msg>reviewid:  
Bug id: 
问题分析:
序列号获取VM个数修改
改动说明:
修改为从配置读取

自测：在229上测试过</msg>
</logentry>
<logentry
   revision="253534">
<author>gwl</author>
<date>2016-03-21T01:10:44.684136Z</date>
<msg>noreview
更新vs
</msg>
</logentry>
<logentry
   revision="253523">
<author>wtd</author>
<date>2016-03-20T08:56:25.542372Z</date>
<msg>reviewid:  
Bug id: 
问题分析:
PXE安装
改动说明:
安装脚本支持网络安装

自测：先上库好打包测试，一次应该搞不定</msg>
</logentry>
<logentry
   revision="253518">
<author>wtd</author>
<date>2016-03-20T07:54:51.231368Z</date>
<msg>reviewid:  
Bug id: 
问题分析:
PXE安装
改动说明:
安装脚本支持网络安装

自测：先上库好打包测试，一次应该搞不定</msg>
</logentry>
<logentry
   revision="253517">
<author>gwl</author>
<date>2016-03-20T07:18:45.197873Z</date>
<msg>noreview

修改部分优化：
1.获取spice端口的时候，获取虚拟机状态太杂了
改为新的接口，单元测试通过，vdi接入测试通过
</msg>
</logentry>
<logentry
   revision="253515">
<author>wtd</author>
<date>2016-03-20T07:04:52.388414Z</date>
<msg>reviewid:  
Bug id: 
问题分析:
PXE安装
改动说明:
安装脚本支持网络安装

自测：先上库好打包测试，一次应该搞不定</msg>
</logentry>
<logentry
   revision="253514">
<author>wtd</author>
<date>2016-03-20T06:35:33.509037Z</date>
<msg>reviewid:  
Bug id: 
问题分析:
PXE安装
改动说明:
安装脚本支持网络安装

自测：先上库好打包测试，一次应该搞不定</msg>
</logentry>
<logentry
   revision="253513">
<author>gwl</author>
<date>2016-03-20T04:51:00.570729Z</date>
<msg>noreview
上库调试工具</msg>
</logentry>
<logentry
   revision="253512">
<author>gwl</author>
<date>2016-03-20T04:49:28.359703Z</date>
<msg>noreview
上库调试工具</msg>
</logentry>
<logentry
   revision="253509">
<author>wtd</author>
<date>2016-03-20T04:23:27.201161Z</date>
<msg>reviewid:  
Bug id: 
问题分析:
PXE安装
改动说明:
安装脚本支持网络安装

自测：先上库好打包测试，一次应该搞不定</msg>
</logentry>
<logentry
   revision="253420">
<author>lcy</author>
<date>2016-03-18T11:08:48.313568Z</date>
<msg>reviewid: 16646
review by gwl
Bug id: 35130
修改三个问题：

修改一下写到redis选择的节点，假如主控在线，先选主控，否则选择IP最小的节点。
检测当前写进去的节点是否是主控，如果不是，就关闭连接，重新连。
每次读数据或者写数据的时候，失败了记录一下，当前进程再次读写的时候，重新连接一下redis
主控离线，会造成自动切换主控卡主，因为log传递到主控的时候会卡主。
解决办法，假如发现主控离线，选择127.0.0.1。下次写log的时候，假如发现往127.0.0.1写，关闭连接，重新连接。

自测：
版本：
4.8.02
build 2016-03-16 16:34:11
自测通过。</msg>
</logentry>
<logentry
   revision="253392">
<author>wtd</author>
<date>2016-03-18T08:05:32.389164Z</date>
<msg>reviewid:  
Bug id: 
问题分析:
PXE安装
改动说明:
安装脚本支持网络安装

自测：先上库好打包测试，一次应该搞不定</msg>
</logentry>
<logentry
   revision="253360">
<author>gwl</author>
<date>2016-03-18T03:39:49.977864Z</date>
<msg>review id : 16665
bug id : 35132
问题描述 : 未找到运行节点时，会直接die，没有clean vm flag
导致后边的很多虚拟机预判正在启动的虚拟机时，多计算了很多虚拟机，
从而很多启动失败
改动说明 : 修改为clean vm flag，并且加入重试机制2s一次，重试10次
经过验证，在集群压力90%内存占用时，重试3次，启动300vm，保持并发13个，会发现有20几个
重试操作，最终有2个vm重试失败。因此加入10次重试，可保证基本重试成功
且20s也在可接受范围内（集群压力很大的情况下会重试失败）
测试场景 : 
vdc批量启动800 vm，无失败
vmp启动300台，失败2台</msg>
</logentry>
<logentry
   revision="253357">
<author>lcy</author>
<date>2016-03-18T03:26:28.923744Z</date>
<msg>reviewid: 16646
review by wtd
Bug id: 35130
问题分析：TD35130,【VMP】【aSV】修改系统时间可能导致redis缓存的API信息很长时间不更新
问题出现的根源：
修改系统时间之后，redis缓存中的expire的值可能一直比当前时间大，需要很久才会更新
修改方法：
多加一个last字段，记录当前写入缓存的时间，expire记录超时的时间间隔。
读取缓存的时候，假如当前时间-last 大于等于0 并且小于等于expire记录的时间间隔，就认为缓存有效
否则，就认为缓存无效，需要更新时间。
修改时间只有以下两种场景：
把当前时间改小，读取缓存的时候，认为是超时
把当前时间改很大，读取缓存的时候，不超过时间间隔就有效，否是无效认为超时
自测：
版本：
4.8.02
build 2016-03-16 16:34:11
自测通过。</msg>
</logentry>
<logentry
   revision="253348">
<author>gwl</author>
<date>2016-03-18T02:49:57.070673Z</date>
<msg>noreview

更新vs代码</msg>
</logentry>
<logentry
   revision="253312">
<author>hyq</author>
<date>2016-03-17T13:35:21.316449Z</date>
<msg>review id : 16652
bug id : 35121
问题描述 : 【VMP】【aSV】升级后(登陆时)需要添加判断集群vs是否稳定
改动说明 : 创建ticket时加判断
测试场景 : 调试代码通过</msg>
</logentry>
<logentry
   revision="253304">
<author>zjy</author>
<date>2016-03-17T12:46:16.826614Z</date>
<msg>noreview
说明：将wtd上库更新到/sf/bin/func-clog.sh改动合并到该文件。</msg>
</logentry>
<logentry
   revision="253303">
<author>zjy</author>
<date>2016-03-17T12:45:02.519640Z</date>
<msg>noreview
说明：app/clogger 编译时会自动将func-clog.sh安装到该目录下。</msg>
</logentry>
<logentry
   revision="253289">
<author>zjy</author>
<date>2016-03-17T11:47:58.887040Z</date>
<msg>noreview
说明：删除原用于备份的func-clog.sh与func-common.sh文件。</msg>
</logentry>
<logentry
   revision="253288">
<author>zjy</author>
<date>2016-03-17T11:46:31.435417Z</date>
<msg>noreview
说明：将wtd上库到/sf/bin目录下移到该目录下。</msg>
</logentry>
<logentry
   revision="253280">
<author>hyq</author>
<date>2016-03-17T11:04:07.521799Z</date>
<msg>reviewid : 16602
bug id : 35092
问题描述 : 修改掉系统中影响批量操作的vtpsh
改动说明 : 修改掉系统中影响批量操作的vtpsh
测试场景 : 
模板虚拟机和派生虚拟机开机状态下更新。
删除虚拟机分组。
虚拟机迁移。</msg>
</logentry>
<logentry
   revision="253276">
<author>gwl</author>
<date>2016-03-17T10:44:52.603972Z</date>
<msg>noreview
导入导出vma的函数调用的参数错误了</msg>
</logentry>
<logentry
   revision="253275">
<author>zjy</author>
<date>2016-03-17T10:20:06.259808Z</date>
<msg>noreview
说明：将wtd上库到/sf/bin目录下移到/usr/bin目录。</msg>
</logentry>
<logentry
   revision="253274">
<author>zjy</author>
<date>2016-03-17T10:17:20.555399Z</date>
<msg>noreview
说明：备份原文件。</msg>
</logentry>
<logentry
   revision="253272">
<author>zjy</author>
<date>2016-03-17T10:07:12.243762Z</date>
<msg>noreview
说明：备份原文件。</msg>
</logentry>
<logentry
   revision="253164">
<author>zjy</author>
<date>2016-03-16T12:44:17.877455Z</date>
<msg>reviewid : 16518
bug id : 34772
问题描述：
集群升级时 就算存在节点没有参与升级，也检测为升级成功；原因是采用检测大版本号，还应检查升级包具体日期。目前采用大版本号和打包时间作为升级包版本信息检查。
改动说明：
1、修正获取主版本失败问题。
测试：
做过单元测试，需要打包验证。</msg>
</logentry>
<logentry
   revision="253123">
<author>zjy</author>
<date>2016-03-16T08:29:42.910589Z</date>
<msg>reviewid : 16518
bug id : 34772
问题描述：
集群升级时 就算存在节点没有参与升级，也检测为升级成功；原因是采用检测大版本号，还应检查升级包具体日期。目前采用大版本号和打包时间作为升级包版本信息检查。
改动说明：
1、升级包增加导出版本打包信息，由大版本号和打包时间组成；
2、升级时查询到的版本信息 也是 由大版本号和打包时间组成;
3、uapi.up文件get_status方法将返回版本号改为打包版本信息。
测试：
做过单元测试，需要打包验证。</msg>
</logentry>
<logentry
   revision="253119">
<author>lcy</author>
<date>2016-03-16T08:21:30.538217Z</date>
<msg>reviewid: 16601
review by gwl
Bug id: 34982
问题分析：TD34982，【vs】【3.14重现】修改时间，重启服务导致前台日志卡主
问题出现的根源：
设置系统时间的时候，会串行执行几个脚本，主机数量一多，API执行的时间就长很多了。
修改方法：
把单个脚本的执行改为并行，通过upid查询脚本执行的状态。
自测：
版本：
4.8.02
build 2016-03-14 22:39:41
自测通过。</msg>
</logentry>
<logentry
   revision="253079">
<author>gwl</author>
<date>2016-03-16T02:51:20.086193Z</date>
<msg>reviewid: 16524
Bug id: 35029
问题分析：【VMP】【aSV】获取交换机列表和存储列表比较卡顿
问题出现的根源：
因为load_config太慢了，优化一下获取交换机信息的来源，把交换机信息存在vmlist里面

改动说明:先修改pmxcfs，再修改perl
这里顺便改了一个bug：pmxcfs从config.db读取的conf文件，里面有快照信息，会导致extend_data包含了快照的配置，
如果快照有字段xxx，而虚拟机实际配置没有xxx字段，那么就会导致解析生成.vmlist时，获取的是快照的xxx字段的值，会让人纠结的。

自测通过。</msg>
</logentry>
<logentry
   revision="253055">
<author>gwl</author>
<date>2016-03-15T13:03:35.274771Z</date>
<msg>Author: wtd
Date: 2016年3月15日 19:09:35
Message:
reviewid: 16572 
Bug id: 34570
问题分析:
迁移是按任务单步排队的
改动说明:
排队按集群数的一半进行排，不fork上层进程，到for循环里再fork。
顺便改了一个BUG，vtpdaemon里面不回收子进程的问题。

自测：在229测试，700台修改耗时4分半，之前耗时8个小时。
----

回滚APIDaemon的修改，会导致apache异常

</msg>
</logentry>
<logentry
   revision="253047">
<author>wtd</author>
<date>2016-03-15T12:45:36.496945Z</date>
<msg>reviewid: 16572 
Bug id: 34570
问题分析:
迁移是按任务单步排队的
改动说明:
排队按集群数的一半进行排，不fork上层进程，到for循环里再fork。
顺便改了一个BUG，vtpdaemon里面不回收子进程的问题。

自测：在229测试，700台修改耗时4分半，之前耗时8个小时。</msg>
</logentry>
<logentry
   revision="253028">
<author>wtd</author>
<date>2016-03-15T11:09:35.889521Z</date>
<msg>reviewid: 16572 
Bug id: 34570
问题分析:
迁移是按任务单步排队的
改动说明:
排队按集群数的一半进行排，不fork上层进程，到for循环里再fork。
顺便改了一个BUG，vtpdaemon里面不回收子进程的问题。

自测：在229测试，700台修改耗时4分半，之前耗时8个小时。</msg>
</logentry>
<logentry
   revision="252982">
<author>gwl</author>
<date>2016-03-15T03:35:59.470489Z</date>
<msg>noreview
HAConfig.pm函数名称没改过来，启动虚拟机失败</msg>
</logentry>
<logentry
   revision="252978">
<author>lcy</author>
<date>2016-03-15T03:20:51.178122Z</date>
<msg>reviewid: 16557
review by gwl
Bug id: 35029
问题分析：TD35029,【VMP】【aSV】获取交换机列表和存储列表比较卡顿
问题出现的根源：
获取存储列表的时候，一体机的判断比较耗时，把一体机的信息存在缓存里，超时时间为3600秒
自测：
版本：
4.8.02
build 2016-03-14 22:39:41
自测通过。</msg>
</logentry>
<logentry
   revision="252945">
<author>gwl</author>
<date>2016-03-14T14:40:19.325927Z</date>
<msg>noreivew
回滚zjy关于升级的修改
有错误，等他后续改动验证通过了再上库</msg>
</logentry>
<logentry
   revision="252883">
<author>lcy</author>
<date>2016-03-14T06:18:36.934555Z</date>
<msg>reviewid: 16417
review by gwl
Bug id: 35029
问题分析：TD35029,【VMP】【aSV】获取交换机列表和存储列表比较卡顿
问题出现的根源：
因为load_config太慢了，优化一下获取交换机信息的来源，把交换机信息存在vmlist里面
自测：
版本：
4.8.00_B
build 2016-03-05 21:59:52
自测通过。</msg>
</logentry>
<logentry
   revision="252839">
<author>gwl</author>
<date>2016-03-12T15:06:11.389512Z</date>
<msg>reviewid: 16524
Bug id: 35029
问题分析：【VMP】【aSV】获取交换机列表和存储列表比较卡顿
问题出现的根源：
因为load_config太慢了，优化一下获取交换机信息的来源，把交换机信息存在vmlist里面

改动说明:先修改pmxcfs，再修改perl
这里顺便改了一个bug：pmxcfs从config.db读取的conf文件，里面有快照信息，会导致extend_data包含了快照的配置，
如果快照有字段xxx，而虚拟机实际配置没有xxx字段，那么就会导致解析生成.vmlist时，获取的是快照的xxx字段的值，会让人纠结的。

自测通过。</msg>
</logentry>
<logentry
   revision="252825">
<author>zjy</author>
<date>2016-03-12T10:47:47.738748Z</date>
<msg>reviewid : 16518
bug id : 34772
问题描述：
集群升级时 就算存在节点没有参与升级，也检测为升级成功；原因是采用检测大版本号，还应检查升级包具体日期。目前采用大版本号和打包时间作为升级包版本信息检查。
改动说明：
1、升级包增加导出版本打包信息，由大版本号和打包时间组成；
2、升级时查询到的版本信息 也是 由大版本号和打包时间组成;
3、uapi.up文件get_status方法将返回版本号改为打包版本信息。
测试：
做过单元测试，需要打包验证。</msg>
</logentry>
<logentry
   revision="252824">
<author>zjy</author>
<date>2016-03-12T10:46:47.471208Z</date>
<msg>reviewid : 16517
bug id : 34772
问题描述：
集群升级时 就算存在节点没有参与升级，也检测为升级成功；原因是采用检测大版本号，还应检查升级包具体日期。目前采用大版本号和打包时间作为升级包版本信息检查。
改动说明：
1、先尝试获取升级包打包版本信息，若失败 则改为获取版本号。
测试：
需要打包验证。</msg>
</logentry>
<logentry
   revision="252814">
<author>wtd</author>
<date>2016-03-12T09:05:12.556880Z</date>
<msg>reviewid: 16434 
Bug id: 35108
问题分析:
一些无关紧要的风格类问题集合
改动说明:
对回调脚本加了日志，主要是打印时间

自测：无</msg>
</logentry>
<logentry
   revision="252794">
<author>gwl</author>
<date>2016-03-12T03:02:29.466603Z</date>
<msg>reviewid:  16510
Bug id: 34984
问题分析：QXL     64M+64M=128M（上限）
写缓存  256M （上限）
共享库  忽略不计，占用不多。
virtio  安装了virtio的虚拟机和没有安装的占用的内存差别不大。
问题出现的根源：

liangcy分析验证过</msg>
</logentry>
<logentry
   revision="252738">
<author>gwl</author>
<date>2016-03-11T08:22:17.017901Z</date>
<msg>reviewid : 16489
bug id :35082
问题描述: 
cluvmadm开机流程里，有两个地方要处理：memInfo为空的时候，get_best_node未处理这个异常，
还有exit的时候，未清空cluster.$vmid.starting状态
改动说明:除了这个bug，还另外改了一个拼写错误的单词，以及两条调试日志
自测通过</msg>
</logentry>
<logentry
   revision="252733">
<author>wtd</author>
<date>2016-03-11T07:54:59.352214Z</date>
<msg>reviewid: 16434 
Bug id: 35108
问题分析:
一些无关紧要的风格类问题集合
改动说明:
修改了日志，防止出现变量为初始化和大量日志超过8K

自测：无</msg>
</logentry>
<logentry
   revision="252689">
<author>gwl</author>
<date>2016-03-10T13:54:34.971773Z</date>
<msg>改版本号</msg>
</logentry>
<logentry
   revision="252664">
<author>gwl</author>
<date>2016-03-10T10:03:48.302762Z</date>
<msg>Merged revision(s) 251768-252598 from VTP/VMP4.7/Trunk:
noreview
更新vs包
........
reviewid: 16336
Bug id: 34628
问题分析:
优化其他模块链接redis部分代码
改动说明:
加了新函数，变量不混合

自测：Cacher和vtpqueue验证过，其他未验证
........
reviewid : 16341
bug id : 35018
问题描述 : 是个同步的api，要代理到每个主机上重启服务,返回超时
改动说明 : 把api改为异步任务，加上进度条，修改不规范的执行shell命令为run_command
测试场景 : 在大集群中测试通过.
........
reviewid : 16339
bug id : 34988
问题描述 : 1、优化批量部署虚拟机的速度。2、大集群环境升级了vdc最新包，没有合入vmp配合vdc的改动
改动说明 : 新建一台虚拟机api同步执行流程放到异步流程里去，睡眠时间改小，实时更新虚拟机新建状态改为没20台更新一次。2把vmp配合vdc的改动合入
测试场景 : 在vmp上一次部署100台虚拟机,时间大概在3-4分钟。一次部署400台，时间大概22分钟。
........
noreview
Bug id: 34628
问题分析:
修改开机优化时，计算单个主机的运行虚拟机数目时，逻辑错误，修改下
改动说明:
........
noreview
上库方便调试的脚本
........
noreview
增加/sf/debug调试脚本目录到PATH里面
........
noreview
没有指定参数的时候输出help信息
........
noreview
修改帮助信息
........
noreview
Bug id: 34628
问题分析:
修改开机优化时，计算单个主机的运行虚拟机数目时，逻辑错误，修改下
改动说明:
........
reviewid 16372
bug id 34925
review by zhangqian
问题分析：
qemu里面的CPUID entries最大设成了200
kernel只有80，对应放大到200
测试：
将虚拟机的CPUID的定制信息设到1900的长度，可以正常开机
........
reviewid:16377
bug id:35045
问题描述:执行sysprep之后，系统会进行重置，由于viostor服务中的ImagePath注册表项缺失导致系统蓝屏
改动说明:在安装fastio磁盘时先用inf进行预安装
测试场景:在win7 x86环境中全新安装vmtools之后，运行sysprep，系统重启之后不蓝屏
........
reviewid : 16381
bug id : 35026
reviewed by : wuyy
问题描述 : 35026：[SDDC快速响应]windows报表内部取不到数据时，需要使用外部获取到的报表数据---cyr已经回归通过
改动说明 : 合入td33597
问题说明：windows报表内部取不到数据时，需要使用外部获取到的报表数据
改动说明：当磁盘每秒读取次数:磁盘每秒写次数:磁盘每秒读取字节数:磁盘每秒写字节数:获取不到时，windows报表内部会把这4个值全部置0.
外面检查到这4个值全部为0，可以认为虚拟机内部没有获取到这4个值，此时不使用内部透传出来的数据
测试：安装了tools的windows虚拟机，往虚拟机内拷一些数据查看/tmp/reportdata-guest/下的报表数据是正常的，ui可以看到虚拟机有io。
      修改虚拟机注册表，并重启，使表报服务不能获取到磁盘io的4项数据，
      往虚拟机内拷一些数据，此时查看/tmp/reportdata-guest/目录中报表数据，虚拟机磁盘io的4项数据一直为0，ui看到的虚拟机io也一直为0
      替换vtp-datareportd并重启。再往虚拟机内拷一些数据，虚拟机详情页面可以看到虚拟机有io
自测场景 : 虚拟机注册表修改不了，测试场景未能按33579覆盖,在环境替换了代码，重启服务vtp-datareportd，往虚拟机拷贝数据，虚拟机详情页面IO和虚拟机内部显示接近
........
noreview
Bug id: 
问题分析:
模板部署的修改有问题，升级后vdc部署一直无状态
改动说明:
........
reviewid: 16336
Bug id: 34628
问题分析:
优化其他模块链接redis部分代码
改动说明:
加了新函数，变量不混合

自测：Cacher和vtpqueue验证过，其他未验证
........
reviewid : 16395
bug id ; 35069
问题描述: 操作日志流程：log_with_task, 调用oplogclient.pm的call
从而写入日志信息到redis（当前节点），再由vtpqueued循环读取redis缓存的日志
发起请求道vtplogd，再由vtplogd写入sqlite

而主机48个，操作13条并发时，整个流程，在vtplogd请求过多，导致
后来的请求直接status 500了（请求是http的）

经过分析代码和验证，以及结合redis官方测试数据，
将网络连接的压力分给redis，redis是tcp连接，所以不会每条日志都发出请求，
具体操作如下：每个节点写日志时，把日志信息发送给主控的redis（之前是当前节点的）
再由主控的vtpqueued读取redis，写给vtplogd，介绍了跨主机连接

而在使用本主机连接请求时，不会出现status 500错误，最多就是延时超时（可能是
perl的HTTP模块本身有防攻击，具体原因暂不追寻）。

经过验证，redis和请求均正确。
改动说明:
自测:自测通过
........
reviewid : 16397
bug id : 35049
问题描述 : 开机备份时，会创建一个task去发送cont命令给虚拟机，而虚拟机由于bug，一直没响应，导致task备份一次产生一条
           从而使得task超过队列限制，后来的备份就会陷入“排队中”。
改动说明 : 判断是否已经存在task，存在的话就不创建
测试场景 : 自测通过，未测试具体备份逻辑。测试代码如下：
#!/usr/bin/perl
use strict;
use warnings;

use VTP::Task;
use Data::Dumper;
use VTP::RPCEnvironment;
VTP::INotify::inotify_init();
use VTP::QemuServer;

my $rpcenv = VTP::RPCEnvironment-&gt;init('cli');

sub test {
     my $vmid = shift;
     if (VTP::QemuServer::check_task_exist($vmid, 'snapshot_create_qmp_cont')) {
         print "exist\n"; 
     }
}

sub make_task {
     my $vmid  = shift;
     my $rpcenv = VTP::RPCEnvironment::get();
     my $code = sub {
         sleep(100000);
     };
     $rpcenv-&gt;fork_worker( 'snapshot_create_qmp_cont', $vmid, 'vmp', $code );
}


sub check_task {
     my $vmid  = shift;
     my $task = VTP::Task::get_tasks();
     #print Dumper($task)."\n";
     foreach my $t (@$task) {
         next if $t-&gt;{type} ne 'snapshot_create_qmp_cont';
         next if $t-&gt;{id} ne $vmid;
         print "detected a task ". $t-&gt;{upid}."\n";
         return 1;
     }
     return 0;
}


my $op = shift;
my $vmid = shift;
make_task($vmid) if $op eq 'mk';
check_task($vmid) if $op eq 'ck';
test($vmid) if $op eq 'ck2';
........
reviewid: 16404 reviewd by: lsh bug id: [35034] 改动说明：【集群】强制设置集群IP
........
noreview
说明：
更新AMD虚拟化方案验证测试 进度。
........
noreview
说明：
更新AMD虚拟化方案验证测试 进度。
........
reviewid: 16414
review by: hyq
Bug id：35084
问题分析：
主机离线导致VTP::VMInfo::need_preload_disk调用的VTP::QemuDerive::is_file_exist抛出异常，异常没有被捕获。

改动说明：
如果VTP::QemuDerive::is_file_exist抛出异常，则认为不需要进行预加载。
因为预加载的操作比较复杂，在不能确定的时候，默认不进行预加载。

自测：
1. 2主机集群，一台主机h1离线，查看虚拟机列表——正常显示；
2. 查看离线主机h1上的虚拟机，点击详情——显示正常。
........
reviewid 16407
Reviewed by: czy
BUG ID: 35077
问题分析：上传文件时waf占用CPU过高
改动说明：将上传URL放入bypass规则中，避免检查
做了哪些测试：无
........
reviewid: 16416
review by gwl
Bug id: 34937
问题分析：TD34937,【VMP】【aSV】大集群环境升级，有任务在运行时开启维护模式，报错信息看不懂
问题出现的根源：
任务名字设置为英文，在翻译文件中没有把英文翻译为中文。
改动说明：
把英文对应的中文翻译加进去。
自测：
版本：
4.8.00_B
build 2016-03-05 21:59:52
自测通过。
........
noreview 
修正代码格式
........
Revision: 249360
Author: panchao
Date: 2016年1月19日 11:02:33
Message:
reviewid: 16424
bugid：34023
问题分析：
改动说明：增加开关限制，可以touch /cfs/log_stack.switch来开启API错误堆栈日志


Modified : /VTP/aSV4.6/VMP4.7/source/app/vtp-common/Exception.pm
........
Merged revision(s) 249370 from VTP/aSV4.6/VMP4.7:
reviewid: 15780
  Bug id: 34202
  问题分析:vs添加的一块代码位于添加主机锁的外面，导致添加任务并发；导致批量添加失败；
  改动说明:修改代码，将代码加入锁的内部
  自测:
  1.修改代码，将代码加入锁的内部;
  2.登录前台，批量添加主机（添加了15台），等待结果，通过；
  环境：
  4.6.01
  build 2015-12-05 23:05:39
........

........
Merged revision(s) 249373 from VTP/aSV4.6/VMP4.7:
reviewid: 15781
Bug id: 34261
问题分析: 添加主机时，重启了被添加主机的集群服务，在等待集群稳定时，超时导致添加主机失败。
改动说明: 大集群，48台主机，需要的集群稳定时间更长，60s左右，改为5min超时。
自测: 大集群环境，vtpcm restart，原来的60s就会出现该问题。
改为5min，不出现问题
........

........
Merged revision(s) 249384 from VTP/aSV4.6/VMP4.7:
reviewid: 15784
Bug id: 34392
问题分析: vs bonding限制了arp_target 16个，导致组建vs链路聚合时，添加到聚合口失败
改动说明: 修改限制为64，考虑大了可能有影响，集群支持48台主机，64够用
自测: 上库打包验证
........

........
Merged revision(s) 249414 from VTP/aSV4.6/VMP4.7:
reviewid: 15791
bugid：
问题分析：解决VMP版本的性能优化问题
自测：通过
........

........
Merged revision(s) 249570 from VTP/aSV4.6/VMP4.7:
reviewid: 15833
bugid：34615
问题分析：当run_command()调用shell脚本、可执行文件返回值为1时，视为错误，输入日志；
改动说明：修改对run_command()的参数，将命令执行后退出码与指定忽略的退出码比较；
环境：
4.8.00_B
build 2016-01-19 22:18:16
自测通过
........

........
Merged revision(s) 249749 from VTP/aSV4.6/VMP4.7:
reviewid: 15883
bugid：34659
问题分析：日志是由unlink函数返回值正常时，发出的提示信息日志，属于正常范畴；
改动说明：刷新频繁，删除掉；
环境：
4.8.00_B
build 2016-01-19 22:18:16
........

........
Merged revision(s) 249896 from VTP/aSV4.6/VMP4.7:
reviewid: 15906
Bug id: 34678
问题分析: get_nodelist多处被重复调用，消耗时间，详见bug附件
改动说明: 
改动后，从/update/step来看， 在主控资源耗尽时，API时间20s， 优化后消耗时间8s - 12s
主控资源消耗一半时，API时间6s， 优化后3s左右。
优化效率约50%

对于其它API的效率也有提升，暂未分析具体哪些提升。
........

........
Merged revision(s) 249937 from VTP/aSV4.6/VMP4.7:
noreview
34333 【VMP】【aSV】【0.5人天】主机详情-存储-存储测速“属性缺失”
问题分析：提交时没判断存储id
改动说明：提交时检测存储id
自测说明：
主机详情-》存储标签页
重新检测存储最大IO速率
下拉列表没加载完成前，点击开始检测
提示“请选择存储”

........

........
Merged revision(s)  from VTP/aSV4.6/VMP4.7:

........
Merged revision(s) 250079 from VTP/aSV4.6/VMP4.7:
noreview
34314 【VMP】【aSV】【体验性】【1人天】48台主机组建了集群之后，在也很多页面 显示主机的时候没有按照ip来排序，导致要定位到某一台主机很不方便

修改说明:
只修改了升级页面的主机列表
........

........
Merged revision(s) 250123 from VTP/aSV4.6/VMP4.7:
reviewid: 15936
bugid：
问题分析：vmp_is_aSV函数中对run_command调用，以及使用diff命令，需要开启新的进程，消耗时间；
改动说明：取消对run_command与diff的调用，自己手动比较/sf/etc/version /sf/etc/version.server；
自测通过
........

........
Merged revision(s) 250249 from VTP/aSV4.6/VMP4.7:
noreview
34378 【VMP】【1人天】体检性:建议在虚拟机各分组视图上添加正在运行vm个数
........

........
Merged revision(s) 250313 from VTP/aSV4.6/VMP4.7:
reviewid: 16001
Bug id: 34738
问题分析:
/cluster/vms这个API耗时&gt;6s
使用工具查看代码耗时，分析出两处位置耗时：
①判断文件是否存在is_file_exist
②判断告警配置（遍历1600台虚拟机时，每次都去读取告警配置）

改动说明:
①get_storage_usage函数有跨主机操作，跨主机时耗时3s左右。
不少地方使用这个函数判断存储是否在线，构造一个新的检测函数（向报表读取数据），
将调用这个函数的代码改为调用新检测接口，时间大幅度降低。
②遍历虚拟机时，有vs加的告警代码，其每次都获取告警配置，然后检测，总耗时4.7s，
改为只读取一次告警配置即可，另外提了bug要求vs改掉这个检测告警的逻辑，按照VMP原有的告警检测逻辑去写代码。
自测:
①generate_cmd函数
修改前：40ms， 跨主机时3s+
修改后：20 us
②get_storage_usage耗时：40ms， 跨主机时3s+
改为从数据报表获取，耗时：20ms
③get_store_offline_vms
修改前，耗时∞+
修改后15s ， 这个15s主要是因为load_config执行了1600次

④修改了get_vms里面判断告警配置的地方
/cluster/vms
修改前：6s+
修改后：3s左右
........

........
Merged revision(s) 250322 from VTP/aSV4.6/VMP4.7:
reviewid: 16009
  Bug id: 34745
  问题分析:计算负载的时候，没有把主控优先级降低
  改动说明:在HAConfig.pm中降低10的优先级
  自测:打包后验证
........

........
noreview aSV4.2 SDDC Beta20
........
reviewid: 16434 
Bug id: 35108
问题分析:
一些无关紧要的风格类问题集合
改动说明:
修改了日志，防止错误日志出现

自测：无
........
Merged revision(s) 247761 from VTP/aSV4.6/ASV4.6:
性能优化
........

........
Merged revision(s) 247964-250274 from VTP/aSV4.6/ASV4.6:
noreview
bugid:34220
改动说明：
合入SDDC修改，针对linux系统关闭sse4.1指令集
测试：
无
........
reviewid: 15338
Bug id: 
问题分析: 正版激活问题
改动说明: 去掉uuid
自测: 未自测
........
reviewid :15342
bug id :34157
问题分析：
1、vmp3.0目录变成分组，每个节点都有相同的目录，vdc调用老接口get_vmtree，其中为了避免返回重复的目录id为其做处理：返回给vdc:每个目录id+主机编号；
2、从而vdc下发的$dirid是通过处理的，为了获取真正的目录id，vmp需要去除掉dirid后面的主机编号3、VTP::QemuServer::get_real_dirid中会对$dirid做处理，但是处理的方式为：使用chop去除$dirid最后一位，然而当主机数量大于等于10台后，主机编号将会变为两位数，此时只去除最后一位将导致得到的$dirid还是错误的，此时就会找不到相应分组的目录，报错
改动说明：
修改了VTP::QemuServer::get_real_dirid，将其中通过去除$dirid最后一位得到目录id的方式修改为:通过获取目前的所有分组id再查找这些分组id中是$dirid前缀的$id，此时就是真正的目录id
自测：
环境： 172.28.162.91 admin/admin123.
1、未修改时， 调用接口 create /cluster/qemu/{templateid}/{node}/derive_one 传递参数dir:目录id+主机编号，编号一位时，得到正确的目录id；编号两位，得到错误的目录id,报错：新建虚拟机失败！错误信息：新建虚拟机失败！错误信息：打开文件夹（1db7721482f8012）失败！
2、修改过后，调用接口 create /cluster/qemu/{templateid}/{node}/derive_one 传递参数dir:目录id+主机编号，编号一位或两位均得到正确的目录id;成功创建虚拟机
........
reviewid :15246
bug id :33535
问题分析： 
ssl用vmid取代uuid则虚拟机启动参数不需要uuid参数，注释相应代码
改动说明：
修改VTP::QemuServer.pm中的vm_start函数，注释掉其中启动需要传递uuid参数的代码
自测：
环境：200.200.101.164 admin123
1、启动虚拟机
2、后台运行ps auxf | grep kvm 看到相应启动参数
3、ps auxf | grep kvm | grep uuid --color=auto查看启动参数中没有uuid参数
........
reviewid :15363
bug id :34029
问题分析：
主机离线，存储异常，导致写入配置文件时重命名文件失败
而在前台报错：重命名（/sf/data/vs_rep2/export_vm//.process_5051858246702.txt) 失败!错误信息：Transport endpoint is not connected
改动说明：
修改VTP::VAPI::Tools::write_ini_conf中的报错信息，将前台报错修改为：写入配置文件失败！存储或集群主机异常，请检查相应配置是否正确
而相应的重命名失败及其原因写入日志中
自测：
环境：200.200.101.164
1、将一台主机（从节点）关机
2、选择一个虚拟机导出
3、观察结果：报错为：写入配置文件失败！存储或集群主机异常，请检查相应配置是否正确
........
reviewid: 15385
review by: lcy
Bug id：34258
问题分析：
集群虚拟机的开机流程大致是VMOperate.pm=&gt;cluvmadm=&gt;vtpvm。从VDI客户端上启动虚拟机以后，VDI那边是通过
HTTP: GET /vapi/json/nodes/{node}/tasks/{upid}/status来查询开机任务的状态，这个API本质是去读
的时候会在cluvmadm中被捕获并且exit（0）;从而导致VMOperate中的API认为这次任务执行成功（因为退出码为0，但是任务实际上是失败的），
API认为任务成功，就会在UPID日志文件的最后一行写下TASK OK，最终导致查询任务状态为OK


改动说明：
将开机失败的各种异常信息一直向上层抛出，最终在VMOperate.pm中捕获并处理。

自测：
1. 开机成功前台日志正常，后台通过vtpsh get /nodes/{node}/tasks/{upid}/status查看exitstatus为OK。
2. 开机失败前台日志报错正常，后台通过vtpsh get /nodes/{node}/tasks/{upid}/status查看exitstatus和VMP前台报错一致。
........
reviewid: 15392
Bug id: 34261
问题分析: 添加主机时，重启了被添加主机的集群服务，在等待集群稳定时，超时导致添加主机失败。
改动说明: 大集群，48台主机，需要的集群稳定时间更长，60s左右，改为5min超时。
自测: 大集群环境，vtpcm restart，原来的60s就会出现该问题。
      改为5min，不出现问题
........
reviewid: 15391
Bug id: 34261
问题分析: 添加主机时，重启了被添加主机的集群服务，在等待集群稳定时，超时导致添加主机失败。
改动说明: 大集群，48台主机，需要的集群稳定时间更长，60s左右，改为5min超时。
自测: 大集群环境，vtpcm restart，原来的60s就会出现该问题。
      改为5min，不出现问题
........
reviewid: 15397
Bug id: 34267
问题分析：
1、vmp3.0目录变成分组，每个节点都有相同的目录，vdc调用老接口get_vmtree，其中为了避免返回重复的目录id为其做处理：返回给vdc:每个目录id+主机编号；
2、从而vdc下发的$dirid是通过处理的，为了获取真正的目录id，vmp需要去除掉dirid后面的主机编号
3、VTP::QemuServer::get_real_dirid中会对$dirid做处理，但是处理的方式为：使用chop去除$dirid最后一位，然而当主机数量大于等于10台后，主机编号将会变为两位数，此时只去除最后一位将导致得到的$dirid还是错误的，此时就会找不到相应分组的目录，报错
改动说明：
修改了VTP::QemuServer::get_real_dirid，将其中通过去除$dirid最后一位得到目录id的方式修改为:通过获取目前的所有分组id再查找这些分组id中是$dirid前缀的$id，此时就是真正的目录id

自测: 直接合入，未自测。
........
reviewid: 15400
Bug id: 34267
问题分析：
1、vmp3.0目录变成分组，每个节点都有相同的目录，vdc调用老接口get_vmtree，其中为了避免返回重复的目录id为其做处理：返回给vdc:每个目录id+主机编号；
2、从而vdc下发的$dirid是通过处理的，为了获取真正的目录id，vmp需要去除掉dirid后面的主机编号
3、VTP::QemuServer::get_real_dirid中会对$dirid做处理，但是处理的方式为：使用chop去除$dirid最后一位，然而当主机数量大于等于10台后，主机编号将会变为两位数，此时只去除最后一位将导致得到的$dirid还是错误的，此时就会找不到相应分组的目录，报错
改动说明：
修改了VTP::QemuServer::get_real_dirid，将其中通过去除$dirid最后一位得到目录id的方式修改为:通过获取目前的所有分组id再查找这些分组id中是$dirid前缀的$id，此时就是真正的目录id

自测: 直接合入，未自测。
........
reviewid: 15398
bugid: 34027
问题描述: 【磁盘扩容】模板扩容成功，更新到虚拟机，更新成功，但是配置文件的磁盘大小未改变。【优先】
改动说明: 在更新派生虚拟机virtio配置virtio时，增加一个更新镜像大小的功能
自测场景: 新建一台虚拟机，并部署两台派生虚拟机到不同的存储,编辑模板虚拟机的镜像大小，再更新模板，页面查看派生虚拟机的的镜像大小是否同步更新
........
noreview
248175修改有问题，会抛出很多英文异常到前台，回滚掉
........
noreview
说明：
更新amd虚拟方案的验证测试计划。
........
noreview
247125和246734修改有问题，会导致TD34051，回滚掉
........
reviewid: 15440
Bug id: 33744
问题描述: HA虚拟机只有一个网口，未插网线，开机启动失败
问题分析: 获取开启该虚拟机的主机流程里参数net_ok默认为1,即默认虚拟机网络是正常的，合入4.2bug后这里逻辑反了，又没有进入把net_ok设置为1的流程
导致获取能开启虚拟机的主机失败
改动说明: 改回原来的逻辑,net_ok初始化为1，检测有问题再设置为0
自测场景: 两台主机组成的集群，新建一台只有一个网口的HA虚拟机，网口不插网线，开启虚拟机。虚拟机能正常启动。
........
reviewid: 15448
review by: fxw
Bug id：34294
问题分析：
在linux下将磁盘镜像文件格式化成NTFS后，在windows内部使用有问题，导致磁盘分区已扩容到40G，而磁盘卷还保持原样1G。

改动说明：
用于预加载的个人盘改成在windows下经格式化好的personal_disk.qcow2

自测：
1. VDC上部署一台虚拟机A，还原模式，选择个人数据盘40G，不加密；从VDC上启动该虚拟机，磁盘正常加载，显示40G；
2. VDC上部署一台虚拟机B，还原模式，选择个人数据盘40G，加密个人盘；从VDC上启动该虚拟机，磁盘正常加载，显示40G；
3. 测试重启还原功能，正常。重启后系统盘被还原，个人盘数据在，个人盘大小仍然为40G。
........
noreview

修改升级版本号相关
........
reviewid: 15466
Bug id: 
问题分析: 
改动说明: vs新改了3个问题，给富士康用，上库
自测:
........
reviewid :15467
bug id :34256
问题分析：
QemuServer.pm中原有的设置开机bios的时间分为几种情况：存在/cfs/vmboot.int则从中读取停留时间；否则，没有该文件则判断是否有cd再设置相应bios停留时间；
然而，如果符合以前设定的为判断是否是一体机的判断VTP::Product::is_vmp_for_vs()函数，则不管之前的设置，强制不停留；可是该函数现在已经不能成为判断一体机的条件，对于现在的VMP都会满足这个条件，而导致所有的bios都被设为强制不停留，从而进入不了安全模式；
改动说明：
1、去掉判断是一体机就不停留的强制条件
2、修改如果有/cfs/vmboot.ini，就用这个文件来配置，如果没有文件判断有没有cd，如果有就menu=on,splash-time=8000，设置停留时间；
，如果没有cd就menu=off,splash-time=1，不停留 
自测：
1、修改之前，bios被设为不停留，控制台启动windows虚拟机，开机按F8进入不了安全模式
2、修改之后，控制台启动虚拟机，能看到bios停留一会，按F8能进入安全模式
........
reviewid: 15487
Bug id: 34023
问题分析: 
改动说明: 增加开关限制，可以touch /cfs/log_stack.switch来开启API错误堆栈日志
自测: 自测通过
........
noreview
上库各个任务相关资料
........
noreview
上库vs最新包
........
noreview
项目任务进度更新
........
reviewid: 15555
  Bug id: 34387
  问题分析:vminfo_list这个API，获取非常慢，原因是里面多次调用cfs_update
  改动说明:将Cluster.pm和QemuServer.pm中调用cfs_update部分去掉，由于程序入口处有调用，不需要再次调用
  自测:在测试部环境测试通过
........
reviewid:15559
review by fxw
BUG ID: 34388
合入。先合入界面逻辑部分。不包括ISO安装部分。
具体对应aSV4.2的改动。
Revision: 242451
Author: qifei
Date: 2015年11月5日 11:31:47
Message:
支持amd改动
安装过程中注释掉cpu型号，bios检测
perl中注释掉bios检测，cpu匹配主频的正则不适用于amd设备，也注释掉
----
Modified : /VTP/aSV4.2/Branchs/aSV4.2_SDDC/build/pkg/replace-root/sf/bin/vmp_install_main.sh
Modified : /VTP/aSV4.2/Branchs/aSV4.2_SDDC/src/app/vtp-common/ProcFSTools.pm
Modified : /VTP/aSV4.2/Branchs/aSV4.2_SDDC/src/app/vtp-qemu-server/VTP/QemuServer.pm
........
reviewid: 15567
Bug id: 
问题分析: 捕获API错误的时候，用了my_die，直接把所有错误当成了字符串，而实际上错误可能是hash结构
改动说明: 改为die
自测: fxw发现，并修改验证
........
reviewid 15569
bug id 34396
review by hyq
问题分析：
gwl加了调试堆栈，捕获到异常后转成了字符串，但是有些异常是hash结构。这样转化导致数据丢失，VDC获取不到数据导致bug
改动说明：
不转化，直接抛出异常
测试：
1、VDC创建虚拟机
2. VMP删除刚创建的虚拟机
3. VDC删除这个虚拟机，可以删除成功
........
noreview suntao修改：
TD: 40566
改动说明：
合入svn://200.200.0.40/ssl/other/技术支持/代码修改/VDI4.7R1/VDI4.7R1_北京智课教育_TD20180/src/vmp/source/packages/spice-0.12.5


........
reviewid: 15578
Bug id: 34392
问题分析: vs bonding限制了arp_target 16个，导致组建vs链路聚合时，添加到聚合口失败
改动说明: 修改限制为64，考虑大了可能有影响，集群支持48台主机，64够用
自测: 上库打包验证
........
reviewid :15542
bug id :34310
问题分析：
根据返回值，使用VTP::Tools::run_command的ignore_exit_code参数，去除后台打印的不必要的日志
改动说明：
QemuServer.pm 关于is_swap_ssd的错误信息，之前已根据退出码被和谐
修改VTP::Tools::get_real_mem函数，忽略返回值 1 ，屏蔽 命令"dmidecode | grep -A 16 \"Memory Device\$\" |grep Size: |grep -v \"No Module Installed\""的日志
自测：
1、修改前，后台sfvt_vtpdaemon报 Failed exec dmidecode | grep -A 16 \"Memory Device\$\" |grep Size: |grep -v \"No Module Installed\ 错误信息 ：返回值 1
相关日志；
2、修改后，返回值为1 的被屏蔽 ，不报相关错误
........
[no review]VDI4.8代码合入，来自svn://200.200.0.40/ssl/dev/Trunk/Personal-Directory/VDI4.8/spice-0.12.5
........
noreview
spice代码更新，对应更新库文件
........
Merged revision(s) 248749 from VTP/aSV4.2/Branchs/aSV4.2_SDDC_CN_EN/src:
noreview
BUGID : 34401
问题说明：原来做AMD支持的时候去掉了这个限制，现在要把它加回来
改动说明：将BIOS的VT-x检测反注释
自测说明：未实际测试，先打包再回归
........

reviewid:15582
review by fxw
bug id: 34388
打包验证。
........
reviewid: 15584
Bug id: 34392
问题分析: vs bonding限制了arp_target 16个，导致组建vs
链路聚合时，添加到聚合口失败
改动说明: 修改限制为64，考虑大了可能有影响，集群支持48台主机，64够用
自测: 上库打包验证
........
noreview：
改动说明：
bug33741，备份恢复支持配置恢复完成后自动重启。包括虚拟机详情里面的单个虚拟机恢复和管理里面的批量恢复虚拟机。
........
noreview
说明：
更新amd测试计划 已执行完的部分。
........
noreview
更新上库规范的格式
........
noreview
更新任务项
........
noreview
说明：
上传amd netperf网络性能测试结果。
........
noreview
说明：
更新amd测试计划 已执行完的部分。
........
reviewid :15593
bug id :33741
问题分析：
   虚拟机备份恢复结束后是关闭状态，对于开机状态下备份恢复后希望能够自动启动的情况进行改进
改动说明：
   在虚拟机备份恢复的选择页面，增添一个恢复后是否自动重启的勾选项，默认不勾选；如果勾选了在备份恢复结束后自动为用户开启虚拟机
自测：
1、虚拟机本地备份后，选择备份恢复，勾选备份结束后自动重启；结果：虚拟机先执行备份恢复，接着自动启动
2、虚拟机本地备份后，选择备份恢复，不勾选备份结束后自动重启；结果：虚拟机只执行备份恢复，恢复结束后处于关闭状态
3、虚拟机异地备份后，选择备份恢复，勾选备份结束后自动重启；结果：虚拟机先执行备份恢复，接着自动启动
4、虚拟机异地备份后，选择备份恢复，不勾选备份结束后自动重启；结果：虚拟机只执行备份恢复，恢复结束后处于关闭状态
5、批量备份恢复虚拟机，多个虚拟机，部分勾选恢复后自动重启，部分不勾选恢复后不自动重启；结果：勾选了的恢复后自动开机；没勾选的只恢复，结束后关闭
........
概要信息: 数据盘或缓存盘拔出格式化后重新插入，页面显示正常，应该提供一个手段恢复该磁盘[集群中磁盘拔出格式化重先插入]
BUG   ID: null
改动说明: 合入代码
测试分析:
reviewid 15596, reviewed by fxw, tyy
........
noreview：
改动说明：
bug33943，序列号没插key的提示“USB-KEY被拔出”改为“未插入USB-KEY”
........
reviewid 15595
bugid 34417
review by fxw
问题分析：
枚举类型传给uint32_t，在进行%u输出程序出core。
改动说明：
错误码强制类型转换为uint32_t。
测试：
/sf/etc/init.d/ukey_proxy restart重复多次测试/sf/data/local/dump是否会产生core。
未产生，测试ok。
........
noreview：
改动说明：
bug34014，导入虚拟机，去掉HA配置。界面当时多合了
........
noreview：
改动说明：
bug34200，新建用户和配置邮件服务器的时候，需要对密码加密。
........
noreview
更新任务项
........
reviewid :15603
bug id :34200
问题分析：
别人疏忽了，帮忙改
改动说明：
合入svn://200.200.0.10/vt/vt/VTP/aSV4.2/Branchs/aSV4.2_SDDC_CN_EN/src/  这个上库记录 245211 
VTP::VAPI::Log.pm 和 VTP::VAPI::User.pm

自测：
1、新建用户，F12查看到新建用户名的密码和确认密码均已加密；使用新添加的用户登录，能登录成功。  --pass
2、配置邮件服务器时，F12查看用户名和密码均加密了；  --pass
3、/cfs/alert.conf文件中，找到pass和user的值，是用命令pwddec xxx分别解密后，得到的值是前台配置的用户名和密码；
........
reviewid 15602
bugid 34339
review by fxw
问题分析：
该函数实现原理是先生成一个进程相关的临时文件并把数据写入该文件，写入成功后，还会把文件的内容读出来和传入的数据内容做对比，如果对比不一致就会失败。这个时候，没有删除临时文件。当传入的字符包含宽字符是就会失败，而没有清理临时文件。
改动说明：
数据内容对比失败，删除临时文件。
测试：
环境72.28.162.91【更换验证环境找我确认】
1、执行附件中的pl.pl脚本
2、/sf目录下不存在sf/data.json*文件
........
reviewid :15601
bug id :34342
问题分析：
1、对于密码策略是根据读取当前主控的超过时间设定是建议修改还是强制修改
2、对于不同主控，呈现的密码策略就会不同，有的可能是建议修改，有的就会使强制修改
改动说明：
1、修改密码策略：
对于集群只要检测到是默认密码就强制修改，不论主控是谁；
对于单机，按照原本密码策略，根据超过时间，选择是建议修改还是强制修改

自测：
1、环境：172.28.51.106 密码为默认密码的集群，登陆，显示强制修改密码
2、环境：172.28.162.91 密码不是默认密码的集群，登陆，不显示强制修改密码
3、环境：172.28.51.3 密码为默认密码 且超过15天的单机，登陆，显示强制修改密码
4、环境：200.200.101.92 密码为默认密码 没超过15天的单机，登陆，显示建议修改密码
........
noreview：
改动说明：
bug34428，解决部分IE11打不开页面控制台
........
reviewid: 15608
review by: hyq
Bug id：34370 34298 34264 34404 
问题分析：
1. 虚拟机转换成模板时，启动虚拟机失败导致模板转换失败，没有回滚、清理环境；
2. 个人盘预加载的代码流程中没有检测关闭虚拟机的任务进度，导致直接通过普通虚拟机部署时部署失败；
3. 模板更新，旧模板更新时需要默认预加载一次个人盘；
4. 预加载个人盘开机前修改磁盘配置时，新增的个人盘字段写死了ide1

改动说明：
1. 虚拟机转换成模板时，启动虚拟机失败导致模板转换失败，将配置回滚、环境清理，使虚拟机恢复到原来状态；
2. 个人盘预加载的代码流程中检测关闭虚拟机的任务进度；
3. 对于旧模板，即模板image目录下不含个人盘personal_disk.qcow2，在其更新的时候，会走一次预加载个人盘流程，
流程结束以后，其image目录下将包含个人盘personal_disk.qcow2；
4. 模板部署代码重构，只要模板虚拟机A的image目录下存在个人盘personal_disk.qcow2，那么模板所在的存储S1
和部署的目的存储S2的template目录下都会有个人盘personal_disk.qcow2，这一点有部署流程保证，这里S1、S2
相等就代表部署到同存储，不等则表示跨存储部署；
5. 预加载个人盘开机前修改磁盘配置时，新增的个人盘字段从ide0-ide3中选出未被使用的一个。

自测：
1. 新建一台普通虚拟机，构造开机失败的场景，转换成模板，转换失败，虚拟机的配置和环境都被回滚到了原来的状态；
2. 新建一台普通虚拟机A，直接用A部署虚拟机，部署成功；
3. 旧模板A已部署过虚拟机，但模板没有个人盘，更新模板，该模板虚拟机A执行一次预加载个人盘，A的image目录下新增个人盘；
4. 跨存储部署一台虚拟机，同存储S1和目的存储S2的template目录下均存在个人盘personal_disk.qcow2。
........
reviewid:15605
review by fxw
Bug id: 34153
问题分析：TD34153,【网口vlan配置】修改汇聚口的mac地址，修改后，子网口的mac地址不是最新的【优先】
问题出现的根源：
网桥的MAC地址没有同步。
改动说明：
同步更新一下网桥的MAC地址。
自测：
验证环境
4.8.00_B
build 2016-01-11 23:56:29
1. 配置聚合网口，配置VLAN。连接网桥，激活网桥
2. 修改MAC地址。
3. 聚合网口，网桥的MAC地址都会修改。
........
noreview：
改动说明：
bug33589,新需求，自动备份策略里面的快照限制个数改成3个到12个，默认8个
........
概要信息: gluster peer status状态为rejected，导致替换主机失败  |  增加主机替换过程中磁盘格式化进度查看和替换主机失败回退操作 | 【网上问题】brick check执行时间太长，导致页面超时，替换主机失败  
BUG   ID: vs td 30836  |   vs TD 30711   | vs TD 30837
改动说明:&lt;bug1 :配置私网之后，调用新增脚本vs_host_replace_checkpeerstatus.sh检查新进主机状态以及旧主机配对brick的状态
&lt;bug2 : 增加vs_host_replace_rollback_delnewhost函数，进行主机删除操作，且等待删除结束。增加新近主机磁盘格式化进度查看。 在1.通知格式化事件失败 2.新近主机磁盘格式化失败 3.通知替换主机任务失败 4.及查询到真正替换主机失败且新主机不在卷中。 则进行删除新进主机及相关删除操作，使得集群回到初始状态。 5.而当查询到真正替换主机失败而新进主机已参与组卷了则提示通知管理员，底层不进行任何回退操作
&lt;bug3:  将brick check过程放到后台执行。 

测试分析:
 &lt;bug1:如果检测到异常返回NO，则终止替换主机过程，进行回退
 &lt;bug2:可针对上面5种情况分别测试，前四种进行回退了，最后一种不进行回退操作
 &lt;bug3: 放到后台之后，页面较快结束，在后台执行。
reviewid 15616, reviewed by yzs
........
reviewid :15518
bug id :34086
问题分析：
1、原本添加主机时只检测了添加主机的基本版本号与要加入的集群是否一致，只要版本号一样就能添加进集群
2、对于主机A打了补丁包A，主机B没打补丁包A，主机A添加主机B组建集群的情况仍能够成功组建，但是集群中不同主机的补丁包是不一致的，会产生问题
3、需要增加检测的条件：检查基础版本号要一致，包括时间；检查主机所打补丁包、定制包都要一致；替换主机时要检查，批量添加主机也要考虑
改动说明：
修改了VTP::VAPI::Hosts::check_vtp_version 函数，再其本来只检测版本号是否一致的基础上增加检测版本时间是否一致，所打补丁包是否一致
自测：
1、添加与当前版本不一致或者时间不一致的主机，报错：远程主机（%s）和当前集群版本不一致！
2、添加与当前版本一致及时间均一致的主机，一个有打补丁，一个没打补丁，报错：远程主机（%s）和当前集群补丁包不一致！
3、添加与当前版本一致及时间均一致的主机，两个都有打补丁，补丁包不一致，报错：远程主机（%s）和当前集群补丁包不一致！
........
reviewid:15613
review by fxw
Bug id: 33788
问题分析：TD33788，【虚拟交换机】编辑虚拟机所桥接网口，任务显示成功了，实际上却编辑失败了
问题出现的根源：
编辑虚拟交换机的时候，有多少台主机就会打印多少条日志，无论编辑成功与否。
在编辑虚拟交换机的过程中，如果检查到其中一台主机的配置信息中不存在这个虚拟交换机，就会在这个主机上创建一台新的虚拟交换机。
这个时候，如果新建的过程中出错了，日志就会混乱。
改动说明：
与新建虚拟交换机同步一致一下。
编辑虚拟交换机的时候，如果是主控，无论成功与否都会打印一条日志。如果是从节点，只有在失败的时候才会打印一条日志。
如果在编辑的过程中，发现配置不存在，需要新建一台虚拟交换机，那么如果在主控新建成功，会打印一条新建的日志。如果在从节点新建成功不打日志，失败才会打印一条新建失败失败的日志。
自测：
验证环境
4.8.00_B
build 2016-01-11 23:56:29
1. 两台主机组成的集群。
2. 新建一个虚拟交换机，不连接物理网口。
3. 编辑虚拟交换机，连接两台主机的网口（保证这两个网口都还没有连接到虚拟交换机），日志打印编辑成功，只有一条，显示主机是主控的。
4. 编辑虚拟交换机，连接两台主机的网口，主控的网口还没有连接到其他的虚拟交换机，非主控的网口已经连接了虚拟交换机。这时候，日志打印两条。一条是主控编辑成功，一条是从节点编辑失败。
5. 编辑虚拟交换机，连接两台主机的网口，主控的网口已经连了另外的虚拟交换机，非主控没有连其他的。打印一条日志，只有主控失败的日志。
6. 后台修改主控的配置信息，把这个虚拟交换机删除掉。/cfs/nodes/hostid/vsw.ini.编辑虚拟交换机，连接主控已经连了其他虚拟交换机的网口。日志打印新建虚拟交换机失败。
........
reviewid: 15623
bug id: 33589
问题描述:不改UI会报错
改动说明: 最小备份个数改为3个
测试: jcy测试通过
........
noreview
说明：
更新amd测试计划 intel和amd相互热迁移的部分。
........
noreview
修正内核路径
........
reviewid: 15629
review by: hyq
Bug id：null
问题分析：
命令行字符串直接放在run_cmd函数内部不太好

改动说明：
将run_cmd命令行字符串提到run_cmd函数外部

自测：
测试了受影响的相关模块，虚拟机转换成模板、模板转换成虚拟机均正常。
........
noreview：
改动说明：
bug33943，序列号没插key，页面顶部的提示“USB-KEY被拔出”改为“未插入USB-KEY”
........
noreview
说明：
更新amd测试计划 已执行完的部分。
........
reviewid: 15638
review by: hyq
Bug id：34468
问题分析：
VMP4.8要支持4.6.02（富士康版本）升级。

改动说明：
修改了version-from文件，增加版本号4.6.02

自测：
需要打新包验证
........
noreview
上传spice要链接的开源库
http://downloads.xiph.org/releases/opus/opus-1.1.2.tar.gz
........
noreview
加入opus库重新编译
........
reviewid:15662
review by fxw
Bug id: 34494
问题分析：TD34494,【老功能】为blackbox日志增加ethtool的日志
问题出现的根源：
blackbox没有ethtool的日志
改动说明：
增加一条这样的定时日志。每隔5分钟往blackbox里面打印一条日志，文件大小上限为20M。日志文件为 LOG_ethtool.txt
自测：
验证环境
打包验证。
........
noreview：
改动说明：
bug34480，聚合口禁止改MAC地址
........
reviewid: 15646
bug id: 34277
问题描述: 模板虚拟机做了异地备份，并恢复到异地备份位置，个人盘没有拷贝到系统盘所在目录
改动说明: 判断备份位置有没有个人盘，如果有个人盘，则拷贝到模板虚拟机系统盘目录
自测场景: 
1、新建一个虚拟机到默认分组，转换为模板，再进行异地备份，最后执行恢复操作，选择恢复到备份位置
........
noreview：
改动说明：
bug33589,新需求，自动备份策略里面的快照限制个数默认最多8个改成默认最多3个
........
概要信息: 虚拟存储有主机离线，编辑虚拟机除了改名其它的要支持
BUG   ID: 30844
改动说明: 只限制改名操作
测试分析:
reviewid 15660, reviewed by lzj
........
noreview
更新vs代码
........
noreview
删除老的vs代码
........
noreview：
改动说明：
bug34465，虚拟机控制台，重启虚拟机时，不显示“正在重启”的遮罩
........
noreview：
改动说明：
bug34489，[合入VMP4.7]虚拟机的bios启动等待时间splash-time建议做成页面可配置的，以满足用户特定场景下的使用。
........
reviewid :15691
bug id :34489
问题分析：
虚拟机的bios启动等待时间splash-time非常短，而web vnc控制台的重连又很慢，导致操作系统的启动界面很多就跳过去，导致很多操作没法做。 
可能遇到如下问题：
1.grub的启动选项来不及选择
2.windows的f8来不及按
虚拟机的bios启动等待时间splash-time建议做成页面可配置的，以满足用户特定场景下的使用

改动说明：
虚拟机添加配置bios停留时间项
合入TD34471 修改 

自测：
1.新建本地（或ha）虚拟机，启动虚拟机
用命令ps auxf | grep vmid | grep splash  --color,有'menu=off,splash-time=1'，即bios菜单为关闭状态
2.编辑本地（或ha）虚拟机bios停留时间为0，启动虚拟机
用命令ps auxf | grep vmid | grep splash  --color,有'menu=off,splash-time=1'，即bios菜单为关闭状态
3.编辑本地（或ha）虚拟机bios停留时间如2的非0值，启动虚拟机
用命令ps auxf | grep vmid | grep splash  --color,有'menu=on,splash-time=2000'，即bios菜单为开启状态 时间为用户设置停留时间
........
reviewid: 15693
review by lcy
bug id: 34516
问题描述: vtprgm调用一个api的接口被改了，导致异常
改动说明: 在新增一个接口用于判断虚拟机是否加密，之前的接口是判断虚拟机的某一个磁盘是否加密
自测场景: 
1. 替换代码，vtprgm运行正常
2. VDC设置开机自动，VMP启动后VDC启动成功
........
noreview
上库libevent2
为了让库有可执行权限，在linux下上库
........
noreview 
上库libevent的头文件
........
reviewid: 15653
bugid:
问题分析：解决VMP版本的性能优化问题；
自测：通过
........
review id: 15696
bug id: 34031
问题描述:td34031:【磁盘扩容】虚拟机存在异地备份，扩容，选择将备份存至回收站，到期后回收站不会清理。【优先】
改动说明:添加一个脚本，每天定时清理 /sf/data/$storageid/private/backup目录下的文件，如果存在文件超过一个星期没有改动，那么将其删除
测试:在/sf/data/$storageid/private/backup新建一些文件:修改系统时间为1星期后，检查/etc/crontab文件中的每天定时执行脚本在什么时候执行
把系统时间修改到它之前不久处，等待时间到达后过时文件是否被删除
........
reviewid :15698
bug id :33697
问题分析： 
因为旧版本的图片会先被删除，而之后如果新版本的图片下载不完整，就会导致前台得到的广告图片不全
改动说明：
合入 bug 32968
新版本的图片下载不完整不会删除旧版本的图片，会等新版本图片全部完成才更新UI的广告图片
自测：
1、vmp4.6 升级到 vmp4.7，观察升级后前台广告
2、重复升级多次，检查前台广告 没有缺失情况
........
reviewid: 15696
bug id: 34101
问题描述: 虚拟机运行在其他节点，qemu-img info 获取镜像信息的时候在本节点，报错208
改动说明: qemu-img info 获取能访问虚拟机的时候判断虚拟机是否运行，优先返回虚拟机的正在运行的位置
测试场景:虚拟机运行在非主控，进行备份。
........
noreview
加入opus库

........
noreview：
改动说明：
bug34528，【集群IP设置】【UI】集群IP设置页面的描述不准确
........
noreview：
改动说明：
bug34481，预加载个人盘会进行开机再关机操作，在会执行此操作的时候加上提示
........
reviewid:15724
review by fxw
Bug id: 33351
问题分析：TD33351,【集群】3台主机组集群，2种情况下导致了所配置的集群IP丢失【需要重现】
问题出现的根源：
集群IP经常被重置，即先删除然后设置。有可能出现某次设置不成功。又或者是设置错了网口导致的。
改动说明：
打印一些调试日志。设置集群IP的时候，把流程打印出来，并且把设置完了之后网口的IP信息打印出来
自测：
自测通过，日志正常。
........
reviewid 15726
review by fxw
bugid 34313
问题分析：
当一个主机装有多个vmp系统的时候，一旦重启主机，就可能出现严重的问题：1、配置发生错误，可能导致例如磁盘没有挂载等问题；2、数据丢失，主要表现在虚拟机丢失，也vmp管理页面的虚拟机页，虚拟机卡片显示镜像丢失，这主要是由于分区挂载错误造成的，可能两个磁盘的local分区挂载错误；等等其他情况。在安装的时候，vmp可以检测到这种情况，并必须格式化安装才能继续安装。在实际部署中，可能部署人员将安装过vmp的盘直接作为本地盘给主机，造成人为的一个主机存在两个vmp现象，从而出现配置丢失、数据丢失等问题。提出一个解决方案检测，并进行告警。
改动说明：
在告警服务中添加对主机安装vmp个数检测，若出现有主机安装多个vmp系统，则在vmp页面进行告警。检测原理是：
1、我们的vmp会将系统盘分成6个分区，因此第一步，需要检测当前主机有哪些块设备有6个分区。检测方式是对分区名为"sd[a-z]6"进行匹配。
2、进一步精匹配，匹配模式是“^(.)-(sd[a-z])6”。
3、对精匹配到的设备进行分区的卷标匹配。有两个分区需要匹配：/dev/sd[a-z]1和/dev/sd[a-z]2，第一个是默认的boot挂载目录，第二个是uefi迁移过来的boot分区。如果匹配到卷标是vtpboot，且统计匹配个数大于1才认为是多个vmp。
测试：
测试环境：
172.28.172.110（lyc提供虚拟环境）
200.200.101.159物理机环境
密码：都是admin
ps：如果重启过需要替换代码
1、在告警页面出现“主机安装多个VMP”告警。
2、后台到有多个vmp节点执行：e2label /dev/sda1 ""，然后/sf/etc/init.d/vtpalertd restart，页面不再产生新的告警。
3、执行perl /sf/bin/vmp_os_num_check.pl输出1.
注意不要清除多余的，否则就不能重启了。
........
reviewid: 15729
review by: fxw
Bug id：34184  34481
问题分析：
转换模板没有任何提示，会进行开机、关机操作

改动说明：
普通虚拟机转换模板、普通虚拟机直接部署会弹框提示需要进行开机关机操作；
旧模板第一次更新也会弹框提示需要进行开机关机操作


自测：
 1. 普通虚拟机的卡片、详情页面，点击转换模板，弹框提示转换模板的过程中会执行开机关机操作,目的是预加载个人盘；
 2. 普通虚拟机的卡片、详情页面，点击模板部署，在确认部署时，弹框提示转换模板的过程中会执行开机关机操作，因为普通虚拟机部署必定会走转换模板的流程；
 3. 模板虚拟机的卡片、详情页面，点击模板更新，目前在确认更新时本身就会弹框，如果时旧模板，那么更新在弹框中会新增提示：更新过程中会执行开机关机操作。
 更新操作不是每次都会将模板开关机的，只要个人盘加载上了，以后再次更新就不会再开机关机了。
........
reviewid 15737
bugid 34497
review by fxw
问题分析：
当存储不存在时，虚拟机开机报错“磁盘不存在”，描述不清楚。
改动说明：修改描述。
测试：
后台执行vtpsh get /vtpstorage/diskpath -did=1234。打印错误为“存储不存在（id：1234）”。测试ok。
........
reviewid : 15741
bug id : 34360
问题描述:【老功能】虚拟存储上的虚拟机克隆，进度条显示不对.
改动说明: 如果是虚拟存储，通过获取每次拷贝的数据再相加
自测场景:克隆一台虚拟存储上的虚拟机到其所在的存储，观察页面进度条是否异常
........
noreview：
改动说明：
bug33286，管理-&gt;虚拟机备份与恢复-&gt;恢复：支持 勾选/取消勾选 所有派生虚拟机的只恢复系统盘
........
noreview 
漏掉了libevent的so
........
copy from VMP4.7 2016-01-18
........
reviewid: 15753
review by: hyq
Bug id：34547 34532
问题分析：
转换模板需要执行开机关机操作，在关机失败时，会执行回滚操作将模板虚拟机转回普通虚拟机，
而转换成虚拟机需要是停止状态。

改动说明：
1. 重构磁盘预加载开机关机这部分代码；
2. 如果关闭虚拟机失败，则尝试关闭虚拟机电源

自测：
1. 新建普通虚拟机A，将A转换成模板，待A启动成功以后，后台用gdb kvm -p pid将虚拟机卡住，构造关机失败场景；
2. 前台操作日志依次会显示关闭虚拟机失败、关闭虚拟机电源成功，且转换模板任务最终也成功
........
noreview

上库最新测试用例
........
noreview
删除旧案例文件，避免误会
........
reviewid: 15776
bugid：34023
问题分析：
改动说明：增加开关限制，可以touch /cfs/log_stack.switch来开启API错误堆栈日志
........
reviewid: 15780
  Bug id: 34202
  问题分析:vs添加的一块代码位于添加主机锁的外面，导致添加任务并发；导致批量添加失败；
  改动说明:修改代码，将代码加入锁的内部
  自测:
  1.修改代码，将代码加入锁的内部;
  2.登录前台，批量添加主机（添加了15台），等待结果，通过；
  环境：
  4.6.01
  build 2015-12-05 23:05:39
........
reviewid: 15781
Bug id: 34261
问题分析: 添加主机时，重启了被添加主机的集群服务，在等待集群稳定时，超时导致添加主机失败。
改动说明: 大集群，48台主机，需要的集群稳定时间更长，60s左右，改为5min超时。
自测: 大集群环境，vtpcm restart，原来的60s就会出现该问题。
改为5min，不出现问题
........
noreview

上库linux系统测试案例
........
reviewid: 15784
Bug id: 34392
问题分析: vs bonding限制了arp_target 16个，导致组建vs链路聚合时，添加到聚合口失败
改动说明: 修改限制为64，考虑大了可能有影响，集群支持48台主机，64够用
自测: 上库打包验证
........
noreview
说明：
将netperf_8_2.xls更名为amd_netperf_8_2.xls.
........
noreview
说明：
上传wrk aSV netperf性能测试结果。
........
reviewid: 15785
bugid:
问题分析：修正内核路径
........
noreview
说明：
上传vCPU core2duo指令集对比结果。
........
reviewid: 15791
bugid：
问题分析：解决VMP版本的性能优化问题
自测：通过
........
noreview

上库管理资料
........
reviewid: 15809
review by: hyq
Bug id：34527
问题分析：
转换模板的过程要开机关机，这个过程没有对用户进行限制

改动说明：
1. 增加一个临时状态用来标识预加载磁盘的过程，在普通虚拟机转换模板、普通虚拟机直接部署的过程中，限制用户操作，显示正在转换模板；
2. 模板更新的整个过程都设为“模板更新状态”

自测：
 1. 普通虚拟机的卡片、详情页面，点击转换模板，卡片页面显示正在转换模板，详情页面虚拟机操作被置灰，控制台处于禁用状态；
 2. 普通虚拟机的卡片、详情页面，点击模板部署，卡片页面依次显示正在部署、正在转换模板、正在部署，详情页面虚拟机操作被置灰，控制台处于禁用状态；
 3. 旧模板虚拟机的卡片、详情页面，点击模板更新，整个过程虚拟机的卡片都显示正在更新。
........
noreview
更新任务进度表
........
noreview
说明：
更新AMD虚拟化方案验证测试计划。
........
reviewid: 15833
bugid：34615
问题分析：当run_command()调用shell脚本、可执行文件返回值为1时，视为错误，输入日志；
改动说明：修改对run_command()的参数，将命令执行后退出码与指定忽略的退出码比较；
环境：
4.8.00_B
build 2016-01-19 22:18:16
自测通过
........
reviewid: 15852
review by: hyq
Bug id：34627
问题分析：
新增个人盘的ide编号是通过遍历虚拟机配置中ide字段，选择未被使用的ide编号，
而如果使用了virtio_blk，配置中的相应ide字段就会被替换成virtio，导致新增个人盘
的配置使用了已有的ide编号，最终写入配置失败。

改动说明：
预加载个人盘在ide编号选择时，增加对virtio的处理

自测：
1. 新建虚拟机，安装虚拟机性能优化工具（安装VDC agent会自动安装性能优化工具），
转换成模板，待虚拟机启动以后，后台查看cfs目录下的虚拟机的配置（vmid为奇数），新增个人盘的配置被写入。
........
reviewid: 15853
bugid：34403
问题分析：物理机的网口没有vlan，函数load_if_vLan_cfg()来获取vlan配置刷这条日志属于正常范畴；
改动说明：刷新频繁，删除掉；
环境：
4.2.09_R1
build 2015-12-15 21:37:19
自测通过
........
reviewid: 15851
bugid：34615
问题分析：当run_command()调用shell脚本、可执行文件返回值为1时，视为错误，输入日志；
改动说明：修改对run_command()的参数，将命令执行后退出码与指定忽略的退出码比较；
环境：
4.8.00_B
build 2016-01-19 22:18:16
自测通过
........
reviewid: 15883
bugid：34659
问题分析：日志是由unlink函数返回值正常时，发出的提示信息日志，属于正常范畴；
改动说明：刷新频繁，删除掉；
环境：
4.8.00_B
build 2016-01-19 22:18:16
........
reviewid: 15889
bugid：34659
问题分析：日志是由unlink函数返回值正常时，发出的提示信息日志，属于正常范畴；
改动说明：刷新频繁，删除掉;
........
noreview
更新项目进度文档
........
reviewid: 15906
Bug id: 34678
问题分析: get_nodelist多处被重复调用，消耗时间，详见bug附件
改动说明: 
改动后，从/update/step来看， 在主控资源耗尽时，API时间20s， 优化后消耗时间8s - 12s
主控资源消耗一半时，API时间6s， 优化后3s左右。
优化效率约50%

对于其它API的效率也有提升，暂未分析具体哪些提升。
........
noreview
更新vs代码
........
noreview
34333 【VMP】【aSV】【0.5人天】主机详情-存储-存储测速“属性缺失”
问题分析：提交时没判断存储id
改动说明：提交时检测存储id
自测说明：
主机详情-》存储标签页
重新检测存储最大IO速率
下拉列表没加载完成前，点击开始检测
提示“请选择存储”

........
noreview
34617 【VMP】升级页面，升级48台主机的时候，在升级列表看不全所有的主机
问题分析：css类冲突
改动说明：修改类型
自测说明：
升级页面-&gt;主机列表：主机超过七台时，列表不会有问题。

........
noreview
34413 【vs】【已改】【优化时间】部分后台任务执行耗时过长，导致前端UI卡顿
问题分析：vs_info调用获取命中率的时间长
改动说明：修改命中率的方法
自测说明：点击虚拟存储界面，显示时间明显缩短

........
合入VMP4.7的改动
........
noreview
34314 【VMP】【aSV】【体验性】【1人天】48台主机组建了集群之后，在也很多页面 显示主机的时候没有按照ip来排序，导致要定位到某一台主机很不方便

修改说明:
只修改了升级页面的主机列表
........
reviewid: 15936
bugid：
问题分析：vmp_is_aSV函数中对run_command调用，以及使用diff命令，需要开启新的进程，消耗时间；
改动说明：取消对run_command与diff的调用，自己手动比较/sf/etc/version /sf/etc/version.server；
自测通过
........
reviewid: 15963
bug id: 34677
问题描述:HA拉起虚拟机失败报错不详细
改动说明:改了下提示，把提示改为“HA拉起虚拟机失败，集群内找不到可以运行该虚拟机的主机！请尝试手动启动该虚拟机！”
自测场景:
1、修改代码，直接报错误信息打出来。
2、主要测试勾选HA配置的第二项（主机管理通信网口和虚拟机通过网桥连接的物理网口掉线），其它主机是否尝试将该虚拟机拉起。
........
reviewid: 15970
review by: hyq
Bug id：34715
问题分析：
最初设计的判断模板虚拟机是否已经预加载过个人盘的方式，是通过检查模板image目录下是否存在personal_disk文件。
大多数情况下，personal_disk的存在性与个人盘是否预加载过是一致的，所以之前也没发现这种方法的存在问题。
在快照恢复这种场景就有问题，预加载之前打快照A，预加载完成，又回滚到A快照，这样操作就出现了上面提到的不一致的问题。

改动说明：
模板预加载完成之后，在模板虚拟机的配置文件中新增一个字段personal_disk_loaded，用于标识个人盘已经加载，
只有当配置中存在该字段，并且personal_disk.qcow2文件也存在，才认为模板已经加载过个人盘。

自测：
1. 新建普通虚拟机，转换模板，后台查看image和cfs目录下的配置文件，新增了personal_disk_loaded：1，image目录下存在personal_disk.qcow2；
2. 新建普通虚拟机A,通过A直接部署几台虚拟机，后台查看image、template和cfs目录下的配置文件与personal_disk.qcow2均存在；
3. 验证备份恢复，对上面的虚拟机A，后台将image、template和cfs目录下的配置文件中的新增了personal_disk_loaded字段或personal_disk.qcow2删掉，
更新模板，会预加载个人盘，三个路径下的配置文件中的新增了personal_disk_loaded字段都会恢复，image目录下的personal_disk.qcow2会恢复，
（template目录下的personal_disk.qcow2会在下次部署时恢复）；
4. 验证克隆，克隆后配置和个人盘都在；
5. 验证导入导出，导出再导入，新虚拟机个人盘和配置的新增字段均没有。
6. 验证迁移，移动到其他目录，其他存储，配置和个人盘都在。
........
noreview
34378 【VMP】【1人天】体检性:建议在虚拟机各分组视图上添加正在运行vm个数
........
noreview
配合ssl，增加新的qxl version
还有250880 250771也是相关修改
........
noreview
spice代码更新，对应更新spice库
........
问题描述： 
	显示私网IP冲突，提示信息更加清晰，不应该显示被占用，应该显示冲突
BUG   ID: 30959
问题原因： 
	
改动思路： 
	配置的虚拟存储IP（192.168.171.101,192.168.171.102） 冲突，请重新配置！
做了哪些测试：
reviewid 15969, commited by yangyf, reviewed by yinxin
........
noreview
34378 【VMP】【1人天】体检性:建议在虚拟机各分组视图上添加正在运行vm个数
........

........
Merged revision(s) 251081 from VTP/aSV4.6/VMP4.7/source/app/vtp-reportdata:
reviewid: 16189
Bug id: 34816 
问题分析:
vtp-datareport-server COREDUMP，原因是出在进程重启的时候，监听线程为退出，而其他线程已经退出，导致依赖free的资源。
改动说明:
如果设置了listen_status为0，则退出监听线程。

自测: 未在大集群环境中测试，打包后测试。
........

........
Revision: 251310
Author: gwl
Date: 2016年2月24日 15:59:18
Message:
reviewid: 16245
Bug id: 34941
问题分析:
获取任务状态的代码不健壮，Tools.pm中upid_read_status函数读取任务状态文件设定1024字节缓冲区，在大集群不行。大集群错误信息可能超过1024字节

改动说明:
改为限制8K，并且按照文件实际大小设置缓冲区。

自测: 在229测试通过。
----
Modified : /VTP/aSV4.6/VMP4.7/source/app/vtp-common/Tools.pm
........
noreview
去掉无用日志
........
Revision: 250349
Author: panchao
Date: 2016年1月29日 8:55:39
Message:
reviewid: 16005
bugid：
问题分析：由于td17295会导致df的线程越来越多，zhx采用控制所用线程的数量；
改动说明：解决控制线程的问题，只限制df的线程；
自测：
----
Modified : /VTP/aSV4.6/VMP4.7/source/kernel/fs/lmtps.c


........
Revision: 251861
Author: gwl
Date: 2016年3月2日 19:58:34
Message:
reviewid : 16341
bug id : 35018
问题描述 : 是个同步的api，要代理到每个主机上重启服务,返回超时
改动说明 : 把api改为异步任务，加上进度条，修改不规范的执行shell命令为run_command
测试场景 : 在大集群中测试通过.
----
Modified : /VTP/aSV4.6/VMP4.7/source/app/vtp-manager/VTP/VAPI/Log.pm


........
Revision: 246726
Author: jcy
Date: 2015年12月23日 17:33:40
Message:
noreview：
改动说明：
VS单主机环境：登录后首页提示组建集群，添加超过八台主机，到第三步，主机序号应显示正确
----
Modified : /VTP/VMP4.7/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-common/vs/cluster/create.js


........
Merged revision(s) 250349 from VTP/aSV4.6/VMP4.7:
reviewid: 16005
bugid：
问题分析：由于td17295会导致df的线程越来越多，zhx采用控制所用线程的数量；
改动说明：解决控制线程的问题，只限制df的线程；
自测：
........

........
Merged revision(s) 250359 from VTP/aSV4.6/VMP4.7:
reviewid: 16021
bugid：34751
问题分析: 添加提NYTProf工具和perld工具到VMP
改动说明: 添加新库
自测:无需测试
........

........
Merged revision(s) 250489 from VTP/aSV4.6/VMP4.7:
问题描述： 
	【vs】【VMP】升级集群，提示错误
BUG   ID: vttd34749
问题原因： 
	提示错误
改动思路： 
	修改提示，即对应中英文
做了哪些测试： 
	验证提示是否正确
........

........
Merged revision(s) 250529 from VTP/aSV4.6/VMP4.7:
no review
vttd:34479
问题：【vs】【优化时间】【初始化异常则告警】打开虚拟存储的页面，一直都显示为正在加载的状态
修改：把检测vmp网和vs的步骤分开，初始化的时候不检查vs网
测试：没有影响原有的逻辑
........

........
Merged revision(s) 250533 from VTP/aSV4.6/VMP4.7:
问题描述： 
	删除冗余代码，修复告警
BUG   ID: vttd34737
问题原因： 
	以前未删除
改动思路： 
	删除
做了哪些测试： 
	/cfs/alert.conf中存在vm_image_fix测试正常；删除代码及配置对应属性，显示正常
........

........
Merged revision(s) 250553 from VTP/aSV4.6/VMP4.7:
reviewid: 16068
Bug id: 34784
问题分析:
查到了原因，是run_command执行时，从命令行读取的数据没有去污染
导致Dumper时在开启-T选项后，会把所有信息变为字符串，具体Dumper代码未找到
不再深究
改动说明:
对run_command做去污染即可。
只看Tools.pm
自测:
对run_command做了专项测试，测试多行，单行结果的获取情况，自测通过
........

........
Merged revision(s) 250529 from VTP/aSV4.6/VMP4.7:
no review
vttd:34479
问题：【vs】【优化时间】【初始化异常则告警】打开虚拟存储的页面，一直都显示为正在加载的状态
修改：把检测vmp网和vs的步骤分开，初始化的时候不检查vs网
测试：没有影响原有的逻辑
........

........
Merged revision(s) 250562 from VTP/aSV4.6/VMP4.7:
reviewid: 16072
Bug id: 34795
问题分析:
虚拟机启动慢，耗时2.5分钟+
改动说明:
优化检查主机内存是否足够，后续wtd也会有优化代码

自测:
8s 优化到800ms
........

........
reviewid: 16434 
Bug id: 35108
问题分析:
一些无关紧要的风格类问题集合
改动说明:
添加user/local/bin为环境变量

自测：无
........
Merged revision(s) 250579-251067 from VTP/aSV4.6/VMP4.7:
reviewid: 16074
Bug id: 34795
问题分析:
检测主机是否符合启动条件的地方，耗时太长。
改动说明:
远程的http get调用，修改为每台主机获取数据存放到数据库，然后主控从数据库获取数据，绕过http get

自测: 100多s，可以优化到1s
........
reviewid: 16074
Bug id: 34795
问题分析:
检测主机是否符合启动条件的地方，耗时太长。
改动说明:
远程的http get调用，修改为每台主机获取数据存放到数据库，然后主控从数据库获取数据，绕过http get

自测: 100多s，可以优化到1s
........
noreview
加可执行权限
........
reviewid: 16074
Bug id: 34795
问题分析:
检测主机是否符合启动条件的地方，耗时太长。
改动说明:
远程的http get调用，修改为每台主机获取数据存放到数据库，然后主控从数据库获取数据，绕过http get

自测: 100多s，可以优化到1s
........
reviewid :16076
bug id :34802
问题分析：没用use plog
改动说明：添加use plog
........
reviewid : 16078
bug id : 34791
问题描述 : 本地存储虚拟机重复备份到异地本地存储失败
改动说明：
获取磁盘大小，访问虚拟机当前磁盘，应当使用当前主机；
获取备份位置磁盘大小才需要使用备份位置ip
测试：
备份虚拟机到从节点的local存储，备份成功(见td28263)
........
noreview
新增VMP4.8修改列表
........
reviewid : 16079
bug id: 34806
问题描述: 之前为了方便开发查问题，gwl添加了在程序抛出异常的地方打印堆栈到日志，默认开启
改动说明: 将其设置为默认不开启，修改后通过命令touch /cfs/log_stack.switch开启
测试场景: 查看sfvt_vtpdaemon.log日志， api执行失败后不再打印堆栈日志。
........
reviewid: 16091
review by: fxw
Bug id：34761
问题分析：
集群锁超时时间设置过长，导致另外一台主机一直获取不到锁，从而不断尝试拉起操作。

改动说明：
修改心跳更新频率为5秒（heartbeat_time）、心跳超时时间为35秒（heartbeat_timeout）

自测：
需要打新包验证
........
reviewid : 16096
bug id: 34823
问题描述:提供一个不需要传hostid的获取spice接口
改动说明:
以前的接口非集群虚拟机获取spice状态需要提供虚拟机所在主机的ID
HTTP:           POST /vapi/json/nodes/{node}/qemu/{vmid}/spice
CLI:    vtpsh create /nodes/{node}/qemu/{vmid}/spice
集群虚拟机接口：
HTTP:           POST /vapi/json/nodes/{node}/qemu/{vmid}/spice
CLI:    vtpsh create /nodes/{node}/qemu/{vmid}/spice
现在修改为：统一用集群虚拟机接口
测试场景:
新建两台虚拟机A和B，虚拟机A为集群虚拟机，虚拟机B为普通虚拟机，启动虚拟机
后台调用命令
vtpsh create /cluster/qemu/{vmidA}/spice
vtpsh create /cluster/qemu/{vmidB}/spice
命令执行成功
........
reviewid 16101
bug id 34824
review by zyj
问题分析：
合入qemu社区bugfix
http://git.qemu.org/?p=qemu.git;a=commit;h=e8d3b1a25f284cdf9705b7cf0412281cc9ee3a36
http://git.qemu.org/?p=qemu.git;a=commit;h=fcf5def1ab0f94ff120b7141c943b517d2ece83d
测试：
1、编译通过
........
reviewid : 16104
bug id : 34810
reviewed by : lcy
问题描述：td34810【备份恢复】备份到另一台主机local存储失败，报错：与qemu-nbd建立连接失败。
改动说明: 选择节点判断是否是本地存储
测试场景:
A主机本地存储原位置备份
A主机本地存储备份到A主机另外一个本地存储
A主机本地存储备份到B主机本地存储
A主机本地存储备份到B主机另外一个本地存储
A主机本地存储备份到共享存储（只有A能访问）
A主机本地存储备份到共享存储（只有B主机能访问）
A主机本地存储备份到共享存储（A、B都能访问）

共享存储访问情况（只有A能访问，只有B能访问，A、B都能访问）
A主机共享存储原存储备份
A主机共享存储备份到A主机本地存储
A主机共享存储备份到A主机另外一个本地存储
A主机共享存储备份到B主机本地存储
A主机共享存储备份到B主机另外一个共享存储
........
reviewid: 16105
review by hyq
Bug id: 34825
问题分析：TD34825,启用HA的VDC虚拟机，勾选主机开机后启动，选项失效
问题出现的根源：
在获取需要进行开机自启动的虚拟机的时候，没有把集群的VDC虚拟机放到启动列表里面。
导致，一直没有把VDC开机拉起。
改动说明：
对集群的VDC虚拟机进行特殊处理，在代码中放到$resList列表里。提供给startall接口使用
自测：
环境：
4.8.00_B
build 2016-02-15 11:02:57
步骤：
1. 新建一台集群的VDC虚拟机，指定运行位置为从节点，并且把虚拟机设置为开机自启动
2. 保证当前主机的资源可以启动这台虚拟机，重启主机
3. 重启主机之后，虚拟机可以开机自启动。
........
reviewid: 16110
review by fxw
Bug id: 34828
问题分析：TD34828,【HA】【优化】HA对于磁盘加密的虚拟机，在后台打印日志说明，方便定位问题
问题出现的根源：
磁盘加密的虚拟机，在需要HA拉起的时候，没有拉起，也没有任何说明。
导致不知道为什么这个虚拟机没有被拉起，还有后台看虚拟机的状态文件发现会有异常
改动说明：
在后台日志中打印说明这个虚拟机为什么没有被拉起，修改虚拟机的电源状态文件，让其正常。
自测：
环境：
4.8.00_B
build 2016-02-15 11:02:57
步骤：
1. 新建一台虚拟机，后台修改配置文件，让其磁盘是加密的。
2. 后台修改电源文件，把虚拟机的电源置为on，cnt=0
3. tail -f sfvt_vtprgm.log可以看到日志打印出来说明这个虚拟机已经被加密了，不会拉起，并且把电源状态设置为off
4. 后台查看这个虚拟机的电源状态为off
........
noreview
更新qxl version为V16
........
reviewid : 16117
bug id : 34813
reviewed by : lcy
问题描述: vmp控制台重置虚拟机调用了03restart.pl这个脚本，该脚本在虚拟机内部重启的时候调用，导致多打了一个日志
改动说明: 虚拟机重启时如果失败才打印日志，成功就不打了
测试场景: 普通虚拟机和HA虚拟机重置电源，查看是否多打了日志
........
reviewid: 16120
review by: fxw
Bug id：34840
问题分析：
xp系统的磁盘注册表项与磁盘大小相关，需要host机将个人盘的大小信息传递给guest机

改动说明：
找到派生虚拟机第一块不含backing_file的磁盘大小，通过cpuid来传递给guest机

自测：
派生一台带个人盘的虚拟机，使用cpuid工具发送cpuid（ebx填0x100b），host机返回的个人盘大小
位于ecx和edx两个寄存器，磁盘大小正确。
........
noreview TD34648 上库源代码
........
noreview TD34648 上库根据util-linux编译出的lsblk
........
reviewid : 16138
bug id : 34852
reviewed by : lcy
问题描述 : 【迁移】虚拟机冷迁移运行位置，迁移页面显示的运行位置有问题
改动说明 : 虚拟机如果在运行才返回虚拟机的运行位置，另外如果虚拟机运行位置为自动选择且没运行过，运行位置设置为自动选择
测试场景 : 虚拟机刚创建且运行位置选择为自动选择
........
noreview
qxl 的revesion改了，ID也需要改
........
noreview
更新qxl id
........
noreview
更新说明
........
reviewid: 16141
review by: hyq
Bug id：34785
问题分析：
备份恢复的存储如果是local，其存储id会带hostid前缀（形如hostid_local），之前的编码没有处理好，
导致拷贝镜像时路径出错。

改动说明：
在组装路径时，将hostid_local替换成local

自测：
1.在A主机的local上准备几个含有预加载个人盘的模板虚拟机，将这些虚拟机备份到B主机的local上
2.恢复到原位置——pass
3.恢复到备份位置——pass
4.恢复到指定存储——pass

虚拟机位于共享存储S1，备份到共享存储S2
5.恢复到原位置——pass
6.恢复到备份位置——pass
7.恢复到指定位置（某主机local）——pass
........
reviewid: 16142
review by: hyq
Bug id：34822
问题分析：
模板转换成虚拟机，如果模板打过快照，快照中会残留personal_disk_loaded字段

改动说明：
去掉快照中会残留personal_disk_loaded字段

自测：
1.新建虚拟机，转换成模板，打快照。模板配置和快照配置中含有personal_disk_loaded
字段；
2.转换成虚拟机，检查配置，配置中（包括快照）没有personal_disk_loaded字段残留；
........
[no review]VDI4.8代码合入，来自svn://200.200.0.40/ssl/dev/Trunk/Personal-Directory/VDI4.8/spice-0.12.5
........
reviewid : 16163
bug id : 34663
问题描述 : td34663:[虚拟机]重置电源直接打印成功，不管有没有重置成功
改动说明 : 重置失败是vtpvm命令里检测到时虚拟机重置则打印日志
测试场景 : 通过修改代码抛出异常测试
........
reviewid: 16162
review by: hyq
Bug id：34840
问题分析：
第一块不含backing_file的块设备有可能是cdrom，需要将其过滤掉

改动说明：
找到派生虚拟机第一块不含backing_file的磁盘大小，通过cpuid来传递给guest机;
过滤掉光驱

自测：
派生一台带个人盘的虚拟机，使用cpuid工具发送cpuid（ebx填0x100b），host机返回的个人盘大小
位于ecx和edx两个寄存器，磁盘大小正确。
........
noreview
新的lsblk输出跟老的不一致，先回滚
........
noreview
SSL要修改usbredir-0.6，先上库原始代码，从以下压缩包解压得到
svn://200.200.0.10/vt/vt/VTP/VMP4.7/Trunk/source/packages/usbredir-0.6.tar.bz2
........
noreview
何入SSL usb映射加速优化
........
noreview 将更改的usbredir-0.6压缩更新
........
noreview
合入入SSL usb映射加速优化，漏了新增文件
........
reviewid: 16171
review by: fxw
Bug id：34840
问题分析：
xp系统还需要个人盘MBR扇区的签名信息

改动说明：
找到派生虚拟机个人盘的第一个扇区，从偏移0x1b8处开始读4个字节（签名信息），通过cpuid来传递给guest机;

自测：
派生一台带个人盘的虚拟机，使用cpuid工具发送cpuid（ebx填0x100c），host机返回的签名信息位于ecx寄存器。
........
noreview 修改依赖的头文件
........
noreview 防止configure没有执行权限
........
noreview usbredir的configure没有执行权限，更新下
........
noreview
更新spice库
........
noreview
添加可执行权限
........
noreview
碰到个坑，注释一下
........
reviewid : 16172
bug id : 34889
问题描述 :【需求】新建虚拟机获取存储信息列表存储如果存储掉线返回的信息存储总量默认置0
改动说明 : 在初始化返回信息结构中加上 total =&gt; 0 字段
测试场景 : 环境中存在掉线存储，后台运行vtpsh  get /vtpstorage/storagetree命令
掉线存储信息存在 total: 0 字段
........
reviewid: 16176
bug id : 34157
问题描述:vdc调用的api vtpsh get /cluster/vmtree 获取的分组接了主机ID导致下发的时候错误
改动说明:把vmgroup主机ID后缀去掉，建议后面vdc把接口换掉
测试场景:按bug回归步骤测试
1、选择10台及以上主机，使用VDC派生虚拟机
2、选择一个分组（非默认）分组，派生虚拟机
........
reviewid: 16180
review by: hyq
Bug id：34874
问题分析：
迁移派生虚拟机到无基镜像的存储，template目录下个人盘未同步拷贝过去。

改动说明：
迁移派生虚拟机到无基镜像的存储，将template目录下个人盘也同步拷贝过去

自测：
用带个人盘的模板虚拟机在存储S1上部署一台虚拟机VM，将VM迁移到未部署过虚拟机的存储S2上，
查看存储S2的template目录下是否存在个人盘——存在
........
reviewid: 16181
bug id : 34887
问题描述: 部分日志文件名过长导致备份失败（sffs文件系统不支持过长的文件名）
改动说明: 去掉文件拷贝的中间流程，直接压缩，也可以节省备份时间
测试场景: 使用带vs存储的环境备份成功
........
reviewid: 16184
Bug id: 34795
问题分析:
检测主机是否符合启动条件的地方，耗时太长。
改动说明:
为cacher添加单实例。

自测: 单实例OK。
........

........
Merged revision(s) 251081 from VTP/aSV4.6/VMP4.7:
reviewid: 16189
Bug id: 34816 
问题分析:
vtp-datareport-server COREDUMP，原因是出在进程重启的时候，监听线程为退出，而其他线程已经退出，导致依赖free的资源。
改动说明:
如果设置了listen_status为0，则退出监听线程。

自测: 未在大集群环境中测试，打包后测试。
........

........
Merged revision(s) 251114 from VTP/aSV4.6/VMP4.7:
reviewid: 16196
Bug id: 34795
问题分析:
检测主机是否符合启动条件的地方，耗时太长。
改动说明:
为cacher添加自动启动项。

自测: 打包测试。
........

........
Merged revision(s) 251142 from VTP/aSV4.6/VMP4.7:
reviewid: 16200
Bug id: 34863
问题分析:
vtpalert误判，KILL掉虚拟机。
改动说明:
将误判点disk io获取的值做下空值判断

自测: 在229测试通过。
........

........
Merged revision(s) 251180 from VTP/aSV4.6/VMP4.7:
reviewid 16185
Reviewed by: gwl
BUG ID: TD34795
问题分析：
节点算分考虑系统负载和增加获取网卡状态接口。
改动说明：
节点算分考虑系统负载和增加获取网卡状态接口，改动如下：
1、计算节点score时 需额外考虑系统当前的负载；
2、增加获取网卡状态接口。
测试：
1、执行过单元测试；
2、大规模集群没测试过。
........

........
Merged revision(s) 251182 from VTP/aSV4.6/VMP4.7:
reviewid 16186
Reviewed by: gwl
BUG ID: TD34795
问题分析：
优化虚拟机开机时间消耗，增加主机cpu、mem、网卡状态和系统负载缓存。
改动说明：
增加主机cpu、mem、网卡状态和系统负载缓存，改动如下：
1、缓存主机cpu和mem配置；
2、缓存网卡状态；
3、缓存系统负载。
测试：
1、执行过单元测试；
2、大规模集群没测试过。
........

........
Merged revision(s) 251186 from VTP/aSV4.6/VMP4.7:
reviewid: 16216
Bug id: TD34795
问题分析：优化开机启动慢问题，增加缓存机制。
改动说明：
同步后面修改代码以屏蔽内部错误，改动如下：
1、同步缓存cpu改动代码，去掉无用代码；
2、修正缓存硬件配置交换内存引用错误；
3、统一风格。

测试：
1、已执行过单元测试。
........

........
Merged revision(s) 251199 from VTP/aSV4.6/VMP4.7:
reviewid: 16217
Bug id: TD34795
问题分析：优化开机启动慢问题，即优化check_net_ok接口实现。
改动说明：
优化check_net_ok接口实现，改动如下：
1、改掉通过ipc机制获取节点网口状态信息机制，改为通过缓存机制获取节点网口状态信息。

测试：
1、已执行过单元测试。
........

........
Merged revision(s) 251201 from VTP/aSV4.6/VMP4.7:
reviewid: 16224
Bug id: 34628
问题分析:
解决启动虚拟机load_config性能消耗问题
改动说明:
将需要的memory和schedopt字段放到vmlist中

自测: 在229测试通过。
........

........
Merged revision(s) 251222-251226 from VTP/aSV4.6/VMP4.7:
reviewid: 16231
Bug id: 34628
问题分析:
让cacher有时间统计
改动说明:
加入时间统计

自测: 在229测试通过。
........
reviewid: 16231
Bug id: 34628
问题分析:
让cacher有时间统计
改动说明:
加入时间统计

自测: 在229测试通过。
........

........
reviewid: 16200
Bug id: 34863
问题分析:
vtpalert误判，KILL掉虚拟机。
改动说明:
将误判点disk io获取的值做下空值判断

自测: 在229测试通过。
........
Merged revision(s) 252404 from VTP/aSV4.6/aSV4.2_SDDC:
noreview aSV4.2 SDDC Beta20
........
回滚代码，不做cache
........
Merged revision(s) 251233 from VTP/aSV4.6/VMP4.7:
reviewid: 16233
Bug id: 34628
问题分析:
开机时资源调度不合理
改动说明:
①优化了内存计算
②优化了获取最优节点的时间
④修改虚拟机状态，实时反馈开机情况，以让启动虚拟机计算节点负载能更准确。

自测: 
函数单元测试功能，及单台虚拟机启动时间计算，内存计算与老算法对比效果均自测通过。
........

........
Merged revision(s) 250578 from VTP/aSV4.6/VMP4.7:
reviewid: 16074
Bug id: 34795
问题分析:
检测主机是否符合启动条件的地方，耗时太长。
改动说明:
远程的http get调用，修改为每台主机获取数据存放到数据库，然后主控从数据库获取数据，绕过http get

自测: 100多s，可以优化到1s
........

........
Merged revision(s) 251258 from VTP/aSV4.6/VMP4.7:
reviewid: 16234
Bug id: 34628
问题分析:
给redis server加上密码校验
改动说明:
加入密码认证，23位

自测：在229测试通过
........

........
Merged revision(s) 251259 from VTP/aSV4.6/VMP4.7:
reviewid: 16235
Bug id: 34628
问题分析:
控制台禁用问题，顺便修改一下rget的调用方式
改动说明:
........

........
Merged revision(s) 251272 from VTP/aSV4.6/VMP4.7:
reviewid: 16231
Bug id: 34628
问题分析:
让cacher有单实例
改动说明:
漏掉MAKEFILE

自测: 无。
........

........
Merged revision(s) 251310-251540 from VTP/aSV4.6/VMP4.7:
reviewid: 16245
Bug id: 34941
问题分析:
获取任务状态的代码不健壮，Tools.pm中upid_read_status函数读取任务状态文件设定1024字节缓冲区，在大集群不行。大集群错误信息可能超过1024字节

改动说明:
改为限制8K，并且按照文件实际大小设置缓冲区。

自测: 在229测试通过。
........
reviewid: 16248
Bug id: 34628
问题分析:
cacher里去掉了loadscore，可能上库的时候不小心抹掉了代码，加回来

改动说明:
修改load_config获取vm的memory为读取vmlist

自测: 在229测试通过。
........
noreview:
BUG ID: 34910
bug34910【老功能】主控，强制把从节点设置为主控需要修改提示信息

问题分析：
体验文案修改

改动说明：
修改非主控页面提示，及确认切换主控的效果

做了哪些测试：
jshint ok
自测 ok

........
no review
个人盘预加载设计文档
........
[no review]VDI4.8代码合入，来自svn://200.200.0.40/ssl/dev/Trunk/Personal-Directory/VDI4.8/spice-0.12.5
........
reviewid: 16234
Bug id: 34628
问题分析:
给redis server加上密码校验
改动说明:
加入密码认证，23位

自测：在229测试通过
........
noreview
代码更新，相应更新库
........
noreview
更新VDC镜像
........
reviewid: 16255
review by fxw
Bug id: 34878
问题分析：TD34878,【SSL研发办公环境】adesk无法连接虚拟机，影响业务，sangfor_waf连接超过限制
问题出现的根源：
waf连接满了，其他的连接请求直接被丢弃了。
改动说明：
规避方法，后台一个定时脚本在执行，每分钟检测一次，只要发现waf连接不上了，就会自动重启waf
自测：
版本：
4.8.00_B
build 2016-02-15 11:02:57
自测通过。
........
reviewid: 16254
Bug id: 34768
问题分析:
遇到个奇葩问题：
my $ha = {
   a =&gt; 0,
   b =&gt; 1,
};

print "$ha-&gt;{a}"."\n"; #注意这行代码

my $js = to_json($ha);
print "$js"."\n";

A.如果加了上边有注释的那行代码，输出结果是：{"a":"0","b":1}
B.如果不加上边有注释的那行代码，输出结果是：{"a": 0 ,"b":1}
C.如果在加了注释的代码后，再执行$ha-&gt;{a} = int($ha-&gt;{a}); 输出结果同B


类似这种代码，就改变了hash里面的变量属性，导致前台得到字符串，而不是整数

而这个问题引发是由于在Rest.pm里面加了cache，缓存数据时，引用了hash信息
导致结果转换成了字符串。


另外vtpdaemon有多个进程，每个进程的cache是单独的，改为共享cache也
一起解决了控制台禁用问题。
改动说明:
共享用redis解决
........
reviewid 16261
bug id 34950
review by lifan
问题分析：
更改iptables的规则，如果被清空，默认将连接都放开，防止异常的时候出问题
测试：
1./sf/etc/init.d/fw.sh stop
2./sf/etc/init.d/pmxcfs restart
前台访问不会卡
........
noreview
更新VDC镜像
........
noreview
提交文档
........
reviewid: 16276
Bug id: 34628
问题分析:
修改redis后，有的cache还是存本机
改动说明:
之前改动将其存主控了

自测：上库后打包验证
........
[no review] 【上库原因】填SPICE_MSG_WAIT_FOR_CHANNELS消息时，传输参数错误，导致x86盒子双屏使用崩溃
........
reviewid: 16279
Bug id: 34628
问题分析:
启动虚拟机，资源分配不均

改动说明: 增加新的分值权重：考虑主机内存、虚拟机内存、主机内存占用率，剩余内存等影响因素，调整计算负载值的公式。

自测：自测分析数据通过
........
reviewid: 16280
Bug id: 34628
问题分析:
解决启动虚拟机load_config性能消耗问题
改动说明:
增加cores字段

自测: 上库测试。
........

........
reviewid : 16449
bug id : 35113
问题描述 : 这个问题vs已经确认，改客户环境打了还原模式虚拟机重新建镜像的补丁包，
还原模式虚拟机在启动过程中删除掉原有的镜像，再重新建一个新的。启动过程中比较慢，
HA检测到虚拟机电源状态异常在另外一台主机拉起，又把虚拟机镜像删除，导致原来的虚拟机进程卡住
改动说明 : 1、在虚拟机删除原有镜像的流程中对镜像加锁，如果镜像被锁住那么说明镜像正被使用，退出开机流程。
2、在HA流程里加个虚拟机正在开机的状态判断，如果虚拟机状态为starting，则不把虚拟机设置为异常状态
3、把旧镜像先删除再把新镜像命名为旧镜像的名称（虚拟存储镜像mv操作覆盖镜像会导致存储空间泄露）
测试场景 : 启动虚拟机，复制改虚拟机的qemu启动命令在另外一台主机执行，启动失败。

........
</msg>
</logentry>
<logentry
   revision="252655">
<author>gwl</author>
<date>2016-03-10T09:40:14.090931Z</date>
<msg>加可执行权限</msg>
</logentry>
<logentry
   revision="252653">
<author>gwl</author>
<date>2016-03-10T09:39:09.269055Z</date>
<msg>不应该这样退出，内核一般都是解压了的</msg>
</logentry>
<logentry
   revision="252648">
<author>gwl</author>
<date>2016-03-10T09:11:09.939661Z</date>
<msg>修改版本号</msg>
</logentry>
<logentry
   revision="252639">
<author>gwl</author>
<date>2016-03-10T08:20:15.482349Z</date>
<msg>Merged revision(s) 249387 from VTP/aSV4.6/VMP4.7_B:
reviewid: 15785
bugid:
问题分析：修正内核路径
........
</msg>
</logentry>
<logentry
   revision="252618">
<author>gwl</author>
<date>2016-03-10T07:32:58.710293Z</date>
<msg>用最新的VMP4.8的代码，已经合入了所有的</msg>
</logentry>
<logentry
   revision="252616">
<author>gwl</author>
<date>2016-03-10T07:28:33.846190Z</date>
<msg>Merged revision(s) 251577-252462 from VTP/aSV4.6/VMP4.7:
reviewid: 16276
Bug id: 34628
问题分析:
修改redis后，有的cache还是存本机
改动说明:
之前改动将其存主控了

自测：上库后打包验证
........
reviewid: 16276
Bug id: 34628
问题分析:
修改redis后，有的cache还是存本机
改动说明:
之前改动将其存主控了

自测：上库后打包验证
........
reviewid: 16276
Bug id: 34628
问题分析:
修改redis后，有的cache还是存本机
改动说明:
之前改动将其存主控了

自测：上库后打包验证
........
noreview
Bug id: 34628
问题分析:
资源调度和HA问题修改，打包看效果，如果正常，需要去掉部分日志
改动说明:
........
noreview
Bug id: 34628
问题分析:
虚拟机开机失败
改动说明:
........
reviewid: 15565
bug id: 34979
问题描述: 使用集群锁会导致cluvmadm进程成为僵尸进程，之前已经回滚，现在把锁改为本地锁
改动说明: 把锁改为本地锁
自测场景: 测试在用户环境上测试通过的，在沧州一中的学生机集群上测试。
在vdc上一次启动两百台虚拟机，在10分钟内全部启动成功，没有启动，失败案例，测试次数3次。
........
noreview
更新vs包
........
[no review]【上库原因】新的客户端连接时，需要把消息序列号清零，为了和x86客户端同步
........
noreview: debug
........
noreview: debug
........
noreview
更新vs包
........
reviewid: 16303
Bug id: 34814
问题分析:
core-in imuxsock 出core，当集群节点掉线或网络不正常时，会导致解析集群列表过程中解析不到节点的IP字段，特别是集群规模较大时 执行节点间会导致大量日志信息。
改动说明:
注释掉 打日志操作，这些日志信息可有可无。

自测: 编译通过。
........
noreview
关掉调试日志
........
reviewid: 16305
Bug id: 34486
问题分析:
在AMD的设备上安装aSV，查看实体机，显示异常；问题原因是cpu model的模式匹配出错所致，并非所有cpu model都是期望中的模式。
改动说明:
1、因已不再使用其中CPU频率域，去掉模式中CPU频率 域匹配。

自测: 单元测试和原环境测试通过。
........
大规模集群优化版本基本完成VMP集群优化，需要将优化项合入到最新的VMP版本中
SVN:251678
........
reviewid: 16322
Bug id: 34980
问题分析:
改动说明:

原bug描述的情况，需要再重现看现场，也有可能是cache引起的。
未发现当时的一些错误信息。


经过阅读代码，发现若干状态相关的bug：
1.启动虚拟机的流程里，对于集群虚拟机，任务排队的锁的代码位置不对
参数以upid传入，而实际应该是log_id，导致其对错误的log_id加锁

2.cluvmadm调用vtpvm时，获取返回值不合理，其要求必须出现错误和exit 退出码
而实际又只把退出码错误错误识别标志，忽略了错误信息。
经过验证，无论vtpvm如果执行，只能通过die让cluvmadm获取到错误信息，
而直接die的话，只有一个11退出码，以及错误信息，不能反馈真正的错误。
修改cluvmadm的标志。

3.对同一个虚拟机并发执行多条开机请求时，可能会卡在任务排队锁那里，修改了
排队锁位置，降低了事件概率，待写并发测试脚本来测试

自测: 自测通过。
........
reviewid: 16322
Bug id: 34980
问题分析:
改动说明:
去掉一条错误日志
自测: 
........
reviewid: 16336
Bug id: 34628
问题分析:
优化其他模块链接redis部分代码
改动说明:
加了新函数，变量不混合

自测：Cacher和vtpqueue验证过，其他未验证
........
reviewid : 16341
bug id : 35018
问题描述 : 是个同步的api，要代理到每个主机上重启服务,返回超时
改动说明 : 把api改为异步任务，加上进度条，修改不规范的执行shell命令为run_command
测试场景 : 在大集群中测试通过.
........
reviewid : 16339
bug id : 34988
问题描述 : 1、优化批量部署虚拟机的速度。2、大集群环境升级了vdc最新包，没有合入vmp配合vdc的改动
改动说明 : 新建一台虚拟机api同步执行流程放到异步流程里去，睡眠时间改小，实时更新虚拟机新建状态改为没20台更新一次。2把vmp配合vdc的改动合入
测试场景 : 在vmp上一次部署100台虚拟机,时间大概在3-4分钟。一次部署400台，时间大概22分钟。
........
noreview
Bug id: 34628
问题分析:
修改开机优化时，计算单个主机的运行虚拟机数目时，逻辑错误，修改下
改动说明:
........
noreview
Bug id: 34628
问题分析:
修改开机优化时，计算单个主机的运行虚拟机数目时，逻辑错误，修改下
改动说明:
........
reviewid:16377
bug id:35045
问题描述:执行sysprep之后，系统会进行重置，由于viostor服务中的ImagePath注册表项缺失导致系统蓝屏
改动说明:在安装fastio磁盘时先用inf进行预安装
测试场景:在win7 x86环境中全新安装vmtools之后，运行sysprep，系统重启之后不蓝屏
........
noreview
Bug id: 
问题分析:
模板部署的修改有问题，升级后vdc部署一直无状态
改动说明:
........
reviewid: 16336
Bug id: 34628
问题分析:
优化其他模块链接redis部分代码
改动说明:
加了新函数，变量不混合

自测：Cacher和vtpqueue验证过，其他未验证
........
reviewid : 16395
bug id ; 35069
问题描述: 操作日志流程：log_with_task, 调用oplogclient.pm的call
从而写入日志信息到redis（当前节点），再由vtpqueued循环读取redis缓存的日志
发起请求道vtplogd，再由vtplogd写入sqlite

而主机48个，操作13条并发时，整个流程，在vtplogd请求过多，导致
后来的请求直接status 500了（请求是http的）

经过分析代码和验证，以及结合redis官方测试数据，
将网络连接的压力分给redis，redis是tcp连接，所以不会每条日志都发出请求，
具体操作如下：每个节点写日志时，把日志信息发送给主控的redis（之前是当前节点的）
再由主控的vtpqueued读取redis，写给vtplogd，介绍了跨主机连接

而在使用本主机连接请求时，不会出现status 500错误，最多就是延时超时（可能是
perl的HTTP模块本身有防攻击，具体原因暂不追寻）。

经过验证，redis和请求均正确。
改动说明:
自测:自测通过
........
reviewid : 16397
bug id : 35049
问题描述 : 开机备份时，会创建一个task去发送cont命令给虚拟机，而虚拟机由于bug，一直没响应，导致task备份一次产生一条
           从而使得task超过队列限制，后来的备份就会陷入“排队中”。
改动说明 : 判断是否已经存在task，存在的话就不创建
测试场景 : 自测通过，未测试具体备份逻辑。测试代码如下：
#!/usr/bin/perl
use strict;
use warnings;

use VTP::Task;
use Data::Dumper;
use VTP::RPCEnvironment;
VTP::INotify::inotify_init();
use VTP::QemuServer;

my $rpcenv = VTP::RPCEnvironment-&gt;init('cli');

sub test {
     my $vmid = shift;
     if (VTP::QemuServer::check_task_exist($vmid, 'snapshot_create_qmp_cont')) {
         print "exist\n"; 
     }
}

sub make_task {
     my $vmid  = shift;
     my $rpcenv = VTP::RPCEnvironment::get();
     my $code = sub {
         sleep(100000);
     };
     $rpcenv-&gt;fork_worker( 'snapshot_create_qmp_cont', $vmid, 'vmp', $code );
}


sub check_task {
     my $vmid  = shift;
     my $task = VTP::Task::get_tasks();
     #print Dumper($task)."\n";
     foreach my $t (@$task) {
         next if $t-&gt;{type} ne 'snapshot_create_qmp_cont';
         next if $t-&gt;{id} ne $vmid;
         print "detected a task ". $t-&gt;{upid}."\n";
         return 1;
     }
     return 0;
}


my $op = shift;
my $vmid = shift;
make_task($vmid) if $op eq 'mk';
check_task($vmid) if $op eq 'ck';
test($vmid) if $op eq 'ck2';
........
noreview
说明：
更新AMD虚拟化方案验证测试 进度。
........
noreview
说明：
更新AMD虚拟化方案验证测试 进度。
........
reviewid: 16416
review by gwl
Bug id: 34937
问题分析：TD34937,【VMP】【aSV】大集群环境升级，有任务在运行时开启维护模式，报错信息看不懂
问题出现的根源：
任务名字设置为英文，在翻译文件中没有把英文翻译为中文。
改动说明：
把英文对应的中文翻译加进去。
自测：
版本：
4.8.00_B
build 2016-03-05 21:59:52
自测通过。
........
noreview 
修正代码格式
........
Revision: 249360
Author: panchao
Date: 2016年1月19日 11:02:33
Message:
reviewid: 16424
bugid：34023
问题分析：
改动说明：增加开关限制，可以touch /cfs/log_stack.switch来开启API错误堆栈日志


Modified : /VTP/aSV4.6/VMP4.7/source/app/vtp-common/Exception.pm
........
Merged revision(s) 249370 from VTP/aSV4.6/VMP4.7:
reviewid: 15780
  Bug id: 34202
  问题分析:vs添加的一块代码位于添加主机锁的外面，导致添加任务并发；导致批量添加失败；
  改动说明:修改代码，将代码加入锁的内部
  自测:
  1.修改代码，将代码加入锁的内部;
  2.登录前台，批量添加主机（添加了15台），等待结果，通过；
  环境：
  4.6.01
  build 2015-12-05 23:05:39
........

........
Merged revision(s) 249373 from VTP/aSV4.6/VMP4.7:
reviewid: 15781
Bug id: 34261
问题分析: 添加主机时，重启了被添加主机的集群服务，在等待集群稳定时，超时导致添加主机失败。
改动说明: 大集群，48台主机，需要的集群稳定时间更长，60s左右，改为5min超时。
自测: 大集群环境，vtpcm restart，原来的60s就会出现该问题。
改为5min，不出现问题
........

........
Merged revision(s) 249384 from VTP/aSV4.6/VMP4.7:
reviewid: 15784
Bug id: 34392
问题分析: vs bonding限制了arp_target 16个，导致组建vs链路聚合时，添加到聚合口失败
改动说明: 修改限制为64，考虑大了可能有影响，集群支持48台主机，64够用
自测: 上库打包验证
........

........
Merged revision(s) 249414 from VTP/aSV4.6/VMP4.7:
reviewid: 15791
bugid：
问题分析：解决VMP版本的性能优化问题
自测：通过
........

........
Merged revision(s) 249570 from VTP/aSV4.6/VMP4.7:
reviewid: 15833
bugid：34615
问题分析：当run_command()调用shell脚本、可执行文件返回值为1时，视为错误，输入日志；
改动说明：修改对run_command()的参数，将命令执行后退出码与指定忽略的退出码比较；
环境：
4.8.00_B
build 2016-01-19 22:18:16
自测通过
........

........
Merged revision(s) 249749 from VTP/aSV4.6/VMP4.7:
reviewid: 15883
bugid：34659
问题分析：日志是由unlink函数返回值正常时，发出的提示信息日志，属于正常范畴；
改动说明：刷新频繁，删除掉；
环境：
4.8.00_B
build 2016-01-19 22:18:16
........

........
noreview aSV4.2 SDDC Beta20
........
reviewid: 16434 
Bug id: 35108
问题分析:
一些无关紧要的风格类问题集合
改动说明:
修改了日志，防止错误日志出现

自测：无
........
Merged revision(s) 247761 from VTP/aSV4.6/ASV4.6:
性能优化
........

........
Merged revision(s) 247964-250274 from VTP/aSV4.6/ASV4.6:
noreview
bugid:34220
改动说明：
合入SDDC修改，针对linux系统关闭sse4.1指令集
测试：
无
........
reviewid: 15338
Bug id: 
问题分析: 正版激活问题
改动说明: 去掉uuid
自测: 未自测
........
reviewid :15342
bug id :34157
问题分析：
1、vmp3.0目录变成分组，每个节点都有相同的目录，vdc调用老接口get_vmtree，其中为了避免返回重复的目录id为其做处理：返回给vdc:每个目录id+主机编号；
2、从而vdc下发的$dirid是通过处理的，为了获取真正的目录id，vmp需要去除掉dirid后面的主机编号3、VTP::QemuServer::get_real_dirid中会对$dirid做处理，但是处理的方式为：使用chop去除$dirid最后一位，然而当主机数量大于等于10台后，主机编号将会变为两位数，此时只去除最后一位将导致得到的$dirid还是错误的，此时就会找不到相应分组的目录，报错
改动说明：
修改了VTP::QemuServer::get_real_dirid，将其中通过去除$dirid最后一位得到目录id的方式修改为:通过获取目前的所有分组id再查找这些分组id中是$dirid前缀的$id，此时就是真正的目录id
自测：
环境： 172.28.162.91 admin/admin123.
1、未修改时， 调用接口 create /cluster/qemu/{templateid}/{node}/derive_one 传递参数dir:目录id+主机编号，编号一位时，得到正确的目录id；编号两位，得到错误的目录id,报错：新建虚拟机失败！错误信息：新建虚拟机失败！错误信息：打开文件夹（1db7721482f8012）失败！
2、修改过后，调用接口 create /cluster/qemu/{templateid}/{node}/derive_one 传递参数dir:目录id+主机编号，编号一位或两位均得到正确的目录id;成功创建虚拟机
........
reviewid :15246
bug id :33535
问题分析： 
ssl用vmid取代uuid则虚拟机启动参数不需要uuid参数，注释相应代码
改动说明：
修改VTP::QemuServer.pm中的vm_start函数，注释掉其中启动需要传递uuid参数的代码
自测：
环境：200.200.101.164 admin123
1、启动虚拟机
2、后台运行ps auxf | grep kvm 看到相应启动参数
3、ps auxf | grep kvm | grep uuid --color=auto查看启动参数中没有uuid参数
........
reviewid :15363
bug id :34029
问题分析：
主机离线，存储异常，导致写入配置文件时重命名文件失败
而在前台报错：重命名（/sf/data/vs_rep2/export_vm//.process_5051858246702.txt) 失败!错误信息：Transport endpoint is not connected
改动说明：
修改VTP::VAPI::Tools::write_ini_conf中的报错信息，将前台报错修改为：写入配置文件失败！存储或集群主机异常，请检查相应配置是否正确
而相应的重命名失败及其原因写入日志中
自测：
环境：200.200.101.164
1、将一台主机（从节点）关机
2、选择一个虚拟机导出
3、观察结果：报错为：写入配置文件失败！存储或集群主机异常，请检查相应配置是否正确
........
reviewid: 15385
review by: lcy
Bug id：34258
问题分析：
集群虚拟机的开机流程大致是VMOperate.pm=&gt;cluvmadm=&gt;vtpvm。从VDI客户端上启动虚拟机以后，VDI那边是通过
HTTP: GET /vapi/json/nodes/{node}/tasks/{upid}/status来查询开机任务的状态，这个API本质是去读
的时候会在cluvmadm中被捕获并且exit（0）;从而导致VMOperate中的API认为这次任务执行成功（因为退出码为0，但是任务实际上是失败的），
API认为任务成功，就会在UPID日志文件的最后一行写下TASK OK，最终导致查询任务状态为OK


改动说明：
将开机失败的各种异常信息一直向上层抛出，最终在VMOperate.pm中捕获并处理。

自测：
1. 开机成功前台日志正常，后台通过vtpsh get /nodes/{node}/tasks/{upid}/status查看exitstatus为OK。
2. 开机失败前台日志报错正常，后台通过vtpsh get /nodes/{node}/tasks/{upid}/status查看exitstatus和VMP前台报错一致。
........
reviewid: 15392
Bug id: 34261
问题分析: 添加主机时，重启了被添加主机的集群服务，在等待集群稳定时，超时导致添加主机失败。
改动说明: 大集群，48台主机，需要的集群稳定时间更长，60s左右，改为5min超时。
自测: 大集群环境，vtpcm restart，原来的60s就会出现该问题。
      改为5min，不出现问题
........
reviewid: 15391
Bug id: 34261
问题分析: 添加主机时，重启了被添加主机的集群服务，在等待集群稳定时，超时导致添加主机失败。
改动说明: 大集群，48台主机，需要的集群稳定时间更长，60s左右，改为5min超时。
自测: 大集群环境，vtpcm restart，原来的60s就会出现该问题。
      改为5min，不出现问题
........
reviewid: 15397
Bug id: 34267
问题分析：
1、vmp3.0目录变成分组，每个节点都有相同的目录，vdc调用老接口get_vmtree，其中为了避免返回重复的目录id为其做处理：返回给vdc:每个目录id+主机编号；
2、从而vdc下发的$dirid是通过处理的，为了获取真正的目录id，vmp需要去除掉dirid后面的主机编号
3、VTP::QemuServer::get_real_dirid中会对$dirid做处理，但是处理的方式为：使用chop去除$dirid最后一位，然而当主机数量大于等于10台后，主机编号将会变为两位数，此时只去除最后一位将导致得到的$dirid还是错误的，此时就会找不到相应分组的目录，报错
改动说明：
修改了VTP::QemuServer::get_real_dirid，将其中通过去除$dirid最后一位得到目录id的方式修改为:通过获取目前的所有分组id再查找这些分组id中是$dirid前缀的$id，此时就是真正的目录id

自测: 直接合入，未自测。
........
reviewid: 15400
Bug id: 34267
问题分析：
1、vmp3.0目录变成分组，每个节点都有相同的目录，vdc调用老接口get_vmtree，其中为了避免返回重复的目录id为其做处理：返回给vdc:每个目录id+主机编号；
2、从而vdc下发的$dirid是通过处理的，为了获取真正的目录id，vmp需要去除掉dirid后面的主机编号
3、VTP::QemuServer::get_real_dirid中会对$dirid做处理，但是处理的方式为：使用chop去除$dirid最后一位，然而当主机数量大于等于10台后，主机编号将会变为两位数，此时只去除最后一位将导致得到的$dirid还是错误的，此时就会找不到相应分组的目录，报错
改动说明：
修改了VTP::QemuServer::get_real_dirid，将其中通过去除$dirid最后一位得到目录id的方式修改为:通过获取目前的所有分组id再查找这些分组id中是$dirid前缀的$id，此时就是真正的目录id

自测: 直接合入，未自测。
........
reviewid: 15398
bugid: 34027
问题描述: 【磁盘扩容】模板扩容成功，更新到虚拟机，更新成功，但是配置文件的磁盘大小未改变。【优先】
改动说明: 在更新派生虚拟机virtio配置virtio时，增加一个更新镜像大小的功能
自测场景: 新建一台虚拟机，并部署两台派生虚拟机到不同的存储,编辑模板虚拟机的镜像大小，再更新模板，页面查看派生虚拟机的的镜像大小是否同步更新
........
noreview
248175修改有问题，会抛出很多英文异常到前台，回滚掉
........
noreview
说明：
更新amd虚拟方案的验证测试计划。
........
noreview
247125和246734修改有问题，会导致TD34051，回滚掉
........
reviewid: 15440
Bug id: 33744
问题描述: HA虚拟机只有一个网口，未插网线，开机启动失败
问题分析: 获取开启该虚拟机的主机流程里参数net_ok默认为1,即默认虚拟机网络是正常的，合入4.2bug后这里逻辑反了，又没有进入把net_ok设置为1的流程
导致获取能开启虚拟机的主机失败
改动说明: 改回原来的逻辑,net_ok初始化为1，检测有问题再设置为0
自测场景: 两台主机组成的集群，新建一台只有一个网口的HA虚拟机，网口不插网线，开启虚拟机。虚拟机能正常启动。
........
reviewid: 15448
review by: fxw
Bug id：34294
问题分析：
在linux下将磁盘镜像文件格式化成NTFS后，在windows内部使用有问题，导致磁盘分区已扩容到40G，而磁盘卷还保持原样1G。

改动说明：
用于预加载的个人盘改成在windows下经格式化好的personal_disk.qcow2

自测：
1. VDC上部署一台虚拟机A，还原模式，选择个人数据盘40G，不加密；从VDC上启动该虚拟机，磁盘正常加载，显示40G；
2. VDC上部署一台虚拟机B，还原模式，选择个人数据盘40G，加密个人盘；从VDC上启动该虚拟机，磁盘正常加载，显示40G；
3. 测试重启还原功能，正常。重启后系统盘被还原，个人盘数据在，个人盘大小仍然为40G。
........
noreview

修改升级版本号相关
........
reviewid: 15466
Bug id: 
问题分析: 
改动说明: vs新改了3个问题，给富士康用，上库
自测:
........
reviewid :15467
bug id :34256
问题分析：
QemuServer.pm中原有的设置开机bios的时间分为几种情况：存在/cfs/vmboot.int则从中读取停留时间；否则，没有该文件则判断是否有cd再设置相应bios停留时间；
然而，如果符合以前设定的为判断是否是一体机的判断VTP::Product::is_vmp_for_vs()函数，则不管之前的设置，强制不停留；可是该函数现在已经不能成为判断一体机的条件，对于现在的VMP都会满足这个条件，而导致所有的bios都被设为强制不停留，从而进入不了安全模式；
改动说明：
1、去掉判断是一体机就不停留的强制条件
2、修改如果有/cfs/vmboot.ini，就用这个文件来配置，如果没有文件判断有没有cd，如果有就menu=on,splash-time=8000，设置停留时间；
，如果没有cd就menu=off,splash-time=1，不停留 
自测：
1、修改之前，bios被设为不停留，控制台启动windows虚拟机，开机按F8进入不了安全模式
2、修改之后，控制台启动虚拟机，能看到bios停留一会，按F8能进入安全模式
........
reviewid: 15487
Bug id: 34023
问题分析: 
改动说明: 增加开关限制，可以touch /cfs/log_stack.switch来开启API错误堆栈日志
自测: 自测通过
........
noreview
上库各个任务相关资料
........
noreview
上库vs最新包
........
noreview
项目任务进度更新
........
reviewid: 15555
  Bug id: 34387
  问题分析:vminfo_list这个API，获取非常慢，原因是里面多次调用cfs_update
  改动说明:将Cluster.pm和QemuServer.pm中调用cfs_update部分去掉，由于程序入口处有调用，不需要再次调用
  自测:在测试部环境测试通过
........
reviewid:15559
review by fxw
BUG ID: 34388
合入。先合入界面逻辑部分。不包括ISO安装部分。
具体对应aSV4.2的改动。
Revision: 242451
Author: qifei
Date: 2015年11月5日 11:31:47
Message:
支持amd改动
安装过程中注释掉cpu型号，bios检测
perl中注释掉bios检测，cpu匹配主频的正则不适用于amd设备，也注释掉
----
Modified : /VTP/aSV4.2/Branchs/aSV4.2_SDDC/build/pkg/replace-root/sf/bin/vmp_install_main.sh
Modified : /VTP/aSV4.2/Branchs/aSV4.2_SDDC/src/app/vtp-common/ProcFSTools.pm
Modified : /VTP/aSV4.2/Branchs/aSV4.2_SDDC/src/app/vtp-qemu-server/VTP/QemuServer.pm
........
reviewid: 15567
Bug id: 
问题分析: 捕获API错误的时候，用了my_die，直接把所有错误当成了字符串，而实际上错误可能是hash结构
改动说明: 改为die
自测: fxw发现，并修改验证
........
reviewid 15569
bug id 34396
review by hyq
问题分析：
gwl加了调试堆栈，捕获到异常后转成了字符串，但是有些异常是hash结构。这样转化导致数据丢失，VDC获取不到数据导致bug
改动说明：
不转化，直接抛出异常
测试：
1、VDC创建虚拟机
2. VMP删除刚创建的虚拟机
3. VDC删除这个虚拟机，可以删除成功
........
noreview suntao修改：
TD: 40566
改动说明：
合入svn://200.200.0.40/ssl/other/技术支持/代码修改/VDI4.7R1/VDI4.7R1_北京智课教育_TD20180/src/vmp/source/packages/spice-0.12.5


........
reviewid: 15578
Bug id: 34392
问题分析: vs bonding限制了arp_target 16个，导致组建vs链路聚合时，添加到聚合口失败
改动说明: 修改限制为64，考虑大了可能有影响，集群支持48台主机，64够用
自测: 上库打包验证
........
reviewid :15542
bug id :34310
问题分析：
根据返回值，使用VTP::Tools::run_command的ignore_exit_code参数，去除后台打印的不必要的日志
改动说明：
QemuServer.pm 关于is_swap_ssd的错误信息，之前已根据退出码被和谐
修改VTP::Tools::get_real_mem函数，忽略返回值 1 ，屏蔽 命令"dmidecode | grep -A 16 \"Memory Device\$\" |grep Size: |grep -v \"No Module Installed\""的日志
自测：
1、修改前，后台sfvt_vtpdaemon报 Failed exec dmidecode | grep -A 16 \"Memory Device\$\" |grep Size: |grep -v \"No Module Installed\ 错误信息 ：返回值 1
相关日志；
2、修改后，返回值为1 的被屏蔽 ，不报相关错误
........
[no review]VDI4.8代码合入，来自svn://200.200.0.40/ssl/dev/Trunk/Personal-Directory/VDI4.8/spice-0.12.5
........
noreview
spice代码更新，对应更新库文件
........
Merged revision(s) 248749 from VTP/aSV4.2/Branchs/aSV4.2_SDDC_CN_EN/src:
noreview
BUGID : 34401
问题说明：原来做AMD支持的时候去掉了这个限制，现在要把它加回来
改动说明：将BIOS的VT-x检测反注释
自测说明：未实际测试，先打包再回归
........

reviewid:15582
review by fxw
bug id: 34388
打包验证。
........
reviewid: 15584
Bug id: 34392
问题分析: vs bonding限制了arp_target 16个，导致组建vs
链路聚合时，添加到聚合口失败
改动说明: 修改限制为64，考虑大了可能有影响，集群支持48台主机，64够用
自测: 上库打包验证
........
noreview：
改动说明：
bug33741，备份恢复支持配置恢复完成后自动重启。包括虚拟机详情里面的单个虚拟机恢复和管理里面的批量恢复虚拟机。
........
noreview
说明：
更新amd测试计划 已执行完的部分。
........
noreview
更新上库规范的格式
........
noreview
更新任务项
........
noreview
说明：
上传amd netperf网络性能测试结果。
........
noreview
说明：
更新amd测试计划 已执行完的部分。
........
reviewid :15593
bug id :33741
问题分析：
   虚拟机备份恢复结束后是关闭状态，对于开机状态下备份恢复后希望能够自动启动的情况进行改进
改动说明：
   在虚拟机备份恢复的选择页面，增添一个恢复后是否自动重启的勾选项，默认不勾选；如果勾选了在备份恢复结束后自动为用户开启虚拟机
自测：
1、虚拟机本地备份后，选择备份恢复，勾选备份结束后自动重启；结果：虚拟机先执行备份恢复，接着自动启动
2、虚拟机本地备份后，选择备份恢复，不勾选备份结束后自动重启；结果：虚拟机只执行备份恢复，恢复结束后处于关闭状态
3、虚拟机异地备份后，选择备份恢复，勾选备份结束后自动重启；结果：虚拟机先执行备份恢复，接着自动启动
4、虚拟机异地备份后，选择备份恢复，不勾选备份结束后自动重启；结果：虚拟机只执行备份恢复，恢复结束后处于关闭状态
5、批量备份恢复虚拟机，多个虚拟机，部分勾选恢复后自动重启，部分不勾选恢复后不自动重启；结果：勾选了的恢复后自动开机；没勾选的只恢复，结束后关闭
........
概要信息: 数据盘或缓存盘拔出格式化后重新插入，页面显示正常，应该提供一个手段恢复该磁盘[集群中磁盘拔出格式化重先插入]
BUG   ID: null
改动说明: 合入代码
测试分析:
reviewid 15596, reviewed by fxw, tyy
........
noreview：
改动说明：
bug33943，序列号没插key的提示“USB-KEY被拔出”改为“未插入USB-KEY”
........
reviewid 15595
bugid 34417
review by fxw
问题分析：
枚举类型传给uint32_t，在进行%u输出程序出core。
改动说明：
错误码强制类型转换为uint32_t。
测试：
/sf/etc/init.d/ukey_proxy restart重复多次测试/sf/data/local/dump是否会产生core。
未产生，测试ok。
........
noreview：
改动说明：
bug34014，导入虚拟机，去掉HA配置。界面当时多合了
........
noreview：
改动说明：
bug34200，新建用户和配置邮件服务器的时候，需要对密码加密。
........
noreview
更新任务项
........
reviewid :15603
bug id :34200
问题分析：
别人疏忽了，帮忙改
改动说明：
合入svn://200.200.0.10/vt/vt/VTP/aSV4.2/Branchs/aSV4.2_SDDC_CN_EN/src/  这个上库记录 245211 
VTP::VAPI::Log.pm 和 VTP::VAPI::User.pm

自测：
1、新建用户，F12查看到新建用户名的密码和确认密码均已加密；使用新添加的用户登录，能登录成功。  --pass
2、配置邮件服务器时，F12查看用户名和密码均加密了；  --pass
3、/cfs/alert.conf文件中，找到pass和user的值，是用命令pwddec xxx分别解密后，得到的值是前台配置的用户名和密码；
........
reviewid 15602
bugid 34339
review by fxw
问题分析：
该函数实现原理是先生成一个进程相关的临时文件并把数据写入该文件，写入成功后，还会把文件的内容读出来和传入的数据内容做对比，如果对比不一致就会失败。这个时候，没有删除临时文件。当传入的字符包含宽字符是就会失败，而没有清理临时文件。
改动说明：
数据内容对比失败，删除临时文件。
测试：
环境72.28.162.91【更换验证环境找我确认】
1、执行附件中的pl.pl脚本
2、/sf目录下不存在sf/data.json*文件
........
reviewid :15601
bug id :34342
问题分析：
1、对于密码策略是根据读取当前主控的超过时间设定是建议修改还是强制修改
2、对于不同主控，呈现的密码策略就会不同，有的可能是建议修改，有的就会使强制修改
改动说明：
1、修改密码策略：
对于集群只要检测到是默认密码就强制修改，不论主控是谁；
对于单机，按照原本密码策略，根据超过时间，选择是建议修改还是强制修改

自测：
1、环境：172.28.51.106 密码为默认密码的集群，登陆，显示强制修改密码
2、环境：172.28.162.91 密码不是默认密码的集群，登陆，不显示强制修改密码
3、环境：172.28.51.3 密码为默认密码 且超过15天的单机，登陆，显示强制修改密码
4、环境：200.200.101.92 密码为默认密码 没超过15天的单机，登陆，显示建议修改密码
........
noreview：
改动说明：
bug34428，解决部分IE11打不开页面控制台
........
reviewid: 15608
review by: hyq
Bug id：34370 34298 34264 34404 
问题分析：
1. 虚拟机转换成模板时，启动虚拟机失败导致模板转换失败，没有回滚、清理环境；
2. 个人盘预加载的代码流程中没有检测关闭虚拟机的任务进度，导致直接通过普通虚拟机部署时部署失败；
3. 模板更新，旧模板更新时需要默认预加载一次个人盘；
4. 预加载个人盘开机前修改磁盘配置时，新增的个人盘字段写死了ide1

改动说明：
1. 虚拟机转换成模板时，启动虚拟机失败导致模板转换失败，将配置回滚、环境清理，使虚拟机恢复到原来状态；
2. 个人盘预加载的代码流程中检测关闭虚拟机的任务进度；
3. 对于旧模板，即模板image目录下不含个人盘personal_disk.qcow2，在其更新的时候，会走一次预加载个人盘流程，
流程结束以后，其image目录下将包含个人盘personal_disk.qcow2；
4. 模板部署代码重构，只要模板虚拟机A的image目录下存在个人盘personal_disk.qcow2，那么模板所在的存储S1
和部署的目的存储S2的template目录下都会有个人盘personal_disk.qcow2，这一点有部署流程保证，这里S1、S2
相等就代表部署到同存储，不等则表示跨存储部署；
5. 预加载个人盘开机前修改磁盘配置时，新增的个人盘字段从ide0-ide3中选出未被使用的一个。

自测：
1. 新建一台普通虚拟机，构造开机失败的场景，转换成模板，转换失败，虚拟机的配置和环境都被回滚到了原来的状态；
2. 新建一台普通虚拟机A，直接用A部署虚拟机，部署成功；
3. 旧模板A已部署过虚拟机，但模板没有个人盘，更新模板，该模板虚拟机A执行一次预加载个人盘，A的image目录下新增个人盘；
4. 跨存储部署一台虚拟机，同存储S1和目的存储S2的template目录下均存在个人盘personal_disk.qcow2。
........
reviewid:15605
review by fxw
Bug id: 34153
问题分析：TD34153,【网口vlan配置】修改汇聚口的mac地址，修改后，子网口的mac地址不是最新的【优先】
问题出现的根源：
网桥的MAC地址没有同步。
改动说明：
同步更新一下网桥的MAC地址。
自测：
验证环境
4.8.00_B
build 2016-01-11 23:56:29
1. 配置聚合网口，配置VLAN。连接网桥，激活网桥
2. 修改MAC地址。
3. 聚合网口，网桥的MAC地址都会修改。
........
noreview：
改动说明：
bug33589,新需求，自动备份策略里面的快照限制个数改成3个到12个，默认8个
........
概要信息: gluster peer status状态为rejected，导致替换主机失败  |  增加主机替换过程中磁盘格式化进度查看和替换主机失败回退操作 | 【网上问题】brick check执行时间太长，导致页面超时，替换主机失败  
BUG   ID: vs td 30836  |   vs TD 30711   | vs TD 30837
改动说明:&lt;bug1 :配置私网之后，调用新增脚本vs_host_replace_checkpeerstatus.sh检查新进主机状态以及旧主机配对brick的状态
&lt;bug2 : 增加vs_host_replace_rollback_delnewhost函数，进行主机删除操作，且等待删除结束。增加新近主机磁盘格式化进度查看。 在1.通知格式化事件失败 2.新近主机磁盘格式化失败 3.通知替换主机任务失败 4.及查询到真正替换主机失败且新主机不在卷中。 则进行删除新进主机及相关删除操作，使得集群回到初始状态。 5.而当查询到真正替换主机失败而新进主机已参与组卷了则提示通知管理员，底层不进行任何回退操作
&lt;bug3:  将brick check过程放到后台执行。 

测试分析:
 &lt;bug1:如果检测到异常返回NO，则终止替换主机过程，进行回退
 &lt;bug2:可针对上面5种情况分别测试，前四种进行回退了，最后一种不进行回退操作
 &lt;bug3: 放到后台之后，页面较快结束，在后台执行。
reviewid 15616, reviewed by yzs
........
reviewid :15518
bug id :34086
问题分析：
1、原本添加主机时只检测了添加主机的基本版本号与要加入的集群是否一致，只要版本号一样就能添加进集群
2、对于主机A打了补丁包A，主机B没打补丁包A，主机A添加主机B组建集群的情况仍能够成功组建，但是集群中不同主机的补丁包是不一致的，会产生问题
3、需要增加检测的条件：检查基础版本号要一致，包括时间；检查主机所打补丁包、定制包都要一致；替换主机时要检查，批量添加主机也要考虑
改动说明：
修改了VTP::VAPI::Hosts::check_vtp_version 函数，再其本来只检测版本号是否一致的基础上增加检测版本时间是否一致，所打补丁包是否一致
自测：
1、添加与当前版本不一致或者时间不一致的主机，报错：远程主机（%s）和当前集群版本不一致！
2、添加与当前版本一致及时间均一致的主机，一个有打补丁，一个没打补丁，报错：远程主机（%s）和当前集群补丁包不一致！
3、添加与当前版本一致及时间均一致的主机，两个都有打补丁，补丁包不一致，报错：远程主机（%s）和当前集群补丁包不一致！
........
reviewid:15613
review by fxw
Bug id: 33788
问题分析：TD33788，【虚拟交换机】编辑虚拟机所桥接网口，任务显示成功了，实际上却编辑失败了
问题出现的根源：
编辑虚拟交换机的时候，有多少台主机就会打印多少条日志，无论编辑成功与否。
在编辑虚拟交换机的过程中，如果检查到其中一台主机的配置信息中不存在这个虚拟交换机，就会在这个主机上创建一台新的虚拟交换机。
这个时候，如果新建的过程中出错了，日志就会混乱。
改动说明：
与新建虚拟交换机同步一致一下。
编辑虚拟交换机的时候，如果是主控，无论成功与否都会打印一条日志。如果是从节点，只有在失败的时候才会打印一条日志。
如果在编辑的过程中，发现配置不存在，需要新建一台虚拟交换机，那么如果在主控新建成功，会打印一条新建的日志。如果在从节点新建成功不打日志，失败才会打印一条新建失败失败的日志。
自测：
验证环境
4.8.00_B
build 2016-01-11 23:56:29
1. 两台主机组成的集群。
2. 新建一个虚拟交换机，不连接物理网口。
3. 编辑虚拟交换机，连接两台主机的网口（保证这两个网口都还没有连接到虚拟交换机），日志打印编辑成功，只有一条，显示主机是主控的。
4. 编辑虚拟交换机，连接两台主机的网口，主控的网口还没有连接到其他的虚拟交换机，非主控的网口已经连接了虚拟交换机。这时候，日志打印两条。一条是主控编辑成功，一条是从节点编辑失败。
5. 编辑虚拟交换机，连接两台主机的网口，主控的网口已经连了另外的虚拟交换机，非主控没有连其他的。打印一条日志，只有主控失败的日志。
6. 后台修改主控的配置信息，把这个虚拟交换机删除掉。/cfs/nodes/hostid/vsw.ini.编辑虚拟交换机，连接主控已经连了其他虚拟交换机的网口。日志打印新建虚拟交换机失败。
........
reviewid: 15623
bug id: 33589
问题描述:不改UI会报错
改动说明: 最小备份个数改为3个
测试: jcy测试通过
........
noreview
说明：
更新amd测试计划 intel和amd相互热迁移的部分。
........
noreview
修正内核路径
........
reviewid: 15629
review by: hyq
Bug id：null
问题分析：
命令行字符串直接放在run_cmd函数内部不太好

改动说明：
将run_cmd命令行字符串提到run_cmd函数外部

自测：
测试了受影响的相关模块，虚拟机转换成模板、模板转换成虚拟机均正常。
........
noreview：
改动说明：
bug33943，序列号没插key，页面顶部的提示“USB-KEY被拔出”改为“未插入USB-KEY”
........
noreview
说明：
更新amd测试计划 已执行完的部分。
........
reviewid: 15638
review by: hyq
Bug id：34468
问题分析：
VMP4.8要支持4.6.02（富士康版本）升级。

改动说明：
修改了version-from文件，增加版本号4.6.02

自测：
需要打新包验证
........
noreview
上传spice要链接的开源库
http://downloads.xiph.org/releases/opus/opus-1.1.2.tar.gz
........
noreview
加入opus库重新编译
........
reviewid:15662
review by fxw
Bug id: 34494
问题分析：TD34494,【老功能】为blackbox日志增加ethtool的日志
问题出现的根源：
blackbox没有ethtool的日志
改动说明：
增加一条这样的定时日志。每隔5分钟往blackbox里面打印一条日志，文件大小上限为20M。日志文件为 LOG_ethtool.txt
自测：
验证环境
打包验证。
........
noreview：
改动说明：
bug34480，聚合口禁止改MAC地址
........
reviewid: 15646
bug id: 34277
问题描述: 模板虚拟机做了异地备份，并恢复到异地备份位置，个人盘没有拷贝到系统盘所在目录
改动说明: 判断备份位置有没有个人盘，如果有个人盘，则拷贝到模板虚拟机系统盘目录
自测场景: 
1、新建一个虚拟机到默认分组，转换为模板，再进行异地备份，最后执行恢复操作，选择恢复到备份位置
........
noreview：
改动说明：
bug33589,新需求，自动备份策略里面的快照限制个数默认最多8个改成默认最多3个
........
概要信息: 虚拟存储有主机离线，编辑虚拟机除了改名其它的要支持
BUG   ID: 30844
改动说明: 只限制改名操作
测试分析:
reviewid 15660, reviewed by lzj
........
noreview
更新vs代码
........
noreview
删除老的vs代码
........
noreview：
改动说明：
bug34465，虚拟机控制台，重启虚拟机时，不显示“正在重启”的遮罩
........
noreview：
改动说明：
bug34489，[合入VMP4.7]虚拟机的bios启动等待时间splash-time建议做成页面可配置的，以满足用户特定场景下的使用。
........
reviewid :15691
bug id :34489
问题分析：
虚拟机的bios启动等待时间splash-time非常短，而web vnc控制台的重连又很慢，导致操作系统的启动界面很多就跳过去，导致很多操作没法做。 
可能遇到如下问题：
1.grub的启动选项来不及选择
2.windows的f8来不及按
虚拟机的bios启动等待时间splash-time建议做成页面可配置的，以满足用户特定场景下的使用

改动说明：
虚拟机添加配置bios停留时间项
合入TD34471 修改 

自测：
1.新建本地（或ha）虚拟机，启动虚拟机
用命令ps auxf | grep vmid | grep splash  --color,有'menu=off,splash-time=1'，即bios菜单为关闭状态
2.编辑本地（或ha）虚拟机bios停留时间为0，启动虚拟机
用命令ps auxf | grep vmid | grep splash  --color,有'menu=off,splash-time=1'，即bios菜单为关闭状态
3.编辑本地（或ha）虚拟机bios停留时间如2的非0值，启动虚拟机
用命令ps auxf | grep vmid | grep splash  --color,有'menu=on,splash-time=2000'，即bios菜单为开启状态 时间为用户设置停留时间
........
reviewid: 15693
review by lcy
bug id: 34516
问题描述: vtprgm调用一个api的接口被改了，导致异常
改动说明: 在新增一个接口用于判断虚拟机是否加密，之前的接口是判断虚拟机的某一个磁盘是否加密
自测场景: 
1. 替换代码，vtprgm运行正常
2. VDC设置开机自动，VMP启动后VDC启动成功
........
noreview
上库libevent2
为了让库有可执行权限，在linux下上库
........
noreview 
上库libevent的头文件
........
reviewid: 15653
bugid:
问题分析：解决VMP版本的性能优化问题；
自测：通过
........
review id: 15696
bug id: 34031
问题描述:td34031:【磁盘扩容】虚拟机存在异地备份，扩容，选择将备份存至回收站，到期后回收站不会清理。【优先】
改动说明:添加一个脚本，每天定时清理 /sf/data/$storageid/private/backup目录下的文件，如果存在文件超过一个星期没有改动，那么将其删除
测试:在/sf/data/$storageid/private/backup新建一些文件:修改系统时间为1星期后，检查/etc/crontab文件中的每天定时执行脚本在什么时候执行
把系统时间修改到它之前不久处，等待时间到达后过时文件是否被删除
........
reviewid :15698
bug id :33697
问题分析： 
因为旧版本的图片会先被删除，而之后如果新版本的图片下载不完整，就会导致前台得到的广告图片不全
改动说明：
合入 bug 32968
新版本的图片下载不完整不会删除旧版本的图片，会等新版本图片全部完成才更新UI的广告图片
自测：
1、vmp4.6 升级到 vmp4.7，观察升级后前台广告
2、重复升级多次，检查前台广告 没有缺失情况
........
reviewid: 15696
bug id: 34101
问题描述: 虚拟机运行在其他节点，qemu-img info 获取镜像信息的时候在本节点，报错208
改动说明: qemu-img info 获取能访问虚拟机的时候判断虚拟机是否运行，优先返回虚拟机的正在运行的位置
测试场景:虚拟机运行在非主控，进行备份。
........
noreview
加入opus库

........
noreview：
改动说明：
bug34528，【集群IP设置】【UI】集群IP设置页面的描述不准确
........
noreview：
改动说明：
bug34481，预加载个人盘会进行开机再关机操作，在会执行此操作的时候加上提示
........
reviewid:15724
review by fxw
Bug id: 33351
问题分析：TD33351,【集群】3台主机组集群，2种情况下导致了所配置的集群IP丢失【需要重现】
问题出现的根源：
集群IP经常被重置，即先删除然后设置。有可能出现某次设置不成功。又或者是设置错了网口导致的。
改动说明：
打印一些调试日志。设置集群IP的时候，把流程打印出来，并且把设置完了之后网口的IP信息打印出来
自测：
自测通过，日志正常。
........
reviewid 15726
review by fxw
bugid 34313
问题分析：
当一个主机装有多个vmp系统的时候，一旦重启主机，就可能出现严重的问题：1、配置发生错误，可能导致例如磁盘没有挂载等问题；2、数据丢失，主要表现在虚拟机丢失，也vmp管理页面的虚拟机页，虚拟机卡片显示镜像丢失，这主要是由于分区挂载错误造成的，可能两个磁盘的local分区挂载错误；等等其他情况。在安装的时候，vmp可以检测到这种情况，并必须格式化安装才能继续安装。在实际部署中，可能部署人员将安装过vmp的盘直接作为本地盘给主机，造成人为的一个主机存在两个vmp现象，从而出现配置丢失、数据丢失等问题。提出一个解决方案检测，并进行告警。
改动说明：
在告警服务中添加对主机安装vmp个数检测，若出现有主机安装多个vmp系统，则在vmp页面进行告警。检测原理是：
1、我们的vmp会将系统盘分成6个分区，因此第一步，需要检测当前主机有哪些块设备有6个分区。检测方式是对分区名为"sd[a-z]6"进行匹配。
2、进一步精匹配，匹配模式是“^(.)-(sd[a-z])6”。
3、对精匹配到的设备进行分区的卷标匹配。有两个分区需要匹配：/dev/sd[a-z]1和/dev/sd[a-z]2，第一个是默认的boot挂载目录，第二个是uefi迁移过来的boot分区。如果匹配到卷标是vtpboot，且统计匹配个数大于1才认为是多个vmp。
测试：
测试环境：
172.28.172.110（lyc提供虚拟环境）
200.200.101.159物理机环境
密码：都是admin
ps：如果重启过需要替换代码
1、在告警页面出现“主机安装多个VMP”告警。
2、后台到有多个vmp节点执行：e2label /dev/sda1 ""，然后/sf/etc/init.d/vtpalertd restart，页面不再产生新的告警。
3、执行perl /sf/bin/vmp_os_num_check.pl输出1.
注意不要清除多余的，否则就不能重启了。
........
reviewid: 15729
review by: fxw
Bug id：34184  34481
问题分析：
转换模板没有任何提示，会进行开机、关机操作

改动说明：
普通虚拟机转换模板、普通虚拟机直接部署会弹框提示需要进行开机关机操作；
旧模板第一次更新也会弹框提示需要进行开机关机操作


自测：
 1. 普通虚拟机的卡片、详情页面，点击转换模板，弹框提示转换模板的过程中会执行开机关机操作,目的是预加载个人盘；
 2. 普通虚拟机的卡片、详情页面，点击模板部署，在确认部署时，弹框提示转换模板的过程中会执行开机关机操作，因为普通虚拟机部署必定会走转换模板的流程；
 3. 模板虚拟机的卡片、详情页面，点击模板更新，目前在确认更新时本身就会弹框，如果时旧模板，那么更新在弹框中会新增提示：更新过程中会执行开机关机操作。
 更新操作不是每次都会将模板开关机的，只要个人盘加载上了，以后再次更新就不会再开机关机了。
........
reviewid 15737
bugid 34497
review by fxw
问题分析：
当存储不存在时，虚拟机开机报错“磁盘不存在”，描述不清楚。
改动说明：修改描述。
测试：
后台执行vtpsh get /vtpstorage/diskpath -did=1234。打印错误为“存储不存在（id：1234）”。测试ok。
........
reviewid : 15741
bug id : 34360
问题描述:【老功能】虚拟存储上的虚拟机克隆，进度条显示不对.
改动说明: 如果是虚拟存储，通过获取每次拷贝的数据再相加
自测场景:克隆一台虚拟存储上的虚拟机到其所在的存储，观察页面进度条是否异常
........
noreview：
改动说明：
bug33286，管理-&gt;虚拟机备份与恢复-&gt;恢复：支持 勾选/取消勾选 所有派生虚拟机的只恢复系统盘
........
noreview 
漏掉了libevent的so
........
copy from VMP4.7 2016-01-18
........
reviewid: 15753
review by: hyq
Bug id：34547 34532
问题分析：
转换模板需要执行开机关机操作，在关机失败时，会执行回滚操作将模板虚拟机转回普通虚拟机，
而转换成虚拟机需要是停止状态。

改动说明：
1. 重构磁盘预加载开机关机这部分代码；
2. 如果关闭虚拟机失败，则尝试关闭虚拟机电源

自测：
1. 新建普通虚拟机A，将A转换成模板，待A启动成功以后，后台用gdb kvm -p pid将虚拟机卡住，构造关机失败场景；
2. 前台操作日志依次会显示关闭虚拟机失败、关闭虚拟机电源成功，且转换模板任务最终也成功
........
noreview

上库最新测试用例
........
noreview
删除旧案例文件，避免误会
........
reviewid: 15776
bugid：34023
问题分析：
改动说明：增加开关限制，可以touch /cfs/log_stack.switch来开启API错误堆栈日志
........
reviewid: 15780
  Bug id: 34202
  问题分析:vs添加的一块代码位于添加主机锁的外面，导致添加任务并发；导致批量添加失败；
  改动说明:修改代码，将代码加入锁的内部
  自测:
  1.修改代码，将代码加入锁的内部;
  2.登录前台，批量添加主机（添加了15台），等待结果，通过；
  环境：
  4.6.01
  build 2015-12-05 23:05:39
........
reviewid: 15781
Bug id: 34261
问题分析: 添加主机时，重启了被添加主机的集群服务，在等待集群稳定时，超时导致添加主机失败。
改动说明: 大集群，48台主机，需要的集群稳定时间更长，60s左右，改为5min超时。
自测: 大集群环境，vtpcm restart，原来的60s就会出现该问题。
改为5min，不出现问题
........
noreview

上库linux系统测试案例
........
reviewid: 15784
Bug id: 34392
问题分析: vs bonding限制了arp_target 16个，导致组建vs链路聚合时，添加到聚合口失败
改动说明: 修改限制为64，考虑大了可能有影响，集群支持48台主机，64够用
自测: 上库打包验证
........
noreview
说明：
将netperf_8_2.xls更名为amd_netperf_8_2.xls.
........
noreview
说明：
上传wrk aSV netperf性能测试结果。
........
reviewid: 15785
bugid:
问题分析：修正内核路径
........
noreview
说明：
上传vCPU core2duo指令集对比结果。
........
reviewid: 15791
bugid：
问题分析：解决VMP版本的性能优化问题
自测：通过
........
noreview

上库管理资料
........
reviewid: 15809
review by: hyq
Bug id：34527
问题分析：
转换模板的过程要开机关机，这个过程没有对用户进行限制

改动说明：
1. 增加一个临时状态用来标识预加载磁盘的过程，在普通虚拟机转换模板、普通虚拟机直接部署的过程中，限制用户操作，显示正在转换模板；
2. 模板更新的整个过程都设为“模板更新状态”

自测：
 1. 普通虚拟机的卡片、详情页面，点击转换模板，卡片页面显示正在转换模板，详情页面虚拟机操作被置灰，控制台处于禁用状态；
 2. 普通虚拟机的卡片、详情页面，点击模板部署，卡片页面依次显示正在部署、正在转换模板、正在部署，详情页面虚拟机操作被置灰，控制台处于禁用状态；
 3. 旧模板虚拟机的卡片、详情页面，点击模板更新，整个过程虚拟机的卡片都显示正在更新。
........
noreview
更新任务进度表
........
noreview
说明：
更新AMD虚拟化方案验证测试计划。
........
reviewid: 15833
bugid：34615
问题分析：当run_command()调用shell脚本、可执行文件返回值为1时，视为错误，输入日志；
改动说明：修改对run_command()的参数，将命令执行后退出码与指定忽略的退出码比较；
环境：
4.8.00_B
build 2016-01-19 22:18:16
自测通过
........
reviewid: 15852
review by: hyq
Bug id：34627
问题分析：
新增个人盘的ide编号是通过遍历虚拟机配置中ide字段，选择未被使用的ide编号，
而如果使用了virtio_blk，配置中的相应ide字段就会被替换成virtio，导致新增个人盘
的配置使用了已有的ide编号，最终写入配置失败。

改动说明：
预加载个人盘在ide编号选择时，增加对virtio的处理

自测：
1. 新建虚拟机，安装虚拟机性能优化工具（安装VDC agent会自动安装性能优化工具），
转换成模板，待虚拟机启动以后，后台查看cfs目录下的虚拟机的配置（vmid为奇数），新增个人盘的配置被写入。
........
reviewid: 15853
bugid：34403
问题分析：物理机的网口没有vlan，函数load_if_vLan_cfg()来获取vlan配置刷这条日志属于正常范畴；
改动说明：刷新频繁，删除掉；
环境：
4.2.09_R1
build 2015-12-15 21:37:19
自测通过
........
reviewid: 15851
bugid：34615
问题分析：当run_command()调用shell脚本、可执行文件返回值为1时，视为错误，输入日志；
改动说明：修改对run_command()的参数，将命令执行后退出码与指定忽略的退出码比较；
环境：
4.8.00_B
build 2016-01-19 22:18:16
自测通过
........
reviewid: 15883
bugid：34659
问题分析：日志是由unlink函数返回值正常时，发出的提示信息日志，属于正常范畴；
改动说明：刷新频繁，删除掉；
环境：
4.8.00_B
build 2016-01-19 22:18:16
........
reviewid: 15889
bugid：34659
问题分析：日志是由unlink函数返回值正常时，发出的提示信息日志，属于正常范畴；
改动说明：刷新频繁，删除掉;
........
noreview
更新项目进度文档
........
reviewid: 15906
Bug id: 34678
问题分析: get_nodelist多处被重复调用，消耗时间，详见bug附件
改动说明: 
改动后，从/update/step来看， 在主控资源耗尽时，API时间20s， 优化后消耗时间8s - 12s
主控资源消耗一半时，API时间6s， 优化后3s左右。
优化效率约50%

对于其它API的效率也有提升，暂未分析具体哪些提升。
........
noreview
更新vs代码
........
noreview
34333 【VMP】【aSV】【0.5人天】主机详情-存储-存储测速“属性缺失”
问题分析：提交时没判断存储id
改动说明：提交时检测存储id
自测说明：
主机详情-》存储标签页
重新检测存储最大IO速率
下拉列表没加载完成前，点击开始检测
提示“请选择存储”

........
noreview
34617 【VMP】升级页面，升级48台主机的时候，在升级列表看不全所有的主机
问题分析：css类冲突
改动说明：修改类型
自测说明：
升级页面-&gt;主机列表：主机超过七台时，列表不会有问题。

........
noreview
34413 【vs】【已改】【优化时间】部分后台任务执行耗时过长，导致前端UI卡顿
问题分析：vs_info调用获取命中率的时间长
改动说明：修改命中率的方法
自测说明：点击虚拟存储界面，显示时间明显缩短

........
合入VMP4.7的改动
........
noreview
34314 【VMP】【aSV】【体验性】【1人天】48台主机组建了集群之后，在也很多页面 显示主机的时候没有按照ip来排序，导致要定位到某一台主机很不方便

修改说明:
只修改了升级页面的主机列表
........
reviewid: 15936
bugid：
问题分析：vmp_is_aSV函数中对run_command调用，以及使用diff命令，需要开启新的进程，消耗时间；
改动说明：取消对run_command与diff的调用，自己手动比较/sf/etc/version /sf/etc/version.server；
自测通过
........
reviewid: 15963
bug id: 34677
问题描述:HA拉起虚拟机失败报错不详细
改动说明:改了下提示，把提示改为“HA拉起虚拟机失败，集群内找不到可以运行该虚拟机的主机！请尝试手动启动该虚拟机！”
自测场景:
1、修改代码，直接报错误信息打出来。
2、主要测试勾选HA配置的第二项（主机管理通信网口和虚拟机通过网桥连接的物理网口掉线），其它主机是否尝试将该虚拟机拉起。
........
reviewid: 15970
review by: hyq
Bug id：34715
问题分析：
最初设计的判断模板虚拟机是否已经预加载过个人盘的方式，是通过检查模板image目录下是否存在personal_disk文件。
大多数情况下，personal_disk的存在性与个人盘是否预加载过是一致的，所以之前也没发现这种方法的存在问题。
在快照恢复这种场景就有问题，预加载之前打快照A，预加载完成，又回滚到A快照，这样操作就出现了上面提到的不一致的问题。

改动说明：
模板预加载完成之后，在模板虚拟机的配置文件中新增一个字段personal_disk_loaded，用于标识个人盘已经加载，
只有当配置中存在该字段，并且personal_disk.qcow2文件也存在，才认为模板已经加载过个人盘。

自测：
1. 新建普通虚拟机，转换模板，后台查看image和cfs目录下的配置文件，新增了personal_disk_loaded：1，image目录下存在personal_disk.qcow2；
2. 新建普通虚拟机A,通过A直接部署几台虚拟机，后台查看image、template和cfs目录下的配置文件与personal_disk.qcow2均存在；
3. 验证备份恢复，对上面的虚拟机A，后台将image、template和cfs目录下的配置文件中的新增了personal_disk_loaded字段或personal_disk.qcow2删掉，
更新模板，会预加载个人盘，三个路径下的配置文件中的新增了personal_disk_loaded字段都会恢复，image目录下的personal_disk.qcow2会恢复，
（template目录下的personal_disk.qcow2会在下次部署时恢复）；
4. 验证克隆，克隆后配置和个人盘都在；
5. 验证导入导出，导出再导入，新虚拟机个人盘和配置的新增字段均没有。
6. 验证迁移，移动到其他目录，其他存储，配置和个人盘都在。
........
noreview
34378 【VMP】【1人天】体检性:建议在虚拟机各分组视图上添加正在运行vm个数
........
noreview
配合ssl，增加新的qxl version
还有250880 250771也是相关修改
........
noreview
spice代码更新，对应更新spice库
........
问题描述： 
	显示私网IP冲突，提示信息更加清晰，不应该显示被占用，应该显示冲突
BUG   ID: 30959
问题原因： 
	
改动思路： 
	配置的虚拟存储IP（192.168.171.101,192.168.171.102） 冲突，请重新配置！
做了哪些测试：
reviewid 15969, commited by yangyf, reviewed by yinxin
........
noreview
34378 【VMP】【1人天】体检性:建议在虚拟机各分组视图上添加正在运行vm个数
........

........
Merged revision(s) 251081 from VTP/aSV4.6/VMP4.7/source/app/vtp-reportdata:
reviewid: 16189
Bug id: 34816 
问题分析:
vtp-datareport-server COREDUMP，原因是出在进程重启的时候，监听线程为退出，而其他线程已经退出，导致依赖free的资源。
改动说明:
如果设置了listen_status为0，则退出监听线程。

自测: 未在大集群环境中测试，打包后测试。
........

........
Revision: 251310
Author: gwl
Date: 2016年2月24日 15:59:18
Message:
reviewid: 16245
Bug id: 34941
问题分析:
获取任务状态的代码不健壮，Tools.pm中upid_read_status函数读取任务状态文件设定1024字节缓冲区，在大集群不行。大集群错误信息可能超过1024字节

改动说明:
改为限制8K，并且按照文件实际大小设置缓冲区。

自测: 在229测试通过。
----
Modified : /VTP/aSV4.6/VMP4.7/source/app/vtp-common/Tools.pm
........
noreview
去掉无用日志
........
Revision: 250349
Author: panchao
Date: 2016年1月29日 8:55:39
Message:
reviewid: 16005
bugid：
问题分析：由于td17295会导致df的线程越来越多，zhx采用控制所用线程的数量；
改动说明：解决控制线程的问题，只限制df的线程；
自测：
----
Modified : /VTP/aSV4.6/VMP4.7/source/kernel/fs/lmtps.c


........
Revision: 251861
Author: gwl
Date: 2016年3月2日 19:58:34
Message:
reviewid : 16341
bug id : 35018
问题描述 : 是个同步的api，要代理到每个主机上重启服务,返回超时
改动说明 : 把api改为异步任务，加上进度条，修改不规范的执行shell命令为run_command
测试场景 : 在大集群中测试通过.
----
Modified : /VTP/aSV4.6/VMP4.7/source/app/vtp-manager/VTP/VAPI/Log.pm


........
Revision: 246726
Author: jcy
Date: 2015年12月23日 17:33:40
Message:
noreview：
改动说明：
VS单主机环境：登录后首页提示组建集群，添加超过八台主机，到第三步，主机序号应显示正确
----
Modified : /VTP/VMP4.7/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-common/vs/cluster/create.js


........
reviewid: 16434 
Bug id: 35108
问题分析:
一些无关紧要的风格类问题集合
改动说明:
添加user/local/bin为环境变量

自测：无
........
</msg>
</logentry>
<logentry
   revision="252542">
<author>gwl</author>
<date>2016-03-09T13:39:02.014382Z</date>
<msg>Merged revision(s) 251310-251540 from VTP/aSV4.6/VMP4.7:
reviewid: 16245
Bug id: 34941
问题分析:
获取任务状态的代码不健壮，Tools.pm中upid_read_status函数读取任务状态文件设定1024字节缓冲区，在大集群不行。大集群错误信息可能超过1024字节

改动说明:
改为限制8K，并且按照文件实际大小设置缓冲区。

自测: 在229测试通过。
........
reviewid: 16248
Bug id: 34628
问题分析:
cacher里去掉了loadscore，可能上库的时候不小心抹掉了代码，加回来

改动说明:
修改load_config获取vm的memory为读取vmlist

自测: 在229测试通过。
........
noreview:
BUG ID: 34910
bug34910【老功能】主控，强制把从节点设置为主控需要修改提示信息

问题分析：
体验文案修改

改动说明：
修改非主控页面提示，及确认切换主控的效果

做了哪些测试：
jshint ok
自测 ok

........
no review
个人盘预加载设计文档
........
[no review]VDI4.8代码合入，来自svn://200.200.0.40/ssl/dev/Trunk/Personal-Directory/VDI4.8/spice-0.12.5
........
reviewid: 16234
Bug id: 34628
问题分析:
给redis server加上密码校验
改动说明:
加入密码认证，23位

自测：在229测试通过
........
noreview
代码更新，相应更新库
........
noreview
更新VDC镜像
........
reviewid: 16255
review by fxw
Bug id: 34878
问题分析：TD34878,【SSL研发办公环境】adesk无法连接虚拟机，影响业务，sangfor_waf连接超过限制
问题出现的根源：
waf连接满了，其他的连接请求直接被丢弃了。
改动说明：
规避方法，后台一个定时脚本在执行，每分钟检测一次，只要发现waf连接不上了，就会自动重启waf
自测：
版本：
4.8.00_B
build 2016-02-15 11:02:57
自测通过。
........
reviewid: 16254
Bug id: 34768
问题分析:
遇到个奇葩问题：
my $ha = {
   a =&gt; 0,
   b =&gt; 1,
};

print "$ha-&gt;{a}"."\n"; #注意这行代码

my $js = to_json($ha);
print "$js"."\n";

A.如果加了上边有注释的那行代码，输出结果是：{"a":"0","b":1}
B.如果不加上边有注释的那行代码，输出结果是：{"a": 0 ,"b":1}
C.如果在加了注释的代码后，再执行$ha-&gt;{a} = int($ha-&gt;{a}); 输出结果同B


类似这种代码，就改变了hash里面的变量属性，导致前台得到字符串，而不是整数

而这个问题引发是由于在Rest.pm里面加了cache，缓存数据时，引用了hash信息
导致结果转换成了字符串。


另外vtpdaemon有多个进程，每个进程的cache是单独的，改为共享cache也
一起解决了控制台禁用问题。
改动说明:
共享用redis解决
........
reviewid 16261
bug id 34950
review by lifan
问题分析：
更改iptables的规则，如果被清空，默认将连接都放开，防止异常的时候出问题
测试：
1./sf/etc/init.d/fw.sh stop
2./sf/etc/init.d/pmxcfs restart
前台访问不会卡
........
noreview
更新VDC镜像
........
noreview
提交文档
........
reviewid: 16276
Bug id: 34628
问题分析:
修改redis后，有的cache还是存本机
改动说明:
之前改动将其存主控了

自测：上库后打包验证
........
[no review] 【上库原因】填SPICE_MSG_WAIT_FOR_CHANNELS消息时，传输参数错误，导致x86盒子双屏使用崩溃
........
reviewid: 16279
Bug id: 34628
问题分析:
启动虚拟机，资源分配不均

改动说明: 增加新的分值权重：考虑主机内存、虚拟机内存、主机内存占用率，剩余内存等影响因素，调整计算负载值的公式。

自测：自测分析数据通过
........
reviewid: 16280
Bug id: 34628
问题分析:
解决启动虚拟机load_config性能消耗问题
改动说明:
增加cores字段

自测: 上库测试。
........
</msg>
</logentry>
<logentry
   revision="252541">
<author>gwl</author>
<date>2016-03-09T13:35:02.261568Z</date>
<msg>Merged revision(s) 251272 from VTP/aSV4.6/VMP4.7:
reviewid: 16231
Bug id: 34628
问题分析:
让cacher有单实例
改动说明:
漏掉MAKEFILE

自测: 无。
........
</msg>
</logentry>
<logentry
   revision="252540">
<author>gwl</author>
<date>2016-03-09T13:33:43.680012Z</date>
<msg>Merged revision(s) 251259 from VTP/aSV4.6/VMP4.7:
reviewid: 16235
Bug id: 34628
问题分析:
控制台禁用问题，顺便修改一下rget的调用方式
改动说明:
........
</msg>
</logentry>
<logentry
   revision="252539">
<author>gwl</author>
<date>2016-03-09T13:32:44.109898Z</date>
<msg>Merged revision(s) 251258 from VTP/aSV4.6/VMP4.7:
reviewid: 16234
Bug id: 34628
问题分析:
给redis server加上密码校验
改动说明:
加入密码认证，23位

自测：在229测试通过
........
</msg>
</logentry>
<logentry
   revision="252538">
<author>gwl</author>
<date>2016-03-09T13:31:30.340895Z</date>
<msg>Merged revision(s) 250578 from VTP/aSV4.6/VMP4.7:
reviewid: 16074
Bug id: 34795
问题分析:
检测主机是否符合启动条件的地方，耗时太长。
改动说明:
远程的http get调用，修改为每台主机获取数据存放到数据库，然后主控从数据库获取数据，绕过http get

自测: 100多s，可以优化到1s
........
</msg>
</logentry>
<logentry
   revision="252532">
<author>gwl</author>
<date>2016-03-09T12:57:03.453578Z</date>
<msg>Merged revision(s) 251233 from VTP/aSV4.6/VMP4.7:
reviewid: 16233
Bug id: 34628
问题分析:
开机时资源调度不合理
改动说明:
①优化了内存计算
②优化了获取最优节点的时间
④修改虚拟机状态，实时反馈开机情况，以让启动虚拟机计算节点负载能更准确。

自测: 
函数单元测试功能，及单台虚拟机启动时间计算，内存计算与老算法对比效果均自测通过。
........
</msg>
</logentry>
<logentry
   revision="252478">
<author>gwl</author>
<date>2016-03-09T04:55:56.446047Z</date>
<msg>Merged revision(s) 251222-251226 from VTP/aSV4.6/VMP4.7:
reviewid: 16231
Bug id: 34628
问题分析:
让cacher有时间统计
改动说明:
加入时间统计

自测: 在229测试通过。
........
reviewid: 16231
Bug id: 34628
问题分析:
让cacher有时间统计
改动说明:
加入时间统计

自测: 在229测试通过。
........
</msg>
</logentry>
<logentry
   revision="252477">
<author>gwl</author>
<date>2016-03-09T04:52:11.543134Z</date>
<msg>Merged revision(s) 251201 from VTP/aSV4.6/VMP4.7:
reviewid: 16224
Bug id: 34628
问题分析:
解决启动虚拟机load_config性能消耗问题
改动说明:
将需要的memory和schedopt字段放到vmlist中

自测: 在229测试通过。
........
</msg>
</logentry>
<logentry
   revision="252476">
<author>gwl</author>
<date>2016-03-09T04:51:03.246512Z</date>
<msg>Merged revision(s) 251199 from VTP/aSV4.6/VMP4.7:
reviewid: 16217
Bug id: TD34795
问题分析：优化开机启动慢问题，即优化check_net_ok接口实现。
改动说明：
优化check_net_ok接口实现，改动如下：
1、改掉通过ipc机制获取节点网口状态信息机制，改为通过缓存机制获取节点网口状态信息。

测试：
1、已执行过单元测试。
........
</msg>
</logentry>
<logentry
   revision="252475">
<author>gwl</author>
<date>2016-03-09T04:50:00.639363Z</date>
<msg>Merged revision(s) 251186 from VTP/aSV4.6/VMP4.7:
reviewid: 16216
Bug id: TD34795
问题分析：优化开机启动慢问题，增加缓存机制。
改动说明：
同步后面修改代码以屏蔽内部错误，改动如下：
1、同步缓存cpu改动代码，去掉无用代码；
2、修正缓存硬件配置交换内存引用错误；
3、统一风格。

测试：
1、已执行过单元测试。
........
</msg>
</logentry>
<logentry
   revision="252474">
<author>gwl</author>
<date>2016-03-09T04:49:04.592397Z</date>
<msg>Merged revision(s) 251182 from VTP/aSV4.6/VMP4.7:
reviewid 16186
Reviewed by: gwl
BUG ID: TD34795
问题分析：
优化虚拟机开机时间消耗，增加主机cpu、mem、网卡状态和系统负载缓存。
改动说明：
增加主机cpu、mem、网卡状态和系统负载缓存，改动如下：
1、缓存主机cpu和mem配置；
2、缓存网卡状态；
3、缓存系统负载。
测试：
1、执行过单元测试；
2、大规模集群没测试过。
........
</msg>
</logentry>
<logentry
   revision="252473">
<author>gwl</author>
<date>2016-03-09T04:47:59.877385Z</date>
<msg>Merged revision(s) 251180 from VTP/aSV4.6/VMP4.7:
reviewid 16185
Reviewed by: gwl
BUG ID: TD34795
问题分析：
节点算分考虑系统负载和增加获取网卡状态接口。
改动说明：
节点算分考虑系统负载和增加获取网卡状态接口，改动如下：
1、计算节点score时 需额外考虑系统当前的负载；
2、增加获取网卡状态接口。
测试：
1、执行过单元测试；
2、大规模集群没测试过。
........
</msg>
</logentry>
<logentry
   revision="252472">
<author>gwl</author>
<date>2016-03-09T04:46:09.956300Z</date>
<msg>Merged revision(s) 251142 from VTP/aSV4.6/VMP4.7:
reviewid: 16200
Bug id: 34863
问题分析:
vtpalert误判，KILL掉虚拟机。
改动说明:
将误判点disk io获取的值做下空值判断

自测: 在229测试通过。
........
</msg>
</logentry>
<logentry
   revision="252467">
<author>gwl</author>
<date>2016-03-09T03:59:52.930550Z</date>
<msg>Merged revision(s) 251114 from VTP/aSV4.6/VMP4.7:
reviewid: 16196
Bug id: 34795
问题分析:
检测主机是否符合启动条件的地方，耗时太长。
改动说明:
为cacher添加自动启动项。

自测: 打包测试。
........
</msg>
</logentry>
<logentry
   revision="252464">
<author>gwl</author>
<date>2016-03-09T03:19:52.542342Z</date>
<msg>Merged revision(s) 251081 from VTP/aSV4.6/VMP4.7:
reviewid: 16189
Bug id: 34816 
问题分析:
vtp-datareport-server COREDUMP，原因是出在进程重启的时候，监听线程为退出，而其他线程已经退出，导致依赖free的资源。
改动说明:
如果设置了listen_status为0，则退出监听线程。

自测: 未在大集群环境中测试，打包后测试。
........
</msg>
</logentry>
<logentry
   revision="252463">
<author>gwl</author>
<date>2016-03-09T03:18:48.399109Z</date>
<msg>Merged revision(s) 250579-251067 from VTP/aSV4.6/VMP4.7:
reviewid: 16074
Bug id: 34795
问题分析:
检测主机是否符合启动条件的地方，耗时太长。
改动说明:
远程的http get调用，修改为每台主机获取数据存放到数据库，然后主控从数据库获取数据，绕过http get

自测: 100多s，可以优化到1s
........
reviewid: 16074
Bug id: 34795
问题分析:
检测主机是否符合启动条件的地方，耗时太长。
改动说明:
远程的http get调用，修改为每台主机获取数据存放到数据库，然后主控从数据库获取数据，绕过http get

自测: 100多s，可以优化到1s
........
noreview
加可执行权限
........
reviewid: 16074
Bug id: 34795
问题分析:
检测主机是否符合启动条件的地方，耗时太长。
改动说明:
远程的http get调用，修改为每台主机获取数据存放到数据库，然后主控从数据库获取数据，绕过http get

自测: 100多s，可以优化到1s
........
reviewid :16076
bug id :34802
问题分析：没用use plog
改动说明：添加use plog
........
reviewid : 16078
bug id : 34791
问题描述 : 本地存储虚拟机重复备份到异地本地存储失败
改动说明：
获取磁盘大小，访问虚拟机当前磁盘，应当使用当前主机；
获取备份位置磁盘大小才需要使用备份位置ip
测试：
备份虚拟机到从节点的local存储，备份成功(见td28263)
........
noreview
新增VMP4.8修改列表
........
reviewid : 16079
bug id: 34806
问题描述: 之前为了方便开发查问题，gwl添加了在程序抛出异常的地方打印堆栈到日志，默认开启
改动说明: 将其设置为默认不开启，修改后通过命令touch /cfs/log_stack.switch开启
测试场景: 查看sfvt_vtpdaemon.log日志， api执行失败后不再打印堆栈日志。
........
reviewid: 16091
review by: fxw
Bug id：34761
问题分析：
集群锁超时时间设置过长，导致另外一台主机一直获取不到锁，从而不断尝试拉起操作。

改动说明：
修改心跳更新频率为5秒（heartbeat_time）、心跳超时时间为35秒（heartbeat_timeout）

自测：
需要打新包验证
........
reviewid : 16096
bug id: 34823
问题描述:提供一个不需要传hostid的获取spice接口
改动说明:
以前的接口非集群虚拟机获取spice状态需要提供虚拟机所在主机的ID
HTTP:           POST /vapi/json/nodes/{node}/qemu/{vmid}/spice
CLI:    vtpsh create /nodes/{node}/qemu/{vmid}/spice
集群虚拟机接口：
HTTP:           POST /vapi/json/nodes/{node}/qemu/{vmid}/spice
CLI:    vtpsh create /nodes/{node}/qemu/{vmid}/spice
现在修改为：统一用集群虚拟机接口
测试场景:
新建两台虚拟机A和B，虚拟机A为集群虚拟机，虚拟机B为普通虚拟机，启动虚拟机
后台调用命令
vtpsh create /cluster/qemu/{vmidA}/spice
vtpsh create /cluster/qemu/{vmidB}/spice
命令执行成功
........
reviewid 16101
bug id 34824
review by zyj
问题分析：
合入qemu社区bugfix
http://git.qemu.org/?p=qemu.git;a=commit;h=e8d3b1a25f284cdf9705b7cf0412281cc9ee3a36
http://git.qemu.org/?p=qemu.git;a=commit;h=fcf5def1ab0f94ff120b7141c943b517d2ece83d
测试：
1、编译通过
........
reviewid : 16104
bug id : 34810
reviewed by : lcy
问题描述：td34810【备份恢复】备份到另一台主机local存储失败，报错：与qemu-nbd建立连接失败。
改动说明: 选择节点判断是否是本地存储
测试场景:
A主机本地存储原位置备份
A主机本地存储备份到A主机另外一个本地存储
A主机本地存储备份到B主机本地存储
A主机本地存储备份到B主机另外一个本地存储
A主机本地存储备份到共享存储（只有A能访问）
A主机本地存储备份到共享存储（只有B主机能访问）
A主机本地存储备份到共享存储（A、B都能访问）

共享存储访问情况（只有A能访问，只有B能访问，A、B都能访问）
A主机共享存储原存储备份
A主机共享存储备份到A主机本地存储
A主机共享存储备份到A主机另外一个本地存储
A主机共享存储备份到B主机本地存储
A主机共享存储备份到B主机另外一个共享存储
........
reviewid: 16105
review by hyq
Bug id: 34825
问题分析：TD34825,启用HA的VDC虚拟机，勾选主机开机后启动，选项失效
问题出现的根源：
在获取需要进行开机自启动的虚拟机的时候，没有把集群的VDC虚拟机放到启动列表里面。
导致，一直没有把VDC开机拉起。
改动说明：
对集群的VDC虚拟机进行特殊处理，在代码中放到$resList列表里。提供给startall接口使用
自测：
环境：
4.8.00_B
build 2016-02-15 11:02:57
步骤：
1. 新建一台集群的VDC虚拟机，指定运行位置为从节点，并且把虚拟机设置为开机自启动
2. 保证当前主机的资源可以启动这台虚拟机，重启主机
3. 重启主机之后，虚拟机可以开机自启动。
........
reviewid: 16110
review by fxw
Bug id: 34828
问题分析：TD34828,【HA】【优化】HA对于磁盘加密的虚拟机，在后台打印日志说明，方便定位问题
问题出现的根源：
磁盘加密的虚拟机，在需要HA拉起的时候，没有拉起，也没有任何说明。
导致不知道为什么这个虚拟机没有被拉起，还有后台看虚拟机的状态文件发现会有异常
改动说明：
在后台日志中打印说明这个虚拟机为什么没有被拉起，修改虚拟机的电源状态文件，让其正常。
自测：
环境：
4.8.00_B
build 2016-02-15 11:02:57
步骤：
1. 新建一台虚拟机，后台修改配置文件，让其磁盘是加密的。
2. 后台修改电源文件，把虚拟机的电源置为on，cnt=0
3. tail -f sfvt_vtprgm.log可以看到日志打印出来说明这个虚拟机已经被加密了，不会拉起，并且把电源状态设置为off
4. 后台查看这个虚拟机的电源状态为off
........
noreview
更新qxl version为V16
........
reviewid : 16117
bug id : 34813
reviewed by : lcy
问题描述: vmp控制台重置虚拟机调用了03restart.pl这个脚本，该脚本在虚拟机内部重启的时候调用，导致多打了一个日志
改动说明: 虚拟机重启时如果失败才打印日志，成功就不打了
测试场景: 普通虚拟机和HA虚拟机重置电源，查看是否多打了日志
........
reviewid: 16120
review by: fxw
Bug id：34840
问题分析：
xp系统的磁盘注册表项与磁盘大小相关，需要host机将个人盘的大小信息传递给guest机

改动说明：
找到派生虚拟机第一块不含backing_file的磁盘大小，通过cpuid来传递给guest机

自测：
派生一台带个人盘的虚拟机，使用cpuid工具发送cpuid（ebx填0x100b），host机返回的个人盘大小
位于ecx和edx两个寄存器，磁盘大小正确。
........
noreview TD34648 上库源代码
........
noreview TD34648 上库根据util-linux编译出的lsblk
........
reviewid : 16138
bug id : 34852
reviewed by : lcy
问题描述 : 【迁移】虚拟机冷迁移运行位置，迁移页面显示的运行位置有问题
改动说明 : 虚拟机如果在运行才返回虚拟机的运行位置，另外如果虚拟机运行位置为自动选择且没运行过，运行位置设置为自动选择
测试场景 : 虚拟机刚创建且运行位置选择为自动选择
........
noreview
qxl 的revesion改了，ID也需要改
........
noreview
更新qxl id
........
noreview
更新说明
........
reviewid: 16141
review by: hyq
Bug id：34785
问题分析：
备份恢复的存储如果是local，其存储id会带hostid前缀（形如hostid_local），之前的编码没有处理好，
导致拷贝镜像时路径出错。

改动说明：
在组装路径时，将hostid_local替换成local

自测：
1.在A主机的local上准备几个含有预加载个人盘的模板虚拟机，将这些虚拟机备份到B主机的local上
2.恢复到原位置——pass
3.恢复到备份位置——pass
4.恢复到指定存储——pass

虚拟机位于共享存储S1，备份到共享存储S2
5.恢复到原位置——pass
6.恢复到备份位置——pass
7.恢复到指定位置（某主机local）——pass
........
reviewid: 16142
review by: hyq
Bug id：34822
问题分析：
模板转换成虚拟机，如果模板打过快照，快照中会残留personal_disk_loaded字段

改动说明：
去掉快照中会残留personal_disk_loaded字段

自测：
1.新建虚拟机，转换成模板，打快照。模板配置和快照配置中含有personal_disk_loaded
字段；
2.转换成虚拟机，检查配置，配置中（包括快照）没有personal_disk_loaded字段残留；
........
[no review]VDI4.8代码合入，来自svn://200.200.0.40/ssl/dev/Trunk/Personal-Directory/VDI4.8/spice-0.12.5
........
reviewid : 16163
bug id : 34663
问题描述 : td34663:[虚拟机]重置电源直接打印成功，不管有没有重置成功
改动说明 : 重置失败是vtpvm命令里检测到时虚拟机重置则打印日志
测试场景 : 通过修改代码抛出异常测试
........
reviewid: 16162
review by: hyq
Bug id：34840
问题分析：
第一块不含backing_file的块设备有可能是cdrom，需要将其过滤掉

改动说明：
找到派生虚拟机第一块不含backing_file的磁盘大小，通过cpuid来传递给guest机;
过滤掉光驱

自测：
派生一台带个人盘的虚拟机，使用cpuid工具发送cpuid（ebx填0x100b），host机返回的个人盘大小
位于ecx和edx两个寄存器，磁盘大小正确。
........
noreview
新的lsblk输出跟老的不一致，先回滚
........
noreview
SSL要修改usbredir-0.6，先上库原始代码，从以下压缩包解压得到
svn://200.200.0.10/vt/vt/VTP/VMP4.7/Trunk/source/packages/usbredir-0.6.tar.bz2
........
noreview
何入SSL usb映射加速优化
........
noreview 将更改的usbredir-0.6压缩更新
........
noreview
合入入SSL usb映射加速优化，漏了新增文件
........
reviewid: 16171
review by: fxw
Bug id：34840
问题分析：
xp系统还需要个人盘MBR扇区的签名信息

改动说明：
找到派生虚拟机个人盘的第一个扇区，从偏移0x1b8处开始读4个字节（签名信息），通过cpuid来传递给guest机;

自测：
派生一台带个人盘的虚拟机，使用cpuid工具发送cpuid（ebx填0x100c），host机返回的签名信息位于ecx寄存器。
........
noreview 修改依赖的头文件
........
noreview 防止configure没有执行权限
........
noreview usbredir的configure没有执行权限，更新下
........
noreview
更新spice库
........
noreview
添加可执行权限
........
noreview
碰到个坑，注释一下
........
reviewid : 16172
bug id : 34889
问题描述 :【需求】新建虚拟机获取存储信息列表存储如果存储掉线返回的信息存储总量默认置0
改动说明 : 在初始化返回信息结构中加上 total =&gt; 0 字段
测试场景 : 环境中存在掉线存储，后台运行vtpsh  get /vtpstorage/storagetree命令
掉线存储信息存在 total: 0 字段
........
reviewid: 16176
bug id : 34157
问题描述:vdc调用的api vtpsh get /cluster/vmtree 获取的分组接了主机ID导致下发的时候错误
改动说明:把vmgroup主机ID后缀去掉，建议后面vdc把接口换掉
测试场景:按bug回归步骤测试
1、选择10台及以上主机，使用VDC派生虚拟机
2、选择一个分组（非默认）分组，派生虚拟机
........
reviewid: 16180
review by: hyq
Bug id：34874
问题分析：
迁移派生虚拟机到无基镜像的存储，template目录下个人盘未同步拷贝过去。

改动说明：
迁移派生虚拟机到无基镜像的存储，将template目录下个人盘也同步拷贝过去

自测：
用带个人盘的模板虚拟机在存储S1上部署一台虚拟机VM，将VM迁移到未部署过虚拟机的存储S2上，
查看存储S2的template目录下是否存在个人盘——存在
........
reviewid: 16181
bug id : 34887
问题描述: 部分日志文件名过长导致备份失败（sffs文件系统不支持过长的文件名）
改动说明: 去掉文件拷贝的中间流程，直接压缩，也可以节省备份时间
测试场景: 使用带vs存储的环境备份成功
........
reviewid: 16184
Bug id: 34795
问题分析:
检测主机是否符合启动条件的地方，耗时太长。
改动说明:
为cacher添加单实例。

自测: 单实例OK。
........
</msg>
</logentry>
<logentry
   revision="252461">
<author>gwl</author>
<date>2016-03-09T03:14:16.851681Z</date>
<msg>Merged revision(s) 250562 from VTP/aSV4.6/VMP4.7:
reviewid: 16072
Bug id: 34795
问题分析:
虚拟机启动慢，耗时2.5分钟+
改动说明:
优化检查主机内存是否足够，后续wtd也会有优化代码

自测:
8s 优化到800ms
........
</msg>
</logentry>
<logentry
   revision="252460">
<author>gwl</author>
<date>2016-03-09T03:08:28.321500Z</date>
<msg>Merged revision(s) 250529 from VTP/aSV4.6/VMP4.7:
no review
vttd:34479
问题：【vs】【优化时间】【初始化异常则告警】打开虚拟存储的页面，一直都显示为正在加载的状态
修改：把检测vmp网和vs的步骤分开，初始化的时候不检查vs网
测试：没有影响原有的逻辑
........
</msg>
</logentry>
<logentry
   revision="252459">
<author>gwl</author>
<date>2016-03-09T03:05:56.128888Z</date>
<msg>Merged revision(s) 250553 from VTP/aSV4.6/VMP4.7:
reviewid: 16068
Bug id: 34784
问题分析:
查到了原因，是run_command执行时，从命令行读取的数据没有去污染
导致Dumper时在开启-T选项后，会把所有信息变为字符串，具体Dumper代码未找到
不再深究
改动说明:
对run_command做去污染即可。
只看Tools.pm
自测:
对run_command做了专项测试，测试多行，单行结果的获取情况，自测通过
........
</msg>
</logentry>
<logentry
   revision="252458">
<author>gwl</author>
<date>2016-03-09T02:59:34.207921Z</date>
<msg>Merged revision(s) 250533 from VTP/aSV4.6/VMP4.7:
问题描述： 
	删除冗余代码，修复告警
BUG   ID: vttd34737
问题原因： 
	以前未删除
改动思路： 
	删除
做了哪些测试： 
	/cfs/alert.conf中存在vm_image_fix测试正常；删除代码及配置对应属性，显示正常
........
</msg>
</logentry>
<logentry
   revision="252457">
<author>gwl</author>
<date>2016-03-09T02:58:16.639211Z</date>
<msg>Merged revision(s) 250529 from VTP/aSV4.6/VMP4.7:
no review
vttd:34479
问题：【vs】【优化时间】【初始化异常则告警】打开虚拟存储的页面，一直都显示为正在加载的状态
修改：把检测vmp网和vs的步骤分开，初始化的时候不检查vs网
测试：没有影响原有的逻辑
........
</msg>
</logentry>
<logentry
   revision="252452">
<author>gwl</author>
<date>2016-03-09T02:48:40.686213Z</date>
<msg>Merged revision(s) 250489 from VTP/aSV4.6/VMP4.7:
问题描述： 
	【vs】【VMP】升级集群，提示错误
BUG   ID: vttd34749
问题原因： 
	提示错误
改动思路： 
	修改提示，即对应中英文
做了哪些测试： 
	验证提示是否正确
........
</msg>
</logentry>
<logentry
   revision="252450">
<author>gwl</author>
<date>2016-03-09T02:42:38.613579Z</date>
<msg>Merged revision(s) 250359 from VTP/aSV4.6/VMP4.7:
reviewid: 16021
bugid：34751
问题分析: 添加提NYTProf工具和perld工具到VMP
改动说明: 添加新库
自测:无需测试
........
</msg>
</logentry>
<logentry
   revision="252449">
<author>gwl</author>
<date>2016-03-09T02:39:32.989118Z</date>
<msg>Merged revision(s) 250349 from VTP/aSV4.6/VMP4.7:
reviewid: 16005
bugid：
问题分析：由于td17295会导致df的线程越来越多，zhx采用控制所用线程的数量；
改动说明：解决控制线程的问题，只限制df的线程；
自测：
........
</msg>
</logentry>
<logentry
   revision="252396">
<author>gwl</author>
<date>2016-03-08T11:04:45.245776Z</date>
<msg>Merged revision(s) 250322 from VTP/aSV4.6/VMP4.7:
reviewid: 16009
  Bug id: 34745
  问题分析:计算负载的时候，没有把主控优先级降低
  改动说明:在HAConfig.pm中降低10的优先级
  自测:打包后验证
........
</msg>
</logentry>
<logentry
   revision="252395">
<author>gwl</author>
<date>2016-03-08T11:04:14.464466Z</date>
<msg>Merged revision(s) 250313 from VTP/aSV4.6/VMP4.7:
reviewid: 16001
Bug id: 34738
问题分析:
/cluster/vms这个API耗时&gt;6s
使用工具查看代码耗时，分析出两处位置耗时：
①判断文件是否存在is_file_exist
②判断告警配置（遍历1600台虚拟机时，每次都去读取告警配置）

改动说明:
①get_storage_usage函数有跨主机操作，跨主机时耗时3s左右。
不少地方使用这个函数判断存储是否在线，构造一个新的检测函数（向报表读取数据），
将调用这个函数的代码改为调用新检测接口，时间大幅度降低。
②遍历虚拟机时，有vs加的告警代码，其每次都获取告警配置，然后检测，总耗时4.7s，
改为只读取一次告警配置即可，另外提了bug要求vs改掉这个检测告警的逻辑，按照VMP原有的告警检测逻辑去写代码。
自测:
①generate_cmd函数
修改前：40ms， 跨主机时3s+
修改后：20 us
②get_storage_usage耗时：40ms， 跨主机时3s+
改为从数据报表获取，耗时：20ms
③get_store_offline_vms
修改前，耗时∞+
修改后15s ， 这个15s主要是因为load_config执行了1600次

④修改了get_vms里面判断告警配置的地方
/cluster/vms
修改前：6s+
修改后：3s左右
........
</msg>
</logentry>
<logentry
   revision="252394">
<author>gwl</author>
<date>2016-03-08T10:57:14.565994Z</date>
<msg>Merged revision(s) 250249 from VTP/aSV4.6/VMP4.7:
noreview
34378 【VMP】【1人天】体检性:建议在虚拟机各分组视图上添加正在运行vm个数
........
</msg>
</logentry>
<logentry
   revision="252393">
<author>gwl</author>
<date>2016-03-08T10:56:09.274527Z</date>
<msg>Merged revision(s) 250123 from VTP/aSV4.6/VMP4.7:
reviewid: 15936
bugid：
问题分析：vmp_is_aSV函数中对run_command调用，以及使用diff命令，需要开启新的进程，消耗时间；
改动说明：取消对run_command与diff的调用，自己手动比较/sf/etc/version /sf/etc/version.server；
自测通过
........
</msg>
</logentry>
<logentry
   revision="252392">
<author>gwl</author>
<date>2016-03-08T10:55:22.761931Z</date>
<msg>Merged revision(s) 250079 from VTP/aSV4.6/VMP4.7:
noreview
34314 【VMP】【aSV】【体验性】【1人天】48台主机组建了集群之后，在也很多页面 显示主机的时候没有按照ip来排序，导致要定位到某一台主机很不方便

修改说明:
只修改了升级页面的主机列表
........
</msg>
</logentry>
<logentry
   revision="252391">
<author>gwl</author>
<date>2016-03-08T10:54:46.593648Z</date>
<msg>Merged revision(s)  from VTP/aSV4.6/VMP4.7:
</msg>
</logentry>
<logentry
   revision="252363">
<author>gwl</author>
<date>2016-03-08T06:18:41.101115Z</date>
<msg>Merged revision(s) 249937 from VTP/aSV4.6/VMP4.7:
noreview
34333 【VMP】【aSV】【0.5人天】主机详情-存储-存储测速“属性缺失”
问题分析：提交时没判断存储id
改动说明：提交时检测存储id
自测说明：
主机详情-》存储标签页
重新检测存储最大IO速率
下拉列表没加载完成前，点击开始检测
提示“请选择存储”

........
</msg>
</logentry>
<logentry
   revision="252362">
<author>gwl</author>
<date>2016-03-08T06:17:57.118342Z</date>
<msg>Merged revision(s) 249896 from VTP/aSV4.6/VMP4.7:
reviewid: 15906
Bug id: 34678
问题分析: get_nodelist多处被重复调用，消耗时间，详见bug附件
改动说明: 
改动后，从/update/step来看， 在主控资源耗尽时，API时间20s， 优化后消耗时间8s - 12s
主控资源消耗一半时，API时间6s， 优化后3s左右。
优化效率约50%

对于其它API的效率也有提升，暂未分析具体哪些提升。
........
</msg>
</logentry>
<logentry
   revision="252361">
<author>gwl</author>
<date>2016-03-08T05:19:05.094248Z</date>
<msg>Merged revision(s) 249749 from VTP/aSV4.6/VMP4.7:
reviewid: 15883
bugid：34659
问题分析：日志是由unlink函数返回值正常时，发出的提示信息日志，属于正常范畴；
改动说明：刷新频繁，删除掉；
环境：
4.8.00_B
build 2016-01-19 22:18:16
........
</msg>
</logentry>
<logentry
   revision="252360">
<author>gwl</author>
<date>2016-03-08T05:03:50.242224Z</date>
<msg>Merged revision(s) 249570 from VTP/aSV4.6/VMP4.7:
reviewid: 15833
bugid：34615
问题分析：当run_command()调用shell脚本、可执行文件返回值为1时，视为错误，输入日志；
改动说明：修改对run_command()的参数，将命令执行后退出码与指定忽略的退出码比较；
环境：
4.8.00_B
build 2016-01-19 22:18:16
自测通过
........
</msg>
</logentry>
<logentry
   revision="252359">
<author>gwl</author>
<date>2016-03-08T05:02:45.524317Z</date>
<msg>Merged revision(s) 249414 from VTP/aSV4.6/VMP4.7:
reviewid: 15791
bugid：
问题分析：解决VMP版本的性能优化问题
自测：通过
........
</msg>
</logentry>
<logentry
   revision="252358">
<author>gwl</author>
<date>2016-03-08T04:56:53.041982Z</date>
<msg>Merged revision(s) 249384 from VTP/aSV4.6/VMP4.7:
reviewid: 15784
Bug id: 34392
问题分析: vs bonding限制了arp_target 16个，导致组建vs链路聚合时，添加到聚合口失败
改动说明: 修改限制为64，考虑大了可能有影响，集群支持48台主机，64够用
自测: 上库打包验证
........
</msg>
</logentry>
<logentry
   revision="252357">
<author>gwl</author>
<date>2016-03-08T04:54:26.806336Z</date>
<msg>Merged revision(s) 249373 from VTP/aSV4.6/VMP4.7:
reviewid: 15781
Bug id: 34261
问题分析: 添加主机时，重启了被添加主机的集群服务，在等待集群稳定时，超时导致添加主机失败。
改动说明: 大集群，48台主机，需要的集群稳定时间更长，60s左右，改为5min超时。
自测: 大集群环境，vtpcm restart，原来的60s就会出现该问题。
改为5min，不出现问题
........
</msg>
</logentry>
<logentry
   revision="252356">
<author>gwl</author>
<date>2016-03-08T04:52:15.700218Z</date>
<msg>Merged revision(s) 249370 from VTP/aSV4.6/VMP4.7:
reviewid: 15780
  Bug id: 34202
  问题分析:vs添加的一块代码位于添加主机锁的外面，导致添加任务并发；导致批量添加失败；
  改动说明:修改代码，将代码加入锁的内部
  自测:
  1.修改代码，将代码加入锁的内部;
  2.登录前台，批量添加主机（添加了15台），等待结果，通过；
  环境：
  4.6.01
  build 2015-12-05 23:05:39
........
</msg>
</logentry>
<logentry
   revision="252355">
<author>gwl</author>
<date>2016-03-08T04:47:22.383327Z</date>
<msg>Revision: 249360
Author: panchao
Date: 2016年1月19日 11:02:33
Message:
reviewid: 16424
bugid：34023
问题分析：
改动说明：增加开关限制，可以touch /cfs/log_stack.switch来开启API错误堆栈日志


Modified : /VTP/aSV4.6/VMP4.7/source/app/vtp-common/Exception.pm</msg>
</logentry>
<logentry
   revision="251714">
<author>lfb</author>
<date>2016-03-01T01:39:37.690805Z</date>
<msg>大规模集群优化版本基本完成VMP集群优化，需要将优化项合入到最新的VMP版本中
SVN:251678</msg>
</logentry>
<logentry
   revision="251676">
<author>fxw</author>
<date>2016-02-29T07:58:58.494939Z</date>
<msg>noreview
关掉调试日志</msg>
</logentry>
<logentry
   revision="251655">
<author>fxw</author>
<date>2016-02-29T03:09:01.205791Z</date>
<msg>noreview
更新vs包</msg>
</logentry>
<logentry
   revision="251651">
<author>fxw</author>
<date>2016-02-29T03:00:29.120077Z</date>
<msg>noreview: debug</msg>
</logentry>
<logentry
   revision="251650">
<author>fxw</author>
<date>2016-02-29T02:56:22.449010Z</date>
<msg>noreview: debug</msg>
</logentry>
<logentry
   revision="251644">
<author>ssl</author>
<date>2016-02-29T02:39:46.833016Z</date>
<msg>[no review]【上库原因】新的客户端连接时，需要把消息序列号清零，为了和x86客户端同步</msg>
</logentry>
<logentry
   revision="251632">
<author>fxw</author>
<date>2016-02-29T00:43:03.709787Z</date>
<msg>noreview
更新vs包</msg>
</logentry>
<logentry
   revision="251631">
<author>hyq</author>
<date>2016-02-28T08:21:01.128143Z</date>
<msg>reviewid: 15565
bug id: 34979
问题描述: 使用集群锁会导致cluvmadm进程成为僵尸进程，之前已经回滚，现在把锁改为本地锁
改动说明: 把锁改为本地锁
自测场景: 测试在用户环境上测试通过的，在沧州一中的学生机集群上测试。
在vdc上一次启动两百台虚拟机，在10分钟内全部启动成功，没有启动，失败案例，测试次数3次。</msg>
</logentry>
<logentry
   revision="251542">
<author>fxw</author>
<date>2016-02-26T08:19:14.904975Z</date>
<msg>noreview
更新vs包</msg>
</logentry>
<logentry
   revision="251530">
<author>ssl</author>
<date>2016-02-26T04:01:58.897705Z</date>
<msg>[no review] 【上库原因】填SPICE_MSG_WAIT_FOR_CHANNELS消息时，传输参数错误，导致x86盒子双屏使用崩溃</msg>
</logentry>
<logentry
   revision="251508">
<author>fxw</author>
<date>2016-02-25T13:46:19.244148Z</date>
<msg>noreview
提交文档</msg>
</logentry>
<logentry
   revision="251403">
<author>fxw</author>
<date>2016-02-25T10:03:49.549633Z</date>
<msg>noreview
更新VDC镜像</msg>
</logentry>
<logentry
   revision="251374">
<author>fxw</author>
<date>2016-02-25T04:45:01.013477Z</date>
<msg>reviewid 16261
bug id 34950
review by lifan
问题分析：
更改iptables的规则，如果被清空，默认将连接都放开，防止异常的时候出问题
测试：
1./sf/etc/init.d/fw.sh stop
2./sf/etc/init.d/pmxcfs restart
前台访问不会卡</msg>
</logentry>
<logentry
   revision="251356">
<author>lcy</author>
<date>2016-02-25T02:20:36.155405Z</date>
<msg>reviewid: 16255
review by fxw
Bug id: 34878
问题分析：TD34878,【SSL研发办公环境】adesk无法连接虚拟机，影响业务，sangfor_waf连接超过限制
问题出现的根源：
waf连接满了，其他的连接请求直接被丢弃了。
改动说明：
规避方法，后台一个定时脚本在执行，每分钟检测一次，只要发现waf连接不上了，就会自动重启waf
自测：
版本：
4.8.00_B
build 2016-02-15 11:02:57
自测通过。</msg>
</logentry>
<logentry
   revision="251347">
<author>fxw</author>
<date>2016-02-25T01:19:13.688977Z</date>
<msg>noreview
更新VDC镜像</msg>
</logentry>
<logentry
   revision="251341">
<author>fxw</author>
<date>2016-02-24T12:56:04.757131Z</date>
<msg>noreview
代码更新，相应更新库</msg>
</logentry>
<logentry
   revision="251316">
<author>ssl</author>
<date>2016-02-24T09:20:26.620666Z</date>
<msg>[no review]VDI4.8代码合入，来自svn://200.200.0.40/ssl/dev/Trunk/Personal-Directory/VDI4.8/spice-0.12.5</msg>
</logentry>
<logentry
   revision="251314">
<author>chenlei</author>
<date>2016-02-24T08:54:36.896237Z</date>
<msg>no review
个人盘预加载设计文档</msg>
</logentry>
<logentry
   revision="251313">
<author>lsh</author>
<date>2016-02-24T08:51:01.757107Z</date>
<msg>noreview:
BUG ID: 34910
bug34910【老功能】主控，强制把从节点设置为主控需要修改提示信息

问题分析：
体验文案修改

改动说明：
修改非主控页面提示，及确认切换主控的效果

做了哪些测试：
jshint ok
自测 ok
</msg>
</logentry>
<logentry
   revision="251304">
<author>fxw</author>
<date>2016-02-24T07:32:20.796381Z</date>
<msg>noreview
更新vs包</msg>
</logentry>
<logentry
   revision="251297">
<author>fxw</author>
<date>2016-02-24T06:49:01.976995Z</date>
<msg>noreview
先回滚，预发布后再测</msg>
</logentry>
<logentry
   revision="251277">
<author>fxw</author>
<date>2016-02-24T04:05:31.709488Z</date>
<msg>noreview
上库打包</msg>
</logentry>
<logentry
   revision="251232">
<author>fxw</author>
<date>2016-02-23T13:09:58.958124Z</date>
<msg>noreview
spice代码更新，库文件对应更新</msg>
</logentry>
<logentry
   revision="251230">
<author>hyq</author>
<date>2016-02-23T13:08:24.599818Z</date>
<msg>reviewid : 16232
bug id : null
问题描述 : 回滚api /cluster/vmtree 去掉分组id主机编号后缀的改动,这样改导致ssl获取主机类型问题。2，存储信息剩余空间默认设置为0
改动说明 : 回滚api /cluster/vmtree 去掉分组id主机编号后缀的改动,这样改导致ssl获取主机类型问题。2，存储信息剩余空间默认设置为0</msg>
</logentry>
<logentry
   revision="251220">
<author>lcy</author>
<date>2016-02-23T12:03:35.831853Z</date>
<msg>reviewid: 16230
review by fxw
Bug id: 31144
问题分析：TD31144，【技术支持】[vmp4.7]【上海宜科信息技术有限公司----朱工QQ27757013】【VDI4.3R2】安装VMP的时候卡住了，不动了，见附件----ok
问题出现的根源：
主机启动的时候，会自动调用setupcon去设置console的字体。设置字体大小的时候，出现卡主了。
改动说明：
注释掉脚本setupcon的设置字体的命令
自测：
通过替换脚本，控制台的字体变大了。</msg>
</logentry>
<logentry
   revision="251219">
<author>lcy</author>
<date>2016-02-23T11:48:18.661689Z</date>
<msg>reviewid: 16228
review by fxw
Bug id: 31144
问题分析：TD31144，【技术支持】[vmp4.7]【上海宜科信息技术有限公司----朱工QQ27757013】【VDI4.3R2】安装VMP的时候卡住了，不动了，见附件----ok
改动说明：
上库几个原文件
自测：
无

</msg>
</logentry>
<logentry
   revision="251213">
<author>hyq</author>
<date>2016-02-23T09:46:58.237132Z</date>
<msg>reviewid : 16227
bug id : 34869
问题描述 : 【技术支持】【黑龙江省监狱管理局 赫元龙qq6203125】VMP bond口直连iscsi存储，测速、部署D进程【需要合入asv关闭硬件加速功能】
改动说明 : 合入ui，perl和内核硬件加速改动代码
测试场景 : 共享存储服务器禁用硬件加速，页面能正常启用</msg>
</logentry>
<logentry
   revision="251208">
<author>ssl</author>
<date>2016-02-23T09:21:40.351426Z</date>
<msg>[no review]VDI4.8代码合入，来自svn://200.200.0.40/ssl/dev/Trunk/Personal-Directory/VDI4.8/spice-0.12.5</msg>
</logentry>
<logentry
   revision="251203">
<author>ssl</author>
<date>2016-02-23T08:34:08.858276Z</date>
<msg>[no review]VDI4.8代码合入，来自svn://200.200.0.40/ssl/dev/Trunk/Personal-Directory/VDI4.8/spice-0.12.5</msg>
</logentry>
<logentry
   revision="251175">
<author>yangwei</author>
<date>2016-02-23T03:08:09.667085Z</date>
<msg>reviewid 16213
bugid NULL
review by fxw
说明：更新序列号授权文档</msg>
</logentry>
<logentry
   revision="251169">
<author>fxw</author>
<date>2016-02-23T02:37:37.156855Z</date>
<msg>noreview
配合代码 更改镜像名称</msg>
</logentry>
<logentry
   revision="251168">
<author>chenlei</author>
<date>2016-02-23T02:35:25.317733Z</date>
<msg>reviewid: 16209
review by: hyq
Bug id：null
问题分析：
个人盘预加载这部分代码存在硬编码，不便于维护

改动说明：
重构代码

自测：
测试了基本功能，均通过</msg>
</logentry>
<logentry
   revision="251157">
<author>lcy</author>
<date>2016-02-23T01:23:52.917023Z</date>
<msg>noreview
上传文档积累</msg>
</logentry>
<logentry
   revision="251147">
<author>hyq</author>
<date>2016-02-22T10:19:37.681559Z</date>
<msg>reviewid: 16206
bug id : 34912
问题描述: 一体机主控虚拟机跑满后，再启动HA虚拟机失败
改动说明: 把检查内存的调用函数去掉，该函数没什么用处
测试场景: 一体机主控虚拟机跑满后，再启动HA虚拟机失败</msg>
</logentry>
<logentry
   revision="251144">
<author>hyq</author>
<date>2016-02-22T10:04:10.286299Z</date>
<msg>reviewid: 16202
bug id : 34887
</logentry>
<logentry
   revision="251135">
<author>jcy</author>
<date>2016-02-22T09:41:38.551287Z</date>
<msg>noreview:
BUG ID: 34910
bug34910【老功能】主控，强制把从节点设置为主控需要修改提示信息

问题分析：
切主控是个严重的操作，改为需输入OK来确认此操作

改动说明：
修改确认切换主控的效果

做了哪些测试：
jshint ok
自测 ok
双主机集群环境
1，未配集群IP，关闭主控，登录从节点，页面提示设置从节点为主控，点击，有切换主控的提示，
     输入错误的值，提交，有提示
     输入ok，提交，能切换成功
2，有配集群IP，关闭主控，登录从节点，会跳往集群IP，从节点自动切成主控</msg>
</logentry>
<logentry
   revision="251104">
<author>fxw</author>
<date>2016-02-22T03:52:56.430525Z</date>
<msg>noreview TD34648 上库新的util-linux源代码解决，lsblk -r 空格被0x20替代的问题</msg>
</logentry>
<logentry
   revision="251103">
<author>fxw</author>
<date>2016-02-22T03:52:10.260957Z</date>
<msg>noreview TD34648 上库根据util-linux编译出的lsblk,解决了lsblk -r 空格被0x20替代的问题</msg>
</logentry>
<logentry
   revision="251075">
<author>fxw</author>
<date>2016-02-22T00:39:04.465446Z</date>
<msg>noreview
合入ssl usb映射加速，更新usb重定向库</msg>
</logentry>
<logentry
   revision="251064">
<author>hyq</author>
<date>2016-02-20T10:03:16.970378Z</date>
<msg>reviewid: 16181
bug id : 34887
问题描述: 部分日志文件名过长导致备份失败（sffs文件系统不支持过长的文件名）
改动说明: 去掉文件拷贝的中间流程，直接压缩，也可以节省备份时间
测试场景: 使用带vs存储的环境备份成功</msg>
</logentry>
<logentry
   revision="251061">
<author>chenlei</author>
<date>2016-02-20T09:54:07.582816Z</date>
<msg>reviewid: 16180
review by: hyq
Bug id：34874
问题分析：
迁移派生虚拟机到无基镜像的存储，template目录下个人盘未同步拷贝过去。

改动说明：
迁移派生虚拟机到无基镜像的存储，将template目录下个人盘也同步拷贝过去

自测：
用带个人盘的模板虚拟机在存储S1上部署一台虚拟机VM，将VM迁移到未部署过虚拟机的存储S2上，
查看存储S2的template目录下是否存在个人盘——存在</msg>
</logentry>
<logentry
   revision="251052">
<author>hyq</author>
<date>2016-02-20T07:18:11.915446Z</date>
<msg>reviewid: 16176
bug id : 34157
问题描述:vdc调用的api vtpsh get /cluster/vmtree 获取的分组接了主机ID导致下发的时候错误
改动说明:把vmgroup主机ID后缀去掉，建议后面vdc把接口换掉
测试场景:按bug回归步骤测试
1、选择10台及以上主机，使用VDC派生虚拟机
2、选择一个分组（非默认）分组，派生虚拟机</msg>
</logentry>
<logentry
   revision="251039">
<author>hyq</author>
<date>2016-02-20T06:20:22.217505Z</date>
<msg>reviewid : 16172
bug id : 34889
问题描述 :【需求】新建虚拟机获取存储信息列表存储如果存储掉线返回的信息存储总量默认置0
改动说明 : 在初始化返回信息结构中加上 total =&gt; 0 字段
测试场景 : 环境中存在掉线存储，后台运行vtpsh  get /vtpstorage/storagetree命令
掉线存储信息存在 total: 0 字段</msg>
</logentry>
<logentry
   revision="251033">
<author>fxw</author>
<date>2016-02-20T05:37:20.256632Z</date>
<msg>noreview
碰到个坑，注释一下</msg>
</logentry>
<logentry
   revision="251028">
<author>fxw</author>
<date>2016-02-20T04:59:30.039237Z</date>
<msg>noreview
添加可执行权限</msg>
</logentry>
<logentry
   revision="251027">
<author>fxw</author>
<date>2016-02-20T04:58:41.021328Z</date>
<msg>noreview
更新spice库</msg>
</logentry>
<logentry
   revision="251026">
<author>fxw</author>
<date>2016-02-20T04:56:43.535637Z</date>
<msg>noreview usbredir的configure没有执行权限，更新下</msg>
</logentry>
<logentry
   revision="251025">
<author>fxw</author>
<date>2016-02-20T04:53:35.433451Z</date>
<msg>noreview 防止configure没有执行权限</msg>
</logentry>
<logentry
   revision="251024">
<author>fxw</author>
<date>2016-02-20T04:52:39.819333Z</date>
<msg>noreview 修改依赖的头文件</msg>
</logentry>
<logentry
   revision="251023">
<author>chenlei</author>
<date>2016-02-20T04:36:04.911708Z</date>
<msg>reviewid: 16171
review by: fxw
Bug id：34840
问题分析：
xp系统还需要个人盘MBR扇区的签名信息

改动说明：
找到派生虚拟机个人盘的第一个扇区，从偏移0x1b8处开始读4个字节（签名信息），通过cpuid来传递给guest机;

自测：
派生一台带个人盘的虚拟机，使用cpuid工具发送cpuid（ebx填0x100c），host机返回的签名信息位于ecx寄存器。</msg>
</logentry>
<logentry
   revision="251014">
<author>fxw</author>
<date>2016-02-20T03:42:46.597350Z</date>
<msg>noreview
合入入SSL usb映射加速优化，漏了新增文件</msg>
</logentry>
<logentry
   revision="251013">
<author>fxw</author>
<date>2016-02-20T03:36:15.334606Z</date>
<msg>noreview 将更改的usbredir-0.6压缩更新</msg>
</logentry>
<logentry
   revision="251012">
<author>fxw</author>
<date>2016-02-20T03:33:50.412507Z</date>
<msg>noreview
何入SSL usb映射加速优化</msg>
</logentry>
<logentry
   revision="251001">
<author>fxw</author>
<date>2016-02-20T02:35:35.598547Z</date>
<msg>noreview
SSL要修改usbredir-0.6，先上库原始代码，从以下压缩包解压得到
svn://200.200.0.10/vt/vt/VTP/VMP4.7/Trunk/source/packages/usbredir-0.6.tar.bz2</msg>
</logentry>
<logentry
   revision="250996">
<author>fxw</author>
<date>2016-02-20T02:07:23.405722Z</date>
<msg>noreview
新的lsblk输出跟老的不一致，先回滚</msg>
</logentry>
<logentry
   revision="250986">
<author>chenlei</author>
<date>2016-02-19T11:12:15.233615Z</date>
<msg>reviewid: 16162
review by: hyq
Bug id：34840
问题分析：
第一块不含backing_file的块设备有可能是cdrom，需要将其过滤掉

改动说明：
找到派生虚拟机第一块不含backing_file的磁盘大小，通过cpuid来传递给guest机;
过滤掉光驱

自测：
派生一台带个人盘的虚拟机，使用cpuid工具发送cpuid（ebx填0x100b），host机返回的个人盘大小
位于ecx和edx两个寄存器，磁盘大小正确。</msg>
</logentry>
<logentry
   revision="250984">
<author>hyq</author>
<date>2016-02-19T11:01:38.594498Z</date>
<msg>reviewid : 16163
bug id : 34663
问题描述 : td34663:[虚拟机]重置电源直接打印成功，不管有没有重置成功
改动说明 : 重置失败是vtpvm命令里检测到时虚拟机重置则打印日志
测试场景 : 通过修改代码抛出异常测试</msg>
</logentry>
<logentry
   revision="250923">
<author>ssl</author>
<date>2016-02-19T02:31:42.037555Z</date>
<msg>[no review]VDI4.8代码合入，来自svn://200.200.0.40/ssl/dev/Trunk/Personal-Directory/VDI4.8/spice-0.12.5</msg>
</logentry>
<logentry
   revision="250906">
<author>chenlei</author>
<date>2016-02-18T13:21:45.932903Z</date>
<msg>reviewid: 16142
review by: hyq
Bug id：34822
问题分析：
模板转换成虚拟机，如果模板打过快照，快照中会残留personal_disk_loaded字段

改动说明：
去掉快照中会残留personal_disk_loaded字段

自测：
1.新建虚拟机，转换成模板，打快照。模板配置和快照配置中含有personal_disk_loaded
字段；
2.转换成虚拟机，检查配置，配置中（包括快照）没有personal_disk_loaded字段残留；</msg>
</logentry>
<logentry
   revision="250891">
<author>chenlei</author>
<date>2016-02-18T12:06:27.137904Z</date>
<msg>reviewid: 16141
review by: hyq
Bug id：34785
问题分析：
备份恢复的存储如果是local，其存储id会带hostid前缀（形如hostid_local），之前的编码没有处理好，
导致拷贝镜像时路径出错。

改动说明：
在组装路径时，将hostid_local替换成local

自测：
1.在A主机的local上准备几个含有预加载个人盘的模板虚拟机，将这些虚拟机备份到B主机的local上
2.恢复到原位置——pass
3.恢复到备份位置——pass
4.恢复到指定存储——pass

虚拟机位于共享存储S1，备份到共享存储S2
5.恢复到原位置——pass
6.恢复到备份位置——pass
7.恢复到指定位置（某主机local）——pass</msg>
</logentry>
<logentry
   revision="250886">
<author>fxw</author>
<date>2016-02-18T11:36:13.653824Z</date>
<msg>noreview
更新说明</msg>
</logentry>
<logentry
   revision="250884">
<author>fxw</author>
<date>2016-02-18T11:28:53.468583Z</date>
<msg>noreview
更新qxl id</msg>
</logentry>
<logentry
   revision="250880">
<author>fxw</author>
<date>2016-02-18T11:20:12.958074Z</date>
<msg>noreview
qxl 的revesion改了，ID也需要改</msg>
</logentry>
<logentry
   revision="250875">
<author>hyq</author>
<date>2016-02-18T09:58:15.257748Z</date>
<msg>reviewid : 16138
bug id : 34852
reviewed by : lcy
问题描述 : 【迁移】虚拟机冷迁移运行位置，迁移页面显示的运行位置有问题
改动说明 : 虚拟机如果在运行才返回虚拟机的运行位置，另外如果虚拟机运行位置为自动选择且没运行过，运行位置设置为自动选择
测试场景 : 虚拟机刚创建且运行位置选择为自动选择</msg>
</logentry>
<logentry
   revision="250874">
<author>fxw</author>
<date>2016-02-18T09:57:03.990676Z</date>
<msg>noreview TD34648 上库根据util-linux编译出的lsblk</msg>
</logentry>
<logentry
   revision="250872">
<author>fxw</author>
<date>2016-02-18T09:51:38.447001Z</date>
<msg>noreview TD34648 上库源代码</msg>
</logentry>
<logentry
   revision="250822">
<author>chenlei</author>
<date>2016-02-17T11:54:30.757371Z</date>
<msg>reviewid: 16120
review by: fxw
Bug id：34840
问题分析：
xp系统的磁盘注册表项与磁盘大小相关，需要host机将个人盘的大小信息传递给guest机

改动说明：
找到派生虚拟机第一块不含backing_file的磁盘大小，通过cpuid来传递给guest机

自测：
派生一台带个人盘的虚拟机，使用cpuid工具发送cpuid（ebx填0x100b），host机返回的个人盘大小
位于ecx和edx两个寄存器，磁盘大小正确。</msg>
</logentry>
<logentry
   revision="250798">
<author>hyq</author>
<date>2016-02-17T09:14:56.930477Z</date>
<msg>reviewid : 16117
bug id : 34813
reviewed by : lcy
问题描述: vmp控制台重置虚拟机调用了03restart.pl这个脚本，该脚本在虚拟机内部重启的时候调用，导致多打了一个日志
改动说明: 虚拟机重启时如果失败才打印日志，成功就不打了
测试场景: 普通虚拟机和HA虚拟机重置电源，查看是否多打了日志</msg>
</logentry>
<logentry
   revision="250771">
<author>fxw</author>
<date>2016-02-17T03:45:48.653083Z</date>
<msg>noreview
更新qxl version为V16</msg>
</logentry>
<logentry
   revision="250770">
<author>lcy</author>
<date>2016-02-17T03:44:35.656380Z</date>
<msg>reviewid: 16110
review by fxw
Bug id: 34828
问题分析：TD34828,【HA】【优化】HA对于磁盘加密的虚拟机，在后台打印日志说明，方便定位问题
问题出现的根源：
磁盘加密的虚拟机，在需要HA拉起的时候，没有拉起，也没有任何说明。
导致不知道为什么这个虚拟机没有被拉起，还有后台看虚拟机的状态文件发现会有异常
改动说明：
在后台日志中打印说明这个虚拟机为什么没有被拉起，修改虚拟机的电源状态文件，让其正常。
自测：
环境：
4.8.00_B
build 2016-02-15 11:02:57
步骤：
1. 新建一台虚拟机，后台修改配置文件，让其磁盘是加密的。
2. 后台修改电源文件，把虚拟机的电源置为on，cnt=0
3. tail -f sfvt_vtprgm.log可以看到日志打印出来说明这个虚拟机已经被加密了，不会拉起，并且把电源状态设置为off
4. 后台查看这个虚拟机的电源状态为off</msg>
</logentry>
<logentry
   revision="250751">
<author>lcy</author>
<date>2016-02-17T02:39:47.111237Z</date>
<msg>reviewid: 16105
review by hyq
Bug id: 34825
问题分析：TD34825,启用HA的VDC虚拟机，勾选主机开机后启动，选项失效
问题出现的根源：
在获取需要进行开机自启动的虚拟机的时候，没有把集群的VDC虚拟机放到启动列表里面。
导致，一直没有把VDC开机拉起。
改动说明：
对集群的VDC虚拟机进行特殊处理，在代码中放到$resList列表里。提供给startall接口使用
自测：
环境：
4.8.00_B
build 2016-02-15 11:02:57
步骤：
1. 新建一台集群的VDC虚拟机，指定运行位置为从节点，并且把虚拟机设置为开机自启动
2. 保证当前主机的资源可以启动这台虚拟机，重启主机
3. 重启主机之后，虚拟机可以开机自启动。</msg>
</logentry>
<logentry
   revision="250735">
<author>hyq</author>
<date>2016-02-16T12:57:23.576526Z</date>
<msg>reviewid : 16104
bug id : 34810
reviewed by : lcy
问题描述：td34810【备份恢复】备份到另一台主机local存储失败，报错：与qemu-nbd建立连接失败。
改动说明: 选择节点判断是否是本地存储
测试场景:
A主机本地存储原位置备份
A主机本地存储备份到A主机另外一个本地存储
A主机本地存储备份到B主机本地存储
A主机本地存储备份到B主机另外一个本地存储
A主机本地存储备份到共享存储（只有A能访问）
A主机本地存储备份到共享存储（只有B主机能访问）
A主机本地存储备份到共享存储（A、B都能访问）

共享存储访问情况（只有A能访问，只有B能访问，A、B都能访问）
A主机共享存储原存储备份
A主机共享存储备份到A主机本地存储
A主机共享存储备份到A主机另外一个本地存储
A主机共享存储备份到B主机本地存储
A主机共享存储备份到B主机另外一个共享存储</msg>
</logentry>
<logentry
   revision="250719">
<author>fxw</author>
<date>2016-02-16T09:48:59.544419Z</date>
<msg>reviewid 16101
bug id 34824
review by zyj
问题分析：
合入qemu社区bugfix
http://git.qemu.org/?p=qemu.git;a=commit;h=e8d3b1a25f284cdf9705b7cf0412281cc9ee3a36
http://git.qemu.org/?p=qemu.git;a=commit;h=fcf5def1ab0f94ff120b7141c943b517d2ece83d
测试：
1、编译通过</msg>
</logentry>
<logentry
   revision="250708">
<author>hyq</author>
<date>2016-02-16T08:08:52.027339Z</date>
<msg>reviewid : 16096
bug id: 34823
问题描述:提供一个不需要传hostid的获取spice接口
改动说明:
以前的接口非集群虚拟机获取spice状态需要提供虚拟机所在主机的ID
HTTP:           POST /vapi/json/nodes/{node}/qemu/{vmid}/spice
CLI:    vtpsh create /nodes/{node}/qemu/{vmid}/spice
集群虚拟机接口：
HTTP:           POST /vapi/json/nodes/{node}/qemu/{vmid}/spice
CLI:    vtpsh create /nodes/{node}/qemu/{vmid}/spice
现在修改为：统一用集群虚拟机接口
测试场景:
新建两台虚拟机A和B，虚拟机A为集群虚拟机，虚拟机B为普通虚拟机，启动虚拟机
后台调用命令
vtpsh create /cluster/qemu/{vmidA}/spice
vtpsh create /cluster/qemu/{vmidB}/spice
命令执行成功</msg>
</logentry>
<logentry
   revision="250686">
<author>chenlei</author>
<date>2016-02-16T03:23:30.004577Z</date>
<msg>reviewid: 16091
review by: fxw
Bug id：34761
问题分析：
集群锁超时时间设置过长，导致另外一台主机一直获取不到锁，从而不断尝试拉起操作。

改动说明：
修改心跳更新频率为5秒（heartbeat_time）、心跳超时时间为35秒（heartbeat_timeout）

自测：
需要打新包验证</msg>
</logentry>
<logentry
   revision="250632">
<author>hyq</author>
<date>2016-02-15T08:34:39.055006Z</date>
<msg>reviewid : 16079
bug id: 34806
问题描述: 之前为了方便开发查问题，gwl添加了在程序抛出异常的地方打印堆栈到日志，默认开启
改动说明: 将其设置为默认不开启，修改后通过命令touch /cfs/log_stack.switch开启
测试场景: 查看sfvt_vtpdaemon.log日志， api执行失败后不再打印堆栈日志。</msg>
</logentry>
<logentry
   revision="250622">
<author>fxw</author>
<date>2016-02-15T07:46:25.209392Z</date>
<msg>noreview
新增VMP4.8修改列表</msg>
</logentry>
<logentry
   revision="250598">
<author>hyq</author>
<date>2016-02-15T03:06:16.915388Z</date>
<msg>reviewid : 16078
bug id : 34791
问题描述 : 本地存储虚拟机重复备份到异地本地存储失败
改动说明：
获取磁盘大小，访问虚拟机当前磁盘，应当使用当前主机；
获取备份位置磁盘大小才需要使用备份位置ip
测试：
备份虚拟机到从节点的local存储，备份成功(见td28263)</msg>
</logentry>
<logentry
   revision="250591">
<author>dongxia</author>
<date>2016-02-01T02:44:08.808916Z</date>
<msg>reviewid :16076
bug id :34802
问题分析：没用use plog
改动说明：添加use plog</msg>
</logentry>
<logentry
   revision="250539">
<author>vs</author>
<date>2016-01-31T03:38:03.537507Z</date>
<msg>问题描述： 
【vs】【优化时间】【初始化异常则告警】打开虚拟存储的页面，一直都显示为正在加载的状态
BUG   ID: vttd34479
问题原因： 
	初始化的时候检测vs网络，可能会有问题
改动思路： 
	初始化的时候只检测vmp网络
做了哪些测试： 
断网时（vs网，vmp网）新建，迁移，克隆，删除，模板部署，新建、删除分组，上传等仍然是限制
正常情况不会产生影响
reviewid 16065, commited by wzl, reviewed by lzj</msg>
</logentry>
<logentry
   revision="250534">
<author>dongxia</author>
<date>2016-01-31T02:35:39.579294Z</date>
<msg>reviewid :16060
bug id :34699
问题分析：
   问题：不同主机之间的local存储之间的迁移发现个人盘丢失
   分析：个人盘迁移是分两步进行的：1、生成源和目的的迁移路径 2、找到目的主机，迁移到目的主机的目标路径下
   之前单主机的local存储和共享存储之间的迁移存在问题是因为生成目的路径的方式错误，导致虚拟机个人盘迁移到了别的路径下
   现在不同主机之间的local存储之间迁移存在问题是因为：虽然生成目的路径的方式是正确的，但是获得目的主机的ip的方式也存在问题，当是local存储之间的迁移的时候获得的是本地主机的IP，从而导致即使目的路径是正确的最终却在本地主机下生成目的路径并迁移个人盘到该位置，而个人盘并没有迁移到目的主机上
改动说明：
   修改VTP::QemuMigrate::migrate_personal_disk中获取目的主机IP的流程，对于local存储和共享存储按照不同的方式获取IP，避免是local的时候一直只获得本地的IP
自测：
环境：172.28.161.14-16 admin/admin123.
1、模板虚拟机位于local存储(非系统盘)，迁移模板到共享存储，检查模板image目录，个人盘存在 -------pass
2、模板虚拟机位于local存储(系统盘)，迁移模板到共享存储，检查模板image目录，个人盘存在   -------pass
3、模板虚拟机位于非local存储，迁移模板到local存储，检查模板image目录，个人盘存在         -------pass
4、模板虚拟机位于local存储（非系统盘），迁移到另一主机local存储（非系统盘），检查模板image目录，个人盘存在 -------pass
5、模板虚拟机位于local存储（系统盘），迁移到另一主机local存储（非系统盘），检查模板image目录，个人盘存在   -------pass
6、模板虚拟机位于local存储（非系统盘），迁移到另一主机local存储（系统盘），检查模板image目录，个人盘存在 -------pass
7、模板虚拟机位于local存储（系统盘），迁移到另一主机local存储（系统盘），检查模板image目录，个人盘存在   -------pass</msg>
</logentry>
<logentry
   revision="250495">
<author>jcy</author>
<date>2016-01-30T06:51:14.370405Z</date>
<msg>noreview：
改动说明：
bug34778，【更新模板计划】更新模板计划，指定时间更新，选择不到靠后的日期
把选日期的弹出框放到输入框的上面，放下面不够显示</msg>
</logentry>
<logentry
   revision="250435">
<author>fxw</author>
<date>2016-01-29T09:21:18.538702Z</date>
<msg>noreview
把spice的编译脚本加入opus动态库，并重新上库spice</msg>
</logentry>
<logentry
   revision="250396">
<author>hyq</author>
<date>2016-01-29T06:25:00.865607Z</date>
<msg>reviewid: 16014
bug id : 34747
问题描述 : 虚拟机内部重启失败，日志描述有问题
改动说明 : 对虚拟机内部启动失败信息进行处理
自测场景 : 
正常情况
1、启动一台普通虚拟机（win7），进入虚拟机控制台，虚拟机内部重启，UI页面有打日志显示成功
2、启动一台HA虚拟机（win7）,进入虚拟机控制台，虚拟机内部重启，UI页面有打日志，显示成功
失败情况:按照上述步骤，构造异常情况（比如内存不足），在虚拟机内部自启动，虚拟机启动失败，提示信息正确</msg>
</logentry>
<logentry
   revision="250393">
<author>vs</author>
<date>2016-01-29T06:20:16.294942Z</date>
<msg>问题描述： 
	数据平衡时间代码为硬代码，截止时间被写死
BUG   ID: 30936
问题原因： 
	最大时间设计为2020-12-31，太短了
改动思路： 
	是开源的代码，就是这么用的改成最大为2999-12-31
做了哪些测试： 
	点击设置时间，可以超过2020-12-31
reviewid 16022, commited by wzl, reviewed by fxw</msg>
</logentry>
<logentry
   revision="250387">
<author>chenlei</author>
<date>2016-01-29T03:53:18.646113Z</date>
<msg>reviewid: 16027
review by: hyq
Bug id：34756
问题分析：
虚拟机的名称采用特殊字符，比如()[]{}（）【】｛｝@|._-+，转换模板时，这些特殊字符会出现在shell命令
中的路径上，导致执行shell命令会失败。

改动说明：
对于个人盘预加载中涉及到的shell命令，路径字符串都用单引号包裹，取消特殊字符的特殊含义。

自测：
1.新建虚拟机，转换模板，转换成功，配置正确；
2.将上述模板转换成虚拟机，转换成功，环境清理，配置正确；
3.新建虚拟机A，直接从A部署几台虚拟机，部署成功，配置正确。</msg>
</logentry>
<logentry
   revision="250320">
<author>hyq</author>
<date>2016-01-28T09:55:56.482902Z</date>
<msg>reviewid : 16008
bug id: 34743
问题描述 ： 拷贝镜像函数中修改镜像名称目的路径没用单引号括起来导致修改失败
改动说明 ：用单引号括起来屏蔽特殊字符
自测场景 ：新建一台虚拟机，名称为Win7x86(学生机)，直接用虚拟机部署一台虚拟机，能够部署成功</msg>
</logentry>
<logentry
   revision="250319">
<author>dongxia</author>
<date>2016-01-28T09:52:09.441313Z</date>
<msg>reviewid :16006
bug id :34699
问题分析：
   迁移模板时，镜像和个人盘的迁移是分开的，迁移个人盘的函数中生成迁移目的路径的方式有问题，导致如果是和本地存储相关的迁移，最终个人盘被迁移到错误的地方，从而真正的image目录下没有个人盘；

改动说明：
   修改VTP::QemuMigrate::migrate_personal_disk函数，按照迁移镜像时生成目的路径的方式修改此函数中生成目的路径的代码
自测：
   环境：VMP4.8 172.28.162.95
   1、模板虚拟机位于local存储(非系统盘)，迁移模板，检查模板image目录，个人盘存在 -------pass
   2、模板虚拟机位于local存储(系统盘)，迁移模板，检查模板image目录，个人盘存在   -------pass
   3、模板虚拟机位于非local存储，迁移模板，检查模板image目录，个人盘存在         -------pass</msg>
</logentry>
<logentry
   revision="250270">
<author>vs</author>
<date>2016-01-28T05:18:35.848229Z</date>
<msg>问题描述： 
	显示私网IP冲突，提示信息更加清晰，不应该显示被占用，应该显示冲突
BUG   ID: 30959
问题原因： 
	
改动思路： 
	配置的虚拟存储IP（192.168.171.101,192.168.171.102） 冲突，请重新配置！
做了哪些测试：
reviewid 15969, commited by yangyf, reviewed by yinxin</msg>
</logentry>
<logentry
   revision="250252">
<author>fxw</author>
<date>2016-01-28T03:05:51.957894Z</date>
<msg>noreview
spice代码更新，对应更新spice库</msg>
</logentry>
<logentry
   revision="250250">
<author>fxw</author>
<date>2016-01-28T03:03:12.767194Z</date>
<msg>noreview
配合ssl，增加新的qxl version
还有250880 250771也是相关修改</msg>
</logentry>
<logentry
   revision="250173">
<author>chenlei</author>
<date>2016-01-27T03:43:17.247742Z</date>
<msg>reviewid: 15970
review by: hyq
Bug id：34715
问题分析：
最初设计的判断模板虚拟机是否已经预加载过个人盘的方式，是通过检查模板image目录下是否存在personal_disk文件。
大多数情况下，personal_disk的存在性与个人盘是否预加载过是一致的，所以之前也没发现这种方法的存在问题。
在快照恢复这种场景就有问题，预加载之前打快照A，预加载完成，又回滚到A快照，这样操作就出现了上面提到的不一致的问题。

改动说明：
模板预加载完成之后，在模板虚拟机的配置文件中新增一个字段personal_disk_loaded，用于标识个人盘已经加载，
只有当配置中存在该字段，并且personal_disk.qcow2文件也存在，才认为模板已经加载过个人盘。

自测：
1. 新建普通虚拟机，转换模板，后台查看image和cfs目录下的配置文件，新增了personal_disk_loaded：1，image目录下存在personal_disk.qcow2；
2. 新建普通虚拟机A,通过A直接部署几台虚拟机，后台查看image、template和cfs目录下的配置文件与personal_disk.qcow2均存在；
3. 验证备份恢复，对上面的虚拟机A，后台将image、template和cfs目录下的配置文件中的新增了personal_disk_loaded字段或personal_disk.qcow2删掉，
更新模板，会预加载个人盘，三个路径下的配置文件中的新增了personal_disk_loaded字段都会恢复，image目录下的personal_disk.qcow2会恢复，
（template目录下的personal_disk.qcow2会在下次部署时恢复）；
4. 验证克隆，克隆后配置和个人盘都在；
5. 验证导入导出，导出再导入，新虚拟机个人盘和配置的新增字段均没有。
6. 验证迁移，移动到其他目录，其他存储，配置和个人盘都在。</msg>
</logentry>
<logentry
   revision="250129">
<author>hyq</author>
<date>2016-01-26T12:12:54.987591Z</date>
<msg>reviewid: 15963
bug id: 34677
问题描述:HA拉起虚拟机失败报错不详细
改动说明:改了下提示，把提示改为“HA拉起虚拟机失败，集群内找不到可以运行该虚拟机的主机！请尝试手动启动该虚拟机！”
自测场景:
1、修改代码，直接报错误信息打出来。
2、主要测试勾选HA配置的第二项（主机管理通信网口和虚拟机通过网桥连接的物理网口掉线），其它主机是否尝试将该虚拟机拉起。</msg>
</logentry>
<logentry
   revision="250076">
<author>hyq</author>
<date>2016-01-26T07:54:53.227902Z</date>
<msg>reviewid: 15950
bug id: 34575
问题描述:获取物理节点调用函数流程里get_remain_memory---&gt;get_running_vms_memory---&gt;check_vs_max_vms
如果一体机虚拟机台数超限，check_vs_max_vms会抛出异常。导致api调用失败
改动说明:在get_remain_memory函数添加个参数用于判断需不需要检查最大可开机台数
自测场景:在测试环境172.28.162.91（改型号一体机最大支持14台虚拟机）上启动14台虚拟机，查看主机详情页面是否显示正常
（代码被覆盖，重新上库）</msg>
</logentry>
<logentry
   revision="250075">
<author>dongxia</author>
<date>2016-01-26T07:48:55.904966Z</date>
<msg>reviewid :15945
bug id :34616
问题分析：
   问题:批量启动虚拟机，虚拟机启动成功，出现报错：Insecure dependency in sprintf while running with -T switch at /usr/share/perl5/VTP/RPCEnvironment.pm line 1206.
   出现原因：VTP::RPCEnvironment::active_workers line1206中调用sprintf操作task-&gt;{status},而task-&gt;{status}是由VTP::Tools::upid_read_status中得到，当存在一些情况导致status被设为：unable to open file - $!，由于涉及文件读写$!中带有一些特殊信息时再通过sprintf操作 perl 就会认为此信息是被污染的信息，由此触发污染模式 -T 告警.
改动说明：
   修改VTP::Tools::upid_read_status，当对文件操作出错的时候status设为unable to open file 而$!中的信息放入日志，防止status带有特殊信息触发污染模式告警。
自测：
   环境：172.28.162.91
   1、为了重现该错误，修改代码Tools::upid_read_status 使status由于目录原因被设为uable to open file - No such file or directory 
   2、改动前，对虚拟机多次操作：批量启动、关机。。能够出现报错：Insecure dependency in sprintf while running with -T switch at /usr/share/perl5/VTP/RPCEnvironment.pm line 1206.
   3、改动后，只让status被设为unable to open file ，重复多次对虚拟机进行启动、修改等操作，均不会触发污染模式告警。</msg>
</logentry>
<logentry
   revision="250065">
<author>hyq</author>
<date>2016-01-26T06:48:03.658440Z</date>
<msg>reviewid: 15943
bug id: 34578
问题描述: 把static_arp_cache_add.pl加入到软狗监控进程
改动说明: 在/etc/sangfor/sdog.conf文件中加入服务static_arp_cache_add.pl
测试场景: 找到static_arp_cache_add.pl进程并杀死后，该进程能被再次拉起</msg>
</logentry>
<logentry
   revision="250061">
<author>chenlei</author>
<date>2016-01-26T06:19:05.043922Z</date>
<msg>reviewid: 15921
review by: fxw
Bug id：34686
问题分析：
对于加密的个人盘，在虚拟机第一次开机的时候VMP会去初始化密码，
而新旧模板的个人盘qcow2文件结构不同（旧模板已加密，新模板未加密），
走相同的流程导致旧模板派生的虚拟机初始化密码失败。

改动说明：
在初始化密码的地方增加一个分支判断是新模板派生还是旧模板派生，兼容旧模板

自测：
1. 在VDC上用旧模板部署几台带加密盘的虚拟机，VDC上启动虚拟机，启动成功；
2. 在VDC上用新模板部署几台带加密盘的虚拟机，VDC上启动虚拟机，启动成功。</msg>
</logentry>
<logentry
   revision="250051">
<author>lcy</author>
<date>2016-01-26T03:40:22.785294Z</date>
<msg>reviewid: 15938
review by fxw
Bug id: 34676
问题分析：TD34676,【检测vmp系统】安装了vmp的raid盘，不能检测出来
问题出现的根源：
raid的前缀标识是mdxxx，然后其分区的标识是mdxxxp1 mdxxxp2
普通的磁盘是sdxxx
在判断是否有安装了VMP系统的时候，组装字符串没有考虑到raid模式的磁盘标志
改动说明：
对raid模式的磁盘标志进行特殊的判断
自测：
后台运行脚本通过。还需要打包验证。</msg>
</logentry>
<logentry
   revision="250032">
<author>lcy</author>
<date>2016-01-26T01:59:55.812807Z</date>
<msg>reviewid: 15932
review by hyq
Bug id: 34674
问题分析：TD34674,【存储详情】非系统所在的本地存储，基本信息中的最大IO读写速率没有值
问题出现的根源：
之前VS修改过测速的代码，改动引发的。之前把所有存储在测速的时候，都往配置文件写了hostid的标识。
导致，读取的时候，出现数据格式不能解释的问题。
改动说明：
在测速的数据写入到配置文件的时候，对存储类型加上一个判断。按照原有的流程，local和VS
才加上hostid的标识
自测：
环境：
4.8.00_B
build 2016-01-22 23:57:21
自测步骤：
1. 主机A有一块非系统盘的本地磁盘。打开存储页面，测试存储速度。测速成功，显示正常。
2. 主机详情页面的存储列表中，速度显示正常
3. 新建虚拟机页面的存储下拉列表的速度显示正常。</msg>
</logentry>
<logentry
   revision="250009">
<author>hyq</author>
<date>2016-01-25T12:32:49.350292Z</date>
<msg>reviewid: 15928
bug id: 34575
问题描述:获取物理节点调用函数流程里get_remain_memory---&gt;get_running_vms_memory---&gt;check_vs_max_vms
如果一体机虚拟机台数超限，check_vs_max_vms会抛出异常。导致api调用失败
改动说明:在get_remain_memory函数添加个参数用于判断需不需要检查最大可开机台数
自测场景:在测试环境172.28.162.91（该型号一体机最大支持14台虚拟机）上启动14台虚拟机，查看主机详情页面是否显示正常</msg>
</logentry>
<logentry
   revision="249992">
<author>hyq</author>
<date>2016-01-25T11:08:23.519500Z</date>
<msg>reviewid: 15912
bug id: 24360
问题描述: td24360:虚拟存储上的虚拟机克隆，进度条显示不对
改动说明: 按照最大30M每秒的速率拷贝，超过30M每秒截取为30M（考虑到vs存储缓存）
存在两种特殊场景: 
1、网络速率较慢的情景下可能还是会在95%卡顿一小段时间
2、网络速率很快的情景下进度条在不到90%退出
自测场景: 克隆一台虚拟存储上的虚拟机到其所在的存储，观察页面进度条是否异常</msg>
</logentry>
<logentry
   revision="249948">
<author>dongxia</author>
<date>2016-01-25T08:23:04.065120Z</date>
<msg>reviewid :15914
bug id :33638
问题分析：
虚拟机开机启动失败，修改提示信息
1、非HA虚拟机，开机启动如果虚拟存储不在线，报错：磁盘不存在
2、HA虚拟机，开机启动如果虚拟存储不在线，报错：找不到主机（xxx）可访问的存储
非HA虚拟机启动过程中对于存储是否在线的检查存在问题：
   检查存储是否在线的VTP::Storage::is_storage_online函数中的$plugin-&gt;check_connection 调用的是VTP::Storage::DirPlugin中的check_connection函数但是DirPlugin中没有对check_connection进行实现，从而直接调用了基类Plugin中的函数直接返回1，所以在存储不在线的情况下也检查存储还是返回存储在线，从而导致启动虚拟机继续访问磁盘，出现磁盘不存在的报错。
改动说明：
   在VTP::Storage::DirPlugin中增加对check_connection的实现，通过调用/sf/vs/bin/vs_is_ready.sh检查虚拟存储是否在线
自测：
环境：172.28.162.148
1、在环境上分别创建多台HA虚拟机、使用虚拟存储的非HA虚拟机、使用本地存储的非HA虚拟机
2、重启环境后，立即启动虚拟机，观察启动失败时的报错
3、HA虚拟机启动失败报错：整个集群找不到可供（xxx）启动的主机： 主机（xxx）不可访问虚拟机所在存储 ---- pass
   使用虚拟存储虚拟机报错：存储（%s）掉线 ----pass
   使用本地存储虚拟机正常启动</msg>
</logentry>
<logentry
   revision="249903">
<author>lcy</author>
<date>2016-01-25T02:46:02.359128Z</date>
<msg>reviewid: 15909
review by fxw
Bug id: 34682
问题分析：TD34682,【聚合网口】带网关的聚合网口连接了虚拟交换机之后，重置异常
问题出现的根源：
聚合网口连接了虚拟交换机之后，虚拟交换机激活之后，会把IP信息迁移到虚拟交换机上。
再次重置聚合网口的IP信息的时候，后台是先down网口，然后up网口。在up之前，会去回调一个脚本把IP信息先清理掉，
然后设置新的IP信息。但是，之前由于这个脚本没有把聚合网口考虑进去，导致聚合网口直接被过滤掉了。
所以，在修改聚合网口的IP的时候，会有异常。
改动说明：
在回调脚本里增加对聚合网口的支持
自测：
环境：
4.8.00_B
build 2016-01-21 23:59:28
自测步骤：
1.聚合网口连接了虚拟交换机，聚合网口配置网关
2.虚拟机连接这个聚合网口
3.后台查看保证虚拟交换机激活了
4.修改聚合网口的IP
5.后台ifconfig查看IP信息正常。聚合网口没有IP，虚拟交换机有IP。</msg>
</logentry>
<logentry
   revision="249824">
<author>hyq</author>
<date>2016-01-22T13:54:54.442557Z</date>
<msg>reviewid : 15903
bug id: 34578
问题描述: 【需求建议】当VMP与网络中其他的设备的IP冲突，需要能够告警通知管理员（32266）
改动说明: 添加一个告警项，把arp功能整合成一个模块文件，方便后续扩展功能使用，把定时执行任务更新任务放到/sf/etc/init.d/目录下开机启动，并添加到软狗监控
自测场景:测试场景中告警检查频率30分钟一次
主机
200.200.103.240
200.200.103.246
200.200.103.250
局域网内存在主机200.200.103.245
修改主机200.200.103.246的iP为200.200.103.245后大概一小时告警栏出现告警</msg>
</logentry>
<logentry
   revision="249823">
<author>hyq</author>
<date>2016-01-22T13:26:45.525930Z</date>
<msg>reviewid : 15902
bug id: 34578
问题描述: 【需求建议】当VMP与网络中其他的设备的IP冲突，需要能够告警通知管理员（32266）
改动说明: 添加一个告警项，把arp功能整合成一个模块文件，方便后续扩展功能使用，把定时执行任务更新任务放到/sf/etc/init.d/目录下开机启动，并添加到软狗监控
自测场景:测试场景中告警检查频率30分钟一次
主机
200.200.103.240
200.200.103.246
200.200.103.250
局域网内存在主机200.200.103.245
修改主机200.200.103.246的iP为200.200.103.245后大概一小时告警栏出现告警</msg>
</logentry>
<logentry
   revision="249802">
<author>lcy</author>
<date>2016-01-22T09:51:57.809626Z</date>
<msg>reviewid: 15897
review by fxw
Bug id: 34207
问题分析：TD34207,【网口vlan配置】切换集群通信口到配置了vlan的网口，集群分裂
是非必现问题。
在切换集群通信口的函数里面，打印一些调试日志。以后出现可以及时查看日志找到问题的根源。
这些日志只有切换集群通信口才会有的。不影响其他功能的使用。
自测：
切换集群通信口，调试日志打印正常。</msg>
</logentry>
<logentry
   revision="249797">
<author>yangwei</author>
<date>2016-01-22T09:17:17.106727Z</date>
<msg>reviewid 15896
review by fxw
bugid 34313
问题分析：
一个服务器装有两个VMP系统，导致local分区挂载混乱
改动说明：
1、非主控不处理；
2、修改描述，主机name以/cfs/nodes/{HOSTID}/host.ini为主。这个是调用不同api问题。
测试：
1、描述ok
2、主机name以/cfs/nodes/{HOSTID}/host.ini为主没有name显示该文件的ip。测试ok。</msg>
</logentry>
<logentry
   revision="249796">
<author>fxw</author>
<date>2016-01-22T09:01:44.676221Z</date>
<msg>noreview
更新spice库</msg>
</logentry>
<logentry
   revision="249795">
<author>fxw</author>
<date>2016-01-22T08:56:50.919309Z</date>
<msg>noreview
更新vs代码</msg>
</logentry>
<logentry
   revision="249790">
<author>dongxia</author>
<date>2016-01-22T08:44:19.592757Z</date>
<msg>reviewid :15764
bug id :34324
问题分析：
问题：aSV4.5.00_B升级到VMP4.8最新包，检查结果 期望：升级检查版本后失败，不进行升级 实际：升级成功
原因：
1、因为uapi.up中的check_sn_version_compatible函数是用来检测，升级的版本是否兼容的，但是只是校验了版本号为2和3 即：企业版的两种版本
2、所以如果当前升级的不是企业版则不会去比较他们的是否同为aDesk或者aSv；
3、所以需要增加对所有序列号类型的校验，包括了序列号类型为0 和 1两种情况

改动说明：
修改uapi.up中的check_sn_version_conpatible函数，增加对0和1两种序列号类型的校验，是这两种序列号的如果不是同为aDesk或aSv也会使升级失败，并且报相应错误信息
自测：
环境：200.200.100.147  VMP4.8升级包
分别用aSv的试用版、标准版、企业版环境 使用VMP4.8的升级包升级，观察结果
结果：升级失败，分别报错：当前VMP为服务器虚拟化试用版（标准版\企业版），请使用服务器虚拟化版本的升级包</msg>
</logentry>
<logentry
   revision="249782">
<author>jcy</author>
<date>2016-01-22T07:40:51.515046Z</date>
<msg>noreview：
改动说明：
bug34666，【UI】老模板更新和转模板时，会进行开关机操作，在此期间，控制台禁用了，但键盘还能输入.</msg>
</logentry>
<logentry
   revision="249776">
<author>hyq</author>
<date>2016-01-22T06:56:54.682091Z</date>
<msg>reviewid : 15891
bug id: 34578
问题描述: 【需求建议】当VMP与网络中其他的设备的IP冲突，需要能够告警通知管理员（32266）
改动说明: 添加一个告警项，把arp功能整合成一个模块文件，方便后续扩展功能使用，把定时执行任务更新任务放到/sf/etc/init.d/目录下开机启动，并添加到软狗监控
自测场景:测试场景中告警检查频率30分钟一次
主机
200.200.103.240
200.200.103.246
200.200.103.250
局域网内存在主机200.200.103.245
修改主机200.200.103.246的iP为200.200.103.245后大概一小时告警栏出现告警</msg>
</logentry>
<logentry
   revision="249747">
<author>hyq</author>
<date>2016-01-22T06:12:55.576040Z</date>
<msg>reviewid : 15878
bug id: 34578
问题描述: 【需求建议】当VMP与网络中其他的设备的IP冲突，需要能够告警通知管理员（32266）
改动说明: 添加一个告警项，把arp功能整合成一个模块文件，方便后续扩展功能使用，把定时执行任务更新任务放到/sf/etc/init.d/目录下开机启动，并添加到软狗监控
自测场景:测试场景中告警检查频率30分钟一次
主机
200.200.103.240
200.200.103.246
200.200.103.250
局域网内存在主机200.200.103.245
修改主机200.200.103.246的iP为200.200.103.245后大概一小时告警栏出现告警</msg>
</logentry>
<logentry
   revision="249727">
<author>vs</author>
<date>2016-01-22T03:40:33.103917Z</date>
<msg>问题描述： 
	【优化时间】部分后台任务执行耗时过长，导致前端UI卡顿
BUG   ID: vttd34413
问题原因： 
	后台执行脚本的时间过长
改动思路： 
	1.修改后台调用时间，perl里直接获取结果
        2.修改获得ip的方法
做了哪些测试： 
	页面点击虚拟存储，页面加载时间减少
reviewid 15835, commited by wzl, reviewed by yinxin</msg>
</logentry>
<logentry
   revision="249725">
<author>ssl</author>
<date>2016-01-22T03:32:39.690020Z</date>
<msg>[no review]VDI4.8代码合入，来自svn://200.200.0.40/ssl/dev/Trunk/Personal-Directory/VDI4.8/spice-0.12.5</msg>
</logentry>
<logentry
   revision="249646">
<author>chenlei</author>
<date>2016-01-21T09:46:46.728634Z</date>
<msg>reviewid: 15852
review by: hyq
Bug id：34627
问题分析：
新增个人盘的ide编号是通过遍历虚拟机配置中ide字段，选择未被使用的ide编号，
而如果使用了virtio_blk，配置中的相应ide字段就会被替换成virtio，导致新增个人盘
的配置使用了已有的ide编号，最终写入配置失败。

改动说明：
预加载个人盘在ide编号选择时，增加对virtio的处理

自测：
1. 新建虚拟机，安装虚拟机性能优化工具（安装VDC agent会自动安装性能优化工具），
转换成模板，待虚拟机启动以后，后台查看cfs目录下的虚拟机的配置（vmid为奇数），新增个人盘的配置被写入。</msg>
</logentry>
<logentry
   revision="249517">
<author>dongxia</author>
<date>2016-01-20T09:44:45.836755Z</date>
<msg>reviewid :15816
bug id :34586
问题分析：
cluvmadm中的vmstart_or_resume 函数用于在集群中恢复或者启动虚拟机，其中在选择获取锁文件/tmp/startvm_for_vs的时候有设置超时时间为60
当同时启动多台虚拟机时由于多个进程同时进行，可能使部分虚拟机的启动在获去锁文件的时候超时
改动说明：
修改了超时时间的设定timeout设为180 尽量减少由于获取锁超时而使得之后的启动/恢复操作失败
自测：
1、在vdc上创建多台（20台以上）虚拟机，开机
2、重启已开启的虚拟机，观察结果 重试多次 均没有部分虚拟机处于关闭状态的情况</msg>
</logentry>
<logentry
   revision="249516">
<author>vs</author>
<date>2016-01-20T09:34:01.095356Z</date>
<msg>问题描述： VS2.2R1不支持单副本
BUG   ID: 30938
问题原因： 针对adesk版本没有屏蔽单副本
改动思路： 
	   去掉单副本选项
做了哪些测试： 
	初始化虚拟机存储看单副本选项是否去掉
reviewid 15821, commited by yangyf, reviewed by tyy</msg>
</logentry>
<logentry
   revision="249510">
<author>fxw</author>
<date>2016-01-20T09:08:10.486976Z</date>
<msg>reviewid: 15818
bug id: 34587
问题描述:虚拟机重启失败
 open失败是因为文件被锁了，因为后台会定时检测镜像是否正常，qemu-img info获取信息时会上锁，而且是我们自己搞得。。。为了规避bug，改了qemu_close
改动说明: 判断是非只读才会去解锁，因为qemu_open的时候非只读才加锁
自测场景:
1. 部署20台虚拟机，成功
</logentry>
<logentry
   revision="249505">
<author>vs</author>
<date>2016-01-20T08:33:40.312802Z</date>
<msg>问题描述： 
	磁盘自修复显示未知错误
BUG   ID: 30937
问题原因： 
	
改动思路： 
	修改相应代码
做了哪些测试：
reviewid 15817, commited by yangyf, reviewed by yinxin</msg>
</logentry>
<logentry
   revision="249483">
<author>vs</author>
<date>2016-01-20T06:42:22.809598Z</date>
<msg>概要信息: bbs上建议如下：adesk用户没有购买VS存储，每次点击VMP界面的虚拟存储界面提示初始化
用户体验非常不好，直接建议隐藏界面或者去掉初始化的页面，改成友好提示，等增加了虚拟存储序列号再调用
BUG   ID:  td 30678
改动说明:
1.VsConfig.pm中当检测到没有有效序列号，但是是aDesk版本，则检测vs试用期的剩余时间，如果还有剩余时间则返回on trial。 如果已经过期则返回 overdue。
2.host_to_vs.js 可以根据VsConfig.pm中check_vs_sn返回的message分别处理。当返回的是“on trial”则在虚拟存储页面跳出提示框则在虚拟存储页面跳出提示框：
当前未检测到有效的虚拟存储授权序列号，但可试用虚拟存储。是否初始化虚拟存储并开始试用？ (提醒：试用期到期后，保持在虚拟存储的虚拟机将无法开机，需购买虚拟存储授权才可继续使用。）
  如果选择是，则显示虚拟存储初始化页面，选择否，则不显示
当放回的是“overdue”则在虚拟存储页面跳出提示框则在虚拟存储页面跳出提示框：
“未检测到有效的虚拟存储授权序列号，且当前试用期已过，无法初始化虚拟存储。请购买或填入有效虚拟存储授权序列号以初始化虚拟存储。”不显示虚拟存储初始化页面。

  修改了部分代码，避免了硬编码问题。

测试分析:
  分试用期和试用期过期两种情况分别测试，1.在试用期，跳出提示框：
当前未检测到有效的虚拟存储授权序列号，但可试用虚拟存储。是否初始化虚拟存储并开始试用？ (提醒：试用期到期后，保持在虚拟存储的虚拟机将无法开机，需购买虚拟存储授权才可继续使用。）
  如果选择是，则显示虚拟存储初始化页面，选择否，则不显示
  2.试用期过期则跳出提示框：
“未检测到有效的虚拟存储授权序列号，且当前试用期已过，无法初始化虚拟存储。请购买或填入有效虚拟存储授权序列号以初始化虚拟存储。”不显示虚拟存储初始化页面。
reviewid 15807, commited by yangyf, reviewed by lrx</msg>
</logentry>
<logentry
   revision="249470">
<author>chenlei</author>
<date>2016-01-20T04:26:06.521397Z</date>
<msg>reviewid: 15809
review by: hyq
Bug id：34527
问题分析：
转换模板的过程要开机关机，这个过程没有对用户进行限制

改动说明：
1. 增加一个临时状态用来标识预加载磁盘的过程，在普通虚拟机转换模板、普通虚拟机直接部署的过程中，限制用户操作，显示正在转换模板；
2. 模板更新的整个过程都设为“模板更新状态”

自测：
 1. 普通虚拟机的卡片、详情页面，点击转换模板，卡片页面显示正在转换模板，详情页面虚拟机操作被置灰，控制台处于禁用状态；
 2. 普通虚拟机的卡片、详情页面，点击模板部署，卡片页面依次显示正在部署、正在转换模板、正在部署，详情页面虚拟机操作被置灰，控制台处于禁用状态；
 3. 旧模板虚拟机的卡片、详情页面，点击模板更新，整个过程虚拟机的卡片都显示正在更新。</msg>
</logentry>
<logentry
   revision="249465">
<author>jcy</author>
<date>2016-01-20T03:30:25.170022Z</date>
<msg>noreview：
改动说明：
bug34527，加个“正在转模板”的状态，此状态不可操作虚拟机</msg>
</logentry>
<logentry
   revision="249464">
<author>jcy</author>
<date>2016-01-20T03:28:25.040018Z</date>
<msg>noreview：
改动说明：
bug34617,CSS类冲突导致升级页面主机列表显示不全</msg>
</logentry>
<logentry
   revision="249461">
<author>jcy</author>
<date>2016-01-20T03:20:21.306086Z</date>
<msg>noreview：
改动说明：
修正VS上库导致打包不过。</msg>
</logentry>
<logentry
   revision="249458">
<author>lcy</author>
<date>2016-01-20T02:58:24.077388Z</date>
<msg>reviewid:15804
review by fxw
改动说明：
【合入】Fake raid
自测：
打包验证</msg>
</logentry>
<logentry
   revision="249433">
<author>hyq</author>
<date>2016-01-19T12:51:10.520626Z</date>
<msg>reviewid: 15792
bug id: 32266
问题描述:2、修改集群中的某台主机IP，形成冲突场景，可能存在集群不稳定的情况
改动说明:添加静态arp缓存功能调整下执行顺序，并加上集群稳定判断,如果集群不稳定，则不执行清理和添加静态arp缓存的代码。等到下次集群稳定了再执行
自测场景:1、三台主机
200.200.103.240 host-fefcfef6fb90
200.200.103.245 host-fefcfe61fb25
200.200.103.250 host-fefcfed2f314
修改200.200.103.245这台主机的ip为局域网内一台主机200.200.103.246的IP
修改成功后，大概2-3分钟，集群恢复稳定</msg>
</logentry>
<logentry
   revision="249428">
<author>vs</author>
<date>2016-01-19T12:24:35.350798Z</date>
<msg>概要信息: [可靠性专项测试]只有BAD副本在线，进行磁盘替换，需要说明替换失败的原因
BUG   ID: td 30933
改动说明: 当vs_disk_replace返回有错，根据返回值不同，报不同的错误信息
测试分析: 当vs_disk_replace返回有错，返回值为1，则报“替换磁盘失败”，
如果返回值为11， 则报“副本存在错误，替换磁盘失败”
reviewid 15799, reviewed by yzs</msg>
</logentry>
<logentry
   revision="249423">
<author>dongxia</author>
<date>2016-01-19T12:01:19.563778Z</date>
<msg>reviewid :15797
bug id :34576
问题分析：
问题： 新建虚拟交换机，例如，填入描述：ss' 因为带有字符'导致操作失败并报错： bash:  -c:  line  0:  unexpected  EOF  while  looking  for  matching  `''bash:  -c:  line  1:  syntax  error:  unexpected  end  of  file
原因： 
1、新建虚拟交换机的时候，如果需要在非本地主机上新建则VTP::VAPI::Network::create_one_vsw中会组建命令通过ssh到其他主机执行，此时命令中的参数是由push 进命令中 再调用VTP::Tools::run_command来运行命令的，如果输入的参数中带有' 则push操作后的参数会缺少一个' 而导致运行命令时出错；
2、而本地主机新建交换机则直接使用参数，传到相应的接口从而不必有这样的错误；
3、修改新建部分的时候发现，编辑虚拟机的时候如果之前建好的未连接的虚拟机 描述信息中也有'符号，则也会有一样的问题存在
改动说明：
修改VTP::VAPI::Network::create_one_vsw 和 VTP::VAPI::Network::edit_one_vsw 函数中要在其他主机上执行的相应部分：由原来的通过组建命令ssh到相应主机运行改变为调用VTP::Clustervm::proxy_handler代理执行，这样的话不再需要push组建参数，直接传参到相应的API 这样对于参数中有特殊字符也能够成功执行相应的操作
自测：
环境：172.28.162.97 
操作：
1、新建虚拟机 描述中输入 含有' 或者其他特殊符号的信息 观察结果
2、相应操作正确则成功执行，如果操作失败也会报正确错误
3、新建虚拟机，选择不连接到物理网络，描述中也输入含有' 或者其他特殊符号的信息 新建成功
4、编辑之前新建的未连接的虚拟机，为其选择添加非本地主机的物理网络后，观察结果
5、相应操作正确则成功执行，如果操作失败也会报正确错误</msg>
</logentry>
<logentry
   revision="249411">
<author>vs</author>
<date>2016-01-19T09:46:25.580282Z</date>
<msg>概要信息: bbs上建议如下：
adesk用户没有购买VS存储，每次点击VMP界面的虚拟存储界面提示初始化
用户体验非常不好，直接建议隐藏界面或者去掉初始化的页面，改成友好提示，等增加了虚拟存储序列号再调用
BUG   ID:  td 30678
改动说明:
1.VsConfig.pm中当检测到没有有效序列号，但是是aDesk版本，则检测vs试用期的剩余时间，如果还有剩余时间则返回on trial。 如果已经过期则返回 overdue。
2.host_to_vs.js 可以根据VsConfig.pm中check_vs_sn返回的message分别处理。当返回的是“on trial”则在虚拟存储页面跳出提示框则在虚拟存储页面跳出提示框：
当前未检测到有效的虚拟存储授权序列号，但可试用虚拟存储。是否初始化虚拟存储并开始试用？ (提醒：试用期到期后，保持在虚拟存储的虚拟机将无法开机，需购买虚拟存储授权才可继续使用。）
  如果选择是，则显示虚拟存储初始化页面，选择否，则不显示
当放回的是“overdue”则在虚拟存储页面跳出提示框则在虚拟存储页面跳出提示框：
“未检测到有效的虚拟存储授权序列号，且当前试用期已过，无法初始化虚拟存储。请购买或填入有效虚拟存储授权序列号以初始化虚拟存储。”不显示虚拟存储初始化页面。

测试分析:
   分试用期和试用期过期两种情况分别测试，1.在试用期，跳出提示框：
当前未检测到有效的虚拟存储授权序列号，但可试用虚拟存储。是否初始化虚拟存储并开始试用？ (提醒：试用期到期后，保持在虚拟存储的虚拟机将无法开机，需购买虚拟存储授权才可继续使用。）
  如果选择是，则显示虚拟存储初始化页面，选择否，则不显示
  2.试用期过期则跳出提示框：
“未检测到有效的虚拟存储授权序列号，且当前试用期已过，无法初始化虚拟存储。请购买或填入有效虚拟存储授权序列号以初始化虚拟存储。”不显示虚拟存储初始化页面。
reviewid 15787, reviewed by tyy</msg>
</logentry>
<logentry
   revision="249408">
<author>hyq</author>
<date>2016-01-19T09:38:11.675654Z</date>
<msg>reviewid : 15793
bug id : 34607
问题描述：td34607:【需求】/vtpconfig/storagetree这个api添加一个参数node给vdc使用
改动说明:1、api  /vtpstorage/storagetree 添加一个参数用于vdc过滤存储
测试场景：
1、三台主机
200.200.103.240 host-fefcfef6fb90
200.200.103.245 host-fefcfe61fb25
200.200.103.250 host-fefcfed2f314
本地存储：local_240,local_250以及各个主机系统盘自带的local分区
共享存储：36f01faf000e8a51a00000c27546de12f 只有200.200.103.240能够访问
虚拟存储 3台主机都能访问
调用api:
vtpsh get /vtpstorage/storagetree
vtpsh get /vtpstorage/storagetree -node host-fefcfef6fb90
vtpsh get /vtpstorage/storagetree -node host-fefcfe61fb25
vtpsh get /vtpstorage/storagetree -node host-fefcfed2f314
vtpsh get /vtpstorage/storagetree -node cluster
返回结果正确</msg>
</logentry>
<logentry
   revision="249394">
<author>fxw</author>
<date>2016-01-19T07:57:56.245352Z</date>
<msg>reviewid: 15789
review by: wzt
Bug id：34602
问题分析：
合入支持SAS的aSV相关代码

改动说明：
增加对SAS存储的扫描，添加到存储列表中

自测：
没有SAS环境，只验证了替换代码后，原来的存储界面显示正常</msg>
</logentry>
<logentry
   revision="249366">
<author>chenlei</author>
<date>2016-01-19T03:23:45.908107Z</date>
<msg>reviewid: 15778
review by: hyq
Bug id：34572
问题分析：
对模板创建快照的时候，没有对个人盘personal_disk.qcow2创建快照，
而克隆快照时又会对个人盘镜像进行快照回滚，导致出错

改动说明：
在克隆快照的快照回滚中过滤掉个人盘personal_disk.qcow2，
因为个人盘始终都是不变的，不需要快照

自测：
新建虚拟机，再将虚拟机转换为模板，然后创建快照，再克隆快照，成功。</msg>
</logentry>
<logentry
   revision="249361">
<author>jcy</author>
<date>2016-01-19T03:03:25.186798Z</date>
<msg>noreview：
改动说明：
管理页面：换下 HA配置 和 服务与支持 的位置</msg>
</logentry>
<logentry
   revision="249356">
<author>jcy</author>
<date>2016-01-19T02:55:32.902935Z</date>
<msg>noreview：
改动说明：
bug34094，规避 跳转IP之后还是会弹框提示 </msg>
</logentry>
<logentry
   revision="249314">
<author>yangwei</author>
<date>2016-01-18T12:03:30.799071Z</date>
<msg>reviewid 15762
bugid 34573
review by fxw
问题分析：
优化虚拟机开机过程。在开机过程中，同一份配置重复加载，对其做了部分优化。
改动说明：
1、vtpsh create /cluster/vm/start_vms接口会调用VTP::VAPI::VMOperate::start_vms开机。在调用之前，会加载虚拟机配置，如果配置加载失败，则直接处理下一个虚拟机，没有告警。添加告警。
2、VTP::VAPI::VMOperate::start_vms会对权限操作进行检查，如果失败，又一次加载虚拟机配置，使用虚拟机的配置name字段报错，因此在第一步中，获取name字段作为参数传给start_vms。
3、批量开机最后调用vtpsh create /cluster/vm/{vmid}/status/start，如果传入cpuid参数，重复获取存储配置，改为一次获取。
测试：
1、后台执行vtpsh create /cluster/vm/start_vms -vms=123。虚拟机开机失败，前台操作日志，开启虚拟机失败，错误信息：“加载虚拟机（123）配置文件失败！”。
2、批量开机，虚拟机正常开机。
3、单个虚拟机开机，虚拟机开机正常。
4、编辑虚拟机配置，配置开机操作前后一致。</msg>
</logentry>
<logentry
   revision="249291">
<author>fxw</author>
<date>2016-01-18T11:10:58.583610Z</date>
<msg>noreview
更新vs代码</msg>
</logentry>
<logentry
   revision="249288">
<author>dongxia</author>
<date>2016-01-18T09:51:34.110768Z</date>
<msg>reviewid :15759
bug id :34510
问题分析：
提示日志：发送控制指令（human-monitor-command:info mice）到虚拟机返回失败！错误信息：无法连接到虚拟机控制通道！尝试次数（81）对于用户难以理解，需要修改

改动说明：
将原本UI提示日志写到后台操作日志中，前台只提示：无法连接到虚拟机控制通道！

自测：
1.存储满了，本地备份虚拟机
2.备份失败，错误信息：无法连接到虚拟机控制通道！。</msg>
</logentry>
<logentry
   revision="249285">
<author>dongxia</author>
<date>2016-01-18T09:47:59.890688Z</date>
<msg>reviewid :15755
bug id :34474
问题分析:
失败日志：
失败日志需要处理：感叹号后面加冒号，语法有问题。 集群锁 这种名次用户看不懂，不要出现。 业务失败了，要告诉用户如何才能成功。
改动说明：
修改VTP::Storage::lock_storage_config中的报错信息，将集群锁相关失败原因放到日志中，返回给用户任务状态，失败的话由于和集群锁相关，提示用户稍后重试，之后能够获得锁了，任务就能成功执行了
自测：
1.添加了共享存储服务器
2.点击 重新发现磁盘 按钮扫描磁盘
3.扫描磁盘任务还未完成，就添加了2个扫描出来的iscsi存储。  zyc-master、zyc-format
4.扫描磁盘任务失败，提示 启用存储失败！请稍后重试</msg>
</logentry>
<logentry
   revision="249280">
<author>hyq</author>
<date>2016-01-18T09:13:59.228550Z</date>
<msg>reviewid : 15758
bug id : 34258
reviewed by : fxw
改动说明 : 读取UPID状态文件的时候多加一个启动集群虚拟机失败的的情况
自测场景 : 在启动HA虚拟机代码流程里直接die出来，启动HA虚拟机，调用api获取该启动虚拟机的UPID状态，
perl -d /usr/bin/vtpsh get /nodes/host-fefcfef6fb90/tasks/UPID:host-fefcfef6fb90:00002972:00082B63:569D1578:启动虚拟机:4892236526630:admin@vtp:/status
{
   "exitstatus" : "gg",
   "id" : "4892236526630",
   "node" : "host-fefcfef6fb90",
   "pid" : 10610,
   "pstart" : 535395,
   "starttime" : 1453135224,
   "status" : "stopped",
   "type" : "启动虚拟机",
   "upid" : "UPID:host-fefcfef6fb90:00002972:00082B63:569D1578:启动虚拟机:4892236526630:admin@vtp:",
   "user" : "admin@vtp"
}
existatus 不是OK</msg>
</logentry>
<logentry
   revision="249279">
<author>chenlei</author>
<date>2016-01-18T09:12:43.335627Z</date>
<msg>reviewid: 15753
review by: hyq
Bug id：34547 34532
问题分析：
转换模板需要执行开机关机操作，在关机失败时，会执行回滚操作将模板虚拟机转回普通虚拟机，
而转换成虚拟机需要是停止状态。

改动说明：
1. 重构磁盘预加载开机关机这部分代码；
2. 如果关闭虚拟机失败，则尝试关闭虚拟机电源

自测：
1. 新建普通虚拟机A，将A转换成模板，待A启动成功以后，后台用gdb kvm -p pid将虚拟机卡住，构造关机失败场景；
2. 前台操作日志依次会显示关闭虚拟机失败、关闭虚拟机电源成功，且转换模板任务最终也成功</msg>
</logentry>
<logentry
   revision="249241">
<author>lcy</author>
<date>2016-01-18T07:21:04.277182Z</date>
<msg>reviewid:15749
review by fxw
Bug id: 34042
问题分析：TD34042,【体验】实体机页面支持可配置内存-需要新包
问题出现的根源：
界面提示不友好
改动说明：
修改界面提示的显示
自测：
验证环境
4.8.00_B
build 2016-01-11 23:56:29
验证步骤：
主机实体页面的内存显示，分为物理内存和可配置内存两种。</msg>
</logentry>
<logentry
   revision="249236">
<author>vs</author>
<date>2016-01-18T07:07:19.284856Z</date>
<msg>概要信息: 合入iscsi的页面代码
BUG   ID: vstd30907
改动说明: 合入iscsi的页面代码
测试分析: 合入iscsi的页面代码，但是页面上不显示
reviewid 15748, reviewed by fxw, tyy</msg>
</logentry>
<logentry
   revision="249228">
<author>jcy</author>
<date>2016-01-18T06:33:58.551643Z</date>
<msg>noreview：
改动说明：
bug32538，单主机登录，根据提示配置vmp集群，添加主机 的地方 也加上改虚拟交换机的提示</msg>
</logentry>
<logentry
   revision="249227">
<author>lcy</author>
<date>2016-01-18T06:30:18.612228Z</date>
<msg>reviewid:15747
review by fxw
Bug id: 34181
问题分析：TD34181,【网口vlan配置】ISO安装vmp，配置网络接口页面问题汇总（不超过5条）
问题出现的根源：
原有的SHELL Dialog中Form的设计全部都是把用户的输入定向到STDOUT里面。
在获取用户输入的时候，通过空格来划分。也就是默认的划分方式。
这样划分有一个问题，就是前面输入框为空，后面输入框不为空。后面输入框的内容会覆盖前面输入框的内容。
改动说明：
通过设置separator这个参数，把用户输入的内容用自定义的分隔符分隔开。form的内容绝大部分情况下都会获取到每个输入框对应的输入内容。
自测：
后台测试通过。还需打包验证。</msg>
</logentry>
<logentry
   revision="249212">
<author>jcy</author>
<date>2016-01-18T03:40:38.657404Z</date>
<msg>noreview：
改动说明：
bug33286，管理-&gt;虚拟机备份与恢复-&gt;恢复：支持 勾选/取消勾选 所有派生虚拟机的只恢复系统盘</msg>
</logentry>
<logentry
   revision="249207">
<author>hyq</author>
<date>2016-01-18T03:31:52.238483Z</date>
<msg>reviewid : 15741
bug id : 34360
问题描述:【老功能】虚拟存储上的虚拟机克隆，进度条显示不对.
改动说明: 如果是虚拟存储，通过获取每次拷贝的数据再相加
自测场景:克隆一台虚拟存储上的虚拟机到其所在的存储，观察页面进度条是否异常</msg>
</logentry>
<logentry
   revision="249201">
<author>yangwei</author>
<date>2016-01-18T02:52:49.928844Z</date>
<msg>reviewid 15737
bugid 34497
review by fxw
问题分析：
当存储不存在时，虚拟机开机报错“磁盘不存在”，描述不清楚。
改动说明：修改描述。
测试：
后台执行vtpsh get /vtpstorage/diskpath -did=1234。打印错误为“存储不存在（id：1234）”。测试ok。</msg>
</logentry>
<logentry
   revision="249175">
<author>chenlei</author>
<date>2016-01-16T10:22:41.436812Z</date>
<msg>reviewid: 15729
review by: fxw
Bug id：34184  34481
问题分析：
转换模板没有任何提示，会进行开机、关机操作

改动说明：
普通虚拟机转换模板、普通虚拟机直接部署会弹框提示需要进行开机关机操作；
旧模板第一次更新也会弹框提示需要进行开机关机操作


自测：
 1. 普通虚拟机的卡片、详情页面，点击转换模板，弹框提示转换模板的过程中会执行开机关机操作,目的是预加载个人盘；
 2. 普通虚拟机的卡片、详情页面，点击模板部署，在确认部署时，弹框提示转换模板的过程中会执行开机关机操作，因为普通虚拟机部署必定会走转换模板的流程；
 3. 模板虚拟机的卡片、详情页面，点击模板更新，目前在确认更新时本身就会弹框，如果时旧模板，那么更新在弹框中会新增提示：更新过程中会执行开机关机操作。
 更新操作不是每次都会将模板开关机的，只要个人盘加载上了，以后再次更新就不会再开机关机了。</msg>
</logentry>
<logentry
   revision="249170">
<author>yangwei</author>
<date>2016-01-16T09:53:25.053457Z</date>
<msg>reviewid 15726
review by fxw
bugid 34313
问题分析：
当一个主机装有多个vmp系统的时候，一旦重启主机，就可能出现严重的问题：1、配置发生错误，可能导致例如磁盘没有挂载等问题；2、数据丢失，主要表现在虚拟机丢失，也vmp管理页面的虚拟机页，虚拟机卡片显示镜像丢失，这主要是由于分区挂载错误造成的，可能两个磁盘的local分区挂载错误；等等其他情况。在安装的时候，vmp可以检测到这种情况，并必须格式化安装才能继续安装。在实际部署中，可能部署人员将安装过vmp的盘直接作为本地盘给主机，造成人为的一个主机存在两个vmp现象，从而出现配置丢失、数据丢失等问题。提出一个解决方案检测，并进行告警。
改动说明：
在告警服务中添加对主机安装vmp个数检测，若出现有主机安装多个vmp系统，则在vmp页面进行告警。检测原理是：
1、我们的vmp会将系统盘分成6个分区，因此第一步，需要检测当前主机有哪些块设备有6个分区。检测方式是对分区名为"sd[a-z]6"进行匹配。
2、进一步精匹配，匹配模式是“^(.)-(sd[a-z])6”。
3、对精匹配到的设备进行分区的卷标匹配。有两个分区需要匹配：/dev/sd[a-z]1和/dev/sd[a-z]2，第一个是默认的boot挂载目录，第二个是uefi迁移过来的boot分区。如果匹配到卷标是vtpboot，且统计匹配个数大于1才认为是多个vmp。
测试：
测试环境：
172.28.172.110（lyc提供虚拟环境）
200.200.101.159物理机环境
密码：都是admin
ps：如果重启过需要替换代码
1、在告警页面出现“主机安装多个VMP”告警。
2、后台到有多个vmp节点执行：e2label /dev/sda1 ""，然后/sf/etc/init.d/vtpalertd restart，页面不再产生新的告警。
3、执行perl /sf/bin/vmp_os_num_check.pl输出1.
注意不要清除多余的，否则就不能重启了。</msg>
</logentry>
<logentry
   revision="249165">
<author>lcy</author>
<date>2016-01-16T09:04:42.145301Z</date>
<msg>reviewid:15724
review by fxw
Bug id: 33351
问题分析：TD33351,【集群】3台主机组集群，2种情况下导致了所配置的集群IP丢失【需要重现】
问题出现的根源：
集群IP经常被重置，即先删除然后设置。有可能出现某次设置不成功。又或者是设置错了网口导致的。
改动说明：
打印一些调试日志。设置集群IP的时候，把流程打印出来，并且把设置完了之后网口的IP信息打印出来
自测：
自测通过，日志正常。</msg>
</logentry>
<logentry
   revision="249161">
<author>jcy</author>
<date>2016-01-16T08:52:32.797659Z</date>
<msg>noreview：
改动说明：
bug34481，预加载个人盘会进行开机再关机操作，在会执行此操作的时候加上提示</msg>
</logentry>
<logentry
   revision="249143">
<author>jcy</author>
<date>2016-01-16T06:51:32.167178Z</date>
<msg>noreview：
改动说明：
bug34528，【集群IP设置】【UI】集群IP设置页面的描述不准确</msg>
</logentry>
<logentry
   revision="249121">
<author>fxw</author>
<date>2016-01-15T10:43:18.621727Z</date>
<msg>noreview
加入opus库
</msg>
</logentry>
<logentry
   revision="249119">
<author>hyq</author>
<date>2016-01-15T10:34:09.281223Z</date>
<msg>reviewid: 15696
bug id: 34101
问题描述: 虚拟机运行在其他节点，qemu-img info 获取镜像信息的时候在本节点，报错208
改动说明: qemu-img info 获取能访问虚拟机的时候判断虚拟机是否运行，优先返回虚拟机的正在运行的位置
测试场景:虚拟机运行在非主控，进行备份。</msg>
</logentry>
<logentry
   revision="249116">
<author>dongxia</author>
<date>2016-01-15T10:23:33.659686Z</date>
<msg>reviewid :15698
bug id :33697
问题分析： 
因为旧版本的图片会先被删除，而之后如果新版本的图片下载不完整，就会导致前台得到的广告图片不全
改动说明：
合入 bug 32968
新版本的图片下载不完整不会删除旧版本的图片，会等新版本图片全部完成才更新UI的广告图片
自测：
1、vmp4.6 升级到 vmp4.7，观察升级后前台广告
2、重复升级多次，检查前台广告 没有缺失情况</msg>
</logentry>
<logentry
   revision="249111">
<author>hyq</author>
<date>2016-01-15T10:01:05.773337Z</date>
<msg>review id: 15696
bug id: 34031
问题描述:td34031:【磁盘扩容】虚拟机存在异地备份，扩容，选择将备份存至回收站，到期后回收站不会清理。【优先】
改动说明:添加一个脚本，每天定时清理 /sf/data/$storageid/private/backup目录下的文件，如果存在文件超过一个星期没有改动，那么将其删除
测试:在/sf/data/$storageid/private/backup新建一些文件:修改系统时间为1星期后，检查/etc/crontab文件中的每天定时执行脚本在什么时候执行
把系统时间修改到它之前不久处，等待时间到达后过时文件是否被删除</msg>
</logentry>
<logentry
   revision="249063">
<author>fxw</author>
<date>2016-01-15T06:32:52.366221Z</date>
<msg>reviewid: 15693
review by lcy
bug id: 34516
问题描述: vtprgm调用一个api的接口被改了，导致异常
改动说明: 在新增一个接口用于判断虚拟机是否加密，之前的接口是判断虚拟机的某一个磁盘是否加密
自测场景: 
1. 替换代码，vtprgm运行正常
2. VDC设置开机自动，VMP启动后VDC启动成功</msg>
</logentry>
<logentry
   revision="249062">
<author>dongxia</author>
<date>2016-01-15T06:26:14.548611Z</date>
<msg>reviewid :15691
bug id :34489
问题分析：
虚拟机的bios启动等待时间splash-time非常短，而web vnc控制台的重连又很慢，导致操作系统的启动界面很多就跳过去，导致很多操作没法做。 
可能遇到如下问题：
1.grub的启动选项来不及选择
2.windows的f8来不及按
虚拟机的bios启动等待时间splash-time建议做成页面可配置的，以满足用户特定场景下的使用

改动说明：
虚拟机添加配置bios停留时间项
合入TD34471 修改 

自测：
1.新建本地（或ha）虚拟机，启动虚拟机
用命令ps auxf | grep vmid | grep splash  --color,有'menu=off,splash-time=1'，即bios菜单为关闭状态
2.编辑本地（或ha）虚拟机bios停留时间为0，启动虚拟机
用命令ps auxf | grep vmid | grep splash  --color,有'menu=off,splash-time=1'，即bios菜单为关闭状态
3.编辑本地（或ha）虚拟机bios停留时间如2的非0值，启动虚拟机
用命令ps auxf | grep vmid | grep splash  --color,有'menu=on,splash-time=2000'，即bios菜单为开启状态 时间为用户设置停留时间</msg>
</logentry>
<logentry
   revision="249048">
<author>jcy</author>
<date>2016-01-15T03:47:06.955707Z</date>
<msg>noreview：
改动说明：
bug34489，[合入VMP4.7]虚拟机的bios启动等待时间splash-time建议做成页面可配置的，以满足用户特定场景下的使用。</msg>
</logentry>
<logentry
   revision="249031">
<author>jcy</author>
<date>2016-01-15T01:52:31.732437Z</date>
<msg>noreview：
改动说明：
bug34465，虚拟机控制台，重启虚拟机时，不显示“正在重启”的遮罩</msg>
</logentry>
<logentry
   revision="249029">
<author>fxw</author>
<date>2016-01-15T01:46:43.540044Z</date>
<msg>noreview
删除老的vs代码</msg>
</logentry>
<logentry
   revision="249023">
<author>fxw</author>
<date>2016-01-15T00:53:58.898136Z</date>
<msg>noreview
更新vs代码</msg>
</logentry>
<logentry
   revision="249010">
<author>vs</author>
<date>2016-01-14T12:41:58.108364Z</date>
<msg>概要信息: 虚拟存储有主机离线，编辑虚拟机除了改名其它的要支持
BUG   ID: 30844
改动说明: 只限制改名操作
测试分析:
reviewid 15660, reviewed by lzj</msg>
</logentry>
<logentry
   revision="249009">
<author>jcy</author>
<date>2016-01-14T12:41:55.886859Z</date>
<msg>noreview：
改动说明：
bug33589,新需求，自动备份策略里面的快照限制个数默认最多8个改成默认最多3个</msg>
</logentry>
<logentry
   revision="249001">
<author>hyq</author>
<date>2016-01-14T12:15:29.301890Z</date>
<msg>reviewid: 15646
bug id: 34277
问题描述: 模板虚拟机做了异地备份，并恢复到异地备份位置，个人盘没有拷贝到系统盘所在目录
改动说明: 判断备份位置有没有个人盘，如果有个人盘，则拷贝到模板虚拟机系统盘目录
自测场景: 
1、新建一个虚拟机到默认分组，转换为模板，再进行异地备份，最后执行恢复操作，选择恢复到备份位置</msg>
</logentry>
<logentry
   revision="248996">
<author>jcy</author>
<date>2016-01-14T11:36:48.765393Z</date>
<msg>noreview：
改动说明：
bug34480，聚合口禁止改MAC地址</msg>
</logentry>
<logentry
   revision="248986">
<author>lcy</author>
<date>2016-01-14T10:48:58.806891Z</date>
<msg>reviewid:15662
review by fxw
Bug id: 34494
问题分析：TD34494,【老功能】为blackbox日志增加ethtool的日志
问题出现的根源：
blackbox没有ethtool的日志
改动说明：
增加一条这样的定时日志。每隔5分钟往blackbox里面打印一条日志，文件大小上限为20M。日志文件为 LOG_ethtool.txt
自测：
验证环境
打包验证。</msg>
</logentry>
<logentry
   revision="248977">
<author>fxw</author>
<date>2016-01-14T09:44:07.171961Z</date>
<msg>noreview
加入opus库重新编译</msg>
</logentry>
<logentry
   revision="248944">
<author>fxw</author>
<date>2016-01-14T06:54:21.079482Z</date>
<msg>noreview
上传spice要链接的开源库
http://downloads.xiph.org/releases/opus/opus-1.1.2.tar.gz</msg>
</logentry>
<logentry
   revision="248928">
<author>chenlei</author>
<date>2016-01-14T03:55:05.344833Z</date>
<msg>reviewid: 15638
review by: hyq
Bug id：34468
问题分析：
VMP4.8要支持4.6.02（富士康版本）升级。

改动说明：
修改了version-from文件，增加版本号4.6.02

自测：
需要打新包验证</msg>
</logentry>
<logentry
   revision="248909">
<author>jcy</author>
<date>2016-01-14T01:47:33.757849Z</date>
<msg>noreview：
改动说明：
bug33943，序列号没插key，页面顶部的提示“USB-KEY被拔出”改为“未插入USB-KEY”</msg>
</logentry>
<logentry
   revision="248893">
<author>chenlei</author>
<date>2016-01-13T13:56:40.002100Z</date>
<msg>reviewid: 15629
review by: hyq
Bug id：null
问题分析：
命令行字符串直接放在run_cmd函数内部不太好

改动说明：
将run_cmd命令行字符串提到run_cmd函数外部

自测：
测试了受影响的相关模块，虚拟机转换成模板、模板转换成虚拟机均正常。</msg>
</logentry>
<logentry
   revision="248878">
<author>hyq</author>
<date>2016-01-13T09:57:19.757015Z</date>
<msg>reviewid: 15623
bug id: 33589
问题描述:不改UI会报错
改动说明: 最小备份个数改为3个
测试: jcy测试通过</msg>
</logentry>
<logentry
   revision="248877">
<author>lcy</author>
<date>2016-01-13T09:56:30.313919Z</date>
<msg>reviewid:15613
review by fxw
Bug id: 33788
问题分析：TD33788，【虚拟交换机】编辑虚拟机所桥接网口，任务显示成功了，实际上却编辑失败了
问题出现的根源：
编辑虚拟交换机的时候，有多少台主机就会打印多少条日志，无论编辑成功与否。
在编辑虚拟交换机的过程中，如果检查到其中一台主机的配置信息中不存在这个虚拟交换机，就会在这个主机上创建一台新的虚拟交换机。
这个时候，如果新建的过程中出错了，日志就会混乱。
改动说明：
与新建虚拟交换机同步一致一下。
编辑虚拟交换机的时候，如果是主控，无论成功与否都会打印一条日志。如果是从节点，只有在失败的时候才会打印一条日志。
如果在编辑的过程中，发现配置不存在，需要新建一台虚拟交换机，那么如果在主控新建成功，会打印一条新建的日志。如果在从节点新建成功不打日志，失败才会打印一条新建失败失败的日志。
自测：
验证环境
4.8.00_B
build 2016-01-11 23:56:29
1. 两台主机组成的集群。
2. 新建一个虚拟交换机，不连接物理网口。
3. 编辑虚拟交换机，连接两台主机的网口（保证这两个网口都还没有连接到虚拟交换机），日志打印编辑成功，只有一条，显示主机是主控的。
4. 编辑虚拟交换机，连接两台主机的网口，主控的网口还没有连接到其他的虚拟交换机，非主控的网口已经连接了虚拟交换机。这时候，日志打印两条。一条是主控编辑成功，一条是从节点编辑失败。
5. 编辑虚拟交换机，连接两台主机的网口，主控的网口已经连了另外的虚拟交换机，非主控没有连其他的。打印一条日志，只有主控失败的日志。
6. 后台修改主控的配置信息，把这个虚拟交换机删除掉。/cfs/nodes/hostid/vsw.ini.编辑虚拟交换机，连接主控已经连了其他虚拟交换机的网口。日志打印新建虚拟交换机失败。</msg>
</logentry>
<logentry
   revision="248867">
<author>dongxia</author>
<date>2016-01-13T09:05:27.892803Z</date>
<msg>reviewid :15518
bug id :34086
问题分析：
1、原本添加主机时只检测了添加主机的基本版本号与要加入的集群是否一致，只要版本号一样就能添加进集群
2、对于主机A打了补丁包A，主机B没打补丁包A，主机A添加主机B组建集群的情况仍能够成功组建，但是集群中不同主机的补丁包是不一致的，会产生问题
3、需要增加检测的条件：检查基础版本号要一致，包括时间；检查主机所打补丁包、定制包都要一致；替换主机时要检查，批量添加主机也要考虑
改动说明：
修改了VTP::VAPI::Hosts::check_vtp_version 函数，再其本来只检测版本号是否一致的基础上增加检测版本时间是否一致，所打补丁包是否一致
自测：
1、添加与当前版本不一致或者时间不一致的主机，报错：远程主机（%s）和当前集群版本不一致！
2、添加与当前版本一致及时间均一致的主机，一个有打补丁，一个没打补丁，报错：远程主机（%s）和当前集群补丁包不一致！
3、添加与当前版本一致及时间均一致的主机，两个都有打补丁，补丁包不一致，报错：远程主机（%s）和当前集群补丁包不一致！</msg>
</logentry>
<logentry
   revision="248864">
<author>vs</author>
<date>2016-01-13T08:57:56.009946Z</date>
<msg>概要信息: gluster peer status状态为rejected，导致替换主机失败  |  增加主机替换过程中磁盘格式化进度查看和替换主机失败回退操作 | 【网上问题】brick check执行时间太长，导致页面超时，替换主机失败  
BUG   ID: vs td 30836  |   vs TD 30711   | vs TD 30837
改动说明:&lt;bug1 :配置私网之后，调用新增脚本vs_host_replace_checkpeerstatus.sh检查新进主机状态以及旧主机配对brick的状态
&lt;bug2 : 增加vs_host_replace_rollback_delnewhost函数，进行主机删除操作，且等待删除结束。增加新近主机磁盘格式化进度查看。 在1.通知格式化事件失败 2.新近主机磁盘格式化失败 3.通知替换主机任务失败 4.及查询到真正替换主机失败且新主机不在卷中。 则进行删除新进主机及相关删除操作，使得集群回到初始状态。 5.而当查询到真正替换主机失败而新进主机已参与组卷了则提示通知管理员，底层不进行任何回退操作
&lt;bug3:  将brick check过程放到后台执行。 

测试分析:
 &lt;bug1:如果检测到异常返回NO，则终止替换主机过程，进行回退
 &lt;bug2:可针对上面5种情况分别测试，前四种进行回退了，最后一种不进行回退操作
 &lt;bug3: 放到后台之后，页面较快结束，在后台执行。
reviewid 15616, reviewed by yzs</msg>
</logentry>
<logentry
   revision="248863">
<author>jcy</author>
<date>2016-01-13T08:56:48.772802Z</date>
<msg>noreview：
改动说明：
bug33589,新需求，自动备份策略里面的快照限制个数改成3个到12个，默认8个</msg>
</logentry>
<logentry
   revision="248858">
<author>lcy</author>
<date>2016-01-13T08:20:23.232683Z</date>
<msg>reviewid:15605
review by fxw
Bug id: 34153
问题分析：TD34153,【网口vlan配置】修改汇聚口的mac地址，修改后，子网口的mac地址不是最新的【优先】
问题出现的根源：
网桥的MAC地址没有同步。
改动说明：
同步更新一下网桥的MAC地址。
自测：
验证环境
4.8.00_B
build 2016-01-11 23:56:29
1. 配置聚合网口，配置VLAN。连接网桥，激活网桥
2. 修改MAC地址。
3. 聚合网口，网桥的MAC地址都会修改。</msg>
</logentry>
<logentry
   revision="248857">
<author>chenlei</author>
<date>2016-01-13T08:18:02.781495Z</date>
<msg>reviewid: 15608
review by: hyq
Bug id：34370 34298 34264 34404 
问题分析：
1. 虚拟机转换成模板时，启动虚拟机失败导致模板转换失败，没有回滚、清理环境；
2. 个人盘预加载的代码流程中没有检测关闭虚拟机的任务进度，导致直接通过普通虚拟机部署时部署失败；
3. 模板更新，旧模板更新时需要默认预加载一次个人盘；
4. 预加载个人盘开机前修改磁盘配置时，新增的个人盘字段写死了ide1

改动说明：
1. 虚拟机转换成模板时，启动虚拟机失败导致模板转换失败，将配置回滚、环境清理，使虚拟机恢复到原来状态；
2. 个人盘预加载的代码流程中检测关闭虚拟机的任务进度；
3. 对于旧模板，即模板image目录下不含个人盘personal_disk.qcow2，在其更新的时候，会走一次预加载个人盘流程，
流程结束以后，其image目录下将包含个人盘personal_disk.qcow2；
4. 模板部署代码重构，只要模板虚拟机A的image目录下存在个人盘personal_disk.qcow2，那么模板所在的存储S1
和部署的目的存储S2的template目录下都会有个人盘personal_disk.qcow2，这一点有部署流程保证，这里S1、S2
相等就代表部署到同存储，不等则表示跨存储部署；
5. 预加载个人盘开机前修改磁盘配置时，新增的个人盘字段从ide0-ide3中选出未被使用的一个。

自测：
1. 新建一台普通虚拟机，构造开机失败的场景，转换成模板，转换失败，虚拟机的配置和环境都被回滚到了原来的状态；
2. 新建一台普通虚拟机A，直接用A部署虚拟机，部署成功；
3. 旧模板A已部署过虚拟机，但模板没有个人盘，更新模板，该模板虚拟机A执行一次预加载个人盘，A的image目录下新增个人盘；
4. 跨存储部署一台虚拟机，同存储S1和目的存储S2的template目录下均存在个人盘personal_disk.qcow2。</msg>
</logentry>
<logentry
   revision="248846">
<author>jcy</author>
<date>2016-01-13T07:11:11.734036Z</date>
<msg>noreview：
改动说明：
bug34428，解决部分IE11打不开页面控制台</msg>
</logentry>
<logentry
   revision="248841">
<author>dongxia</author>
<date>2016-01-13T06:53:14.704453Z</date>
<msg>reviewid :15601
bug id :34342
问题分析：
1、对于密码策略是根据读取当前主控的超过时间设定是建议修改还是强制修改
2、对于不同主控，呈现的密码策略就会不同，有的可能是建议修改，有的就会使强制修改
改动说明：
1、修改密码策略：
对于集群只要检测到是默认密码就强制修改，不论主控是谁；
对于单机，按照原本密码策略，根据超过时间，选择是建议修改还是强制修改

自测：
1、环境：172.28.51.106 密码为默认密码的集群，登陆，显示强制修改密码
2、环境：172.28.162.91 密码不是默认密码的集群，登陆，不显示强制修改密码
3、环境：172.28.51.3 密码为默认密码 且超过15天的单机，登陆，显示强制修改密码
4、环境：200.200.101.92 密码为默认密码 没超过15天的单机，登陆，显示建议修改密码</msg>
</logentry>
<logentry
   revision="248833">
<author>yangwei</author>
<date>2016-01-13T03:41:45.947855Z</date>
<msg>reviewid 15602
bugid 34339
review by fxw
问题分析：
该函数实现原理是先生成一个进程相关的临时文件并把数据写入该文件，写入成功后，还会把文件的内容读出来和传入的数据内容做对比，如果对比不一致就会失败。这个时候，没有删除临时文件。当传入的字符包含宽字符是就会失败，而没有清理临时文件。
改动说明：
数据内容对比失败，删除临时文件。
测试：
环境72.28.162.91【更换验证环境找我确认】
1、执行附件中的pl.pl脚本
2、/sf目录下不存在sf/data.json*文件
</logentry>
<logentry
   revision="248832">
<author>dongxia</author>
<date>2016-01-13T03:40:42.692139Z</date>
<msg>reviewid :15603
bug id :34200
问题分析：
别人疏忽了，帮忙改
改动说明：
合入svn://200.200.0.10/vt/vt/VTP/aSV4.2/Branchs/aSV4.2_SDDC_CN_EN/src/  这个上库记录 245211 
VTP::VAPI::Log.pm 和 VTP::VAPI::User.pm

自测：
1、新建用户，F12查看到新建用户名的密码和确认密码均已加密；使用新添加的用户登录，能登录成功。  --pass
2、配置邮件服务器时，F12查看用户名和密码均加密了；  --pass
3、/cfs/alert.conf文件中，找到pass和user的值，是用命令pwddec xxx分别解密后，得到的值是前台配置的用户名和密码；</msg>
</logentry>
<logentry
   revision="248829">
<author>jcy</author>
<date>2016-01-13T03:20:44.742997Z</date>
<msg>noreview：
改动说明：
bug34200，新建用户和配置邮件服务器的时候，需要对密码加密。</msg>
</logentry>
<logentry
   revision="248826">
<author>jcy</author>
<date>2016-01-13T03:06:13.856868Z</date>
<msg>noreview：
改动说明：
bug34014，导入虚拟机，去掉HA配置。界面当时多合了</msg>
</logentry>
<logentry
   revision="248825">
<author>yangwei</author>
<date>2016-01-13T03:01:16.801928Z</date>
<msg>reviewid 15595
bugid 34417
review by fxw
问题分析：
枚举类型传给uint32_t，在进行%u输出程序出core。
改动说明：
错误码强制类型转换为uint32_t。
测试：
/sf/etc/init.d/ukey_proxy restart重复多次测试/sf/data/local/dump是否会产生core。
未产生，测试ok。</msg>
</logentry>
<logentry
   revision="248824">
<author>jcy</author>
<date>2016-01-13T02:57:35.832200Z</date>
<msg>noreview：
改动说明：
bug33943，序列号没插key的提示“USB-KEY被拔出”改为“未插入USB-KEY”</msg>
</logentry>
<logentry
   revision="248823">
<author>vs</author>
<date>2016-01-13T02:54:04.522332Z</date>
<msg>概要信息: 数据盘或缓存盘拔出格式化后重新插入，页面显示正常，应该提供一个手段恢复该磁盘[集群中磁盘拔出格式化重先插入]
BUG   ID: null
改动说明: 合入代码
测试分析:
reviewid 15596, reviewed by fxw, tyy</msg>
</logentry>
<logentry
   revision="248818">
<author>dongxia</author>
<date>2016-01-13T02:36:29.060745Z</date>
<msg>reviewid :15593
bug id :33741
问题分析：
   虚拟机备份恢复结束后是关闭状态，对于开机状态下备份恢复后希望能够自动启动的情况进行改进
改动说明：
   在虚拟机备份恢复的选择页面，增添一个恢复后是否自动重启的勾选项，默认不勾选；如果勾选了在备份恢复结束后自动为用户开启虚拟机
自测：
1、虚拟机本地备份后，选择备份恢复，勾选备份结束后自动重启；结果：虚拟机先执行备份恢复，接着自动启动
2、虚拟机本地备份后，选择备份恢复，不勾选备份结束后自动重启；结果：虚拟机只执行备份恢复，恢复结束后处于关闭状态
3、虚拟机异地备份后，选择备份恢复，勾选备份结束后自动重启；结果：虚拟机先执行备份恢复，接着自动启动
4、虚拟机异地备份后，选择备份恢复，不勾选备份结束后自动重启；结果：虚拟机只执行备份恢复，恢复结束后处于关闭状态
5、批量备份恢复虚拟机，多个虚拟机，部分勾选恢复后自动重启，部分不勾选恢复后不自动重启；结果：勾选了的恢复后自动开机；没勾选的只恢复，结束后关闭</msg>
</logentry>
<logentry
   revision="248804">
<author>jcy</author>
<date>2016-01-13T01:23:35.483688Z</date>
<msg>noreview：
改动说明：
bug33741，备份恢复支持配置恢复完成后自动重启。包括虚拟机详情里面的单个虚拟机恢复和管理里面的批量恢复虚拟机。</msg>
</logentry>
<logentry
   revision="248784">
<author>lcy</author>
<date>2016-01-12T13:00:54.215222Z</date>
<msg>Merged revision(s) 248749 from VTP/aSV4.2/Branchs/aSV4.2_SDDC_CN_EN/src:
noreview
BUGID : 34401
问题说明：原来做AMD支持的时候去掉了这个限制，现在要把它加回来
改动说明：将BIOS的VT-x检测反注释
自测说明：未实际测试，先打包再回归
........

reviewid:15582
review by fxw
bug id: 34388
打包验证。</msg>
</logentry>
<logentry
   revision="248779">
<author>fxw</author>
<date>2016-01-12T12:43:09.024900Z</date>
<msg>noreview
spice代码更新，对应更新库文件</msg>
</logentry>
<logentry
   revision="248774">
<author>ssl</author>
<date>2016-01-12T12:10:19.069819Z</date>
<msg>[no review]VDI4.8代码合入，来自svn://200.200.0.40/ssl/dev/Trunk/Personal-Directory/VDI4.8/spice-0.12.5</msg>
</logentry>
<logentry
   revision="248764">
<author>dongxia</author>
<date>2016-01-12T11:37:31.250677Z</date>
<msg>reviewid :15542
bug id :34310
问题分析：
根据返回值，使用VTP::Tools::run_command的ignore_exit_code参数，去除后台打印的不必要的日志
改动说明：
QemuServer.pm 关于is_swap_ssd的错误信息，之前已根据退出码被和谐
修改VTP::Tools::get_real_mem函数，忽略返回值 1 ，屏蔽 命令"dmidecode | grep -A 16 \"Memory Device\$\" |grep Size: |grep -v \"No Module Installed\""的日志
自测：
1、修改前，后台sfvt_vtpdaemon报 Failed exec dmidecode | grep -A 16 \"Memory Device\$\" |grep Size: |grep -v \"No Module Installed\ 错误信息 ：返回值 1
相关日志；
2、修改后，返回值为1 的被屏蔽 ，不报相关错误</msg>
</logentry>
<logentry
   revision="248753">
<author>ssl</author>
<date>2016-01-12T10:16:59.981859Z</date>
<msg>noreview suntao修改：
TD: 40566
改动说明：
合入svn://200.200.0.40/ssl/other/技术支持/代码修改/VDI4.7R1/VDI4.7R1_北京智课教育_TD20180/src/vmp/source/packages/spice-0.12.5

</msg>
</logentry>
<logentry
   revision="248742">
<author>fxw</author>
<date>2016-01-12T09:46:58.616139Z</date>
<msg>reviewid 15569
bug id 34396
review by hyq
问题分析：
gwl加了调试堆栈，捕获到异常后转成了字符串，但是有些异常是hash结构。这样转化导致数据丢失，VDC获取不到数据导致bug
改动说明：
不转化，直接抛出异常
测试：
1、VDC创建虚拟机
2. VMP删除刚创建的虚拟机
3. VDC删除这个虚拟机，可以删除成功</msg>
</logentry>
<logentry
   revision="248733">
<author>yangwei</author>
<date>2016-01-12T08:59:40.325694Z</date>
<msg>reviewid 15564
bug id 34393
review by fxw
问题分析：
key的错误码输出到文件，合了asv后该功能就被干掉了，重新加进来
改动说明：
在合入asv4.2代码前，adesk前台操作key发生错误，可以反馈回正确的错误类型，精确定位注册失败的原因。该功能是在libsfRockeyARM.a中实现的。在合入asv4.2的序列号功能架构以后，libsfRockeyARM.a实际上是负责和ukey_proxy通信，操作key的活都没ukey_proxy干了，因此，反馈飞天key的错误操作功能就被干掉了。在ukey_proxy中操作key的地方，如果操作失败了，将错误输出到记录文件/sf/.sn_register_errinfo。
测试：
1、打包通过。
2、序列号注册功能正常。
3、在无飞天key的节点，查看/sf/.sn_register_errinfo，文件值为15728640，即0xF00000，表示没有找到key，则测试ok。</msg>
</logentry>
<logentry
   revision="248724">
<author>lcy</author>
<date>2016-01-12T08:18:56.555557Z</date>
<msg>reviewid:15559
review by fxw
BUG ID: 34388
合入。先合入界面逻辑部分。不包括ISO安装部分。
具体对应aSV4.2的改动。
Revision: 242451
Author: qifei
Date: 2015年11月5日 11:31:47
Message:
支持amd改动
安装过程中注释掉cpu型号，bios检测
perl中注释掉bios检测，cpu匹配主频的正则不适用于amd设备，也注释掉
----
Modified : /VTP/aSV4.2/Branchs/aSV4.2_SDDC/build/pkg/replace-root/sf/bin/vmp_install_main.sh
Modified : /VTP/aSV4.2/Branchs/aSV4.2_SDDC/src/app/vtp-common/ProcFSTools.pm
Modified : /VTP/aSV4.2/Branchs/aSV4.2_SDDC/src/app/vtp-qemu-server/VTP/QemuServer.pm</msg>
</logentry>
<logentry
   revision="248707">
<author>hyq</author>
<date>2016-01-12T07:22:38.414722Z</date>
<msg>reviewid: 15551
bug id: 32266
问题描述: 虚拟机的IP和主机IP冲突了。导致集群异常。
改动说明: 增加一个定时刷新主机间arp静态缓存的脚本。
比如主机a把主机b的arp缓存设置为静态，主机b把主机a的arp缓存设置为静态。主机a和主机b在同一个集群
测试场景
测试场景1
三台主机组成集群
200.200.103.240
200.200.103.245
200.200.103.250

局域网内有一台配置了200.200.103.246的主机

集群内各个主机的静态arp缓存配置目录/cfs/nodes/host-xxx/cluster_interface.ini

集群内各个主机的静态arp缓存(arp -n 查看，flag M 表示静态arp缓存)

200.200.103.240
200.200.103.245          ether   fe:fc:fe:61:fb:25   CM                    eth0
200.200.103.250          ether   fe:fc:fe:d2:f3:14   CM                    eth0

200.200.103.245
200.200.103.240          ether   fe:fc:fe:f6:fb:90   CM                    vd24d91b23690
200.200.103.250          ether   fe:fc:fe:d2:f3:14   CM                    vd24d91b23690

200.200.103.250
200.200.103.240          ether   fe:fc:fe:f6:fb:90   CM                    eth0
200.200.103.245          ether   fe:fc:fe:61:fb:25   CM                    eth0

修改200.200.103.245的主机IP为200.200.103.246

修改完成后大概过两分钟，查看各个主机的静态arp缓存

200.200.103.240
200.200.103.246          ether   fe:fc:fe:61:fb:25   CM                    eth0
200.200.103.250          ether   fe:fc:fe:d2:f3:14   CM                    eth0

200.200.103.246
200.200.103.240          ether   fe:fc:fe:f6:fb:90   CM                    vd24d91b23690
200.200.103.250          ether   fe:fc:fe:d2:f3:14   CM                    vd24d91b23690

200.200.103.240          ether   fe:fc:fe:f6:fb:90   CM                    eth0
200.200.103.246          ether   fe:fc:fe:61:fb:25   CM                    eth0

测试场景2
两台主机组成集群
172.28.51.2
172.28.51.3

新建一台vdc虚拟机，IP配置为172.28.51.3
主控为172.28.51.2
启动vdc虚拟机，检查集群是否异常</msg>
</logentry>
<logentry
   revision="248696">
<author>yangwei</author>
<date>2016-01-12T07:07:12.522773Z</date>
<msg>reviewid 15557
bugid 34315
review by fxw
问题分析：
对于无限期的老key，类型为"sn_flag":3。当把key拔掉后，反馈给前台的剩余天数是-1。在没有key的情况下，返回的天数应该是大于等于0。-1表示永不过期，而前台看到没有key，也不是0，就像是成-1天过期了。这里需要修改下key类型判断。
改动说明：
在返回key的剩余天数的时候，添加对"sn_flag":3判断的流程。这个使用应该返回nk_ut字段的值。
测试：
环境：200.200.136.48
密码：admin
原始数据：
Sangfor:VMP/host-a0369f8fb490 /sf # vtsn_tool -i
{"sn":"CPFDXDHU-TKB64N8W-5FQS5AH8-M53JS6AC-YU7S7C3X","keyid":"1325820327","sn_flag":3,"coremax":0,"vmmax1":0,"vmmem1":0,"vmmax2":0,"vmmem2":8,"date":"1970-01-01 08:00:00","last_days":-1,"key_state":0,"key_type":0,"user_name":"","ever_enterprise":1,"sn_version":5}
在环境执行更新后的工具：
Sangfor:VMP/host-a0369f8fb490 /home # ./vtsn_tool -i
{"sn":"CPFDXDHU-TKB64N8W-5FQS5AH8-M53JS6AC-YU7S7C3X","keyid":"1325820327","sn_flag":3,"coremax":0,"vmmax1":0,"vmmem1":0,"vmmax2":0,"vmmem2":8,"date":"1970-01-01 08:00:00","last_days":24,"key_state":0,"key_type":0,"user_name":"","ever_enterprise":1,"sn_version":5}
Sangfor:VMP/host-a0369f8fb490 /home # vtsn_tool -D nk_ut
{"nk_ut": "528600"}  6天   上面显示剩余24天，测试ok。</msg>
</logentry>
<logentry
   revision="248695">
<author>ssl</author>
<date>2016-01-12T07:06:27.321271Z</date>
<msg>noreview suntao修改：
TD: 40566
改动说明：
合入svn://200.200.0.40/ssl/other/技术支持/代码修改/VDI4.7R1/VDI4.7R1_北京智课教育_TD20180/src/vmp/source/packages/spice-0.12.5

</msg>
</logentry>
<logentry
   revision="248682">
<author>jcy</author>
<date>2016-01-12T06:28:14.350067Z</date>
<msg>noreview：
改动说明：
bug32538，添加主机时，在提交前提示用户，“主机添加成功后，请修改虚拟交换机的配置，将其接入新的主机”</msg>
</logentry>
<logentry
   revision="248667">
<author>yangwei</author>
<date>2016-01-12T03:26:47.499278Z</date>
<msg>reviewid 15537
review by fxw
bugid 34372
问题分析：
从目前客户反馈来看，VMP虚拟机开机速度一直是客户诟病的一个话题。虚拟机开机时间优化，对序列号读取方面进行了优化。
改动说明：
以前的序列号都是开虚拟机时通过VMPSN模块的序列号读取函数获取，本次优化从缓存文件中直接读取，该文件进行定时更新。主要的改动有：
1、批量开机
a、去掉试用版的序列号过期检查：批量开机都会调用单个虚拟机开机流程，改判断已经在单个开机流程中判断，不再重复；大部分都是企业版，可以去掉。
b、批量开机时从缓存文件读取序列号信息，并下发给单个开机流程
c、如果文件不存在，走正常流程读。
2、单个开机
a、判断序列号数据是否传入，否则从缓存文件读，如果文件不存在，走正常流程读。
3、该文件5分钟更新一次，插拔key，注册序列号都会进行更新。
4、文件存放位置/cfs/.authinfo_cache.json
测试：
功能测试
1、/cfs/.authinfo_cache.json文件存在，数据正确。
2、单个开机，能够按照序列号限制正确开机。
3、批量开机，能够按照序列号限制正确开机。
4、注册序列号功能正常。
5、注册序列号，该文件进行正确更新。
性能测试
避免其它影响，不要打开前台页面，独占操作。虚拟机为本地虚拟机。
时间统计user和sys时间之和。
1、单个虚拟机开机性能测试：
单个虚拟机重复开关20次，测试平均值，单个虚拟机开机时间提升0.0595s。
2、批量虚拟机开机性能测试：
一次5个虚拟机开机，重复开关机10次，测试开机时间，平均开机时间提升0.32s。
统计时间尽量避免其它干扰，从测试数据看，时间提升主要体现在批量开机上。</msg>
</logentry>
<logentry
   revision="248659">
<author>lcy</author>
<date>2016-01-12T03:02:54.338964Z</date>
<msg>reviewid:15545
review by lifan
Bug id: 34376
问题分析：TD34376,【修改网口配置】修改非集群通信口的网口配置，也会导致重启集群服务，一段时间内网络异常
自测：
打包验证。

Merged revision(s) 247140 from VTP/aSV4.2/Branchs/aSV4.2_SDDC_CN_EN/build:
reviewid : 15114
reviewed by : hlc
BUG ID : 34017
问题分析:  增加一些blackbox调试日志，以及集群任务管理脚本的优化。
改动说明：  
1.增加一些blackbox调试日志：(1)记录udp socket信息；(2)记录multicast group memberships信息。
2.集群任务管理脚本的优化，减少历史任务文件的堆积。
........
Merged revision(s) 247140 from VTP/aSV4.2/Branchs/aSV4.2_SDDC_CN_EN/src:
reviewid : 15114
reviewed by : hlc
BUG ID : 34017
问题分析:  增加一些blackbox调试日志，以及集群任务管理脚本的优化。
改动说明：  
1.增加一些blackbox调试日志：(1)记录udp socket信息；(2)记录multicast group memberships信息。
2.集群任务管理脚本的优化，减少历史任务文件的堆积。
........
</msg>
</logentry>
<logentry
   revision="248658">
<author>vs</author>
<date>2016-01-12T03:02:31.024580Z</date>
<msg>概要信息: 合入2.2修改的asv代码到vmp4.7
BUG   ID: vstd30907
改动说明: 
1.合入asv4.5 247801
review id 15261
Reviewed by: jyz
Commited by: oxj
BUG ID： VSTD30865
问题分析：iscsi用到3261端口，需将该端口添加到/sf/etc/sysctl.d/vtp.conf里
改动说明：vtp.conf里的ipv4保留端口添加3261
做了哪些测试：null
测试分析: 无

2.合入iscsi相关

3.合入asv4.5 246245
review id: 14837
reviewed by: jyz
commited by: yzs
BUG ID: vstd 30449
问题分析：数据平衡显示
改动说明：设置时间大于今天的完成时间，不显示上次的执行时间，而是显示下次执行的时间
做了哪些测试：设置时间大于今天的完成时间，不显示上次的执行时间，而是显示下次执行的时间

4.合入asv4.5 246128
review id 14803
reviewed by jyz
commited by yinxin
BUG ID: 30754
问题分析： 替换主机时发现失败，但是没有日志，无法定位出到底是替换主机的哪个环节出了问题
问题原因： 无日志，不好定位根因
改动思路： 在perl执行脚本里，每一个步骤都判断执行结果是否成功，执行失败时输出日志，方便下一步定位问题
做了哪些测试： 使用perl -c测试改动后的脚本没有问题

5.合入asv4.5 244866
review id 14393,reviewed by fuweiye,commit by fuweiye
BUG ID:null
问题分析：无
改动说明：VS磁盘坏道修复页面提示消息支持中英文
做了哪些测试：页面支持中英文

reviewid 15539, reviewed by ygh</msg>
</logentry>
<logentry
   revision="248654">
<author>jcy</author>
<date>2016-01-12T02:36:35.520828Z</date>
<msg>noreview：
改动说明：
bug33962，VMP在删除主机期间会无法登录，在删除主机时加上提示</msg>
</logentry>
<logentry
   revision="248650">
<author>jcy</author>
<date>2016-01-12T02:26:26.741014Z</date>
<msg>noreview：
改动说明：
bug33900，编辑虚拟交换机所连接虚拟机的网口，会导致虚拟交换机所桥接的物理网口被删除
原因是UI没下发主机网口信息，</msg>
</logentry>
<logentry
   revision="248645">
<author>lcy</author>
<date>2016-01-12T02:04:45.284641Z</date>
<msg>reviewid:15534
review by fxw
Bug id: 34345
问题分析：TD34345,【修改网口配置】修改非集群通信口的网口配置，也会导致重启集群服务，一段时间内网络异常
问题出现的根源：
修改所有网口的配置都会重启一次集群服务导致的。
改动说明：
对于非集群通信口不需要重启集群服务。即使，发生IP迁移到网桥。也会在网桥那里发送通知集群服务。不需要再网口配置的流程中再次重启集群服务。
自测：
验证环境
4.8.00_B
build 2016-01-06 23:56:46
1. 修改非集群通信口的配置信息。没有出现网络异常。操作正常。</msg>
</logentry>
<logentry
   revision="248638">
<author>jcy</author>
<date>2016-01-12T01:41:34.174352Z</date>
<msg>noreview：
改动说明：
bug34026，模板上一次更新时间显示有误。“模板未派生虚拟机”改为“模板未进行更新”</msg>
</logentry>
<logentry
   revision="248630">
<author>jcy</author>
<date>2016-01-12T01:30:36.394691Z</date>
<msg>noreview：
改动说明：
bug34021，聚合口的配置，默认的网口工作方式需要设置物理交换机，参考aSV的做法，在第一步的顶部也加上提示</msg>
</logentry>
<logentry
   revision="248612">
<author>jcy</author>
<date>2016-01-11T12:41:52.545966Z</date>
<msg>noreview：
改动说明：
bug34011，编辑网口时，
a，未配IP，但配置了网关，
b，未配IP，但配置了掩码，
c，配置了掩码，但未配IP，
限制提交</msg>
</logentry>
<logentry
   revision="248593">
<author>jcy</author>
<date>2016-01-11T09:57:45.255423Z</date>
<msg>noreview：
改动说明：
bug34094，修改默认IP后，获取不到后台的返回，页面不能跳转到新IP。</msg>
</logentry>
<logentry
   revision="248583">
<author>lcy</author>
<date>2016-01-11T09:06:45.429045Z</date>
<msg>reviewid:15510
review by fxw
Bug id: 33513
问题分析：TD33513,【集群】td33347，3主机集群分裂问题
问题出现的根源：
主机开机的时候，设置集群IP结束之后，马上发送arping包。但是，因为主机开机的时候，并没有插上网线，导致发送的ARP包，路由器没有收到。
跨网段访问的时候，就一直访问不了集群IP。
改动说明：
对于设置集群IP的时候，发送的ARP包。先检查一下集群通信口的状态。如果是还没有插上网线，那么就一直等待。直到插上了网线才去发送包。
自测：
验证环境
4.8.00_B
build 2016-01-06 23:56:46
1. 两台主机A，B组成的集群。主机A为主控，设置了集群IP。
2. 主机A断网，关机。
3. 查看主机B，确保IP已经迁移到主机B。
4. 主机B断网。
5. 主机A开机，先不通网。
6. 等待5分钟左右。主机A通网
7. 不同网段的PC可以ping通集群IP。也就是主机A上的集群IP。</msg>
</logentry>
<logentry
   revision="248538">
<author>dongxia</author>
<date>2016-01-11T02:27:01.025151Z</date>
<msg>reviewid :15480
bug id :33506
问题分析：
1、派生虚拟机的流程是先模板部署再进行新建虚拟机，对于派生虚拟机时所设定的各个选项是否合理均在新建虚拟机的时候才检测；
2、对于譬如该问题：标准版本，派生时勾选标记为重要虚拟机的情况，执行时也会完成模板部署，到了新建的时候才会因为条件不符合版本而使任务失败
这样对于用户是一个不好的体验
3、所以需要将检测的步骤提前，在用户选择好所要派生的虚拟机的各个条件之后，先检测不符合就弹框直接提醒用户，直到用户修改符号版本条件再执行相应操作
改动说明：
修改VTP::VAPI::VMOperate中的derive_vm接口，在操作部署模板之前先调用VTP::VMPSN::check_vmpsn_vm_param($param);检测好相应的条件是否符合版本
自测：
环境：200.200.101.164 admin/admin123
1、标准版本VMP环境
2、选择模板部署：勾选 高级-&gt;标记为重要虚拟机 确定
3、检查此时出现弹框，信息为 提示 当前VMP为标准版，不支持重要虚拟机（高级-&gt;标记为重要虚拟机）请升级到企业版</msg>
</logentry>
<logentry
   revision="248418">
<author>dongxia</author>
<date>2016-01-08T09:54:47.205511Z</date>
<msg>reviewid :15467
bug id :34256
问题分析：
QemuServer.pm中原有的设置开机bios的时间分为几种情况：存在/cfs/vmboot.int则从中读取停留时间；否则，没有该文件则判断是否有cd再设置相应bios停留时间；
然而，如果符合以前设定的为判断是否是一体机的判断VTP::Product::is_vmp_for_vs()函数，则不管之前的设置，强制不停留；可是该函数现在已经不能成为判断一体机的条件，对于现在的VMP都会满足这个条件，而导致所有的bios都被设为强制不停留，从而进入不了安全模式；
改动说明：
1、去掉判断是一体机就不停留的强制条件
2、修改如果有/cfs/vmboot.ini，就用这个文件来配置，如果没有文件判断有没有cd，如果有就menu=on,splash-time=8000，设置停留时间；
，如果没有cd就menu=off,splash-time=1，不停留 
自测：
1、修改之前，bios被设为不停留，控制台启动windows虚拟机，开机按F8进入不了安全模式
2、修改之后，控制台启动虚拟机，能看到bios停留一会，按F8能进入安全模式</msg>
</logentry>
<logentry
   revision="248417">
<author>chenlei</author>
<date>2016-01-08T09:48:44.774695Z</date>
<msg>reviewid: 15468
review by: hyq
Bug id：34250
问题分析：
由于不熟悉相关对象的数据结构，导致磁盘路径参数传递错误。

改动说明：
目的节点应该是$self-&gt;{ opts }-&gt;{ node }

自测：
1. 创建一台虚拟机，转换成模板，后台进入虚拟机的磁盘路径，存在personal_disk.qocw2文件；
2. 前台批量管理，移动该虚拟机到其他目录，后台进入虚拟机的磁盘路径，存在personal_disk.qocw2文件；
3. 迁移该虚拟机到其他存储，后台进入虚拟机的磁盘路径，存在personal_disk.qocw2文件。</msg>
</logentry>
<logentry
   revision="248403">
<author>lcy</author>
<date>2016-01-08T07:54:51.660789Z</date>
<msg>reviewid:15460
review by fxw
Bug id: 34153
问题分析：TD34153,【网口vlan配置】修改汇聚口的mac地址，修改后，子网口的mac地址不是最新的【优先】
问题出现的根源：
对于聚合网口，没有考虑到其MAC地址会发生改变。
改动说明：
在网络配置的代码中，如果判断到时聚合网口，要重置一次聚合网口的MAC。
假如是配置了VLAN口的聚合网口。会自动走激活网桥的代码，重置网桥的MAC地址。
假如是原来的聚合网口，会回调vtp-interface脚本重置网桥桥的MAC地址。
自测：
验证环境
4.8.00_B
build 2016-01-06 23:56:46
1. 新建一个聚合网口。
2. 修改聚合网口的MAC地址。前台查看MAC地址发生变化。后台也有相应的变化。
3. 给聚合网口配置VLAN信息，并且修改MAC地址。前台有变化，后台也有相应的变化MAC地址。</msg>
</logentry>
<logentry
   revision="248358">
<author>chenlei</author>
<date>2016-01-08T02:12:29.589255Z</date>
<msg>reviewid: 15448
review by: fxw
Bug id：34294
问题分析：
在linux下将磁盘镜像文件格式化成NTFS后，在windows内部使用有问题，导致磁盘分区已扩容到40G，而磁盘卷还保持原样1G。

改动说明：
用于预加载的个人盘改成在windows下经格式化好的personal_disk.qcow2

自测：
1. VDC上部署一台虚拟机A，还原模式，选择个人数据盘40G，不加密；从VDC上启动该虚拟机，磁盘正常加载，显示40G；
2. VDC上部署一台虚拟机B，还原模式，选择个人数据盘40G，加密个人盘；从VDC上启动该虚拟机，磁盘正常加载，显示40G；
3. 测试重启还原功能，正常。重启后系统盘被还原，个人盘数据在，个人盘大小仍然为40G。</msg>
</logentry>
<logentry
   revision="248338">
<author>fxw</author>
<date>2016-01-07T13:51:20.083989Z</date>
<msg>noreview
未加密盘转换成加密盘，代码逻辑有问题，导致数据并没有被加密</msg>
</logentry>
<logentry
   revision="248295">
<author>jcy</author>
<date>2016-01-07T11:19:02.341481Z</date>
<msg>noreview：
改动说明：
bug33420，修改默认IP时，修改网关，如果已有其他网口配有网关，需要加force参数强制修改</msg>
</logentry>
<logentry
   revision="248279">
<author>vs</author>
<date>2016-01-07T09:25:13.593909Z</date>
<msg>概要信息: 页面显示英文
BUG   ID: 30883
改动说明: zh_CN.yml文件里没有合入对应的翻译
测试分析: 有多余的磁盘没有加入到vs，查看页面提示是否是中文
reviewid 15424, reviewed by yinxin</msg>
</logentry>
<logentry
   revision="248256">
<author>lcy</author>
<date>2016-01-07T07:38:34.347674Z</date>
<msg>reviewid:15413
review by fxw
Bug id: 34214
问题分析：TD34214,【虚拟交换机】VS初始化，选择通信网口，未过滤掉已经被虚拟交换机桥接的网口
问题出现的根源：
VS通过这个接口获取VMP的网口信息/cluster/network/iface。在这个API接口返回VMP的网口信息的时候，
判断网口是否连接了虚拟交换机的判断有误。不能把条件弄的太紧。之前的判断条件是，只能是这个网口
连接了虚拟交换机，假如又给这个虚拟交换机配置了VLAN信息，会导致有误判。
改动说明：
放开限制，只有是和物理网口有关的网口连接了虚拟交换机，就认为被虚拟交换机独占了。及时虚拟交换机
配置了VLAN信息，也认为这个物理网口被虚拟交换机独占了。
自测：
验证环境
4.7.00_B
build 2015-12-28 15:23:05
验证步骤：
1. 主机A,主机B组成的集群
2. 新建一个虚拟交换机br1,连接了两台主机的eth1,给虚拟交换机配置一个VLAN信息。
3. 进入初始化VS页面，VS已经把这两个网口过滤掉
4. 新建一个虚拟交换机br2,连接了两台主机的eth2，虚拟交换机不配置VLAN信息。
5. 进入初始化VS页面，VS也把两台主机的eth2过滤掉。</msg>
</logentry>
<logentry
   revision="248247">
<author>fxw</author>
<date>2016-01-07T07:10:46.904125Z</date>
<msg>noreview
247125和246734修改有问题，会导致TD34051，回滚掉</msg>
</logentry>
<logentry
   revision="248228">
<author>fxw</author>
<date>2016-01-07T06:22:49.952173Z</date>
<msg>noreview
248175修改有问题，会抛出很多英文异常到前台，回滚掉</msg>
</logentry>
<logentry
   revision="248204">
<author>hyq</author>
<date>2016-01-07T02:28:32.526827Z</date>
<msg>reviewid: 15398
bugid: 34027
问题描述: 【磁盘扩容】模板扩容成功，更新到虚拟机，更新成功，但是配置文件的磁盘大小未改变。【优先】
改动说明: 在更新派生虚拟机virtio配置virtio时，增加一个更新镜像大小的功能
自测场景: 新建一台虚拟机，并部署两台派生虚拟机到不同的存储,编辑模板虚拟机的镜像大小，再更新模板，页面查看派生虚拟机的的镜像大小是否同步更新</msg>
</logentry>
<logentry
   revision="248184">
<author>hyq</author>
<date>2016-01-07T01:43:40.781476Z</date>
<msg>no review
BUG ID: null
问题分析：更新每日工作日报。
改动说明：
更新每日日报
</msg>
</logentry>
<logentry
   revision="248175">
<author>chenlei</author>
<date>2016-01-06T11:54:05.733851Z</date>
<msg>reviewid: 15385
review by: lcy
Bug id：34258
问题分析：
集群虚拟机的开机流程大致是VMOperate.pm=&gt;cluvmadm=&gt;vtpvm。从VDI客户端上启动虚拟机以后，VDI那边是通过
HTTP: GET /vapi/json/nodes/{node}/tasks/{upid}/status来查询开机任务的状态，这个API本质是去读
的时候会在cluvmadm中被捕获并且exit（0）;从而导致VMOperate中的API认为这次任务执行成功（因为退出码为0，但是任务实际上是失败的），
API认为任务成功，就会在UPID日志文件的最后一行写下TASK OK，最终导致查询任务状态为OK


改动说明：
将开机失败的各种异常信息一直向上层抛出，最终在VMOperate.pm中捕获并处理。

自测：
1. 开机成功前台日志正常，后台通过vtpsh get /nodes/{node}/tasks/{upid}/status查看exitstatus为OK。
2. 开机失败前台日志报错正常，后台通过vtpsh get /nodes/{node}/tasks/{upid}/status查看exitstatus和VMP前台报错一致。</msg>
</logentry>
<logentry
   revision="248158">
<author>fxw</author>
<date>2016-01-06T10:40:03.268101Z</date>
<msg>noreview
更新libspice</msg>
</logentry>
<logentry
   revision="248135">
<author>ssl</author>
<date>2016-01-06T09:18:24.363317Z</date>
<msg>[no review]原make.sh用于自动打包编译，手工编译不能用，新增加手工编译脚本</msg>
</logentry>
<logentry
   revision="248128">
<author>ssl</author>
<date>2016-01-06T09:03:34.587496Z</date>
<msg>[no review]使用新缓存方案，这两个文件已经不用了</msg>
</logentry>
<logentry
   revision="248125">
<author>ssl</author>
<date>2016-01-06T08:55:55.970702Z</date>
<msg>[no review]VDI4.8代码合入，来自svn://200.200.0.40/ssl/dev/Trunk/Personal-Directory/VDI4.8/spice-0.12.5</msg>
</logentry>
<logentry
   revision="248124">
<author>lcy</author>
<date>2016-01-06T08:46:30.661943Z</date>
<msg>reviewid:15370
review by fxw
Bug id: 34042
问题分析：TD34042,【体验】实体机页面支持可配置内存-需要新包
问题出现的根源：
界面提示不友好
改动说明：
修改界面提示的显示
自测：
验证环境
4.7.00_B
build 2015-12-28 15:23:05
验证步骤：
修改提示为 可配置剩余内存：启动虚拟机可以使用的内存。比如可配置内存剩余4G，则当前只能启动小于4G内存的虚拟机。</msg>
</logentry>
<logentry
   revision="248119">
<author>dongxia</author>
<date>2016-01-06T08:28:00.427290Z</date>
<msg>reviewid :15363
bug id :34029
问题分析：
主机离线，存储异常，导致写入配置文件时重命名文件失败
而在前台报错：重命名（/sf/data/vs_rep2/export_vm//.process_5051858246702.txt) 失败!错误信息：Transport endpoint is not connected
改动说明：
修改VTP::VAPI::Tools::write_ini_conf中的报错信息，将前台报错修改为：写入配置文件失败！存储或集群主机异常，请检查相应配置是否正确
而相应的重命名失败及其原因写入日志中
自测：
环境：200.200.101.164
1、将一台主机（从节点）关机
2、选择一个虚拟机导出
3、观察结果：报错为：写入配置文件失败！存储或集群主机异常，请检查相应配置是否正确</msg>
</logentry>
<logentry
   revision="248118">
<author>lcy</author>
<date>2016-01-06T08:25:30.098023Z</date>
<msg>reviewid:15367
review by fxw
Bug id: 34179
问题分析：TD34179,【ISO安装】iso镜像安装vmp，版权期限需要延伸到 2016 年
问题出现的根源：
ISO安装的时候，对话框没有显示正常的年份
改动说明：
版权修改为2016
自测：
打包验证</msg>
</logentry>
<logentry
   revision="248116">
<author>fxw</author>
<date>2016-01-06T08:20:05.422154Z</date>
<msg>reviewid:15350
review by :fxw
Bug id: 34154
问题分析：
之前关闭了p2v服务，导致前台调用p2v接口会出错，狂刷错误日志
改动说明：
在p2v的接口处直接返回
自测：
替换文件，看前台p2v_migrating调用时间降低，无错误，后台没有p2v错误日志</msg>
</logentry>
<logentry
   revision="248114">
<author>lcy</author>
<date>2016-01-06T08:17:01.672293Z</date>
<msg>reviewid:15361
review by fxw
Bug id: 34152
问题分析：TD34152,【网口vlan配置】修改了网口的mtu值，可前台编辑页面看还是修改之前的值【优先】
问题出现的根源：
修改网口的MTU的时候，只是更新了配置文件。没有及时更新网口的MTU。
改动说明：
及时更新网口的MTU。
自测：
验证环境
4.7.00_B
build 2015-12-28 15:23:05
验证步骤：
1. eth1,修改MTU为1300.前台看到修改成功。
2. eth1,配置vlan，修改MTU为1300，前台看到修改成功。</msg>
</logentry>
<logentry
   revision="248093">
<author>dongxia</author>
<date>2016-01-06T07:07:37.131776Z</date>
<msg>reviewid :15246
bug id :33535
问题分析： 
ssl用vmid取代uuid则虚拟机启动参数不需要uuid参数，注释相应代码
改动说明：
修改VTP::QemuServer.pm中的vm_start函数，注释掉其中启动需要传递uuid参数的代码
自测：
环境：200.200.101.164 admin123
1、启动虚拟机
2、后台运行ps auxf | grep kvm 看到相应启动参数
3、ps auxf | grep kvm | grep uuid --color=auto查看启动参数中没有uuid参数</msg>
</logentry>
<logentry
   revision="248085">
<author>dongxia</author>
<date>2016-01-06T06:34:58.355858Z</date>
<msg>reviewid :15342
bug id :34157
问题分析：
1、vmp3.0目录变成分组，每个节点都有相同的目录，vdc调用老接口get_vmtree，其中为了避免返回重复的目录id为其做处理：返回给vdc:每个目录id+主机编号；
2、从而vdc下发的$dirid是通过处理的，为了获取真正的目录id，vmp需要去除掉dirid后面的主机编号3、VTP::QemuServer::get_real_dirid中会对$dirid做处理，但是处理的方式为：使用chop去除$dirid最后一位，然而当主机数量大于等于10台后，主机编号将会变为两位数，此时只去除最后一位将导致得到的$dirid还是错误的，此时就会找不到相应分组的目录，报错
改动说明：
修改了VTP::QemuServer::get_real_dirid，将其中通过去除$dirid最后一位得到目录id的方式修改为:通过获取目前的所有分组id再查找这些分组id中是$dirid前缀的$id，此时就是真正的目录id
自测：
环境： 172.28.162.91 admin/admin123.
1、未修改时， 调用接口 create /cluster/qemu/{templateid}/{node}/derive_one 传递参数dir:目录id+主机编号，编号一位时，得到正确的目录id；编号两位，得到错误的目录id,报错：新建虚拟机失败！错误信息：新建虚拟机失败！错误信息：打开文件夹（1db7721482f8012）失败！
2、修改过后，调用接口 create /cluster/qemu/{templateid}/{node}/derive_one 传递参数dir:目录id+主机编号，编号一位或两位均得到正确的目录id;成功创建虚拟机</msg>
</logentry>
<logentry
   revision="248058">
<author>lcy</author>
<date>2016-01-06T02:34:51.959782Z</date>
<msg>reviewid:15347
review by fxw
Bug id: 34154
问题分析：TD34154,【网口vlan配置】主机重启后，会有网口被禁用【优先
问题出现的根源：
开机的时候，配置VMP的网络的时候，会自动调用/sf/bin/set_vlan.sh的脚本。
之前默认都是网口是启动状态的，没有对网络的原来的状态进行特殊的判断。导致VLAN子接口的状态有点混乱。
从而影响了界面的网口状态的显示。
改动说明：
获取物理网口的状态，根据物理网口的状态确定VLAN子接口的状态。保证两者的状态是一致的。
自测：
验证环境
4.7.00_B
build 2015-12-28 15:23:05
验证步骤：
1. 给eth1配置一个VLAN，配置IP 掩码。启用状态
2. 给eth2配置一个VLAN，启用状态
3. 给eth3配置VLAN，配置IP 掩码， 禁用状态
4. 给eth4配置一个VLAN，禁用状态
5. 重启主机，上面四步配置的网口信息和状态，在重启主机之后，还是一样的。</msg>
</logentry>
<logentry
   revision="248050">
<author>fxw</author>
<date>2016-01-06T01:58:07.630468Z</date>
<msg>noreview
更新VS代码</msg>
</logentry>
<logentry
   revision="248048">
<author>lcy</author>
<date>2016-01-06T01:54:41.186005Z</date>
<msg>reviewid:15340
review by fxw
Bug id: 34151
问题分析：TD34151,【网口vlan配置】恢复出厂配置，将网口配置的vlan清掉了【优先】
问题出现的根源：
恢复出厂设置的时候，会清除/sf/cfg的内容。
改动说明：
对于网络配置的信息，可以通过这个backupnetwork这个脚本把配置备份起来。
恢复出厂之后，主机重启，会自动去备份目录读取配置，重置主机的网络信息。保证主机的网络信息不回丢失。
恢复出厂不会保留用户配置的聚合网口。
自测：
验证环境
4.7.00_B
build 2015-12-28 15:23:05
验证步骤：
1. 给eth1网口配置VLAN信息，100
2. 恢复出厂设置
3. 开机，查看实体机页面。eth1依然保留着VLAN信息100.</msg>
</logentry>
<logentry
   revision="247996">
<author>fxw</author>
<date>2016-01-05T11:20:51.473263Z</date>
<msg>noreview
bugid:34220
改动说明：
合入SDDC修改，针对linux系统关闭sse4.1指令集
测试：
无</msg>
</logentry>
<logentry
   revision="247988">
<author>fxw</author>
<date>2016-01-05T09:44:51.313035Z</date>
<msg>noreview
bugid:34206
改动说明：
合入SDDC UI优化，把vtpdaemon fork的子进程限制改成10
测试：
无</msg>
</logentry>
<logentry
   revision="247914">
<author>fxw</author>
<date>2016-01-05T03:54:44.051130Z</date>
<msg>noreview
bugid:34203
改动说明：
合入VS的bug 30598
bug现象：两套环境配置了单交换机链路聚合之后，私网丢包甚至ping不通
修改：支持多集群接入相同交换机，支持与公网接入相同交换机
测试：
无</msg>
</logentry>
<logentry
   revision="247890">
<author>hyq</author>
<date>2016-01-05T01:48:21.196430Z</date>
<msg>no review
BUG ID: null
问题分析：更新每日工作日报。
改动说明：
更新每日日报
</msg>
</logentry>
<logentry
   revision="247860">
<author>chenlei</author>
<date>2016-01-04T12:42:10.578009Z</date>
<msg>reviewid: 15289
review by: fxw
Bug id：34188
问题分析：
为了和VDI4.8的版本号保持一致，VMP4.7.00版本号修改为4.8.00，相应预发布版本号为4.8.00_B

改动说明：
修改了build.sh和version-from文件中相应版本号;
修改了个人盘预加载中个人盘初始大小。

自测：
需要打新包验证</msg>
</logentry>
<logentry
   revision="247848">
<author>fxw</author>
<date>2016-01-04T11:35:44.845868Z</date>
<msg>noreview
bugid:34183
改动说明：
有些目录还是需要删除，只保留usr/share/locale
测试：
无</msg>
</logentry>
<logentry
   revision="247846">
<author>fxw</author>
<date>2016-01-04T11:30:21.143499Z</date>
<msg>noreview
更新VS代码</msg>
</logentry>
<logentry
   revision="247833">
<author>fxw</author>
<date>2016-01-04T09:48:56.844768Z</date>
<msg>noreview
bugid:34183
改动说明：
VS的改动被打包脚本删掉了
测试：
无

</msg>
</logentry>
<logentry
   revision="247826">
<author>fxw</author>
<date>2016-01-04T09:23:14.811347Z</date>
<msg>noreview
bugid 34009
问题分析：
qemu默认第二块qxl显卡和e1000、rtl8139网卡是可以热插拔的
改动说明：
初始化设备的时候强制设成不可热插拔
测试：
修改后替换qemu，启动虚拟机，查看网卡和显卡都已不在热插拔的列表里
</msg>
</logentry>
<logentry
   revision="247794">
<author>yangwei</author>
<date>2016-01-04T08:17:12.190034Z</date>
<msg>reviewid 15265
bugid 34108
reviewed by fxw
问题分析：
asv重构了序列号模块，vs对接版本配合进行了相应的修改。vs只维护一份代码，因此adesk版本将asv的改动合过来，保持一致。
改动说明：
1、libsfRockeyARM.a库不再对飞天进行直接操作，而是负责和ukey_proxy通信，获取飞天key序列号相关的数据。
2、hotplugusb后台服务程序负责对飞天key的插拔进行响应，并通知vtsn_server插拔时间。
3、ukey_proxy负责对飞天key的读写操作，并对其他的飞天key请求操作做出回应。
4、vtsn_server仍负责超级狗的读写以及事件响应，并接受hotplugusb通知并和ukey_proxy通信，更新序列号数据。
测试：
1、无序列号的key设置vmp序列号，测试ok
2、修改序列号测试，测试ok
3、sn文件删除，序列号授权功能正常，测试ok
4、删除sn文件的sn字段，序列号授权功能正常，测试ok
5、删除本地备份文件，重新注册序列号，会恢复备份文件，测试ok。
6、拔掉key，删除sn文件，授权正常，测试ok。
7、拔掉key，sn文件不完整，授权正常，测试ok。
8、拔掉key恢复出厂设置，备份文件删除，插上key，备份文件恢复，授权正常。测试ok
9、一个集群插多个key，使用最先插的key的授权信息。测试ok
10、hotplugusb、ukey_proxy、vtsn_server进程被kill后能够被重新拉起。测试ok。
</msg>
</logentry>
<logentry
   revision="247790">
<author>yangwei</author>
<date>2016-01-04T08:02:10.987747Z</date>
<msg>reviewid 15259
bugid 34167
reviewed by fxw
问题分析：
将虚拟机的配置的双屏字段全部统一改为int类型
改动说明：
将快照的该字段也转换为int类型。
测试：
环境 172.28.162.91
虚拟机有快照
测试脚本test.pl
use VTP::QemuServer;
$vmid = shift @ARGV;
$node = shift @ARGV;
$dir=shift @ARGV;
$conf = VTP::QemuServer::load_config($vmid,$node,$dir);
$a = 1;
print $a;
执行perl -d ./test.pl '1601493651968' 'host-0cc47a42a1cc' '657a6786a305'
调试执行，查看双屏字段的数据类型均为int。
测试ok</msg>
</logentry>
<logentry
   revision="247789">
<author>chenlei</author>
<date>2016-01-04T08:00:57.217663Z</date>
<msg>reviewid: 15252
review by: fxw,hyq
Bug id：null
问题分析：
通过VDC派生的带个人数据盘的虚拟机，如果勾选了重启还原模式，那么当派生虚拟机重启以后，由于其系统盘会被还原成模板基镜像，而模板的基镜像中是不存在个人数据盘的注册表等信息的。这样就会导致用户每次重启虚拟机都会有很长一段时间，虚拟机的个人数据盘处于丢失状态，非常影响用户体验。（个人数据盘对应的后台qcow2文件存在，但是在虚拟机内部不可见，因为虚拟机系统盘缺少相应注册表等信息。）

改动说明：
1. 虚拟机转换模板的过程会创建一块个人盘、格式化、将磁盘配置添加到模板虚拟机，启动、关闭模板虚拟机，删除配置。从而使模板虚拟机系统盘镜像中保存有磁盘注册表等相关信息。
2. 模板更新修复功能，目的兼容旧版本已有模板。模板更新时可以通过配置设置来预加载个人数据盘。
3. 模板部署，会在模板所在存储以及各个目的存储的template目录下拷贝一份个人盘镜像。
4. 模板克隆、迁移、备份也会处理个人数据盘qcow2文件。
5. 直接通过普通虚拟机部署，将模板转换的流程放到异步任务中，避免前台UI卡死。
6. 修改了qemu，用来接收guest机内部磁盘加载成功之后发送的cpuid

自测：
自测案例见下面链接
http://200.200.0.37/products/30#</msg>
</logentry>
<logentry
   revision="247772">
<author>fxw</author>
<date>2016-01-04T07:00:55.383585Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="247771">
<author>zhaoxl</author>
<date>2016-01-04T06:59:06.255373Z</date>
<msg>no review
更新VMP4.7迭代2SBL</msg>
</logentry>
<logentry
   revision="247751">
<author>fxw</author>
<date>2016-01-04T03:35:53.627001Z</date>
<msg>reviewid 15001
bugid 32498
reviewed by lifan
问题分析：
查看里了VMP4.6的modules.dep，发现bnx2x.ko的依赖关系不对，
kernel/drivers/net/ethernet/broadcom/bnx2x/bnx2x.ko: kernel/drivers/net/mdio.ko kernel/lib/libcrc32c.ko
缺少了ptp.ko，VMP4.7升级了内核，依赖关系已经修复
kernel/drivers/net/ethernet/broadcom/bnx2x/bnx2x.ko: kernel/drivers/ptp/ptp.ko kernel/drivers/pps/pps_core.ko kernel/drivers/net/mdio.ko kernel/lib/libcrc32c.ko

问题原因应该是老内核的bnx2x依赖关系不需要pt.ko，我们单独编译的bnx2x需要，但是编译后没有更新依赖关系表。
升级的新内核的bnx2x依赖关系包含了ptp.ko，正好跟我们单独编译的bnx2x依赖关系一样，所以没有问题。
实际上应该修改打包脚本，单独编译的driver的依赖关系要更新到modules.dep里面
asv的打包脚本里面也没有找到更新依赖关系的代码

改动说明：
打包的时候更新驱动依赖关系
测试：
在编译环境修改打包脚本测试，打完包后检查依赖关系文件，已被更新</msg>
</logentry>
<logentry
   revision="247735">
<author>hyq</author>
<date>2016-01-04T02:26:45.422534Z</date>
<msg>no review
BUG ID: null
问题分析：更新每日工作日报。
改动说明：
更新每日日报
</msg>
</logentry>
<logentry
   revision="247726">
<author>vs</author>
<date>2016-01-04T01:51:23.324383Z</date>
<msg>概要信息: 修改已配置VLAN网口的文字描述
BUG   ID: vstd 30753
改动说明: 修改文字描述
测试分析: 只是修改文字描述，无测试
reviewid 15253, reviewed by tyy</msg>
</logentry>
<logentry
   revision="247652">
<author>dongxia</author>
<date>2015-12-31T09:31:11.758676Z</date>
<msg>reviewid :14736
bug id : 33506
问题分析： 
    VTP::Exception::raise函数会扔出异常msg，但是有两种格式，一种是纯字符串，另一种，$@是一个hash结构在VTP::Exception中new得到，而在VTP::Tools::convert2utf8 和 VTP::Tools::convert2noutf8函数中会判断msg的类型，得到VTP::Exception类型时认为是错误的所以报出错误的异常
这些普通函数中只考虑了纯字符串类型异常的情况。
    而函数VTP::REST中需要调用VTP::Exception::raise生成hash结构的异常信息，也有相应的hash异常信息的处理函数，所以要为其保持raise的生成hash结构的特性
    所以，为了减少改动，当VTP::REST需要生成hash异常时，设置标识，使得raise能够满足；而标识没设置则默认为普通函数的调用，只需要字符串的异常
改动说明：
1、在VTP::Exception::raise函数中添加变量$is_raise_str 函数raise_str_flag_clear用来设置$is_raise_str的值，在raise函数中根据该值判断die字符串还是hash 
2、在VTP::REST函数中在将会调用raise以die hash类型的信息的地方之前调用raise_str_flag_clear设置标志告诉raise该生成什么样的信息
自测：
1、在VTP::REST中调用raise_str_flag_clear设置is_raise_str的值，之后调用raise函数生成hash结构的值
2、在普通的函数中直接调用raise函数，生成字符串的msg</msg>
</logentry>
<logentry
   revision="247622">
<author>yangwei</author>
<date>2015-12-31T04:47:53.617682Z</date>
<msg>reviewid 15227
bugid 34108
reviewed by fxw
问题说明：vs的序列号和asv对接，adesk修改接口
改动说明：
待测试后添加
测试：
先打包验证，后续添加</msg>
</logentry>
<logentry
   revision="247619">
<author>yangwei</author>
<date>2015-12-31T03:52:46.303637Z</date>
<msg>reviewid 15222
bugid 34108
reviewed by fxw
问题说明：vs的序列号和asv对接，adesk修改接口
改动说明：
待测试后添加
测试：
先打包验证，后续添加</msg>
</logentry>
<logentry
   revision="247595">
<author>lcy</author>
<date>2015-12-31T01:44:09.465613Z</date>
<msg>no review
BUG ID: null
问题分析：更新每日工作日报。
改动说明：
更新每日日报
</msg>
</logentry>
<logentry
   revision="247593">
<author>lcy</author>
<date>2015-12-31T01:21:37.116032Z</date>
<msg>reviewid:15210
review by fxw
Bug id: 34121
问题分析：TD34121,【虚拟机启动】虚拟机启动的时候，网桥都会激活一次
问题出现的根源：
虚拟机每次启动的时候，桥接了网桥，会回调这个脚本把虚拟TAP口加到网桥里。在这个过程中，无论网桥是否
已经激活，都会激活一次。
改动说明：
如果判断到网桥已经被激活了，则不需要再次激活这个网桥，直接把网口加到网桥中即可。
自测：
验证环境
4.7.00_B
build 2015-12-28 15:23:05
验证步骤：
1. 新建一台虚拟机，桥接了一个虚拟交换机，虚拟交换机没有激活。
2. 虚拟机开机。后台查看sfvt_vtp-bridge.log这个脚本信息。有激活网桥的日志。具体为Begin to active vsw: xxxxx
3. brctl show.可以看到这个这个网桥已经激活和虚拟机的网口已经加入到网桥中。具体的网桥ID可以在/cfs/nodes/hostid/vsw.ini中找到，虚拟机网口ID格式为vmid+xx
4. 关闭虚拟机。brctl show。虚拟机的网口不见了。从网桥中拔出。
5. 重新开机。在sfvt_vtp-bridge.log这个日志里面找不到这个虚拟交换机被激活的日志。
6. brctl show可以看到这个虚拟机的网口已经插入到网桥中。</msg>
</logentry>
<logentry
   revision="247537">
<author>yangwei</author>
<date>2015-12-30T09:26:24.711369Z</date>
<msg>reviewid 15194
bugid 34108
reviewed by fxw
问题说明：vs的序列号和asv对接，adesk修改接口
改动说明：
待测试后添加
测试：
先打包验证，后续添加</msg>
</logentry>
<logentry
   revision="247526">
<author>lcy</author>
<date>2015-12-30T07:50:44.668801Z</date>
<msg>reviewid:15196
review by fxw
Bug id: 34110
问题分析：TD34110,【集群IP】设置集群IP的时候，发送ARP的命令，忽略返回值为1的错误
问题出现的根源：
没有注意到执行这个命令会返回为1的。实际上这个命令执行成功的。
改动说明：
run_command的时候，加上为1的返回值忽略
自测：
验证环境
4.7.00_B
build 2015-12-28 15:23:05
验证步骤：
重置集群IP。不会有多余的日志产生。</msg>
</logentry>
<logentry
   revision="247517">
<author>jcy</author>
<date>2015-12-30T06:23:21.051257Z</date>
<msg>noreview：
改动说明：
修改序列号快过期的提示</msg>
</logentry>
<logentry
   revision="247499">
<author>fxw</author>
<date>2015-12-30T03:48:53.129171Z</date>
<msg>noreview

Merged revision(s) 247014, 247016, 247035, 247038-247039, 247076, 247100, 247102, 247107, 247109, 247148-247149, 247170 from VTP/VMP4.7/Personal/fxw/Trunk:
让qemu-img convert可以直接从参数里面读取目的文件的密码
........
让qemu-img convert可以直接从参数里面读取目的文件的密码
........
让qemu-img convert可以直接从参数里面读取目的文件的密码
........
让qemu-img convert可以直接从参数里面读取目的文件的密码
........
让qemu-img convert可以直接从参数里面读取目的文件的密码
........
增加一个用share key加密（解密）密码的参数，结果输出到stdout
qemu-img password -u password -i vmid test.qcow2
........
增加一个用share key加密（解密）密码的参数，结果输出到stdout
qemu-img password -u password -i vmid test.qcow2
........
增加一个用share key加密（解密）密码的参数，结果输出到stdout
qemu-img password -u password -i vmid test.qcow2
........
增加一个用share key加密（解密）密码的参数，结果输出到stdout
qemu-img password -u password -i vmid test.qcow2
........
增加一个用share key加密（解密）密码的参数，结果输出到stdout
qemu-img password -u password -i vmid test.qcow2
........
让qemu-img convert可以直接从参数里面读取目的文件的密码
........
让qemu-img convert可以直接从参数里面读取目的文件的密码
........
convert
........
</msg>
</logentry>
<logentry
   revision="247467">
<author>lcy</author>
<date>2015-12-30T01:37:02.926544Z</date>
<msg>no review
BUG ID: null
问题分析：更新每日工作日报。
改动说明：
更新每日日报
</msg>
</logentry>
<logentry
   revision="247466">
<author>lcy</author>
<date>2015-12-30T01:36:04.246904Z</date>
<msg>reviewid:15164
review by fxw
Bug id: 34019
问题分析：TD34019,【网口vlan配置】bond口中有一个网口掉线，修改bond口配置失败，提示有问题
问题出现的根源：
编辑网口假如发现网口状态异常报错之后，对于bond口的处理是直接打印其后台的ID。
改动说明：
先获取bond口的名字，获取不到的情况下才打印ID
自测：
验证环境
4.7.00_B
build 2015-12-28 15:23:05
验证步骤：
1. 新建一个bond口。然后，把其中一个网口的网线拔掉。
2. 编辑bond，禁用bond口，可以正常禁用。
3. 编辑bond, 启用bond口，可以正常启用。

之前的那个提示信息，理论上修改之后是不会再打印出来的。除非真的出现异常情况了才会打印出来。一般来说，断开物理网口网线也不会有状态异常的。回归的时候，范为了查看真的发生异常了是否有打印正常的日志，可以直接到后台看日志。
类似的日志：[interface] edit xxxx   (注：xxx是网口的实际打印错误日志的名字)
</logentry>
<logentry
   revision="247305">
<author>fxw</author>
<date>2015-12-29T09:52:53.340145Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="247272">
<author>yangwei</author>
<date>2015-12-29T06:17:11.329398Z</date>
<msg>reviewid 15138
reviewed by fxw
bugid 33462
问题说明：
虚拟机异常挂掉，出core，HA不停拉起，出core数量太多。
改动说明：
由一小时执行一次为5分钟执行一次。</msg>
</logentry>
<logentry
   revision="247268">
<author>yangwei</author>
<date>2015-12-29T03:55:42.373577Z</date>
<msg>reviewid 15133
bugid 34038
reviewed by fxw
问题分析：将双屏字段在load_config中类型强制转换为int
改动说明：
将双屏字段统一成int类型。
测试：
调试如下代码，查看双拼字段类型为int型。
use VTP::QemuServer;
$a = VTP::QemuServer::load_config('5916315349963');
print 123;
测试ok。</msg>
</logentry>
<logentry
   revision="247252">
<author>lcy</author>
<date>2015-12-29T02:55:24.083342Z</date>
<msg>reviewid:15129
review by fxw
Bug id: 34028
问题分析：TD34028,【虚拟交换机】删除虚拟交换机，删除失败，提示信息为网口id，而不是网口名称
问题出现的根源：
打印前台日志的时候，后台打印的是虚拟机网口的ID.
改动说明：
把日志显示的网口ID改成网卡1，网卡2这种形式。
自测：
验证环境
4.7.00_B
build 2015-12-28 15:23:05
验证步骤：
1. 虚拟机开机，运行在主机A.
2. 新建虚拟交换机1.虚拟机网卡2桥接虚拟交换机1.
3. 在主机A后台brctl show可以看到虚拟交换机已经起来。
4. 前台删除虚拟交换机
5. 有打印错误日志。日志显示为在主机A上，虚拟机的网卡2没有断开连接，删除失败。</msg>
</logentry>
<logentry
   revision="247234">
<author>lcy</author>
<date>2015-12-29T01:38:58.287063Z</date>
<msg>no review
BUG ID: null
问题分析：更新每日工作日报。
改动说明：
更新每日日报
</msg>
</logentry>
<logentry
   revision="247216">
<author>yangwei</author>
<date>2015-12-28T13:47:14.619071Z</date>
<msg>reviewid 15088
bugid 33965
reviewed by fxw
问题分析：
cfs集群不稳定等原因可能造成授权文件的不完整，即读取的SN和keyid为空（其中一个或者两者均为空）。环境插着合法的硬件key，出现这种情况不合理，需要修改。
改动说明：
1、如果对keyid和sn做了修改，那么将数据写到cfs的同时，将数据写到本地。
2、如果从cfs读到的keyid和sn为空，那么再试着从本地读取。
3、谁对sn和keyid做了修改要负责将更新的本地文件传送给其他节点。
4、如果这种情况持续出现30天，流程会将keyid清空，最终会成为非法企业版。
5、仅对sn和keyid进行了备份，不考虑对插key主机host等字段的备份，优先确保序列号功能的完整性，不影响虚拟机的开机等操作。
6、删除节点删除备份文件
7、添加节点，删除被添加节点的备份文件，并同步集群的备份文件
8、恢复出厂设置删除备份文件
9、更换主机，因为被更换主机不能访问，因此，不能删除备份文件。不考虑。
测试：
-----常规测试
1、集群插入一个合法key，每一个节点存在文件/boot/firmware/conf/.vmpsn.bak，该文件的keyid和sn匹配；
2、在页面换一个sn注册，每一个节点仍存在该文件，且内容变更为新的序列号；
3、将/cfs/priv/sn/sn的sn字段清掉，人为构造cfs数据丢失。
4、vtsn_tool -i 每一个节点都要查看，应该显示正确的keyid和sn匹配对。查看/cfs/priv/sn/sn数据又被正确填充。
----集群测试
5、标准版+企业版：
a、添加之前，查看备份文件，标准版不存在备份文件，企业版存在，且和硬件可以匹配；
b、添加结点
c、添加后，节点都无备份文件，十分钟内同步KEY信息，集群激活为企业版。
6、将key拔掉，备份文件仍然是企业版的匹配数据
7、将key插在主控上，备份文件匹配。
8、删除从节点：主控集群文件仍在，相匹配；被删除节点为无备份文件，为失效企业版。
9、将key从集群拔出，恢复出厂设置。备份文件不存在。</msg>
</logentry>
<logentry
   revision="247163">
<author>dongxia</author>
<date>2015-12-28T11:25:16.985393Z</date>
<msg>reviewid:15117
bug id:33843
问题分析：      模板定时更新的'plan_time'参数在创建时可以接受多个空格,保存在/cfs/.tpl_update_plans/下。但是用于定时扫描模板更新计划任务的脚本102check_tpl_update_plan.pl不能匹配含有多个空格的plan_time 所以会有“计划更新任务设置异常” 的日志
改动说明：
  更改了定时脚本102check_tpl_update_plan.pl中对plan_time 的匹配表达式，使能接受多个空格
自测：
1、未更改定时脚本时，将/cfs/.tpl_update_plans/下的计划中的时间添加多个空格，log中报出设置异常错误
2、更改定时脚本中的匹配表达式后，对于计划中有多个空格的时间，不会报出异常</msg>
</logentry>
<logentry
   revision="247161">
<author>dongxia</author>
<date>2015-12-28T11:05:33.221120Z</date>
<msg>reviewid:15066
bugid:33635
问题分析：
现象：
1.原101和103两台主机组集群，101主机上插了一个key；102主机也插了一个key，从4.5.01升级到4.7.00
2.101和103所租集群106上，添加102主机到集群中
3.告警信息提示集群中有2个key，根据告警信息，拔掉了101主机上的key
4.发现106控制台前台不能识别出102主机上的key了，当前集群认为集群中是没有key。实际上
到102主机的后台，vtsn_tool -k可以看到keyid：
Sangfor:VMP/host-001e67a1a9e9 /sf # vtsn_tool -k
2763872903
5.隔几分钟以后，可以识别到key了。使用新key的序列号设置，会设置存储序列号失败

原因：
 查看了当时的日志，是因为ssh用的是hostname不是ip，换成ip即可
改动说明：
修改了VTP::VMPSN::set_vssn函数，将其中需要ssh时，原来所用的$owner_hostname改为使用$owner_ip
自测：
环境：192.28.162.91 admin
1、将key插到从节点192.28.162.94上
2、注册vs
3、使用不同的序列号注册多次，操作均成功</msg>
</logentry>
<logentry
   revision="247155">
<author>lcy</author>
<date>2015-12-28T09:58:34.407901Z</date>
<msg>reviewid:15115
review by gwl
Bug id: 34015
问题分析：TD34015,【Bond口】2台主机组集群，A主机组了汇聚网口eth23，B主机组汇聚网口 eth23 会报重名
问题出现的根源：
原来添加Bond口的流程，在判断用户自定义的名字是否重名的时候，是扫描整个集群所有主机的配置信息。有重名
就会报错。
改动说明：
判断Bond口是否有重名，不需要扫描集群中所有主机。只需要扫描本地的配置即可。
原来编辑的流程没有检查是否存在同名，现在加上检查，假如是编辑的操作检查网口同名，则跳过当前网口的配置信息。
自测：
验证环境
4.7.00_B
build 2015-12-26 23:55:10
验证步骤：
1.单主机集群。配置一个聚合网口bondA，再添加一个聚合网口bondA。页面会弹出错误信息，有存在同名的网口。
2.单主机集群。配置一个聚合网口bondA，再配置一个聚合网口bondB。修改聚合网口bondB的名字为bongA。页面提示错误信息，有存在同名的网口。
3.两台主机组成的集群。在A主机上配置一个聚合网口bondA,再在B主机上添加一个聚合网口bondA.可以添加成功。</msg>
</logentry>
<logentry
   revision="247125">
<author>hyq</author>
<date>2015-12-28T08:35:46.452816Z</date>
<msg>reviewid: 15113
bug id: null
问题描述: null
改动说明: 把锁目录修改为 /cfs/priv/lock
自测场景: 在后台执行虚拟机流程 cluvmadm -e vmid 时，在/cfs/priv/lock/目录下有cluvm_start_lock_目录</msg>
</logentry>
<logentry
   revision="247110">
<author>vs</author>
<date>2015-12-28T06:56:01.568996Z</date>
<msg>概要信息: 增加新需求，vs配置网络的时候要过滤掉vmp已配了VLAN的网口
BUG   ID: vstd 30753
改动说明: 增加新需求，vs配置网络的时候要过滤掉vmp已配了VLAN的网口
测试分析: 在配置vs网络的页面，查看配置网络时是否过滤掉了配了VLAN的网口
reviewid 14963, reviewed by lzj, tyy</msg>
</logentry>
<logentry
   revision="247101">
<author>hyq</author>
<date>2015-12-28T06:34:30.207063Z</date>
<msg>reviewid: 15105
bug id: null
问题描述: 异地备份有出错
改动说明: 异地备份的时候需要调用到这个函数，加上
测试场景: 执行异地备份操作通过</msg>
</logentry>
<logentry
   revision="247096">
<author>zhaoxl</author>
<date>2015-12-28T05:00:43.425224Z</date>
<msg>no review
更新VMP4.7迭代2SBL</msg>
</logentry>
<logentry
   revision="247092">
<author>lcy</author>
<date>2015-12-28T04:26:54.825476Z</date>
<msg>reviewid:15102
review by fxw
Bug id: 33951
问题分析：TD33951,【网口vlan配置】一个网口所连交换机端口禁用，导致一系列问题
问题出现的根源：
禁用网卡的时候，从/sys/class/net/ethx/operstate这个系统文件里面读取设备的系统状态。
这里记录的是网卡插上了网线与否。
改动说明：
清除IP信息的时候，不用再次判断网口的状态。直接清除就好
自测：
验证环境
4.7.00_B
build 2015-12-26 23:55:10
验证步骤：
1. 网口插上网线，启用网口，网口正常被启用
2. 网口插上网线，禁用网口，网口正常被禁用
3. 网口拔出网线，启用网口，网口正常被启用
4. 网口拔出网线，禁用网口，网口正常被禁用</msg>
</logentry>
<logentry
   revision="247065">
<author>zhaoxl</author>
<date>2015-12-28T02:26:55.643992Z</date>
<msg>no review
更新VMP4.7迭代2SBL</msg>
</logentry>
<logentry
   revision="247061">
<author>lcy</author>
<date>2015-12-28T02:15:22.689886Z</date>
<msg>no review
BUG ID: null
问题分析：更新每日工作日报。
改动说明：
更新每日日报
</msg>
</logentry>
<logentry
   revision="247043">
<author>hyq</author>
<date>2015-12-26T09:30:41.742169Z</date>
<msg>noreview
改动说明: UI 显示模板虚拟机不能扩容放开限制
自测场景: 未自测</msg>
</logentry>
<logentry
   revision="247034">
<author>lcy</author>
<date>2015-12-26T08:36:59.255292Z</date>
<msg>reviewid:15075
review by fxw,jcy
Bug id: no
描述：【新需求】实体机页面支持显示主机配置内存的值
VMP实体机页面支持显示可配置内存的大小。
自测：
自测通过</msg>
</logentry>
<logentry
   revision="247033">
<author>hyq</author>
<date>2015-12-26T08:36:38.513148Z</date>
<msg>reviewid: 15084
bug id: null
问题描述: null
改动说明: 分支合入到主干没合入进来
自测场景: 编辑模板虚拟机镜像大小成功。备份模板虚拟机成功。虚拟机有备份扩容成功。</msg>
</logentry>
<logentry
   revision="247029">
<author>yangwei</author>
<date>2015-12-26T08:07:25.158952Z</date>
<msg>reviewid 15079
bugid 33960
reviewed by fxw
问题分析：添加了双显卡后导致原有设备的pci位置变化，驱动重装
改动说明：将双屏支持的qxl参数移动到kvm启动参数的末尾。
测试：
1.新建一个win7虚拟机，关闭双屏
2.安装vdc agent
3. 在设备管理器中记录网卡，sangfor channel driver设备的pci设备号(在设备常规tab里能看到）
4. 关闭虚拟机，开启双屏，启动虚拟机
5. 再次查看上述设备的pci设备号
设备号一样，测试ok。</msg>
</logentry>
<logentry
   revision="247018">
<author>hyq</author>
<date>2015-12-26T05:30:34.388436Z</date>
<msg>noreview
改动说明: 合入到主干
自测场景: 未自测</msg>
</logentry>
<logentry
   revision="247013">
<author>lcy</author>
<date>2015-12-26T03:51:10.942921Z</date>
<msg>reviewid:15071
review by fxw
Bug id: no
描述：【新需求VLAN】默认IP修改支持VLAN修改
首次登陆VMP的时候，默认IP修改支持配置集群通信口的VLAN。
自测：
与UI联调通过。</msg>
</logentry>
<logentry
   revision="247011">
<author>jcy</author>
<date>2015-12-26T03:00:17.711019Z</date>
<msg>noreview：
改动说明：
bug33841，新需求，模板部署时，个人盘只能选精简分配，非置零</msg>
</logentry>
<logentry
   revision="247009">
<author>jcy</author>
<date>2015-12-26T02:35:24.782465Z</date>
<msg>noreview：
改动说明：
bug33959，主机卡片上显示谁是主控</msg>
</logentry>
<logentry
   revision="247007">
<author>jcy</author>
<date>2015-12-26T02:11:20.504223Z</date>
<msg>noreview：
改动说明：
默认IP登录时，配置IP的页面支持配置网口的vlan</msg>
</logentry>
<logentry
   revision="246978">
<author>yangwei</author>
<date>2015-12-25T10:12:09.591604Z</date>
<msg>reviewid 15048
Reviewed by: fxw
BUG ID: 33823
问题分析：快照过多，导致镜像数据大，需要释放镜像空间
VMP的自动备份功能以及手动快照都会对虚拟机镜像打快照。这就引发一个问题，如果客户频繁添加删除大文件，以及频繁地打快照，就会让镜像越来越大。虽然限制了快照个数以及可以对快照进行删除，但是并没有从根本上解决问题，或者根本就没有解决什么问题，仅仅是减少了配置文件的大小。因为删除快照并不会释放qcow2文件空间。例如存在一个1G的文件，快照1的时候镜像中不存在该文件的数据，将该文件放到虚拟机中，打快照2，这个时候即使恢复到快照1，虚拟机的qcow2文件并不会因此释放这个文件的空间，qcow2文件中会一直保留该文件的数据。
改动说明：
空间优化有三种策略：
1、删除虚拟机所有快照，然后对虚拟机最新状态打一个快照，再进行一次convert优化。
2、先将虚拟机镜像convert到第一个的快照，然后依次提取各个快照间的差异。
3、直接convert到指定快照。
第1和第2种方法类似，都会使虚拟机保持最新状态。区别是是否会保留快照信息。这两种方式进行优化性能差不多，都不能从根本上解决引导语中的问题，但经过convert之后，qcow2镜像的空间会重新整合。在试验中，最好的情况是优化后的qcow2文件释放了大约一半的空间，最坏的情况是几乎没有变化。
第3种方法会将指定快照后的所有快照数据全部丢弃。例如有快照N，快照N后虚拟机下载了个1G的文件，然后各种快照。使用该策略优化，恢复到快照N，就可以真正吧这1G文件空间，以及后面数据释放出来，真正地给qcow2文件瘦身。
就目前而言，最好的优化性能是使用第三种方法将虚拟机恢复到第一个最老的快照位置。除非修改qemu源码，可以提取出删除快照后不需要的数据，释放掉。例如快照N之后虚拟机多了一个1G的文件，然后打快照N+1，再删除快照N+1，按理qemu就应该在qcow2镜像中释放这1G的文件空间。但事实是没有释放的。
该脚本已经实现1、2种方法。第3种方法已经实现，还需要测试，后续持续更新。
测试：
1、开启虚拟机  虚拟机id为VMID。【虚拟机存储分别为本地、共享、VS】
2、手动快照
3、新建文件1.txt，写入1，保存，手动快照    【可加入删除大文件测试   可以灵活测试  效果更佳】
4、新建文件2.txt，写入2，保存，手动快照
5、新建文件3.txt，写入3，保存，手动快照
6、新建文件4.txt，写入4，保存
7、关机
8、后台执行脚本： ./opt_snapshot.pl [-c] VMID
9、很很耗时的等待
10、检查前台的快照显示和后台配置的一致性：即是否存在相匹配的快照，有没有多余的或者少的。
11、完成后开虚拟机，应该有4个文件，并检查文件内容。
12、检查优化前后的镜像大小变化。
13、依次恢复快照，检查数据状态是否正确。
测试用例见附件。
主要场景处理：
1、非stopped状态的不处理
2、镜像所在分区空间不足不处理，至少需要和镜像一样大剩余空间
3、非清理模式，手动快照小于7才处理</msg>
</logentry>
<logentry
   revision="246958">
<author>hyq</author>
<date>2015-12-25T09:14:17.777909Z</date>
<msg>reviewid: 15052
bug id: null
问题描述:派生时点确定 没反应
改动说明: 合入到主干
自测场景: 未自测</msg>
</logentry>
<logentry
   revision="246952">
<author>lcy</author>
<date>2015-12-25T08:42:56.864905Z</date>
<msg>reviewid:15049
review by fxw
Bug id: no
描述：【新需求VLAN】VMP支持在ISO安装的时候给网口配置VLAN信息
【新需求VLAN】VMP支持在ISO安装的时候给网口配置VLAN信息。在ISO安装界面支持VLAN配置。
自测：
打包验证。</msg>
</logentry>
<logentry
   revision="246930">
<author>hyq</author>
<date>2015-12-25T06:52:00.037113Z</date>
<msg>noreview：
改动说明：分支合入主干冲突</msg>
</logentry>
<logentry
   revision="246929">
<author>hyq</author>
<date>2015-12-25T06:43:59.498122Z</date>
<msg>noreview：
改动说明：分支合入主干冲突</msg>
</logentry>
<logentry
   revision="246926">
<author>hyq</author>
<date>2015-12-25T06:24:49.543957Z</date>
<msg>reviewid: 15037
bug id: null
问题原因: null
改动说明: 3.6限制了模板虚拟机的扩容，这里放开
自测场景: 用分支的包测试通过</msg>
</logentry>
<logentry
   revision="246915">
<author>hyq</author>
<date>2015-12-25T03:36:28.788186Z</date>
<msg>reviewid: 15026
bug id: 32801
问题描述: 将/log与/sf/cfg分区的文件系统变为ext3格式。(td33307)
把p2v快虚后的vmp的log、cfg分区文件系统格式从ext4改为ext3(vmp不支持p2v，但vmp里已经有p2v_mount.sh这个文件，因此也合入 td33308)
TD 33451,恢复出厂后，集群信息还保留着。问题原因如下：
1./sf/cfg的分区格式从ext4变为ext3，中间设备有做过降级回滚操作，当时cfg分区挂载失败，而根分区的真实/sf/cfg目录被写入数据，导致数据被残留。
2.恢复出厂设置后，设备启动会重新创建cfg文件，并从根分区的真实/sf/cfg目录中拷贝文件，而此目录下文件已经被写入数据了。
3.这样就导致恢复出厂设置后的cfg目录下面还残留着以前的数据。
改动说明: 
1、最近一年redhat内核对ext4代码一直在大改重构，使这块的功能存在很大风险，经过与whf、leijian讨论，决定切到稳定成熟的ext3文件系统格式。
2、把p2v快虚后的vmp的log、cfg分区文件系统格式从ext4改为ext3
3、如果/sf/cfg分区挂载失败，就将/sf/cfg挂载为内存目录，这样就对根分区的真实/sf/cfg目录起到了保护作用。
/dev/loop0                      ext3    97M  6.5M   86M   8% /sf/cfg
分区文件系统为ext3

2、升级设备（设备/sf/log和/sf/cfg原来的分区文件系统为ext4）,升级成功后，按td33451回归通过</msg>
</logentry>
<logentry
   revision="246886">
<author>jcy</author>
<date>2015-12-25T02:03:44.428761Z</date>
<msg>noreview：
改动说明：
bug33901，虚拟交换机：查看已连接的虚拟机，编辑网口不生效</msg>
</logentry>
<logentry
   revision="246881">
<author>chenlei</author>
<date>2015-12-25T01:38:27.844321Z</date>
<msg>no review
BUG ID: null
问题分析：更新每日工作日报。
改动说明：
更新每日日报
</msg>
</logentry>
<logentry
   revision="246851">
<author>yangwei</author>
<date>2015-12-24T09:57:26.739191Z</date>
<msg>reviewid 15000
reviewed by fxw 
BUG ID: 33905
问题分析： 4.5升级上来的虚拟机是没有双屏配置的，开启状态的vm不修改任何配置，提交。提示不允许修改.
改动说明： 
在虚拟机配置函数里面进行判断，如果是非sslvpn，没有双屏字段就置为1.
测试：
1、配置没有双屏字段的虚拟机
2、开机，编辑虚拟机，不做任何修改，提交成功。
测试ok</msg>
</logentry>
<logentry
   revision="246822">
<author>yangwei</author>
<date>2015-12-24T07:50:44.917246Z</date>
<msg>reviewid 14987
Reviewed by: fxw
BUG ID: 33897
问题分析：虚拟机没有双屏的配置字段，开启虚拟机应该默认开启双屏
改动说明：
在启动虚拟机的时候，会进行kvm启动参数的组装，判断是否存在双屏字段。如果配置没有该字段，且不是sslvpn，则添加双屏启动参数。
测试：
1、虚拟机VM的配置中没有双屏字段
2、开启虚拟机
3、查看虚拟机的硬件配置，有两个“显示显示适配器”，则ok。
4、如果是sslvpn，则查看kvm启动参数，是没有qxl的，则ok。
测试ok。</msg>
</logentry>
<logentry
   revision="246800">
<author>hyq</author>
<date>2015-12-24T04:40:29.190847Z</date>
<msg>reviewid: 14981
bug id: 33881
问题描述: 【合入VMP4.7】优化apache，和vtpdaemon执行api的时间输出z
改动说明: 合入sddc优化apache，和vtpdaemon执行api的时间输出
自测场景: 

</logentry>
<logentry
   revision="246773">
<author>chenlei</author>
<date>2015-12-24T01:36:02.215190Z</date>
<msg>no review
BUG ID: null
问题分析：更新每日工作日报。
改动说明：
更新每日日报
</msg>
</logentry>
<logentry
   revision="246734">
<author>hyq</author>
<date>2015-12-23T09:45:36.441671Z</date>
<msg>reviewid: 14760
bug id : td33735
问题分析: 见td33735
改动说明: HA虚拟机启动添加一个锁，避免多个主机多次拉起
自测场景: 这里没有多台主机，测试了3个虚拟主机的场景，测试结果如下

for((i=0; i&lt;10; i++)); do ./cluvmadm -e 922771629474; done
trying to get cfs lock 'cluvm_start_lock_922771629474' ...虚拟机正在进行其他操作，请稍后重试！
trying to get cfs lock 'cluvm_start_lock_922771629474' ...虚拟机正在进行其他操作，请稍后重试！
trying to get cfs lock 'cluvm_start_lock_922771629474' ...虚拟机正在进行其他操作，请稍后重试！
trying to get cfs lock 'cluvm_start_lock_922771629474' ...虚拟机正在进行其他操作，请稍后重试！
trying to get cfs lock 'cluvm_start_lock_922771629474' ...虚拟机正在进行其他操作，请稍后重试！
trying to get cfs lock 'cluvm_start_lock_922771629474' ...虚拟机正在进行其他操作，请稍后重试！
trying to get cfs lock 'cluvm_start_lock_922771629474' ...虚拟机正在进行其他操作，请稍后重试！
trying to get cfs lock 'cluvm_start_lock_922771629474' ...虚拟机正在进行其他操作，请稍后重试！
trying to get cfs lock 'cluvm_start_lock_922771629474' ...虚拟机正在进行其他操作，请稍后重试！

for((i=0; i&lt;10; i++)); do ./cluvmadm -e 8630326225782; done
8630326225782 is already running on host-fefcfed2f314
8630326225782 is already running on host-fefcfed2f314
8630326225782 is already running on host-fefcfed2f314
8630326225782 is already running on host-fefcfed2f314
8630326225782 is already running on host-fefcfed2f314
8630326225782 is already running on host-fefcfed2f314
8630326225782 is already running on host-fefcfed2f314
8630326225782 is already running on host-fefcfed2f314
8630326225782 is already running on host-fefcfed2f314
</msg>
</logentry>
<logentry
   revision="246726">
<author>jcy</author>
<date>2015-12-23T09:33:40.565332Z</date>
<msg>noreview：
改动说明：
VS单主机环境：登录后首页提示组建集群，添加超过八台主机，到第三步，主机序号应显示正确</msg>
</logentry>
<logentry
   revision="246706">
<author>lcy</author>
<date>2015-12-23T08:10:56.976406Z</date>
<msg>reviewid:14948
review by fxw
Bug id: no
描述：【新需求VLAN】增加对Bond口的支持，对一些异常的处理。
界面可以编辑普通网口成为聚合网口，对于已经配置了VLAN的网口，后台加以限制。
自测：
自测通过</msg>
</logentry>
<logentry
   revision="246683">
<author>dongxia</author>
<date>2015-12-23T03:27:29.865365Z</date>
<msg>reviewid: 14813
bugid: 33569
问题分析：
批量编辑虚拟机(含vdc虚拟机)勾选双屏后，检查结果，对于vdc虚拟机双屏操作失败但是日志打印成功
这里是批量，UI不做限制，perl让任务失败就行，单个编辑vdc时已有限制。
所以在批量编辑时需要检验如果是对vdc虚拟机设置双屏显示，则不仅仅不执行还需要在日志中报告错误，并且显示执行失败
改动说明：
修改了VTP::QemuServer::edit_vm_conf函数，增加一个检测如果虚拟机是VDC虚拟机并且还对于它的设置中有设置双屏的信息则显示该操作失败并且日志中报错：VDC虚拟机不支持双屏显示
自 测：
172.28.162.91 admin
1、批量编辑虚拟机（含vdc虚拟机）勾选双屏，检查结果，对于vdc虚拟机操作会失败，并且报错：vdc虚拟机不支持双屏显示；非vdc虚拟机则操作成功
2、批量编辑虚拟机（含vdc虚拟机）不选双屏，检查结果，操作均成功</msg>
</logentry>
<logentry
   revision="246662">
<author>chenlei</author>
<date>2015-12-23T01:42:07.052942Z</date>
<msg>no review
BUG ID: null
问题分析：更新每日工作日报。
改动说明：
更新每日日报
</msg>
</logentry>
<logentry
   revision="246632">
<author>fxw</author>
<date>2015-12-22T11:42:44.385763Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="246631">
<author>fxw</author>
<date>2015-12-22T11:41:58.500352Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="246625">
<author>fxw</author>
<date>2015-12-22T11:03:09.163987Z</date>
<msg>noreview
添加qemu-img password的两个新参数，用于磁盘预加载：
1. -d 删除RC4加密盘的默认密码，非加密盘和非默认密码无效
2. -o 用于-d删除默认密码后恢复默认密码，恢复的key和之前的key不一致

增加一个测试脚本，将脚本和qemu-img放到同一个目录下执行即可</msg>
</logentry>
<logentry
   revision="246623">
<author>fxw</author>
<date>2015-12-22T10:35:02.446484Z</date>
<msg>noreview
消除告警</msg>
</logentry>
<logentry
   revision="246618">
<author>fxw</author>
<date>2015-12-22T09:51:52.059468Z</date>
<msg>noreview
合入SSL的patch
解决公安三所Usbkey、名门地产加密狗外设映射问题

问题原因：
由于这类Key的Guest驱动实现方式，对于Interrupt IN断点进行READ的时候，中间有超过32ms的空档
qemu原始的机制超过32ms会导致Interrupt IN的流被取消，同时清除掉这个端点已收到还没提交给Guest的数据
所以会导致丢数据

修改方法：
针对Interrupt IN断点，将这个32ms时间延长至1000ms，其他类型保持不变，尽量将影响减小，满足大多数驱动
当1000ms还不够的时候，仅针对这种情况下的ep stop，保留其缓冲区数据，其他情况仍然清除，尽量减小影响</msg>
</logentry>
<logentry
   revision="246601">
<author>lcy</author>
<date>2015-12-22T09:02:29.393801Z</date>
<msg>reviewid:14923
review by fxw
Bug id: no
描述：【新需求VLAN】后台重启网络服务，改动重启网络服务的脚本
开机的时候，VMP可以自动加载已经配置VLAN的网口。
后台重启网络服务，集群IP，网桥，bond口，普通网口的IP信息和路由表可以正常使用。
自测：
自测通过。</msg>
</logentry>
<logentry
   revision="246552">
<author>jcy</author>
<date>2015-12-22T02:58:48.820148Z</date>
<msg>noreview：
改动说明：
bug33798,限制vlan只能输整数
bug33767，网口配置未更改时，不下发数据</msg>
</logentry>
<logentry
   revision="246547">
<author>dongxia</author>
<date>2015-12-22T02:49:35.673194Z</date>
<msg>reviewid: 14909
bug id: 33616 
问题分析：  
从VMP4.5升级到VMP4.6或者VMP4.7,查看虚拟机的编辑里的双屏选项 ,UI显示有双屏，但是启动参数没有
当启动参数中没有双屏字段返回到UI，UI就会默认置为勾选；

修改成UI保持不变，如果配置没有双屏选项，对于非VDC虚拟机则默认为其开启双屏，为其添加双屏字段置为1返回到UI，UI就显示勾选

改动说明：
修改了VTP::VMInfo::edit_vm_conf函数，当获得虚拟机的配置参数后，对于非VDC虚拟机如果其中没有双屏的信息就为其添加双屏字段并且置为1；如果本来有双屏字段或者是VDC虚拟机，则保持原值
自测：
设备172.28.162.91 密码admin
1、对于启动参数中没有双屏字段的非VDC虚拟机，修改后通过UI编辑页面查看双屏选项勾选，编辑生效后，配置文件中增加double_screen字段，开启双屏。
2、对于启动参数中有双屏字段的虚拟机，修改后通过UI编辑页面查看，启动参数中为1，则双屏选项勾选，启动参数中为0，则双屏选项不勾选.
3、对于VDC虚拟机，则UI双屏选项继续置灰并且显示不勾选</msg>
</logentry>
<logentry
   revision="246525">
<author>chenlei</author>
<date>2015-12-22T01:31:57.555041Z</date>
<msg>no review
BUG ID: null
问题分析：更新每日工作日报。
改动说明：
更新每日日报
</msg>
</logentry>
<logentry
   revision="246443">
<author>dongxia</author>
<date>2015-12-21T12:22:09.490379Z</date>
<msg>reviewid: 14896
bugid: 33420
问题分析：
【测试环境】
Sangfor:VMP/host-001517255889 /sf # cat version 
4.6.00_B
build 2015-11-25 14:20:19
Chrome浏览器 版本 41.0.2272.118 m
【测试步骤】
1.新安装的VMP，IP默认，PC机直连，登录https://10.254.254.10,检查弹框
2.
【期望结果】
1.弹框可修改网关

【实际结果】
1.弹框无网关配置项，如附件

改动说明：
修改了VTP::VAPI::Cluster 在/cluster/network/cluster_iface这个API访问时，增加获取gateway的字段的值并且返回给API
自测：
通过掉用API /vapi/json/cluster/network/cluster_iface
得到含有网关字段的返回值：
{"success":1,"data":{"gateway":"172.28.162.254","name":"eth0","netmask":"255.255.255.0","address":"172.28.162.91","hostid":"host-0cc47a42a1cc"}}</msg>
</logentry>
<logentry
   revision="246408">
<author>lcy</author>
<date>2015-12-21T09:01:13.012511Z</date>
<msg>reviewid:14883
review by fxw
Bug id: no
描述：【新需求VLAN】配合VS进行修改返回网口配置的API
修改API /cluster/network/iface,增加网口的vlanid字段。
自测：
自测通过</msg>
</logentry>
<logentry
   revision="246393">
<author>dongxia</author>
<date>2015-12-21T07:50:35.592008Z</date>
<msg>reviewid: 14878
bugid: 33616 
问题分析：
【测试环境】
VMP4.7
【测试步骤】
1.从VMP4.5升级到VMP4.6或者VMP4.7
2.查看虚拟机的编辑里的双屏选项
【期望结果】
UI的双屏和启动虚拟机的参数一致
【实际结果】
UI显示有双屏，但是启动参数没有
【备注】
修改成如果配置没有双屏选项，UI就显示不勾选

改动说明：
修改了VTP::VMInfo::edit_vm_conf函数，当获得虚拟机的配置参数后，如果其中没有双屏的信息就为其添加双屏字段并且置为0；如果本来有双屏字段，则保持原值
自测：
设备172.28.162.91 密码admin
1、对于启动参数中没有双屏字段的虚拟机，修改后通过UI编辑页面查看双屏选项没有勾选。
2、对于启动参数中有双屏字段的虚拟机，修改后通过UI编辑页面查看，启动参数中为1，则双屏选项勾选，启动参数中为0，则双屏选项不勾选.</msg>
</logentry>
<logentry
   revision="246380">
<author>chenlei</author>
<date>2015-12-21T06:37:31.103594Z</date>
<msg>no review
BUG ID: null
问题分析：更新每日工作日报。
改动说明：
更新每日日报
</msg>
</logentry>
<logentry
   revision="246344">
<author>yangwei</author>
<date>2015-12-21T00:59:00.188498Z</date>
<msg>reviewid 14862
Reviewed by: lcy
BUG ID: 
问题分析：添加14-18的工作日报。
改动说明：
1、添加本周的工作日报。
</msg>
</logentry>
<logentry
   revision="246217">
<author>vs</author>
<date>2015-12-18T08:00:00.461443Z</date>
<msg>概要信息: 去掉4K扇区检测
BUG   ID: 30733
改动说明: 不需要检测了，去掉检测的代码
测试分析:
reviewid 14820, reviewed by tyy</msg>
</logentry>
<logentry
   revision="246214">
<author>vs</author>
<date>2015-12-18T07:47:46.433172Z</date>
<msg>概要信息: 修改2.1的测速方法和2.0一样
BUG   ID: 30719
改动说明: 之前改动到了4.6，转到4.7
测试分析:
reviewid 14819, reviewed by fxw</msg>
</logentry>
<logentry
   revision="246156">
<author>fxw</author>
<date>2015-12-18T02:10:59.545521Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="246149">
<author>hyq</author>
<date>2015-12-18T01:34:38.434173Z</date>
<msg>reviewid: 14811
bug id: 33744
问题描述: HA虚拟机只有一个网口，未插网线，开机启动失败
问题分析: 获取开启该虚拟机的主机流程里参数net_ok默认为1,即默认虚拟机网络是正常的，合入4.2bug后这里逻辑反了，又没有进入把net_ok设置为1的流程
导致获取能开启虚拟机的主机失败
改动说明: 改回原来的逻辑,net_ok初始化为1，检测有问题再设置为0
自测场景: 两台主机组成的集群，新建一台只有一个网口的HA虚拟机，网口不插网线，开启虚拟机。虚拟机能正常启动。</msg>
</logentry>
<logentry
   revision="246148">
<author>lcy</author>
<date>2015-12-18T01:33:04.755027Z</date>
<msg>reviewid:14766
review by fxw
Bug id: 33748
问题分析：TD33748,【新需求VLAN】集群通信口拔出网桥，会导致集群IP删除。
问题出现的根源：
直接把集群通信口从网桥中拔出，会去删除集群IP，后面判断到集群通信口已经配置了VLAN信息
就没有走原来的重置集群IP的流程，导致集群IP被删除。
改动说明：
在把物理网口从网桥中拔出之后，重置一次集群IP.
自测：
验证环境
4.7.00_B
build 2015-12-17 11:45:41
验证步骤：
集群通信口桥接了网桥，配置了集群IP，网桥已经激活，给集群通信口配置了VLAN信息。
把网桥中的集群通信口拔出，网桥不连接其他的物理网络
查看集群IP，集群IP没有被删除。</msg>
</logentry>
<logentry
   revision="246106">
<author>dongxia</author>
<date>2015-12-17T10:52:33.906282Z</date>
<msg>reviewid:14685
bugid:33577

问题分析：
Tools.pm中的函数run_command
在执行一些命令的时候，比如
Tools::run_command("lsusb | grep -ciE '(096e:0209)|(096e:020a)|(08e2:0008)'");
命令执行后的返回值可能是0，可能是1，调用者不关心返回值，只需要输出的内容
然而，run_command会判断返回值，只要不是0.它就认为命令执行失败，会die出来。
为了灵活应用，需要给它加一个参数，修改函数的行为，允许调用者指定忽略某些返回值
或者指定某些返回值为正确的值，从而不让函数报错。

改动说明：修改了Tools.pm中的run_command函数，为其增加一个数组参数@ignore_exit_code,通过@ignore_exit_code设定对于某命令某个返回值是正确的，若设为0则表示对于所有返回值都可以认为正确

自测： 
例如对于命令qemu-img info /sf/data/360050763008082fd800000000000005e/images/cluster/xp22220003.vm/vm-disk-2.qcow2,执行之后 返回值为1
分别执行
eval {
        VTP::Tools::run_command("qemu-img info /sf/data/360050763008082fd800000000000005e/images/cluster/xp22220003.vm/vm-disk-2.qcow2");
};
if( $err = $@) {
                lerror("1:$err");
}
eval {
        VTP::Tools::run_command("qemu-img info /sf/data/360050763008082fd800000000000005e/images/cluster/xp22220003.vm/vm-disk-2.qcow2",ignore_exit_code =&gt; [1]);
};
if( $err = $@) {
                lerror("1:$err");
}
eval {
       VTP::Tools::run_command("qemu-img info /sf/data/360050763008082fd800000000000005e/images/cluster/xp22220003.vm/vm-disk-2.qcow2",ignore_exit_code =&gt; [0]);
};
if( $err = $@) {
        lerror("2:$err");
}
测得在有了ignore_exit_code设为0,1后，不会die;若不设则会die</msg>
</logentry>
<logentry
   revision="246062">
<author>lcy</author>
<date>2015-12-17T03:47:57.098550Z</date>
<msg>reviewid:14764
review by fxw
Bug id: no
描述：新需求VLAN，修改VAPI目录下的Makefile
增加Vlan.pm文件
自测：
打包验证</msg>
</logentry>
<logentry
   revision="246047">
<author>zhaoxl</author>
<date>2015-12-17T02:15:28.998046Z</date>
<msg>no review
更新SBL</msg>
</logentry>
<logentry
   revision="246044">
<author>lcy</author>
<date>2015-12-17T01:58:50.912195Z</date>
<msg>reviewid:14742
review by fxw
Bug id: no
描述：新需求，VMP网口支持VLAN配置
VMP的网口都支持配置VLAN信息。包括VDC通信口，集群通信口，普通网口。
VS私网网口不支持VLAN配置。
自测：
BTV部分案例执行完，并且已经执行通过。</msg>
</logentry>
<logentry
   revision="246016">
<author>fxw</author>
<date>2015-12-16T09:48:15.729028Z</date>
<msg>Author: fxw
reviewid: 14698
review by hyq
Bug id：33237
问题分析：
重置派生虚拟机镜像的脚本为了性能考虑和开机速度考虑，没有把原来的镜像删除，导致文件越来越大
改动说明：
增量镜像删了重建
自测：
还原模式虚拟机重启后镜像被还原，原来占用的空间被释放</msg>
</logentry>
<logentry
   revision="246009">
<author>jcy</author>
<date>2015-12-16T09:09:05.068934Z</date>
<msg>noreview：
改动说明：
被VS占用的网口不允许启用VLAN</msg>
</logentry>
<logentry
   revision="246007">
<author>zhaoxl</author>
<date>2015-12-16T09:01:40.441662Z</date>
<msg>no review
更新一下文档格式</msg>
</logentry>
<logentry
   revision="245919">
<author>zhaoxl</author>
<date>2015-12-16T03:45:08.913998Z</date>
<msg>no review</msg>
</logentry>
<logentry
   revision="245848">
<author>jcy</author>
<date>2015-12-15T12:16:28.313029Z</date>
<msg>noreview：
改动说明：
bug33519：安装了vmtool的限制为16个驱动器</msg>
</logentry>
<logentry
   revision="245846">
<author>hyq</author>
<date>2015-12-15T11:40:37.092501Z</date>
<msg>reviewid: 14711
bug id: 33519
问题描述: 放开虚拟机的磁盘数量限制为16个
改动说明: 放开虚拟机的磁盘数量限制为16个
自测场景: jcy测试通过</msg>
</logentry>
<logentry
   revision="245832">
<author>jcy</author>
<date>2015-12-15T09:32:21.578062Z</date>
<msg>noreview：
改动说明：
新需求：网口支持配VLAN--
1，点击启用禁用时要下发vlan信息
2，添加虚拟口时，在名称浮现显示配有vlan</msg>
</logentry>
<logentry
   revision="245814">
<author>jcy</author>
<date>2015-12-15T08:31:51.859294Z</date>
<msg>noreview：
改动说明：
bug33420，新环境使用默认ip登录时，会提示配置IP，现在再加上支配在管理口上配置网关
</msg>
</logentry>
<logentry
   revision="245786">
<author>jcy</author>
<date>2015-12-15T07:22:27.588593Z</date>
<msg>noreview：
改动说明：
bug33574，新建虚拟机 win7 的网卡型号默认设置为“Realtek RTL8139”
</msg>
</logentry>
<logentry
   revision="245781">
<author>jcy</author>
<date>2015-12-15T07:03:44.192320Z</date>
<msg>noreview：
改动说明：
bug33692，部署虚拟机的时候选择了重启还原，但是未下发
</msg>
</logentry>
<logentry
   revision="245777">
<author>jcy</author>
<date>2015-12-15T06:27:36.170640Z</date>
<msg>noreview：
改动说明：
新需求：网口支持配VLAN
</msg>
</logentry>
<logentry
   revision="245769">
<author>hyq</author>
<date>2015-12-15T03:54:44.296453Z</date>
<msg>reviewid: 14691
bug id: 32338
问题描述: 合入有问题
改动说明: net_ok 初始化为0，检查到某个主机存在可以拉起该虚拟机的情况下将其置为1
自测场景: 未自测</msg>
</logentry>
<logentry
   revision="245732">
<author>fxw</author>
<date>2015-12-14T12:32:49.051084Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="245721">
<author>hyq</author>
<date>2015-12-14T09:37:48.690165Z</date>
<msg>reviewid: 14675
bug id: null
问题描述: 合入aSV4.2HA配置功能
改动说明: 合入aSV4.2HA配置功能
自测场景: 未自测</msg>
</logentry>
<logentry
   revision="245640">
<author>yangwei</author>
<date>2015-12-14T03:31:26.367782Z</date>
<msg>reviewid 14646
Reviewed by: fxw
BUG ID: 
问题分析：项目文档更新
改动说明：
1、修改更新授权文档
2、添加每日日报文档</msg>
</logentry>
<logentry
   revision="245537">
<author>fxw</author>
<date>2015-12-11T09:07:50.713555Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="245476">
<author>chenlei</author>
<date>2015-12-11T02:07:19.394044Z</date>
<msg>reviewid: 14585
review by: fxw
Bug id：null
问题分析：
编译spice的脚本和LibVNCServer-0.9.7的Makefile依赖于VMP和开源软件的的版本号以及代码路径，不便于维护。

改动说明：
采用相对路径

自测：
左武辉自动打包通过。</msg>
</logentry>
<logentry
   revision="245439">
<author>fxw</author>
<date>2015-12-10T12:34:43.860430Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="245430">
<author>fxw</author>
<date>2015-12-10T12:03:20.892582Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="245396">
<author>hyq</author>
<date>2015-12-10T08:08:53.035221Z</date>
<msg>reviewid: 14564
早会纪要（2015-12-10）</msg>
</logentry>
<logentry
   revision="245386">
<author>fxw</author>
<date>2015-12-10T07:16:42.725378Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="245352">
<author>lcy</author>
<date>2015-12-10T02:45:53.010137Z</date>
<msg>reviewid:14561
review by fxw
Bug id: 33599
问题分析：TD33599,【虚拟机开机】虚拟机开机长时间停留在正在启动的状态
问题出现的根源：
虚拟机桥接了虚拟交换机，虚拟交换机连接了集群通信口，集群配置了集群IP。
在这种场景下，虚拟机启动，kvm启动进程后台会去调用vtp-bridge脚本激活虚拟交换机。
在虚拟交换机激活的函数中，集群IP会被重置。
集群IP重置，会发送arp包，并且会在后台拉起一个进程发送几十秒的arp包。
kvm会一直等待后台的子进程。所以，在控制台会看到正在启动的状态停留的时间比较长。
改动说明：
把后台发送arp包的脚本，改成守护进程的模式。
自测：
验证环境
4.7.00_B
build 2015-12-05 13:29:36
验证步骤：
在不修改脚本为守护进程的情况下，开机和修改脚本为守护模式开机的情况作对比
之前的情况：51秒
修改之后：20秒</msg>
</logentry>
<logentry
   revision="245336">
<author>fxw</author>
<date>2015-12-10T01:20:26.287879Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="245328">
<author>fxw</author>
<date>2015-12-09T13:32:52.810979Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="245263">
<author>fxw</author>
<date>2015-12-09T02:19:55.953102Z</date>
<msg>noreview
享个脚本，查启动虚拟机内存不足的时候有帮助
</msg>
</logentry>
<logentry
   revision="245176">
<author>vs</author>
<date>2015-12-08T07:32:28.280409Z</date>
<msg>reviewid 14497
, reviewed by fxw
VSTD30606 修改时间后需要重启VS的服务</msg>
</logentry>
<logentry
   revision="245175">
<author>chenlei</author>
<date>2015-12-08T07:25:46.343057Z</date>
<msg>reviewid: 14430
review by: hyq,fxw
Bug id：33129
问题分析：
在挂载加密个人盘到虚拟机B（编辑虚拟机B）的时候，虚拟机B的配置文件中缺少encrypted=yes字段，导致虚拟机B启动黑屏。

改动说明：
编辑虚拟机的时候，对于添加的现有磁盘，检测其是否为加密盘，若是加密盘，则在虚拟机的配置中补充加密字段encrypted=yes

自测：
4.7.00_B
build 2015-12-05 13:29:36
采用后台替换Perl文件的方式自测。

使用同一个模板虚拟机，通过VDC派生1台带加密个人盘的虚拟机A，一台不带个人盘的虚拟机B。
编辑虚拟机B，添加已有磁盘，选择虚拟机A的加密个人盘。
后台查看虚拟机B的配置文件，在新增磁盘（我这里是ide1）的配置中有encrypted=yes字段。
启动虚拟机B，启动失败，提示“加密磁盘缺少密码！”。这时需要进入VDC后台数据库中，将虚拟机A的秘钥插入到虚拟机B中。</msg>
</logentry>
<logentry
   revision="245108">
<author>gwl</author>
<date>2015-12-07T12:25:01.330424Z</date>
<msg>reviewid: 14467
Bug id: 33513
问题分析:
【见td33347】
A、B、C组成集群
我们这边发生的集群分裂问题，可以定论了：
原主控A，从节点B、C。
主控离线，访问集群IP，C被自动切换为主控，此时获取到的离线主机列表里面，A有IP，B没有IP，所以导致/sf/cfg/vtp-cluster/splithosts没有记录离线主机B，直到主机B连接了网络也没有加回集群。
读取host.ini文件，只是/cfs/.member里面记录的主控没有ip的时候，才会读取
【变更】
针对33347，在VMP4.6做了修改，但是由于修改了集群id，为了防止后续再出现类似的问题，在VMP4.7修改自动切换主控的方案


改动说明:在切换主控时，不重新生成集群id，改为touch /cfs/cfgmaster.ini   2000次
【原理】cfs靠文件/cfs/.update_version记录的version大小来判断以哪个主机的数据为准，在新的主控touch 2000次，会让其/cfs/.update_version增加2000，用户场景下，基本能保证原主控上线后，新的主控的/cfs/cfgmaster.ini会覆盖原主控的/cfs/cfgmaster.ini
即使最坏的情况出现，即原主控的/cfs/.update_verison更大，则顶多是以原主控为主。

自测：
构造3台主机的集群，配置集群IP，主控离线，前台登陆集群IP，发生了自动切换主控。
过一会儿，让原主控上线，后台查看/cfs/cfgmaster.ini，显示的主控是新的主机，而不是原主控了。
期间有检查/cfs/.update_version变化，确定变化是按照预期的。</msg>
</logentry>
<logentry
   revision="245062">
<author>hyq</author>
<date>2015-12-07T06:51:52.725987Z</date>
<msg>【新内核合入---合漏】
reviewid: 14456
bug id: 33366
reviewed by: fxw,lifan
问题说明: 无
改动说明: 两个改动: 1、kernel/init/main.c 用原生的代码，不需要合入4.0zcm的模块。2、合入td33366：内核在启动过程中出错不会重启。
自测场景: 未自测</msg>
</logentry>
<logentry
   revision="245019">
<author>fxw</author>
<date>2015-12-07T02:14:13.631818Z</date>
<msg>Merged revision(s) 244653-244992 from VTP/VMP4.6/Trunk:
noreview：
改动说明：
bug33467,备份恢复时，默认勾选‘只恢复系统盘’复选框。

........

bug id: 33389
reviewed by: gwl
问题分析:另外一种情况可能导致关闭电源又被HA拉起：
虚拟机电源电源状态设置为off,运行状态为running,进程还在，HA检测到有进程又把电源状态设置为on。然后虚拟机关机流程完成，HA重新检测的时候发现虚拟机电源状态为on ,进程却不存在，所以又把HA虚拟机拉起来了。
改动说明:检查虚拟机电源状态的流程里加上检测虚拟机运行状态判断，如果是stoping状态，那么不处理。
测试步骤:这种情况在虚拟机进程结束前使虚拟机睡眠，会让ha下次检测的时候拉起
........

Bug id: 33347
问题分析:
A、B、C组成集群
我们这边发生的集群分裂问题，可以定论了：
原主控A，从节点B、C。
主控离线，访问集群IP，C被自动切换为主控，此时获取到的离线主机列表里面，A有IP，B没有IP，所以导致/sf/cfg/vtp-cluster/splithosts没有记录离线主机B，直到主机B连接了网络也没有加回集群。
读取host.ini文件，只是/cfs/.member里面记录的主控没有ip的时候，才会读取
改动说明: 检测离线主机时，如果没有读取有效ip，从host.ini再获取一次，以前是主控才会这样做，改为从节点也这样做
自测：

构造上述场景，在只剩下C且没有前台登陆时，在C后台/sf/etc/init.d/pmxcfs restart，手动让/cfs/.members记录的离线主机的ip字段为0
前台登陆集群IP，C后台检查/sf/cfg/vtp-cluster/splithosts.ini，有所有离线主机的字段，恢复其它主机后，所有主机恢复在线。

另外使用未做本次修改的环境，测试相同场景，结果是，离线的从节点加不回来了。
........
noreview
更新VDI镜像
........

Bug id：33488
review by:lifan
问题分析：
VMP做成母盘后swap分区会丢失，导致客户那边没有swap，内存不够时容易导致系统异常。

改动说明：
找出原来的swap分区，再重新建立swap

自测：
需要打包在自测
........
noreview：
改动说明：
bug33516,批量恢复的地方， 恢复时，默认勾选‘只恢复系统盘’复选框。

........

Reviewed by: fxw hyq
BUG ID: 33511
问题分析：将每一个主机节点的虚拟机报表信息进行统计。
改动说明：
1、扫描每一节点的虚拟机报表数据库，将数据库的数据解析，并保存。
3、每隔一小时统计vm一小时之内的报表数据信息（统计频率为1min）。
4、每一个统计数据文件不超过1600行。
测试：
2、报表数据正确，保存的数据和rrd_tool解析结果一致。测试ok。
3、报表数据频率为一分钟，测试ok。
4、数据行不超过1600行，测试ok。
........
noreview
更新VS
........
noreview
更新VDI镜像
........
</msg>
</logentry>
<logentry
   revision="244998">
<author>hyq</author>
<date>2015-12-05T05:04:18.933672Z</date>
<msg>【新内核合入---从4.6合入】
reviewid: 14443
bug id: 33348
reviewed by: fxw
问题分析： 无
改动说明: 合入4.6ksm改动: revision244238
自测场景： 无</msg>
</logentry>
<logentry
   revision="244993">
<author>gwl</author>
<date>2015-12-05T04:02:25.873673Z</date>
<msg>reviewid: 14437
Bug id: 33530
问题分析:
sprintf里面不能嵌入需要解析的变量，在-T参数时，启用了去污染，会对不安全的代码做告警
改动说明: 见代码</msg>
</logentry>
<logentry
   revision="244956">
<author>hyq</author>
<date>2015-12-04T11:56:05.686513Z</date>
<msg>reviewid: 14427
bug id: null
reviewed by: chenlei
问题分析: 无
改动说明: 修改内核svn名称为kernel,合入新内核后改了
自测场景: 未自测</msg>
</logentry>
<logentry
   revision="244951">
<author>hyq</author>
<date>2015-12-04T11:39:19.909655Z</date>
<msg>【新内核合入---从4.2合入】
reviewid: 14424
bug id: null
reviewed by: fxw
问题改动说明: 编译不过
测试场景: 无</msg>
</logentry>
<logentry
   revision="244939">
<author>hyq</author>
<date>2015-12-04T10:55:02.164342Z</date>
<msg>【新内核合入---从4.2合入】
reviewid: 14423
bug id: null
reviewed by: fxw
问题分析: 无
改动说明: 1、提供对AMD处理主机的cpuid指令透传数据的支持。 内核原始文件提交。2、amd设备下，cat /proc/kvm_bios会有问题。3、合入vs新增的聚合网口单交换机模式功能
测试场景: 无</msg>
</logentry>
<logentry
   revision="244937">
<author>hyq</author>
<date>2015-12-04T10:16:39.963547Z</date>
<msg>【新内核合入---从4.2合入】
reviewid: 14417
bug id: null
reviewed by: fxw
问题描述: 无
改动说明: 修改有二：1、[VS] 修改scis.c，修复支持磁盘热拔插功能Bug(vstd:30174).周正平。2、签入新内核原始文件svm.c
自测场景: 无</msg>
</logentry>
<logentry
   revision="244922">
<author>hyq</author>
<date>2015-12-04T09:03:23.611630Z</date>
<msg>【新内核合入---从4.2合入】
reviewid: 14414
bug id: null
问题分析: 无
改动说明: 三个问题： 1、tap网口初始化失败，驱动中加入调试代码查问题。2、TD29438,3com网卡驱动没有编译进内核。3、签入修复支持磁盘热拔插功能Bu需要改动的内核原始文件
测试场景: 无</msg>
</logentry>
<logentry
   revision="244915">
<author>hyq</author>
<date>2015-12-04T08:38:07.116103Z</date>
<msg>【新内核合入---从4.1合入】
reviewid: 14413
bug id: null
reviewed by: fxw
问题原因: 无
改动说明: 合入redhat7.1的linux-3.10.0-229.11.1.el7版本内核源码的几个bug fix。
自测场景: 无</msg>
</logentry>
<logentry
   revision="244913">
<author>hyq</author>
<date>2015-12-04T08:29:22.897993Z</date>
<msg>【新内核合入--从4.1合入】
reviewid: 14411
bug id: null
reviewed by: fxw,gwl
问题原因: 无
改动说明：三个问题：1、合入USB reset变只读问题。2、在出现VMX_EXIT_REASONS_FAILED_VMENTRY错误时，打印VMCS的状态信息。3、redhat7.1 linux-3.10.0-229.4.2.el7内核原始代码归档
自测场景: 无</msg>
</logentry>
<logentry
   revision="244909">
<author>hyq</author>
<date>2015-12-04T07:57:13.275771Z</date>
<msg>【新内核合入---从4.1合入】
reviewid: 14409
bug id: null
reviewed by: fxw,gwl
问题原因: 无
改动说明：两个问题：1、签入 修改“USB reset变只读”的问题需要 修改的linux-3.10.0-229.4.2.el7内核原始文件。2、合入vmp3.6的内核改动。
自测场景：无</msg>
</logentry>
<logentry
   revision="244907">
<author>hyq</author>
<date>2015-12-04T07:37:46.660087Z</date>
<msg>【新内核合入---从4.1合入】
reviewid: 14406
bug id: null
reviewed by: fxw
问题分析: 无
改动说明: 内核原始代码归档， 作为合入vmp3.6改动的基础。
自测场景: 无</msg>
</logentry>
<logentry
   revision="244904">
<author>hyq</author>
<date>2015-12-04T07:28:13.305935Z</date>
<msg>【新内核合入---从4.1合入】
reviewid: 14405
bug id: null
reviewed by: fxw
问题原因: 无
改动说明: 改动有三：1、内核编译选项支持xenserver。2、解决指针二次释放导致的宕机问题。3、virtio-net网卡不通时，tap会收包队列满了，不再丢掉，在此唤醒vhost_worker内核线程，让虚拟机virtio-net网卡收包
自测场景: 无</msg>
</logentry>
<logentry
   revision="244901">
<author>hyq</author>
<date>2015-12-04T07:07:45.329551Z</date>
<msg>【新内核合入---从4.1合入】
reviewid: 14404
bug id: null
reviewed by: fxw
原因分析: 无
改动说明: 提交需要修改的原始文件(bonding cpufreq)
自测场景: 无</msg>
</logentry>
<logentry
   revision="244899">
<author>hyq</author>
<date>2015-12-04T07:00:59.100928Z</date>
<msg>【新内核合入---从4.0合入】
reviewid: 14403
bug id: null
reviewed by: fxw
问题分析: 无
改动说明: 修改有二: 1、合入3.x内核对版本号的修改。2、合入代码时合漏了一个括号，这段代码是if宏屏蔽掉不起作用的，所以编译时没有报错（x86.c）
自测场景: 无</msg>
</logentry>
<logentry
   revision="244897">
<author>hyq</author>
<date>2015-12-04T06:10:09.710555Z</date>
<msg>【新内核合入---从4.0合入】
reviewid: 14385
bug id: null
reviewed by: fxw
原因分析: 无
改动说明: 合入vmp3.5 4月20号至今的内核修改
自测场景: 无</msg>
</logentry>
<logentry
   revision="244865">
<author>hyq</author>
<date>2015-12-04T01:45:42.726432Z</date>
<msg>【新内核合入---从4.0合入】
reviewid: 14383
bug id: null
reviewed by: fxw
原因分析: 无
改动说明: 为了合入vmp3.5内核的新修改，将相应的新内核原始源码文件归档
自测场景: 无</msg>
</logentry>
<logentry
   revision="244863">
<author>hyq</author>
<date>2015-12-04T01:31:35.423407Z</date>
<msg>【新内核合入---从4.0合入】
reviewid: 14382
bug id: null
reviewed by: fxw
原因分析: 无
改动说明: 1、合入VT内核修改。2、回滚rtc修改。3、回滚fastide修改
自测场景: 无</msg>
</logentry>
<logentry
   revision="244852">
<author>chenlei</author>
<date>2015-12-03T12:45:25.929298Z</date>
<msg>reviewid: 14375
review by: lcy
Bug id：33338
问题分析：
VMP不支持p2v功能，但是p2v相关的开机服务还存在。

改动说明：
将p2v相关的开机服务关闭。

自测：
需打新包验证。</msg>
</logentry>
<logentry
   revision="244808">
<author>hyq</author>
<date>2015-12-03T08:27:21.804889Z</date>
<msg>【新内核合入---从4.0合入】
reviewid: 14354
bug id: null
reviewed by: gwl
问题分析:无
改动说明: 签入229.4.2.el7原版内核VT需要修改的部分，作为合入VT内核修改的基础
自测场景: 无</msg>
</logentry>
<logentry
   revision="244795">
<author>hyq</author>
<date>2015-12-03T07:27:13.082939Z</date>
<msg>【新内核合入---从4.0合入】
reviewid: 14348
bug id: null
reviewed by: fxw
问题描述: vmp4.7k开始使用红帽229.4.2.el7新内核，合入前把旧的内核改动删除
改动说明: 删除旧的目录kernel目录（弃用的内核改动也去掉）和kernel.new（使用的旧版本linux）
自测场景: 无</msg>
</logentry>
<logentry
   revision="244788">
<author>fxw</author>
<date>2015-12-03T06:45:48.322651Z</date>
<msg>noreview
更新版本号</msg>
</logentry>
<logentry
   revision="244705">
<author>gwl</author>
<date>2015-12-02T11:02:33.501723Z</date>
<msg>noreview
自动切换主控与主机离线，模块说明</msg>
</logentry>
<logentry
   revision="244704">
<author>chenlei</author>
<date>2015-12-02T10:36:46.609489Z</date>
<msg>reviewid: 14334
review by: fxw
Bug id：33338
问题分析：
VMP不支持p2v功能，但是p2v相关的一些开机服务还存在。

改动说明：
将p2v相关的开机服务关闭。

自测：
需要打新包验证。</msg>
</logentry>
<logentry
   revision="244647">
<author>fxw</author>
<date>2015-12-02T02:50:06.687986Z</date>
<msg>noreview 升级版本号</msg>
</logentry>
<logentry
   revision="244644">
<author>fxw</author>
<date>2015-12-02T02:21:13.493536Z</date>
<msg>Merged revision(s) 243379-243380, 243400, 243403, 243409, 243413, 243454, 243483, 243485, 243496, 243515, 243539, 243550, 243565, 243591, 243604, 243670, 243684, 243709, 243711, 243788, 243806, 243822, 243864, 243981, 244040, 244086, 244093, 244175, 244182, 244188, 244211, 244227-244228, 244258, 244262, 244283, 244285, 244295, 244303, 244324, 244355, 244371, 244379-244382, 244491, 244514, 244521, 244525, 244574, 244579 from VTP/VMP4.6/Trunk:
reviewid: 14029
reviewd by: fxw
bug id: 33118
改动说明：
去掉增量更新总的描述信息 “本次更新为增量更新”；因为增量更新流程里存在上次更新失败导致此次更新为全拷贝更新的情况。
这样和总的描述信息存在矛盾。

........
reviewid 14030
Reviewed by: lifan
BUG ID: null
改动说明：
合入aSV修改
修改qcow2 cache size，防止hash位置太集中
测试：
无
........
noreview
更新VS到VS2.1R1
........
reviewid:14040
review by fxw
TD:33187
现象：TD33187,编辑虚拟机的桥接的虚拟机提示有问题
改动说明：
修改编辑虚拟机的时候，虚拟交换机不存在的时候的提示。之前的提示有可能误导用户
测试：
自测通过
........
reviewid:14043
review by lifan
TD:33189
现象：TD33189,修改blackbox中ps的参数【合入】
改动说明：
合入aSV4.2对ps参数的修改
测试：
打包验证
........
reviewid 14045
reviewed by  huda
BUG ID: 33188
问题分析： 一台服务器上有多个vmp系统，导致不能正常引导
修改说明：安装新的vmp，要先格掉一个。
测试： 打包验证

........
reviewid:14067
review by lcy
TD:33188
现象：一台服务器上有多个vmp系统，导致不能正常引导
改动说明：
修改部分描述以及找不到函数问题
测试：
打包验证
........
noreview：
改动说明：
bug33214,上传iso只支持上传iso和qcow2文件
........
reviewid 14081, reviewed by lzj
td30589 修改提示
问题分析：显示虚拟机信息如果是vs要显示虚拟存储
改动说明：修改前存储位置显示：IP1;IP2 修改后为：虚拟存储(IP1;IP2)
做了哪些测试：查看虚拟机详细信息的存储位置
........
reviewid 14083
Reviewed by: fxw
BUG ID: null
改动说明：
合入patch.
[e1000: Fixing the packet address filtering procedure] (http://git.qemu.org/?p=qemu.git;a=commit;h=4aeea330f022f45d0dabff6090ecbb98755c2116)
测试：
编译通过
........
reviewid: 14009
reviewd by: fxw
bug id: 33223
改动说明：
1、服务器重启把集群虚拟机加入到关机列表
2、显示关闭虚拟机日志
3、重启服务器过程中等待两分钟至虚拟机全部关闭，超过两分钟则会杀进程
........
reviewid:14095
review by lifan
TD:33233
现象：TD33233,为qm monitor命令增加日志,方便查BUG
改动说明：
为qm monitor命令增加日志,方便查BUG
测试：
编译通过，自测，可以在qemu日志里面找到对应的qm monitor的日志
........
reviewid 14096
reviewed by  fxw
BUG ID: 33234
问题分析： raid卡告警，增加白名单
修改说明：合入raid PERC H310 Mini卡状态异常，导致告警的问题
增加okPD白名单
测试： 

........
noreview
更新VS
........
reviewid: 14103
Reviewed by：hyq
BUGID: 
问题分析：vdc关联用户之后，虚拟机名称索引值又从1开始
........
reviewid: 14110
reviewd by: fxw
bug id: 33223
改动说明：
sh不支持"[[]]"以及 "[]"不支持&amp;&amp;,也不支持let


........
reviewid: 14114
reviewd by: fxw
bug id: 33223
改动说明：虚拟机进程关完后再等待5秒


........
noreview
升级VDI4.7 qcow2镜像
........
noreview：
改动说明：
bug33213，替换默认的广告图片
........
reviewid 14120
Reviewed by: fxw
BUG ID: 33294
问题分析：删除多余的日志
改动说明：删除多余的日志
测试：
........
reviewid: 14147
Reviewed by：fxw
BUGID: 33291
问题分析：自动切换主控，恢复离线主机时，临时目录有冲突
........
reviewid 14159
Reviewed by: fxw
BUG ID: 33294
问题分析：删除多余的日志
改动说明：删除多余的日志
测试：
........
noreview
更新VS
........
reviewid 14176
Reviewed by: xhz
BUG ID: 33301
问题分析：新建虚拟机，加载共享目录的iso文件
改动说明：判断共享目录是否存在，需要单独判断，和判断存储是否存在是不同的接口。
测试：新建虚拟机，加载共享目录的iso文件，创建虚拟机成功。测试ok
........
noreview
........
noreview
更新预发布的VDI qcow2
........
noreview
更新预发布的VDI qcow2

........
reviewid: 14196
Reviewed by：gwl
BUGID: 33327
问题分析：
模板第一次部署派生虚拟机带上这个need_repair字段
打开控制台提示需要修复
........
reviewid: 14214
reviewed by: gwl
bug id: 33343
问题分析: 模板虚拟机镜像存在，配置中存在need_repair字段，值为1，修复过程中检测到虚拟机镜像存在直接返回，没有把need_repair字段置为0
改动说明: 修复过程中如果检测到模板虚拟机镜像存在，则跳过镜像拷贝过程，再设置模板虚拟机配置中的need_repair字段为0
测试场景: 
场景1 
模板虚拟机镜像存在，配置中的need_repair,字段值为1，UI页面显示需要修复，点击修复，能够很快修复成功。
场景2 
模板虚拟机镜像不存在，配置中的need_repair 字段值为1，UI页面显示需要修复，点击修复，由于修复过程需要回拷镜像，修复过程相对较慢。
场景3 
模板虚拟机镜像存在，但镜像中的更新快照不存在（qemu-img snapshot -d 快照名镜像名）配置中的need_repair字段为1，UI页面显示需要修复，点击修复，修复完成后镜像中会有新的更新快照。


........
noreview：
改动说明：
bug33350：标准版无uid，也应从服务器拿广告

........
noreview
更新文档
........
reviewid 14220
Reviewed by: fxw
BUG ID: 33356
问题分析：原来的处理流程，只要是没有插key，就会报该警告，没有对版本进行判断。
改动说明：未插key时增加对版本的判断，只有企业版(包括过期)才会报该告警
测试：
1、标准版，后台执行/sf/etc/init.d/vtsn_server restart，前台刷新，无该警告；
2、企业版，无key。后台执行/sf/etc/init.d/vtsn_server restart，前台刷新，有该警告。
测试ok。
........
处理redu时流数据没有被拦截问题，noreview
........
reviewid: 14191
Bug id：33137
问题分析：集群虚拟机运行节点的选择没有考虑到其要能够访问ISO镜像存储。
改动说明：对于集群虚拟机，如果指定了ISO镜像，虚拟机的运行位置需要能够访问到ISO镜像所在存储。
自测：
验证集群虚拟机开机：
abc三个共享存储，51.2/51.3两台主机。51.2可以访问ac，51.3可以访问bc。 新建虚拟机，存储位置选择c，运行位置自动选择。
1. 新建虚拟机vm，选择a存储上的ISO镜像，开机，成功，虚拟机详情页面，虚拟机运行位置为51.2；
2. 开机状态编辑虚拟机，切换ISO镜像，b存储被置灰，提示虚拟机运行位置无法访问ISO存储；
3. 关机状态编辑虚拟机，选择b存储上的ISO镜像，开机，成功，虚拟机运行位置切换到51.3上。

验证对HA的影响：
1. abcd4个共享存储，101/102/103三台主机，101可以访问abd，102可以访问bcd，103可以访问acd，新建HA虚拟机，存储位置选择d，运行位置自动选择。
2. 新建虚拟机vm，选择a存储上的ISO镜像，开机，成功，虚拟机详情页面，虚拟机运行位置为101；
3. 后台通过iptables将主机101与iscsi存储网络断开，等待几分钟，虚拟机vm将在能够同时访问ISO存储和虚拟机存储位置的主机103上被拉起；
4. 后台通过iptables将主机103与iscsi存储网络断开，这是将没有主机能够拉起虚拟机vm。手动点击启动虚拟机会失败，并提示详细的启动失败原因。
........
reviewid:14235
review by: hyq
Bug id: 33355
问题分析：TD33355,【虚拟机分组】虚拟机分组置顶操作有问题.虚拟机分组置顶的时候，只是把当前分组和原顶部的分组交换过来。实际上应该是，把当前分组置顶，然后，原顶部的分组往下移动一位。
改动说明：修改移动分组的代码，判断假如是置顶操作，那么当前要置顶的分组前面的所有分组都往下移动一位
自测：
4.6.00_B
build 2015-11-25 14:20:19
 环境上新建三个分组 A B C
 把最后一个分组置C置顶，得到的分组排序为C A B
 把B置顶，得到的分组排序为 B C A
 把C上移，得到的排序为 C B A
 把B下移，得到的排序为 C A B
 把A置顶，得到的排序为 A C B
........
reviewid: 14225
review by: gwl, fxw
bug id: 33327
问题分析: 在vdc上第一次部署100台虚拟机到模板虚拟机所在存储，模板虚拟机镜像还没回拷完成就又进行了一次部署，第二次部署派生虚拟机到异地存储。第二次部署读取的模板虚拟机配置文件中含有need_repair字段，其值置为1。第一次部署完成后把该字段置0，但第二次部署获取的模板虚拟机配置中该字段值仍然为1，部署完成后把该字段写进了配置
改动说明: 部署过程中存在几次写配置，lock字段，template_version字段以及template_uuid字段，其中lock字段和template_version实际上是没有用的，把它们去掉
测试场景: 
在vdc上第一次部署100台虚拟机到模板虚拟机所在存储（模板虚拟机镜像大小建议大于4G），然后在模板虚拟机镜像还没回拷完成就又进行了一次部署，第二次部署派生虚拟机到异地存储。查看日志可以看到模板重载的结束时间先于第二次部署完成的时间。
最后写template_uuid字段的时候，重新读取配置，再写会配置文件中
........
reviewid: 14237
bug id: 33348
reviewd by: fxw,zhangqian
问题分析: 1.从vmp3.0开始，内核的合入代码就有失误，导致普通页合并失效；
2.之后加入的快速全零页合并开关，导致虚拟机开机十分钟后，内存合并永久失效。
改动说明:
1.修正快速合并禁用后，永久失效的问题；
2.修正普通页合并，hash值计算错误的问题；
3.永久禁用普通页合并，仅开启快速全零页合并；
4.开机前10分钟，快速全零页合并生效，之后停用；
5.当host机内存消耗大于2/3时，全零页合并生效。

自测场景(未测试)
1.启动一批虚拟机，所占用内存不超过host机2/3， 内存合并应不生效；
2.再启动一批虚拟机，让host机占用内存超过总量的2/3，内存合并开始生效，用top看各个虚拟机进程的RES值，实际物理占用；
3.再关掉一批虚拟机，让占用内存不超过host机2/3， 找一台虚拟机，在内部开启hevayload耗内存，内存合并应该不生效。
........
reviewid: 14236
Bug id：33364
问题分析：
之前设计的控制台防泄密其中一种机制是：只要aDesk一断开与虚拟机的连接就会触发虚拟机windows锁屏操作。
一些aDesk用户，由于网络不稳定的原因，经常由于网络断线触发锁屏，非常影响用户体验。

改动说明：
1. 设计了一种延迟锁屏的机制，只有当aDesk与虚拟机的连接断开超过设定的值（默认为90秒，可自由配置，最长600秒，即10分钟）
的时候才会触发锁屏操作。控制台在这段时间仍然处于禁用状态。
2. 配置延迟锁屏时间的文件位于/cfs/.delay_lock_screan，修改配置之后需要重启虚拟机才能生效。

自测：
1. 断开aDesk连接小于90秒（X掉导航条或者直接拔掉网线都测过），重新接入虚拟机，虚拟机没有被锁屏。
2. 断开aDesk连接超过90秒（X掉导航条或者直接拔掉网线都测过），控制台被解禁，虚拟机处于锁屏状态。
3. 修改配置设定时间为20秒，重复1、2步骤，结果符合预期。
4. 配置文件不存在，文件内容非数字这些异常，时间都采用默认的90秒
........
reviewid: 14241
Bug id：33354
问题分析：
正式版需要修改版本号和version-from文件

改动说明：
修改正式版的版本号和version-from文件

自测：
需要打新包验证
........
reviewid: 14239
bug id: 31929
reviewd by: fxw, hyq
问题分析：现在磁盘异构的虚拟机迁移，如果vm镜像分布在两个存储上，如果往另一个存储迁的话会出错，报同名虚拟机错误。
改动说明：
1、对于镜像分布在不同磁盘的虚拟机，在迁移检查目标存储是否存在同名虚拟机时，判断的条件是镜像目录下有没有存在conf文件，如果不存在就不认为存在同名虚拟机，允许迁移，如果存在conf文件，认为存在同名虚拟机，不允许迁移
2、在修正迁移后派生盘的基镜像时，原来查看的是目标路径/源镜像名称，而在上述的迁移时镜像名称发生了改变，导致出错，改为目标路径/目标镜像名称
自测场景：
1.vm1两个磁盘d1、d2，d1在存储s1上，d2在存储s2上，d1为启动盘，把vm迁到s2上，成功，且启动盘依然为d1
2.vm1两个磁盘d1、d2，d1在存储s1上，d2在存储s2上，在d2的镜像目录新建一个12345678.conf文件，d1为启动盘，把vm迁到s2上，迁移失败
........
reviewid: 14258
bug id: 33348
review by: zhangqian
问题分析: get_host_avail_mem_size.sh会更准一些,考虑了rd对内存的占用
改动说明: 获取系统剩余内存用/sf/bin/get_host_avail_mem_size.sh脚本

自测场景(未测试)
1.启动一批虚拟机，所占用内存不超过host机2/3， 内存合并应不生效；
2.再启动一批虚拟机，让host机占用内存超过总量的2/3，内存合并开始生效，用top看各个虚拟机进程的RES值，实际物理占用；
3.再关掉一批虚拟机，让占用内存不超过host机2/3， 找一台虚拟机，在内部开启hevayload耗内存，内存合并应该不生效。
........
reviewid: 14265
bug id: 33348
review by: zhangqian
问题分析: 从代码的健壮性看，如果返回可用内存小于0，是会有问题的，如果host机物理内存耗满，就会负。
那么，如果计算系统内存使用率调用了该脚本，会出现系统内存使用率超过100%的情况
改动说明: 获取的服务器可用内存如果小于0，那么返回100MB（zhangqian找lifan确认）
自测场景:
在vmp4.6环境执行脚本get_host_avail_mem_size.sh，语法没问题
下面附上合入ksm修改的测试场景
1.启动一批虚拟机，所占用内存不超过host机2/3， 内存合并应不生效；
2.再启动一批虚拟机，让host机占用内存超过总量的2/3，内存合并开始生效，用top看各个虚拟机进程的RES值，实际物理占用；
3.再关掉一批虚拟机，让占用内存不超过host机2/3， 找一台虚拟机，在内部开启hevayload耗内存，内存合并应该不生效。

........
reviewid:14266
review by hyq
Bug id: 33391
问题分析：TD33391,【集群】关闭一台主机，其他主机的虚拟机也被关闭。在主机被关闭的时候，会有一个vtp-manager脚本调用stopall。这个函数会去遍历所有运行在本机上的虚拟机，加入到关闭列表。然后统一关闭。在检查HA虚拟机的时候，没有把运行在本地的条件加进去，把集群中所有的HA虚拟机都加进关闭列表了。导致，一台机器关机，所有的HA虚拟机都被无缘无故的关闭掉了。
改动说明：
在HA虚拟机的判断的地方加上该虚拟机运行在哪个节点的过滤条件。
自测：
4.6.00_B
build 2015-11-26 16:05:34
1. 两台机器组成的集群，A和B，A是主控，B是从节点。
2. A上运行2台HA虚拟机，B上运行2台HA虚拟机
3. 在界面上关闭B主机
4. 在Web的操作日志上会看到B主机的两台HA虚拟机被关闭了，A主机的两台HA没有被关闭
5. 重复上面的环境，A有两台HA，B有两台HA
6. 对主控进行同样的操作，主控上面的虚拟机会被关掉，从节点的HA虚拟机不会被关闭掉
........
noreview：
改动说明：
bug33410，虚拟机系统为win7或xp时，默认开启双屏
........
noreview：
改动说明：
bug33150,升级成功时，关闭维护模式则提示要重启主机或是回滚
........
reviewid: 14272
review by: fxw
Bug id：33404
问题分析：
模板计划更新时，关闭模板虚拟机失败，需要提示用户手动关闭虚拟机

改动说明：
修改更新失败的提示信息。

自测：
1. 虚拟机的异常重启选项去掉，启动模板虚拟机；
2. 创建计划更新任务，gdb连入模板虚拟机，后台修改/cfs/.tpl_update_plans目录下配置文件的时间；
3. 等计划更新执行，计划更新执行失败，前台操作日志依次显示3条失败记录：
更新模板、模板计划更新、关闭虚拟机。且提示信息正确合理。
........
noreview：
改动说明：
bug33383，修改虚拟机详情页面更多菜单的菜单项的文字
........
reviewid:14284
Bug id:33437
问题分析:自动切换的代码中，有asv版本的代码：restart_host_proxy
VMP4.6本身没有这个函数，也没有相关的host_proxy服务，所以，应该去掉这个代码
改动说明:注释掉这个代码调用
自测：之前测试自动切换主控的一个bug时，有去掉这个日志测试，没问题。
........
reviewid:14288
review by chengtao
Bug id: 33336
问题分析：TD33336,【安装】通过iso全新安装VMP，网卡有接线，提示未接线---非必现-syl.
这是非必现的问题。ISO安装，我们的安装流程：
首先，lspci检测网卡是否已经被加载。接着，ifconfig ethx up网卡启用。最后，通过ethtool ethx获取网卡是否是已经连线的状态。
改动说明：
合入4.2BUG,31151.
在ifconfig ethx up命令执行的时候，增加log，方便日后出问题排查
把ethtool ethx的命令输出到log里面
自测：
需要ISO安装才可以验证。打包验证。
........
reviewid: 14293
bug id: 33402
review by: gwl
问题描述: 主机重启或关机时vdc的HA虚拟机优先关闭
改动说明: 获取需要关闭的HA虚拟机流程里放回虚拟机的操作系统类型（vdc虚拟机的操作系统类型为sslvpn），用于后面关闭虚拟机时排序，
对获取到的需要关闭的HA虚拟机进行分组，vdc虚拟机分为一组，其它类型虚拟机分为一组，关闭时先关闭vdc虚拟机，再关闭其它虚拟机
测试步骤: 创建多个vdc的HA虚拟机，启动，再启动若干个其它类型操作系统的虚拟机，重启服务器，UI页面显示vdc的HA虚拟机优先于其它类型操作系统的虚拟机关机
备注:这个改动只针对vdc的HA虚拟机，普通的vdc虚拟机关机不进行排序，因为普通关机会等待进程结束
........
reviewid: 14292
review by: lrx
Bug id：33346
问题分析：
vs配置存储网络，主机超过8台时，表格高度限制造成数据丢失。

改动说明：
去掉表格本身的高度限制，改用父层div限制。

自测：
1. 将api：/vapi/extjs/vs/vs_config/vs_networksetting_get的返回结果修改为固定的json字符串，返回11条记录。
2. 前台页面点击虚拟存储-&gt;配置存储通信网口-&gt;任选一种存储通信部署方式-&gt;下一步，主机列表显示正常。
3. 还需要打包验证：配以一个超过8台（不包括8），是否能够正常的配置vs网络。
........
reviewid: 14297
bug id: 33389
reviewed by: gwl
问题描述:集群虚拟机关机过程中把虚拟机电源状态置为off,再执行关机操作，
最后把虚拟机的状态设置为stopped。因为关机操作执行时间至少持续几秒，
所以会导致虚拟机的处于电源状态为off,启动状态为running的情景。
当HA检测到这个虚拟机的时候，会认为虚拟机是异常关机，所以又把该虚拟机拉起来了。
总而言之就是HA获取虚拟机的状态和关闭虚拟机流程设置虚拟机状态没有互斥。
改动说明: 把虚拟机关闭电源流程里的清除stopping状态函数去掉，进程结束后自动清除。
ha获取异常虚拟机的过程中先判断虚拟机的临时状态是否处于stoping状态，如果是，则不列入异常状态。
测试步骤：
自测场景:
写了个测试脚本进行测试，脚本内容如下：

!/bin/bash

vmid=$1;
while true;
do
        vtpsh create /cluster/vm/${vmid}/status/start;
        sleep 60;
        vtpsh create /cluster/vm/${vmid}/status/stop;
        sleep 30;
done
运行命令为: nohup ./test.sh vmid &amp;
在200.200.101.94上运行了一个晚上，第二天检查日志，没有出现这个问题,检查命令
........
noreview
上传文档
........
</msg>
</logentry>
<logentry
   revision="244515">
<author>gwl</author>
<date>2015-11-30T11:05:28.603129Z</date>
<msg>reviewid：14277
Bug id：
问题分析：
  改动说明：在API调用时，如果捕获到异常，在异常即将发送到前台时，打印调用堆栈到日志，方便排查问题。
  自测：
  异常捕获打堆栈测试点：
1.常规die
2.运行错误的die，比如my $cal = undef; $cal-&gt;sdfsdf;  CXX::sdff();
3.判断$@是否正常
4.die "$@"
5.die "$@"."\n";
6.die ("xx",sdfs);
7.die $@
8.die $@."\n"
9.每一项die都要检查eval捕获之后的$@
10.直接设置$@
11.die之后，不继续die，设置$@，捕获后，再die
12.my_die

针对以上测试点，写了测试代码，
选择派生模板虚拟机的API里面调用H();
测试了vtpsh 方式调用API；
测试了fork_worker里面调用H()；
sub A {
    VTP::QemuServer::gwl();
}

sub B {
    eval { A(); };
    if ($@) {
        linfo("eval A: $@");
        die "eval A: $@";
    }
}

sub C {
    eval { B(); };
    if ($@) {
        linfo("eval B: $@");
        my $xx = ["123", "1234"];
        if ($xx-&gt;{A}-&gt;{B} eq 'xxx') { linfo("boom!gwl test error"); }
    }
}

sub D {
    eval { C(); };
    if ($@) {
        linfo("eval C: $@");
        my_die "表达式错误: $@";
    }
}

sub E {
    eval { D(); };
    if ($@) {
        linfo("eval D: $@");
        die "add enter: $@"."\n";
    }
}

sub F {
    eval { E(); };
    if ($@) {
        linfo("eval E: $@");
        die ("$@", "eat dinner");
    }
}

sub G {
    eval { F(); };
    if ($@) {
        linfo("eval F: $@");
    }
}

sub H {
    my $err = undef;
    eval { G(); $err = $@ if $@; };
    if ($err) {
        my_die "就是这里";
    }
}</msg>
</logentry>
<logentry
   revision="243378">
<author>fxw</author>
<date>2015-11-16T02:36:03.880969Z</date>
<msg>VMP4.7</msg>
</logentry>
<logentry
   revision="243324">
<author>gwl</author>
<date>2015-11-13T11:34:09.740095Z</date>
<msg>reviewid: 14007
Reviewed by：fxw
BUGID: 33024
问题分析：td33024先打印调试日志，等后续出现后再查</msg>
</logentry>
<logentry
   revision="243306">
<author>lcy</author>
<date>2015-11-13T09:14:56.945755Z</date>
<msg>reviewid:14002
review by fxw
TD:33159
现象：TD33159,往VMP4.6加上pmap，查看内存映射的工具
改动说明：
往VMP4.6加上pmap，查看内存映射的工具
测试：
自测工具可以正常使用。</msg>
</logentry>
<logentry
   revision="243304">
<author>chenlei</author>
<date>2015-11-13T09:00:41.292451Z</date>
<msg>reviewid:14001
review by:gwl
bugid:32997
改动说明：
只处理cdrom</msg>
</logentry>
<logentry
   revision="243251">
<author>lcy</author>
<date>2015-11-13T02:46:03.220902Z</date>
<msg>reviewid:13973
review by gwl
TD:33133
现象：TD33133,HA启动虚拟机的日志里聚合网口的名称写错了。如附件
改动说明：
页面显示的网口id，改成显示网口name
测试：
自测通过</msg>
</logentry>
<logentry
   revision="243248">
<author>hyq</author>
<date>2015-11-13T02:40:00.293167Z</date>
<msg>reviewid: 13975
Reviewed by: gwl
BUG ID: 33105
问题分析：
改动说明：
td33105 : 为derive API增加一个参数getusermsg，正式发布前要去掉</msg>
</logentry>
<logentry
   revision="243245">
<author>chenlei</author>
<date>2015-11-13T02:25:39.456716Z</date>
<msg>reviewid:13974
review by:hyq
bugid:null
改动说明：
[模板计划更新] 定时脚本加载虚拟机配置之前需要更新cfs</msg>
</logentry>
<logentry
   revision="243239">
<author>yangwei</author>
<date>2015-11-13T02:02:11.888908Z</date>
<msg>reviewid 13971
reviewed by  fxw
BUG ID: 33112
问题分析： 插入新key，注册序列号
修改说明：插入新key注册序列号应该更新host和username字段。
测试：
插入新key，注册序列号。更新host和username字段，测试ok。</msg>
</logentry>
<logentry
   revision="243235">
<author>hyq</author>
<date>2015-11-13T01:50:31.766153Z</date>
<msg>reviewid: 13970
Reviewed by: gwl
BUG ID: 33118
问题分析：
改动说明：
[模板优化]模板更新需要在日志里描述出更新的类型和更新文件大小。
更新存储如果是本地存储的话，需要显示该本地存储的主机</msg>
</logentry>
<logentry
   revision="243222">
<author>hyq</author>
<date>2015-11-12T14:03:26.676654Z</date>
<msg>reviewid: 13968
Reviewed by: chenlei
BUG ID: 33118
问题分析：
改动说明：
[模板优化]模板更新需要在日志里描述出更新的类型和更新文件大小。</msg>
</logentry>
<logentry
   revision="243161">
<author>lcy</author>
<date>2015-11-12T06:53:39.112541Z</date>
<msg>reviewid:13952
review by czy
TD:33121
现象：TD33121,【历史遗留,合入4.6】log日志分区中各模块的调试日志打印专项检查，对打印频繁的日志要进行优化。
改动说明：
【历史遗留,合入4.6】log日志分区中各模块的调试日志打印专项检查，对打印频繁的日志要进行优化。
对应aSV4.2TD32570
代码有多个review,13950 13952 13953
测试：
打包验证</msg>
</logentry>
<logentry
   revision="243143">
<author>lcy</author>
<date>2015-11-12T03:13:18.792048Z</date>
<msg>reviewid:13948
review by lifan
TD:33121
现象：TD33121,【历史遗留,合入4.6】log日志分区中各模块的调试日志打印专项检查，对打印频繁的日志要进行优化。
改动说明：
【历史遗留,合入4.6】log日志分区中各模块的调试日志打印专项检查，对打印频繁的日志要进行优化。
对应aSV4.2TD32570
测试：
打包验证</msg>
</logentry>
<logentry
   revision="243140">
<author>lcy</author>
<date>2015-11-12T02:48:08.704906Z</date>
<msg>reviewid:13946
review by lifan
TD:33086
现象：TD33086,【历史遗留，合入VMP4.6】将之前的all.log日志放到/var/内存目录下
改动说明：
合入4.2的改动。
具体改动说明：
将之前的all.log日志放到/var/内存目录下.合入4.2的改动。对应的4.2TD32780
增加一个&lt;task interval="120" path="/var/dmesg.txt" size_limit="20000000"&gt;dmesg -T&lt;/task&gt;
测试：
打包验证</msg>
</logentry>
<logentry
   revision="243139">
<author>jcy</author>
<date>2015-11-12T02:44:56.829380Z</date>
<msg>noreview：
改动说明：
bug32997，添加虚拟机选择光驱文件时，无法选中</msg>
</logentry>
<logentry
   revision="243134">
<author>lcy</author>
<date>2015-11-12T02:32:17.922391Z</date>
<msg>reviewid:13945
review by lifan
TD:33086
现象：TD33086,【历史遗留，合入VMP4.6】将之前的all.log日志放到/var/内存目录下
改动说明：
合入4.2的改动。
具体改动说明：
将之前的all.log日志放到/var/内存目录下.合入4.2的改动。对应的4.2TD32780
测试：
打包验证</msg>
</logentry>
<logentry
   revision="243117">
<author>chenlei</author>
<date>2015-11-11T14:23:35.634565Z</date>
<msg>reviewid:13942
review by:gwl
bugid:32997
改动说明：
新建虚拟机，创建虚拟机的主机需要能够同时访问ISO镜像所在存储和虚拟机存储位置</msg>
</logentry>
<logentry
   revision="243114">
<author>hyq</author>
<date>2015-11-11T13:33:58.563448Z</date>
<msg>reviewid: 13944
Reviewed by: fxw
BUG ID: 33097
问题分析：
代码没有和全
改动说明：
td33097:异地备份，日志里单位搞错了，如附件【11.11】
</msg>
</logentry>
<logentry
   revision="243097">
<author>yangwei</author>
<date>2015-11-11T11:18:30.132259Z</date>
<msg>reviewid 13939
reviewed by  fxw gwl
BUG ID: 33112
问题分析： 插入新key，不让输入序列号，应该让输入序列号
修改说明：插入一个新key，视为不兼容的key，前台不能注册，不合理。增加一个key_type状态，表示新key，前台允许输入序列号。
测试：
1、插入新key，允许输入序列号，用户注册,测试ok。
2、插入asvkey，不兼容，不允许输入修改序列号，测试ok。
3、插入正确的adesk key，注册页面显示key的信息，可以注册修改序列号，测试ok。</msg>
</logentry>
<logentry
   revision="243075">
<author>gwl</author>
<date>2015-11-11T09:23:42.026806Z</date>
<msg>reviewid: 13934
Reviewed by：fxw
BUGID: 33105
问题分析：为derive API增加一个getusermsg字段，正式发布前会去掉</msg>
</logentry>
<logentry
   revision="243073">
<author>jcy</author>
<date>2015-11-11T09:14:18.676191Z</date>
<msg>noreview：
改动说明：
bug33109，编辑 自动选择运行位置的虚拟机时，浏览iso，无法选择共享存储</msg>
</logentry>
<logentry
   revision="243065">
<author>yangwei</author>
<date>2015-11-11T08:56:01.456955Z</date>
<msg>reviewid 13935
reviewed by  fxw
BUG ID: 
问题分析： 更新VMP序列号授权文档
修改说明：
测试：
</msg>
</logentry>
<logentry
   revision="243060">
<author>yangwei</author>
<date>2015-11-11T08:30:58.987775Z</date>
<msg>reviewid 13932
reviewed by  fxw
BUG ID: 33100
问题分析： 授权工具修改
修改说明：
1、删除了计算过期函数中的一个日志项，
2、返回配置信息函数中，key_type变量初始化为0，否则无key情况下会返回随机数
测试：
不插key情况下，vtsn_tool -B, key_type = 0，测试ok。
不插key，前台显示未插key，测试ok。
插正确的key，正确显示keyid，测试ok。
插不兼容的key，正确显示key不兼容，测试ok。</msg>
</logentry>
<logentry
   revision="243037">
<author>jcy</author>
<date>2015-11-11T06:41:19.847403Z</date>
<msg>noreview：
改动说明：
bug33074，序列号页面UI问题</msg>
</logentry>
<logentry
   revision="243035">
<author>lcy</author>
<date>2015-11-11T06:36:32.247766Z</date>
<msg>reviewid:13921
review by gwl
TD:33005
现象：TD33005,【HA】HA虚拟机虚拟设备拉起判定有问题
改动说明：
4.2的虚拟网络和vmp4.5的有很大的差异，在判断上vmp还需要修改过来，不能仅仅合4.2对手动拉起HA的修改。还要修改后台HA拉起的代码
测试：
自测通过
</msg>
</logentry>
<logentry
   revision="243032">
<author>hyq</author>
<date>2015-11-11T06:28:13.097283Z</date>
<msg>reviewid 13926
Reviewed by: fxw
BUG ID: 33062
问题分析：
如果有多个主机离线不会把所有主机都打印出来，这里改下
改动说明：
td33062:vs存储，有主机离线，vs存储的虚拟机迁移、编辑提示有问题</msg>
</logentry>
<logentry
   revision="243027">
<author>hyq</author>
<date>2015-11-11T04:41:16.253877Z</date>
<msg>reviewid 13924
Reviewed by: fxw
BUG ID: 33062
问题分析：
主机离线/cfs/.members这个配置文件里的没有该主机的IP信息
改动说明：
td33062:vs存储，有主机离线，vs存储的虚拟机迁移、编辑提示有问题</msg>
</logentry>
<logentry
   revision="243022">
<author>hyq</author>
<date>2015-11-11T03:07:19.557806Z</date>
<msg>reviewid 13920
Reviewed by: fxw
BUG ID: 32966
问题分析：
改动说明：
td32966:磁盘分配方式如果是动态分配则转换为精简分配，原因是虚拟存储不支持动态分配，vmp也不再支持。
</msg>
</logentry>
<logentry
   revision="243003">
<author>yangwei</author>
<date>2015-11-11T02:26:42.611583Z</date>
<msg>reviewid 13918
reviewed by lcy 
BUG ID: 32473
问题分析： 修改vmpsn错误描述
改动说明：修改vmpsn错误描述</msg>
</logentry>
<logentry
   revision="242999">
<author>lcy</author>
<date>2015-11-11T02:14:18.667911Z</date>
<msg>reviewid:13913
review by gwl
TD:33032
现象：TD33032,【vs相关】获取存储列表树的api执行时间很长【必改】【11.10】
改动说明：
传递给函数is_all_in_one_hardware的参数出错了，修改传递的参数，并且对is_all_in_one_hardware函数进行一些异常处理
测试：
自测通过
</msg>
</logentry>
<logentry
   revision="242956">
<author>gwl</author>
<date>2015-11-10T11:37:39.963907Z</date>
<msg>reviewid: 13908
Reviewed by：fxw
BUGID: 32529
问题分析：/sf/etc/cron.d/daily.d/95sync_log_db.pl语法不规范</msg>
</logentry>
<logentry
   revision="242953">
<author>yangwei</author>
<date>2015-11-10T11:11:18.630816Z</date>
<msg>reviewid 13907
reviewed by fxw 
BUG ID: 32473
问题分析： 插新的key，ut清零
改动说明： 
老的流程：更换key时，重新开始计时。
测试：当前有效key使用时间ut为n，插入新的key，ut清零，重新开始计时，测试ok。</msg>
</logentry>
<logentry
   revision="242949">
<author>gwl</author>
<date>2015-11-10T10:19:48.400799Z</date>
<msg>reviewid: 13906
Reviewed by：hyq
BUGID: 33057
问题分析：[模板优化]首次部署完成后，模板配置文件没有template_uuid字段。【优先】【11.10】</msg>
</logentry>
<logentry
   revision="242932">
<author>lcy</author>
<date>2015-11-10T09:07:03.150549Z</date>
<msg>reviewid:13900
review by fxw
TD:33045
现象：TD33045, 【历史遗留，合入VMP4.6】【技术支持】【多个用户出现】【ALL】多个用的VMP出现日志分区变只读了。导致系统异常【11.10】
改动说明：
合入4.2的改动。
具体改动说明：
1.log分区采用ext4文件系统，实际测试中容易损坏，参考ext3的默认挂载参数。在挂载log分区时，增加barrier=1,data=journal选项。
aSV4.2对应的BUGID32334
测试：
打包验证</msg>
</logentry>
<logentry
   revision="242923">
<author>yangwei</author>
<date>2015-11-10T07:01:42.678253Z</date>
<msg>reviewid 13898
reviewed by fxw 
BUG ID: 32996
问题分析： 插入错误的key，会修改集群的信息
改动说明： 
老的流程：插入新key，先将keyid更新到配置文件，如果是asv的key配置里的keyid和sn肯定不匹配。然后更新sn，如果key里面的sn和keyid正确就更新到配置，否则就尝试吧配置的写入到key。
新流程：先同步sn，如果同步正确，才修改keyid等信息，保证和keyid正在配置里面是匹配的。
插入不兼容key时返回的keyid和owner为不兼容key信息。
不兼容key期限也是30天。
测试：
1、插入正确的key，显示正常。
2、拔掉key，剩余天数为min（30，key剩余期限）。
3、插入不兼容的key，剩余天数不变，使用的授权序列号的sn和keyid不变，为原来正确的sn和keyid。
4、页面上显示不兼容的key。
5、vtsn_tool -o为不兼容key所在主机，vtsn_tool -B，为不兼容key的keyid。
测试ok</msg>
</logentry>
<logentry
   revision="242918">
<author>jcy</author>
<date>2015-11-10T06:51:08.904669Z</date>
<msg>noreview：
改动说明：
bug33060，企业版序列号加上快过期和key不正确的提示</msg>
</logentry>
<logentry
   revision="242915">
<author>gwl</author>
<date>2015-11-10T06:35:53.219020Z</date>
<msg>reviewid: 13897
Reviewed by：hyq
BUGID: 
问题分析：虚拟机需要修复状态，详情页面未启用修复模板</msg>
</logentry>
<logentry
   revision="242914">
<author>hyq</author>
<date>2015-11-10T06:30:50.434948Z</date>
<msg>reviewid 13896
Reviewed by: fxw
BUG ID: 33059
问题分析：
改动说明：
td33059:模板修复进度条显示不准确，</msg>
</logentry>
<logentry
   revision="242904">
<author>jcy</author>
<date>2015-11-10T03:05:09.101495Z</date>
<msg>noreview：
改动说明：
bug33052，VS更换主机时的删除主机，下发参数错误</msg>
</logentry>
<logentry
   revision="242899">
<author>jcy</author>
<date>2015-11-10T02:31:51.611676Z</date>
<msg>noreview：
改动说明：
bug33053，vmp首页下方的主页链接应该链接到桌面虚拟化板块，而不是服务器虚拟化板块</msg>
</logentry>
<logentry
   revision="242897">
<author>jcy</author>
<date>2015-11-10T02:27:33.081263Z</date>
<msg>noreview：
改动说明：
bug33036，模板更新时，未指定备份时应报错</msg>
</logentry>
<logentry
   revision="242895">
<author>jcy</author>
<date>2015-11-10T02:26:41.157268Z</date>
<msg>noreview：
改动说明：
bug32882，趋势图显示有问题</msg>
</logentry>
<logentry
   revision="242889">
<author>gwl</author>
<date>2015-11-10T01:43:56.956288Z</date>
<msg>reviewid: 13891
Reviewed by：fxw
BUGID: 
问题分析：查询upid接口，增加参数，以判断是否需要获取usermsg</msg>
</logentry>
<logentry
   revision="242888">
<author>gwl</author>
<date>2015-11-10T01:43:15.626273Z</date>
<msg>reviewid: 13890
Reviewed by：fxw
BUGID: 33006
问题分析：新建虚拟交换机，桥接聚合口（该聚合口已桥接别的虚拟交换机），失败日志显示的名称为sf_bond0，改为聚合口用户名称</msg>
</logentry>
<logentry
   revision="242873">
<author>hyq</author>
<date>2015-11-09T13:11:01.509284Z</date>
<msg>reviewid 13886
Reviewed by: fxw
BUG ID: 32959
问题分析：
改动说明：
[模板优化]模板重载的进度条，直接从0到100%了[10.7]</msg>
</logentry>
<logentry
   revision="242861">
<author>jcy</author>
<date>2015-11-09T11:54:44.320920Z</date>
<msg>noreview：
改动说明：
bug32976，升级页面的回滚补丁包操作，优化</msg>
</logentry>
<logentry
   revision="242856">
<author>gwl</author>
<date>2015-11-09T11:39:26.294192Z</date>
<msg>reviewid: 13882
Reviewed by：fxw
BUGID: 30620
问题分析：
100M网络告警，设置不成功</msg>
</logentry>
<logentry
   revision="242849">
<author>lcy</author>
<date>2015-11-09T11:11:03.812213Z</date>
<msg>reviewid:13881
review by zyj
TD:32952
现象：TD32952,【历史遗留，合入VMP4.6】3.5设备跑ltp会宕机---cgroup【11.9】
改动说明：
合入VMP3.6处理的内核patch。内核patch，专门处理cgroups宕机问题。对应TD29069
测试：
编译通过
</msg>
</logentry>
<logentry
   revision="242848">
<author>jcy</author>
<date>2015-11-09T11:08:03.323426Z</date>
<msg>noreview：
改动说明：
bug32987，去掉“服务与支持”页面的“试用版”字眼。</msg>
</logentry>
<logentry
   revision="242846">
<author>lcy</author>
<date>2015-11-09T10:26:24.062946Z</date>
<msg>reviewid:13880
review by fxw
TD:32952
现象：TD32952,【历史遗留，合入VMP4.6】3.5设备跑ltp会宕机---cgroup【11.9】
改动说明：
提交原始文件
测试：
无</msg>
</logentry>
<logentry
   revision="242839">
<author>jcy</author>
<date>2015-11-09T09:33:52.462502Z</date>
<msg>noreview：
改动说明：
bug32936，换掉登录页面的图片</msg>
</logentry>
<logentry
   revision="242836">
<author>jcy</author>
<date>2015-11-09T09:26:45.934288Z</date>
<msg>noreview：
改动说明：
bug32997，添加虚拟机时，共享存储不能被当前选的运行主机访问时 需禁止选择此存储上的文件。</msg>
</logentry>
<logentry
   revision="242825">
<author>hyq</author>
<date>2015-11-09T08:45:41.141337Z</date>
<msg>reviewid 13875
Reviewed by: gwl
BUG ID: 33002
问题分析：
获取vs存储名称的方式不对
改动说明：
改用获取存储名称的公共接口
td33002:【镜像异常】模板基镜像被重命名，进行模板修复，在后台杀掉修复进程，模板出现异常【必改】</msg>
</logentry>
<logentry
   revision="242824">
<author>gwl</author>
<date>2015-11-09T08:45:21.695594Z</date>
<msg>reviewid: 13877
Reviewed by：fxw
BUGID:
问题分析：
js代码告警</msg>
</logentry>
<logentry
   revision="242810">
<author>lcy</author>
<date>2015-11-09T08:13:21.835423Z</date>
<msg>reviewid:13872
review by fxw
TD:32998
现象：TD32998,【技术支持】【黄磊测试】【VDI4.5】首页的内存显示是实际内存的两倍。【必改】
改动说明：
用dmidecode获取内存大小的时候，客户现场中出现输出的物理内存信息被重复了两份的情况，导致主机详情页面的内存显示不正确。
修改方法：在获取完内存大小之后，需要除以信息打印的次数，即调用这个命令 dmidecode -t memory | grep SMBIOS | wc -l
测试：
自测通过
</msg>
</logentry>
<logentry
   revision="242805">
<author>yangwei</author>
<date>2015-11-09T07:55:02.782679Z</date>
<msg>reviewid 13873
reviewed by  gwl
BUG ID: 33027
问题分析： 拔掉key剩余时间问题
改动说明： 拔掉key以后剩余时间天数为30天，而序列号的剩余期限可能小于没有key的使用期限：返回给前台的数据取二者最小值。
测试：
key剩余天数为2，拔掉key，页面提示剩余时间为2.测试ok。
key过期，且拔掉key，页面提示过期，测试ok。</msg>
</logentry>
<logentry
   revision="242802">
<author>yangwei</author>
<date>2015-11-09T07:37:27.712416Z</date>
<msg>reviewid 13868
reviewed by czy 
BUG ID: 33004
问题分析： 【合入32342】备份存储的qcow2文件损坏后，进行全备份，却没有尝试修复或删除 。之前的备份，仍然以追加的形式进行备份，导致一直进行全备份。
改动说明： 
之前流程是check后不删除不修复备份的qcow2文件，导致一直以全备份形式追加，文件变得非常大。改动如下：
1. 备份前的检查中如果发现备份端qcow2文件损坏，尝试用-r leaks修复，修复成功走正常增量备份流程，失败走全备份流程。
2. 全备份前删掉之前的旧备份文件
3. 备份文件损坏后，日志加入提示做全备份的原因
</msg>
</logentry>
<logentry
   revision="242801">
<author>chenlei</author>
<date>2015-11-09T07:37:20.326905Z</date>
<msg>reviewid:13871
review by:fxw
bugid:null
改动说明：
[模板更新] 去掉计划更新定时脚本中的调试日志</msg>
</logentry>
<logentry
   revision="242799">
<author>gwl</author>
<date>2015-11-09T07:26:55.734375Z</date>
<msg>reviewid: 13869
Reviewed by：chenlei, fxw, hyq, zhangxin
BUGID: 32693  32980  32991
问题分析：

32693:
问题1和问题2按附件标注的改了
问题3改为： 虚拟机卡片状态改为：需要修复，且只有修复操作可以点


32980:
改为读取配置的方式，在虚拟机配置中加一个字段：need_repair
以标记虚拟机需要修复

32991:
改为，在后台检测告警时，如果检测到需要修复，则告警，如果检测到不需要修复，则消除告警，
这样会有几秒的延迟时间，即用户点了修复之后，可能会过几秒才自动消除告警

之所以不在点击修复的API函数里消除告警，是考虑代码复用，以及可维护性，还有
尽量不use（会use DoAlert，这是一个服务的代码，可能会出现未知异常的）。

且体验性也不差，如果一定要纠结这几秒
再等提bug了，复制代码的方式去改吧</msg>
</logentry>
<logentry
   revision="242797">
<author>jcy</author>
<date>2015-11-09T06:54:52.253153Z</date>
<msg>noreview：
改动说明：
bug32936，去掉p2v功能的入口</msg>
</logentry>
<logentry
   revision="242790">
<author>lcy</author>
<date>2015-11-09T03:44:53.603450Z</date>
<msg>reviewid:13866
review by sxk
TD:33005
现象：TD33005,【历史遗留，合入VMP4.6】【HA】HA虚拟机虚拟设备拉起判定有问题【11.9】
改动说明：
合入4.2的改动。4.2对应的BUGID：32455
测试：
打包验证</msg>
</logentry>
<logentry
   revision="242787">
<author>jcy</author>
<date>2015-11-09T03:36:26.369055Z</date>
<msg>noreview：
改动说明：
bug32987，去掉“服务与支持”页面的“试用版”字眼。</msg>
</logentry>
<logentry
   revision="242783">
<author>chenlei</author>
<date>2015-11-09T02:50:07.860964Z</date>
<msg>reviewid:13864
review by:fxw
bugid: 33023
现象：
告警里出现raid卡ok (jbod)状态，严格匹配“ok”字符串失败，导致告警
改动说明：
将匹配raid正常状态的尾匹配去掉，保留首匹配来确保获得到raid卡状态并且忽略后面跟的模式信息。</msg>
</logentry>
<logentry
   revision="242761">
<author>fxw</author>
<date>2015-11-09T01:35:45.455451Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="242747">
<author>hyq</author>
<date>2015-11-07T12:15:28.317077Z</date>
<msg>reviewid 13862
Reviewed by: gwl
BUG ID: 32966
问题分析：
vs存储不支持动态分配，设置为动态分配和预分配是一样的
改动说明：
td32966 : [模板优化]通过VDC部署虚拟机，添加个人磁盘，个人盘分配方式需改为精简分配。【11.6】</msg>
</logentry>
<logentry
   revision="242744">
<author>hyq</author>
<date>2015-11-07T11:27:47.761024Z</date>
<msg>reviewid 13860
Reviewed by: gwl
BUG ID: 32953
问题分析：
解决cpufreq可能引发二次释放问题。
改动说明：
【历史遗留，合入VMP4.6】[BDD]从节点kmalloc等宕机【开发回归】【11.6】
</msg>
</logentry>
<logentry
   revision="242741">
<author>hyq</author>
<date>2015-11-07T10:24:21.246935Z</date>
<msg>reviewid 13859
reviewed by: gwl
Bug ID：32985
改动说明：
遗留bug : 在4.2的环境上验证了下，也有这个问题
【模板部署】模板之前做过备份，删除备份并进行部署，操作失败【必改】</msg>
</logentry>
<logentry
   revision="242726">
<author>fxw</author>
<date>2015-11-07T09:07:44.877268Z</date>
<msg>noreview
ssl 更新spice代码，同步更新spice库</msg>
</logentry>
<logentry
   revision="242724">
<author>ssl</author>
<date>2015-11-07T08:47:34.596113Z</date>
<msg>noreview 肖俊修改：
【修改原因】1.缩短通道空闲时的PING消息发送间隔到两秒，客户端把PING消息当作心跳检测包；2.PING消息不做MD压缩，因为作为心跳包，实时性要求高
【如何修改】修改宏定义，增加一个消息判断函数</msg>
</logentry>
<logentry
   revision="242720">
<author>yangwei</author>
<date>2015-11-07T08:42:17.469047Z</date>
<msg>reviewid 13855
reviewed by xhz 
BUG ID: 32969
问题分析： 迁移虚拟机报错
改动说明： 1、去掉迁移虚拟机去掉目录锁，仅加虚拟机锁。
2、之前为了修改报目录锁加锁失败问题，把报错统一为“可能有其他虚拟机正在迁移”，屏蔽了真实的错误，也太笼统，也不够准确。仍将报错信息修改为实际错误原因，更为准确。
测试：1、同分组下虚拟机可以同时正常编辑或者迁移，测试ok。
2、取消迁移任务，报错正常，不影响客户的可读性，测试ok。
3、磁盘A剩余空间不足，向A迁移虚拟机，报错正常，测试ok。
</msg>
</logentry>
<logentry
   revision="242693">
<author>yangwei</author>
<date>2015-11-07T06:23:12.606758Z</date>
<msg>reviewid 13853
reviewed by fxw 
BUG ID: 32969 32989
问题分析： 双屏支持后台数据返回
改动说明： 虚拟机配置双屏支持返回类型转换为int
测试：测试ok
</msg>
</logentry>
<logentry
   revision="242679">
<author>hyq</author>
<date>2015-11-07T01:50:38.690784Z</date>
<msg>reviewid 13850
reviewed by: gwl
Bug ID：32953
改动说明：
32953：【历史遗留，合入VMP4.6】[BDD]从节点kmalloc等宕机【开发回归】【11.6】，添加原始文件</msg>
</logentry>
<logentry
   revision="242676">
<author>lcy</author>
<date>2015-11-07T01:19:57.637777Z</date>
<msg>reviewid:13827
review by hyq
TD:32959
现象：TD32959,[模板优化]模板重载的进度条，直接从0到100%了
改动说明：
增加拷贝镜像的进度条显示
测试：
自测通过
</msg>
</logentry>
<logentry
   revision="242675">
<author>lcy</author>
<date>2015-11-07T01:16:58.421021Z</date>
<msg>reviewid:13849
review by fxw
TD:32753
现象：TD32753,Beta包，需要把之前在my_die函数中增加一条打印到后台日志的代码回滚
改动说明：
回滚之前的调试代码
测试：
自测通过</msg>
</logentry>
<logentry
   revision="242658">
<author>vs</author>
<date>2015-11-06T09:58:57.751321Z</date>
<msg>vstd 30542 reviewid 13782
问题分析：VS异常的时候，限制操作
改动说明：在有节点离线的时候，限制删除，创建，克隆，模板部署，新建分组，删除分组，导入虚拟机，迁移虚拟机，上传iso的操作
做了哪些测试：虚拟机创建，删除，克隆，模板部署，新建分组，删除分组，导入虚拟机，迁移虚拟机，上传iso的操作</msg>
</logentry>
<logentry
   revision="242649">
<author>lrx</author>
<date>2015-11-06T09:20:56.033504Z</date>
<msg>reviewid: 13836
reviewd by: jcy
bugid 32947
改动说明：1、合入4.2关于驱动器的提示到4.6

</msg>
</logentry>
<logentry
   revision="242618">
<author>yangwei</author>
<date>2015-11-06T06:16:41.418024Z</date>
<msg>reviewid 13815
reviewed by fxw 
BUG ID: 32945
问题分析： 修改分组失败，提示包含迁移失败
改动说明： 无论是修改分组还是迁移都会对虚拟机镜像目录加锁。这两种不同操作，底层实质都是迁移，在提示错误的时候，提示“迁移XXXX”，修改提示为“操作XXX”，提示对于客户更容易理解一些。
测试：
</msg>
</logentry>
<logentry
   revision="242601">
<author>chenlei</author>
<date>2015-11-06T03:27:43.091351Z</date>
<msg>reviewid:13805
review by:gwl
bugid: 32724
改动说明：
[模板优化]模板需要修复在虚拟机卡片左上角告警提示用户需要修复

测试：
自测通过</msg>
</logentry>
<logentry
   revision="242593">
<author>fxw</author>
<date>2015-11-06T02:22:32.780350Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="242590">
<author>hyq</author>
<date>2015-11-06T02:04:20.040532Z</date>
<msg>reviewid 13802
reviewed by: gwl
Bug ID：32909
改动说明：
两个问题：
1、开机模板更新失败提示“模板未停止不允许发布更新”;
原因是：虚拟机关机过程中有一个stoping(应该是stopping,代码状态有错别字)，如果虚拟机关机持续较长时间，这个状态会持续较长时间。老的代码流程认为这个状态为非关机状态。
2、去掉更新模板锁，理由是：这个锁不需要且会导致前面代码异常抛出不被捕获（VTP::Tools::lock_file应该和VTP::Oplog::log_with_task，gwl得出的结论）</msg>
</logentry>
<logentry
   revision="242587">
<author>vs</author>
<date>2015-11-06T01:25:42.720465Z</date>
<msg>reviewid 13798, 
reviewed by fxw
VS2.0合入到2.1R1,  添加主机失败后删除主机，可以下次重试</msg>
</logentry>
<logentry
   revision="242561">
<author>fxw</author>
<date>2015-11-05T13:09:17.765287Z</date>
<msg>noreview
SSL 修改spice代码，更新库</msg>
</logentry>
<logentry
   revision="242536">
<author>lcy</author>
<date>2015-11-05T11:29:30.233213Z</date>
<msg>reviewid:13788
review by lifan
TD:32951
现象：TD32951,集群通信方式从组播改为广播
改动说明：
集群通信方式从组播改为广播
测试：
打包验证</msg>
</logentry>
<logentry
   revision="242505">
<author>fxw</author>
<date>2015-11-05T09:03:00.063158Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="242502">
<author>fxw</author>
<date>2015-11-05T08:50:46.662109Z</date>
<msg>noreview 格式化代码</msg>
</logentry>
<logentry
   revision="242501">
<author>yangwei</author>
<date>2015-11-05T08:48:13.423033Z</date>
<msg>reviewid 13786
reviewed by gwl
BUG ID: 32818
问题分析： 【迁移】同时迁移2台虚拟机的运行位置，后一台会迁移失败，提示获取目录锁失败
改动说明： 修改错误描述
</msg>
</logentry>
<logentry
   revision="242497">
<author>lrx</author>
<date>2015-11-05T08:39:31.883464Z</date>
<msg>reviewid: 13785
reviewd by: jcy
bugid 32661
改动说明：1、将4.2的企业版过期提示合入到4.6，去掉ad、af的检测

</msg>
</logentry>
<logentry
   revision="242487">
<author>lcy</author>
<date>2015-11-05T07:29:19.739725Z</date>
<msg>reviewid:13784
review by gwl
TD:32923
现象：TD32923,vs上虚拟机开机本地备份失败，报错如附件
改动说明：
开机备份的时候会有超时的可能，发送stop命令的时候，有可能超时。这里解决的办法是尝试几次。
测试：
自测通过</msg>
</logentry>
<logentry
   revision="242476">
<author>yangwei</author>
<date>2015-11-05T06:27:55.018178Z</date>
<msg>reviewid 13780
reviewed by fxw xhz
BUG ID: 32926
问题分析： swap优化限制swap空间大小
改动说明： 安装VMP的时候，swap的大小不能超过内存的25%，最小为8G
测试：打包测试
</msg>
</logentry>
<logentry
   revision="242460">
<author>yangwei</author>
<date>2015-11-05T04:00:44.080847Z</date>
<msg>reviewid 13779
reviewed by fxw
BUG ID: 
问题分析： 更新设计文档
改动说明： 更新VMP授权设计文档
</msg>
</logentry>
<logentry
   revision="242448">
<author>ssl</author>
<date>2015-11-05T03:15:37.771903Z</date>
<msg>noreview wkz修改：
【修改原因】优化画线算法，以及增加协商流程，动态关闭服务端（spice）的画线
【如何修改】1、增加了协商用的caps，用于动态关闭服务端画线；2、优化了画线算法，主要优化与坐标轴平行的，超出图像区域的图像；提前识别这种场景，优化坐标；</msg>
</logentry>
<logentry
   revision="242445">
<author>lrx</author>
<date>2015-11-05T03:04:31.019590Z</date>
<msg>reviewid: 13776
reviewd by: jcy
bugid 32635
改动说明：1、4.6在虚拟机操作的二级菜单上，添加转为模板和虚拟机的操作，同时为防止菜单多长，不显示一定不能用的操作

</msg>
</logentry>
<logentry
   revision="242432">
<author>lcy</author>
<date>2015-11-05T02:07:02.205201Z</date>
<msg>reviewid:13773
review by wyy
TD:32927
现象：TD32927,新建虚拟机，加载的ISO含空格，启动失败，报错存储不存在，如附件【遗留】
改动说明：
合入4.2的改动。aSV4.2的TD32925
测试：
自测通过</msg>
</logentry>
<logentry
   revision="242398">
<author>yangwei</author>
<date>2015-11-04T12:01:49.119810Z</date>
<msg>reviewid 13770
reviewed by gwl
BUG ID: 
问题分析： 添加主机代码优化
改动说明： 1、对端主机为企业版不处理
2、对端主机授权hash的key添加sn_type，vmpsn将sn_flag装换成了sn_type.
</msg>
</logentry>
<logentry
   revision="242375">
<author>gwl</author>
<date>2015-11-04T09:28:46.574591Z</date>
<msg>reviewid: 13764
Reviewed by：hyq
BUGID: 
问题分析：ssl的vdc agent驱动有bug，会导致蓝屏，已找到原因，无人力修改，暂时先禁掉休眠</msg>
</logentry>
<logentry
   revision="242363">
<author>hyq</author>
<date>2015-11-04T08:51:11.234268Z</date>
<msg>reviewid 13769
reviewed by: gwl
Bug ID：32906，32918
改动说明：
1、td32906：[模板优化]更新指定备份内容到其它虚拟机操作有update_snapshot_***快照残留；2、,td32918：[模板优化]模板镜像正常，误判为模板丢失或损坏。如附件</msg>
</logentry>
<logentry
   revision="242344">
<author>fxw</author>
<date>2015-11-04T08:27:42.292090Z</date>
<msg>noreview
更改目录名称</msg>
</logentry>
<logentry
   revision="242343">
<author>fxw</author>
<date>2015-11-04T08:26:50.701632Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="242342">
<author>fxw</author>
<date>2015-11-04T08:26:16.101389Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="242328">
<author>lcy</author>
<date>2015-11-04T07:44:27.500746Z</date>
<msg>reviewid:13766
review by gwl
TD:32828
现象：TD32828,[模板优化]模板部署，回拷基镜像过程中空间不足导致基镜像丢失，无任何提示，日志也只是部署成功。
改动说明：
回拷过程做成一个任务，在前台要显示出来，操作名称是模板重载，如果失败了要提示模板重载失败，模板虚拟机无法使用，请在虚拟机操作列表中使用修复
测试：
自测通过</msg>
</logentry>
<logentry
   revision="242324">
<author>lrx</author>
<date>2015-11-04T07:20:35.267631Z</date>
<msg>reviewid: 13765
reviewd by: jcy
改动说明：1、4.2的派生虚拟机名称序号机制合入4.6，2、合入multiajax到4.6

</msg>
</logentry>
<logentry
   revision="242288">
<author>gwl</author>
<date>2015-11-04T02:32:50.688072Z</date>
<msg>reviewid: 13760
Reviewed by：fxw
BUGID: 
问题分析：批量创建虚拟机接口，虚拟机名称之前默认从1开始计数，
改为获取已有的名称的最大值，作为起始值，后台上库，UI稍后</msg>
</logentry>
<logentry
   revision="242287">
<author>fxw</author>
<date>2015-11-04T02:22:03.073477Z</date>
<msg>noreview
添加文档</msg>
</logentry>
<logentry
   revision="242286">
<author>fxw</author>
<date>2015-11-04T02:20:15.729435Z</date>
<msg>noreview
添加文档积累</msg>
</logentry>
<logentry
   revision="242259">
<author>lcy</author>
<date>2015-11-03T12:25:01.127488Z</date>
<msg>reviewid:13739
review by gwl
TD:32874
现象：TD32874,【技术支持】【SSL转接客户----麦闲亮】【VDI4.5.01】集群IP切换后，VDC记录的mac地址没有发生变化，还是老的mac【必改】
改动说明：
每次切换之后，发送3次arp广播包。然后，为了防止其他的主机没有收到，后台起一个脚本继续发送30秒的包
测试：
自测通过</msg>
</logentry>
<logentry
   revision="242251">
<author>chenlei</author>
<date>2015-11-03T11:37:45.577200Z</date>
<msg>reviewid:13751
review by:hyq
bugid: 32895
改动说明：
解决对模板虚拟机创建备份,用于更新的update_snapshot_****的快照会被删除的问题

测试：
自测通过</msg>
</logentry>
<logentry
   revision="242250">
<author>hyq</author>
<date>2015-11-03T11:37:19.970446Z</date>
<msg>reviewid 13747
reviewed by: wzt
Bug ID：32896
改动说明：
td32896 : 模板虚拟机卸载virtio工具后更新，导致派生虚拟机配置不正确
原因：写配置判断的时候有误virtio字段被过滤，写到配置没修改过来</msg>
</logentry>
<logentry
   revision="242234">
<author>chenlei</author>
<date>2015-11-03T09:13:04.149078Z</date>
<msg>reviewid:13745
review by:hyq
bugid: 32895
改动说明：
解决对模板虚拟机创建备份,用于更新的update_snapshot_****的快照会被删除的问题

测试：
自测通过</msg>
</logentry>
<logentry
   revision="242203">
<author>fxw</author>
<date>2015-11-03T06:56:03.585372Z</date>
<msg>reviewid 13738
Reviewed by: gwl
BUG ID: 32887
改动说明：
VMP4.5合入swap优化的时候引发的问题：
原来的内存计算会有一个20%的超配比例，合入swap优化后这个超配计算被删了，
但是在VMP安装在SSD的情况下，swap并没有使用，导致可配置内存总量变少。
修改方法：在没有使用swap的时候，仍然超配内存。
测试：
无</msg>
</logentry>
<logentry
   revision="242190">
<author>fxw</author>
<date>2015-11-03T03:59:27.615938Z</date>
<msg>noreview 格式化代码</msg>
</logentry>
<logentry
   revision="242123">
<author>lrx</author>
<date>2015-11-02T12:57:17.208618Z</date>
<msg>reviewid: 13730
reviewd by: jcy
bugid  
改动说明：1、强制添加主机密码加密错误

</msg>
</logentry>
<logentry
   revision="242083">
<author>lcy</author>
<date>2015-11-02T09:25:40.827438Z</date>
<msg>reviewid:13724
review by xhz
TD:31465
现象：TD31465,两主机两副本，一台主机故障，有虚拟机未被拉起,内存不足，没有任何提示信息【需要重现】[9.18]
改动说明：
加到忽略列表的虚拟机，在尝试多次无法启动后，在前台打印HA拉起虚拟机启动失败的错误提示。
测试：
自测通过</msg>
</logentry>
<logentry
   revision="242078">
<author>lrx</author>
<date>2015-11-02T09:02:54.934549Z</date>
<msg>reviewid: 13722
reviewd by: jcy
bugid 32160 
改动说明：1、将4.2对密码的说明合入到4.6

</msg>
</logentry>
<logentry
   revision="242074">
<author>hyq</author>
<date>2015-11-02T08:52:56.475458Z</date>
<msg>reviewid 13720
reviewed by: gwl
Bug ID：32829
改动说明：
TD32829:[模板优化]空间不足导致模板修复失败的提示需要具体一点。【必改】
先检查存储空间是否足够大</msg>
</logentry>
<logentry
   revision="242073">
<author>gwl</author>
<date>2015-11-02T08:52:13.842603Z</date>
<msg>reviewid: 13721
Reviewed by：fxw
BUGID: 32848
问题分析：${ 1 }错误</msg>
</logentry>
<logentry
   revision="242065">
<author>hyq</author>
<date>2015-11-02T08:12:43.607634Z</date>
<msg>reviewid 13715
reviewed by: gwl
Bug ID：32829
改动说明：
TD32829:[模板优化]空间不足导致模板修复失败的提示需要具体一点。【必改】</msg>
</logentry>
<logentry
   revision="242058">
<author>gwl</author>
<date>2015-11-02T07:35:00.783785Z</date>
<msg>reviewid: 13712
Reviewed by：hyq
BUGID: 
问题分析：虚拟存储序列号检查提示，多了逗号</msg>
</logentry>
<logentry
   revision="242057">
<author>hyq</author>
<date>2015-11-02T07:34:32.167175Z</date>
<msg>reviewid 13711
reviewed by: gwl
改动说明：
修改更新UUID名称</msg>
</logentry>
<logentry
   revision="242051">
<author>chenlei</author>
<date>2015-11-02T06:55:08.245221Z</date>
<msg>reviewid:13710
review by:hyq
bugid: null
改动说明：
修改模板部署时所打快照的名称

测试：
自测通过</msg>
</logentry>
<logentry
   revision="242050">
<author>hyq</author>
<date>2015-11-02T06:54:21.824030Z</date>
<msg>reviewid 13707
reviewed by: gwl
Bug ID：32854
改动说明：
td32854:改动引发
获取访问存储的节点处eval 住，如果出错或返回空，不抛出异常，返回空
【自动化】删除共享存储后，删除在这个共享存储上的集群虚拟机失败，显示‘未找到合适的主机可以访问存储：xxxx’</msg>
</logentry>
<logentry
   revision="242031">
<author>fxw</author>
<date>2015-11-02T03:50:06.947630Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="242025">
<author>yangwei</author>
<date>2015-11-02T03:16:48.466674Z</date>
<msg>reviewid 13704
reviewed by fxw
BUG ID: 32842
问题分析： 插拔key序列号没有读出来
改动说明： 插key事件后枚举飞天key失败，第一次失败，停2s，进行第二次枚举。
测试：测试ok
</msg>
</logentry>
<logentry
   revision="242020">
<author>yangwei</author>
<date>2015-11-02T02:49:08.733743Z</date>
<msg>reviewid 13701
reviewed by hyq
BUG ID: 32969
问题分析： 精确匹配虚拟机配置中的双屏支持字段
改动说明： 精确匹配虚拟机配置中的双屏支持字段，匹配字段间的空格
</msg>
</logentry>
<logentry
   revision="241999">
<author>hyq</author>
<date>2015-10-31T10:58:03.099239Z</date>
<msg>reviewid 13696
reviewed by: gwl
Bug ID：32751
改动说明：
[模板优化]更新成功，派生虚拟机桌面文件损坏。【beta改】-优先改</msg>
</logentry>
<logentry
   revision="241998">
<author>gwl</author>
<date>2015-10-31T10:56:40.030979Z</date>
<msg>reviewid: 13699
Reviewed by：hyq
BUGID: 32824
问题分析：导入导出虚拟机页面，当其它页面点击注销时，应该自动跳转到主页
自测通过</msg>
</logentry>
<logentry
   revision="241977">
<author>yangwei</author>
<date>2015-10-31T09:39:35.001896Z</date>
<msg>reviewid 13691
reviewed by hyq
BUG ID: 32818
问题分析： 【迁移】同时迁移2台虚拟机的运行位置，后一台会迁移失败，提示获取目录锁失败
改动说明： 修改错误描述
</msg>
</logentry>
<logentry
   revision="241942">
<author>fxw</author>
<date>2015-10-31T03:43:06.342232Z</date>
<msg>noreview
TD32548 VMP for adesk不支持4个以上的磁盘，不需要合入这些代码，回滚掉</msg>
</logentry>
<logentry
   revision="241914">
<author>hyq</author>
<date>2015-10-30T14:04:44.096678Z</date>
<msg>reviewid 13683
reviewed by: gwl
Bug ID：32779
改动说明：
td32779: [模板优化]存储空间不足应该提前告知，不要等到关闭所有虚拟机之后。</msg>
</logentry>
<logentry
   revision="241910">
<author>hyq</author>
<date>2015-10-30T13:15:17.146654Z</date>
<msg>reviewid 13682
reviewed by: gwl
Bug ID：32786
改动说明：
td32786:非主控本地的模板部署到共享存储没有打更新快照</msg>
</logentry>
<logentry
   revision="241907">
<author>yangwei</author>
<date>2015-10-30T11:59:09.084416Z</date>
<msg>reviewid 13681
reviewed by hyq
BUG ID: 32436
问题分析： 企业版使用时间为t1，更换序列号使用期限小于t1的序列号注册失败
改动说明： 
设置序列号只要合法就应该设置，且检查过期是在先前的序列号使用时间基础上检查，不合理
测试：当前vmp已经使用时间为ut1。更换序列号为有期限，且期限小于ut1，注册成功。测试ok。



</msg>
</logentry>
<logentry
   revision="241871">
<author>lcy</author>
<date>2015-10-30T10:07:53.270852Z</date>
<msg>reviewid:13664
review by xhz
TD:32792
现象：TD32792,[体验]HA虚拟机拉起的时候，拉起失败给出的错误原因不明确，需要修改
改动说明：
列举出每个主机不能启动的具体原因
还有一个reviewid:13665
测试：
自测通过</msg>
</logentry>
<logentry
   revision="241865">
<author>hyq</author>
<date>2015-10-30T09:51:44.347551Z</date>
<msg>reviewid 13673
reviewed by: chenlei
Bug ID：32783
改动说明：
td32783:[模板优化]仅非主控能访问的共享存储的模板，部署vm到同存储，模板基镜像丢失。【beta改】</msg>
</logentry>
<logentry
   revision="241854">
<author>chenlei</author>
<date>2015-10-30T09:25:41.588467Z</date>
<msg>reviewid:13666
review by:hyq
bugid: 32598
现象：
[模板优化]解决aDesk版本派生虚拟机，获取模版部署的UPID时，
exitstatus返回unexpected status的问题
改动说明：
采用$rpcenv-&gt;fork_worker的方式启动回拷镜像的子进程，而不是直接调用fork

测试：
自测通过</msg>
</logentry>
<logentry
   revision="241830">
<author>zhangxin</author>
<date>2015-10-30T07:50:44.767458Z</date>
<msg>noreview
32618 虚拟机备份自动生成的名称无效【必改】【beta改】
32562 【历史遗留，合入VMP4.6】当aSV插上VMP的key时，页面可以显示出来说“非aSV的key”</msg>
</logentry>
<logentry
   revision="241824">
<author>fxw</author>
<date>2015-10-30T07:35:25.789420Z</date>
<msg>noreview  格式化代码</msg>
</logentry>
<logentry
   revision="241809">
<author>yangwei</author>
<date>2015-10-30T06:57:13.521731Z</date>
<msg>reviewid 13302
reviewed by gwl
BUG ID: 32436
问题分析： [32436]发现系统中出现两个以上的key，告警
改动说明： 
1、主控检查各个主机key数量
2、超过1个key立即告警。
测试：集群中插入多个key，测试ok。



</msg>
</logentry>
<logentry
   revision="241807">
<author>fxw</author>
<date>2015-10-30T06:47:23.667777Z</date>
<msg>noreview
格式化代码</msg>
</logentry>
<logentry
   revision="241736">
<author>lcy</author>
<date>2015-10-29T12:00:40.020320Z</date>
<msg>reviewid:13636
review by hyq
TD:32025
现象：优先拉起VDC虚拟机（虚拟机重要性应该有顺序）
改动说明：
HA功能的时候，对虚拟机进行排序。具体的启动顺序如下：
VDC(默认是重要虚拟机)
重要虚拟机
普通的虚拟机
测试：
自测通过</msg>
</logentry>
<logentry
   revision="241717">
<author>hyq</author>
<date>2015-10-29T11:13:14.796278Z</date>
<msg>reviewid 13633
reviewed by: gwl
Bug ID：32789
改动说明：
[模板优化]以“更新指定备份内容到其它虚拟机”这种方式更新模板，没有删除之前的更新快照</msg>
</logentry>
<logentry
   revision="241665">
<author>chenlei</author>
<date>2015-10-29T06:33:51.274080Z</date>
<msg>reviewid:13621
review by:hyq
bugid: 32742
改动说明：
[模板优化]将模板部署的取消开关关闭

测试：
自测通过</msg>
</logentry>
<logentry
   revision="241614">
<author>hyq</author>
<date>2015-10-28T12:52:38.382485Z</date>
<msg>reviewid 13611
reviewed by: gwl
Bug ID：32687
改动说明：
第二次更新为全拷贝
</msg>
</logentry>
<logentry
   revision="241612">
<author>gwl</author>
<date>2015-10-28T12:44:39.809600Z</date>
<msg>reviewid: 13610
Reviewed by：hyq
BUGID: 
问题分析：正则不对
自测可行</msg>
</logentry>
<logentry
   revision="241598">
<author>gwl</author>
<date>2015-10-28T12:13:19.521706Z</date>
<msg>reviewid: 13609
Reviewed by：fxw
BUGID: 
问题分析：配合ssl，修改批量派生虚拟机的接口，在vmp后台查询所有task，返回
自测可行</msg>
</logentry>
<logentry
   revision="241594">
<author>lcy</author>
<date>2015-10-28T11:47:18.029338Z</date>
<msg>reviewid:13607
review by fxw
TD:32575
现象：自动化测试】更新模板失败---提示:存储（虚拟存储(二副本卷)）剩余空间不足！【疑难】
改动说明：
在虚拟存储获取大小容量的时候，假如第一次在2秒超时时间内没有获取到，再次尝试一次获取，超时时间为5秒
测试：
自测通过</msg>
</logentry>
<logentry
   revision="241563">
<author>chenlei</author>
<date>2015-10-28T09:42:55.185791Z</date>
<msg>reviewid:13603
review by:hyq
bugid: 32758
改动说明：
[计划更新]解决计划更新误报时间格式错误的问题

测试：
自测通过</msg>
</logentry>
<logentry
   revision="241551">
<author>yangwei</author>
<date>2015-10-28T08:54:58.868778Z</date>
<msg>reviewid 13599
reviewed by chengtao
BUG ID: 32299
问题分析： 升级空间不足导致的错误，报错不正确。
改动说明： 桌面虚拟化升级VMP一直就报错无法校验升级包。核对了升级包是没有问题的，但是就是无法升级。原因：这个是上传包成功了，解压包的时候存储空间不够了。
增大升级前的磁盘检查空间。

</msg>
</logentry>
<logentry
   revision="241544">
<author>lcy</author>
<date>2015-10-28T07:55:32.963437Z</date>
<msg>reviewid:13579
review by fxw
TD:32753
现象：往my_die函数添加调试日志，方便查找问题来源
改动说明：
往my_die函数添加调试日志，方便查找问题来源
测试：
自测通过</msg>
</logentry>
<logentry
   revision="241543">
<author>yangwei</author>
<date>2015-10-28T07:51:18.962077Z</date>
<msg>reviewid 13595
reviewed by gwl
BUG ID: 32721
问题分析： 虚拟存储掉线，新建虚拟机引发虚拟存储脑裂
改动说明： 新建虚拟机，检查vmname时候优先选择本机作为存储访问节点
测试：vs测试曾汝佳验证ok
</msg>
</logentry>
<logentry
   revision="241509">
<author>hyq</author>
<date>2015-10-28T03:32:32.898237Z</date>
<msg>reviewid 13580
reviewed by: gwl
Bug ID：32686
改动说明：
更新进度卡住在43%

</msg>
</logentry>
<logentry
   revision="241484">
<author>hyq</author>
<date>2015-10-27T14:11:46.379205Z</date>
<msg>reviewid 13570
reviewed by: fxw
Bug ID：32711
改动说明：
[模板优化]子节点本地存储的模板更新到只有主节点可访问的共享存储失败。【beta改】

</msg>
</logentry>
<logentry
   revision="241480">
<author>gwl</author>
<date>2015-10-27T13:37:30.909186Z</date>
<msg>reviewid: 13568
Reviewed by：fxw
BUGID: 
问题分析：为status方式查询upid获取usermsg的修改，频繁打日志
自测可行</msg>
</logentry>
<logentry
   revision="241477">
<author>gwl</author>
<date>2015-10-27T13:21:33.519400Z</date>
<msg>reviewid: 13567
Reviewed by：fxw
BUGID: 
问题分析：批量派生虚拟机，增加已经处理的虚拟机个数 字段
自测可行</msg>
</logentry>
<logentry
   revision="241473">
<author>gwl</author>
<date>2015-10-27T13:11:27.614951Z</date>
<msg>reviewid: 13565
Reviewed by：fxw
BUGID: 32696
问题分析：vma导出，路径不匹配
自测可行


</msg>
</logentry>
<logentry
   revision="241455">
<author>chenlei</author>
<date>2015-10-27T12:13:06.367834Z</date>
<msg>reviewid:13554
review by:hyq
bugid: 32689

改动说明：
[模板优化]解决取消更新失败，仍继续更新的问题

测试：
自测通过</msg>
</logentry>
<logentry
   revision="241453">
<author>lcy</author>
<date>2015-10-27T11:52:32.721156Z</date>
<msg>reviewid:13553
review by:hyq
TD: 32675
现象：TD32675,[模板优化]更新模板失败，报错不存在主机，如附件【beta改】
改动说明：
实际上的错误，是存储空间不足引起的。在代码的实现中，中途已经发现了存储空间不足，并且已经my_die出来了，但是在外层捕获到错误之后，没有立即输出到前台日志中，而是执行一段出错回滚的代码，在这段代码中因为前面的my_die，很多变量没有赋值，导致连发引起其他错误，最终引起最原始的错误信息被覆盖。
改动方法：保留最原始的my_die信息，并且加上捕获回滚更新模板的代码的错误信息。及时把原始的错误信息反馈到前台。
测试：
自测通过</msg>
</logentry>
<logentry
   revision="241444">
<author>hyq</author>
<date>2015-10-27T11:26:47.279457Z</date>
<msg>reviewid 13552
reviewed by: fxw
Bug ID：32640
改动说明：
更新模板-模板虚拟机关闭电源改为关机


</msg>
</logentry>
<logentry
   revision="241404">
<author>yangwei</author>
<date>2015-10-27T07:06:12.226472Z</date>
<msg>reviewid 13534
Reviewed by: gwl
BUG ID: 32661
问题分析： 【TD32661】拔掉key的企业版剩余时间按照没有key的时间计算
改动说明： 没插key的企业版返回没插key剩余天数增加个判断，小于0则返回0
测试：测试ok。
</msg>
</logentry>
<logentry
   revision="241395">
<author>yangwei</author>
<date>2015-10-27T04:00:35.456046Z</date>
<msg>reviewid 13530
Reviewed by: fxw
BUG ID: 32661
问题分析： 【TD32661】拔掉key的企业版剩余时间按照没有key的时间计算
改动说明： 企业版，拔掉key剩余时间为30-nk_ut。
测试：企业版，拔掉key，剩余时间显示ok。测试ok。
</msg>
</logentry>
<logentry
   revision="241378">
<author>hyq</author>
<date>2015-10-27T02:54:38.676267Z</date>
<msg>reviewid 13525
reviewed by: fxw
改动说明：
修改差异文件名称（加上qcow2后缀,VS存储会对含有qcow2子字符串的文件做特殊处理）



</msg>
</logentry>
<logentry
   revision="241371">
<author>yangwei</author>
<date>2015-10-27T02:28:18.658781Z</date>
<msg>reviewid 13522
Reviewed by: fxw
BUG ID: 
问题分析： 重新编译了下vtsn
改动说明： gwl和yw昨天更新代码分开上库了，合起来重新编译上库
</msg>
</logentry>
<logentry
   revision="241369">
<author>fxw</author>
<date>2015-10-27T02:23:31.972946Z</date>
<msg>noreview
合入社区patch，解决虚拟机卡死的问题
http://www.lupaworld.com/article-252795-1.html</msg>
</logentry>
<logentry
   revision="241368">
<author>fxw</author>
<date>2015-10-27T02:22:08.529551Z</date>
<msg>noreview
上库内核代码原始文件，等下准备合入社区patch</msg>
</logentry>
<logentry
   revision="241339">
<author>chenlei</author>
<date>2015-10-26T13:03:19.847986Z</date>
<msg>reviewid:13509
review by:fxw
bugid: 32637

改动说明：
解决后台kill -9虚拟机进程，发现没有被拉起的问题

测试：
自测通过</msg>
</logentry>
<logentry
   revision="241338">
<author>gwl</author>
<date>2015-10-26T12:53:37.420161Z</date>
<msg>reviewid: 13508
Reviewed by：fxw
BUGID:32562
问题分析：key不兼容时，前台提示
自测可行
</msg>
</logentry>
<logentry
   revision="241330">
<author>gwl</author>
<date>2015-10-26T12:28:27.808260Z</date>
<msg>reviewid: 13506
Reviewed by：fxw
BUGID: 32562
问题分析：key不兼容时，前台提示
自测可行
</msg>
</logentry>
<logentry
   revision="241317">
<author>yangwei</author>
<date>2015-10-26T11:12:34.366118Z</date>
<msg>reviewid 13499
Reviewed by: gwl
BUG ID: 32971
问题分析： 更换序列号激活vmp，ut清0
改动说明： 序列号工具。更换序列号激活vmp，ut清0
</msg>
</logentry>
<logentry
   revision="241306">
<author>chenlei</author>
<date>2015-10-26T09:23:41.302930Z</date>
<msg>reviewid:13496
review by:fxw
bugid: 32621

改动说明：
解决修复的cp进程被kill掉、cp或者mv操作失败，修复操作日志仍然显示完成，
但是虚拟机还是无法使的问题

测试：
自测通过</msg>
</logentry>
<logentry
   revision="241303">
<author>gwl</author>
<date>2015-10-26T09:17:28.774467Z</date>
<msg>Merged revision(s) 238468 from VTP/aSV4.2/Alternate/src/app/vtp-cluster/corosync-1.4.6/exec:
reviewid : 13494
Reviewed by：jyz
BUG ID：31866
问题分析:
TD TD 31866，corosync进程占7.6G，存在内存泄露[L必须解决][Jbeta]
改动说明:
1.corosync的消息节点分配释放流程assembly_ref()与assembly_deref()存在问题，在网络异常情况下会导致消息节点堆积。
2.assembly_ref()中分配一个内存节点，会根据totempg_waiting_transack全局变量来保存到一个inuse队列。assembly_deref()释放内存节点时，也是根据totempg_waiting_transack全局变量来选择保存到一个free队列。而totempg_waiting_transack值是不断变化的，这样就会导致消息节点分配与释放位置不匹配，最后导致内存节点一直堆积。
........
</msg>
</logentry>
<logentry
   revision="241292">
<author>fxw</author>
<date>2015-10-26T08:39:17.008527Z</date>
<msg>noreview
删除4.5的文档</msg>
</logentry>
<logentry
   revision="241291">
<author>fxw</author>
<date>2015-10-26T08:38:10.858991Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="241289">
<author>hyq</author>
<date>2015-10-26T08:30:49.670265Z</date>
<msg>reviewid 13492
reviewed by: gwl
Bug ID : 32640
改动说明：
只有挂起状态不能更新


</msg>
</logentry>
<logentry
   revision="241277">
<author>chenlei</author>
<date>2015-10-26T07:35:32.672971Z</date>
<msg>reviewid:13484
review by:hyq
bugid: 32650
现象：null

改动说明：
解决模板修复前台操作日志显示误报的问题

测试：
自测通过</msg>
</logentry>
<logentry
   revision="241274">
<author>lcy</author>
<date>2015-10-26T07:23:37.371341Z</date>
<msg>reviewid:13487
review by:lrx
TD: 32312
现象：TD32312,登录主页，弹出的提示修改IP的对话框报错【beta改】
改动说明：js修改一下调用的接口。从/nodes/hostname/network/interfaces/ethxxx 改成 /nodes/hostname/interfaces/ethxxx
测试：
打包验证</msg>
</logentry>
<logentry
   revision="241249">
<author>zhangxin</author>
<date>2015-10-26T02:16:19.064544Z</date>
<msg>noreview
32640 [模板优化]开机状态的模板需要能够立即更新和计划更新。[UI需放开限制]</msg>
</logentry>
<logentry
   revision="241245">
<author>gwl</author>
<date>2015-10-26T01:29:57.081539Z</date>
<msg>reviewid: 13467
Reviewed by：fxw
BUGID:
问题分析：vdc批量创建虚拟机接口修改
先上库，打包后，如果ssl有要求变更，配合修改即可。
自测可行</msg>
</logentry>
<logentry
   revision="241240">
<author>hyq</author>
<date>2015-10-26T00:54:49.329502Z</date>
<msg>reviewid 13470
reviewed by: gwl
改动说明：
逻辑反了



</msg>
</logentry>
<logentry
   revision="241224">
<author>hyq</author>
<date>2015-10-24T11:00:33.110928Z</date>
<msg>reviewid 13444
reviewed by: gwl
改动说明：
1、获取虚拟机电源状态函数，2，异地部署打更新快照1错误。



</msg>
</logentry>
<logentry
   revision="241212">
<author>chenlei</author>
<date>2015-10-24T09:59:37.958822Z</date>
<msg>reviewid:13454
review by:fxw
bugid: 32631 
现象：null

改动说明：
1. 处理模板更新die掉后，计划任务仍报成功的问题；
2. 修改模板计划更新前台操作日志显示；
3. 挂起状态的模板虚拟机执行计划更新任务时，单独报错。

测试：
自测通过</msg>
</logentry>
<logentry
   revision="241152">
<author>hyq</author>
<date>2015-10-23T13:34:04.210122Z</date>
<msg>reviewid 13430
reviewed by: fxw
改动说明：模板快速更新代码



</msg>
</logentry>
<logentry
   revision="241119">
<author>zhangxin</author>
<date>2015-10-23T09:18:21.628113Z</date>
<msg>reviewid 13419

32371 【UI】【体验性】-配置完虚拟存储，页面不会自动刷新。【10.19】【已定位】
</msg>
</logentry>
<logentry
   revision="241110">
<author>zhangxin</author>
<date>2015-10-23T07:51:31.338317Z</date>
<msg>noreview
31427 【批量操作添加磁盘】开机状态 确定添加磁盘的时候未及时提示不能进行操作【延后处理】</msg>
</logentry>
<logentry
   revision="241075">
<author>zhangxin</author>
<date>2015-10-23T02:55:32.062739Z</date>
<msg>noreview
32514 编辑、部署的双屏选项 要对VDC失效</msg>
</logentry>
<logentry
   revision="241073">
<author>lcy</author>
<date>2015-10-23T02:52:24.644839Z</date>
<msg>reviewid:13402
review by:xhz
TD: 32561
现象：TTD32561,【历史遗留，合入VMP4.6】[合入3.7][导入导出虚拟机]虚拟机编辑名称后导出文件下载不了
改动说明：合入aSV4.2的BUG.TD31948.
测试：
打包验证</msg>
</logentry>
<logentry
   revision="241071">
<author>lcy</author>
<date>2015-10-23T02:32:59.998647Z</date>
<msg>reviewid:13400
review by:lzl
TD: 32564
现象：TD32564,【历史遗留，合入VMP4.6】【技术支持】【上海宜科信息技术有限公司----朱工QQ27757013】【aSV3.7.01】【可以close】导入ova后新建虚拟机失败了，见附件
改动说明：合入aSV4.2.TD32022
测试：
打包验证</msg>
</logentry>
<logentry
   revision="241070">
<author>gwl</author>
<date>2015-10-23T02:30:29.814495Z</date>
<msg>reviewid: 13401
Reviewed by：fxw
BUGID:32544
问题分析：添加用户，编辑用户，输入描述字符串超过限制，点击确定。提示不正确：“信息：最多只允许输入 90 个字符”
实际应该是：“用户描述最长为90个字符”

从4.2合入：svn 237947</msg>
</logentry>
<logentry
   revision="241038">
<author>gwl</author>
<date>2015-10-22T14:35:12.450979Z</date>
<msg>reviewid: 13395
Reviewed by：fxw
BUGID:32543
问题分析：前台页面，显示VMP版本号，合入4.2修改，并根据4.6页面，调整了像素宽度</msg>
</logentry>
<logentry
   revision="241019">
<author>lcy</author>
<date>2015-10-22T13:32:18.153324Z</date>
<msg>reviewid:13390
review by:wcx
TD: 32552
现象：【历史遗留，合入VMP4.6】【asv4.2】磁盘空间被使用了接近100%，但详情页面显示为96%
改动说明：
合入aSV4.2的BUG，TD为31785
测试：
自测通过</msg>
</logentry>
<logentry
   revision="241003">
<author>zhangxin</author>
<date>2015-10-22T12:26:16.798154Z</date>
<msg>noreview
1.取消模板更新计划、修复模板图标
2.模板更新计划弹窗，默认时间有时不是系统时间+1 问题
3.修复模板菜单功能</msg>
</logentry>
<logentry
   revision="240989">
<author>gwl</author>
<date>2015-10-22T12:08:25.260914Z</date>
<msg>reviewid: 13384
Reviewed by：fxw
BUGID:32542
问题分析：上传模板到共享存储失败，保存目的存储不可写，实际上可写[asv4.2][Lbeta]
合入</msg>
</logentry>
<logentry
   revision="240970">
<author>fxw</author>
<date>2015-10-22T10:12:23.898239Z</date>
<msg>noreview
代码合漏了，补上</msg>
</logentry>
<logentry
   revision="240968">
<author>yangwei</author>
<date>2015-10-22T09:57:22.577697Z</date>
<msg>reviewid 13365
Reviewed by: gwl
BUG ID: 32514
问题分析：双屏编辑对vdc失效
改动说明：
编辑、批量编辑和新建对vdc进行双屏支持过滤
测试：测试ok</msg>
</logentry>
<logentry
   revision="240957">
<author>gwl</author>
<date>2015-10-22T09:29:20.757029Z</date>
<msg>reviewid: 13368
Reviewed by：fxw
BUGID:32529
问题分析：切换主控导致日志丢失</msg>
</logentry>
<logentry
   revision="240955">
<author>fxw</author>
<date>2015-10-22T09:20:26.122376Z</date>
<msg>reviewid 13371
Reviewed by: lzl
BUG ID: 32560
改动说明：
合入TD31930
内存超配，虚拟重启失败
测试：
重启HA虚拟机成功</msg>
</logentry>
<logentry
   revision="240930">
<author>fxw</author>
<date>2015-10-22T08:07:35.212555Z</date>
<msg>reviewid 13366
Reviewed by: lifan
BUG ID: 32565
改动说明：
合入TD32071
vs环境，主控断电后自动切换主控，再恢复断电主机会导致/cfs目录下丢虚拟机配置
测试：
无</msg>
</logentry>
<logentry
   revision="240916">
<author>fxw</author>
<date>2015-10-22T07:07:25.679445Z</date>
<msg>noreview
SSL修改的技术支持问题
TD在网上问题，TD17883
客户有外设加密狗，插上adesk可以映射成功，但是插上就装不上驱动，拔掉能装。装好再插上也无法使用，软件卡死。</msg>
</logentry>
<logentry
   revision="240913">
<author>fxw</author>
<date>2015-10-22T06:58:12.078992Z</date>
<msg>reviewid 13356
Reviewed by: lzl
BUG ID: 32559
改动说明：
合入TD31894
修改HA拉起失败的提示
测试：
无</msg>
</logentry>
<logentry
   revision="240907">
<author>fxw</author>
<date>2015-10-22T06:19:07.318500Z</date>
<msg>noreview
合入31973，修改出错提示</msg>
</logentry>
<logentry
   revision="240903">
<author>chenlei</author>
<date>2015-10-22T04:42:11.018824Z</date>
<msg>reviewid:13348
review by:fxw
TD: null 
现象：null

改动说明：
模板计划更新，修改前台UI日志显示问题

测试：
自测通过</msg>
</logentry>
<logentry
   revision="240902">
<author>fxw</author>
<date>2015-10-22T04:00:06.415727Z</date>
<msg>reviewid 13352
Reviewed by: wyy
BUG ID: 32554
改动说明：
合入TD31805
存储中断，HA虚拟机没有迁移
测试：
无</msg>
</logentry>
<logentry
   revision="240895">
<author>fxw</author>
<date>2015-10-22T03:31:41.895536Z</date>
<msg>reviewid 13347
Reviewed by: lsh
BUG ID: 32549
改动说明：
合入TD31567
虚拟存储路径不能有?，限制虚拟机取名带？
测试：
无</msg>
</logentry>
<logentry
   revision="240892">
<author>fxw</author>
<date>2015-10-22T03:04:52.671295Z</date>
<msg>reviewid 13344
Reviewed by: lrx
BUG ID: 32548
改动说明：
合入TD32548
新建虚拟机、模板部署虚拟机时，驱动器达到4个报错时，提示安装vmtools
测试：
无</msg>
</logentry>
<logentry
   revision="240877">
<author>hyq</author>
<date>2015-10-22T00:57:28.821926Z</date>
<msg>reviewid 13310
reviewed by: fxw
Bug ID：32111
改动说明：增加修复的api



</msg>
</logentry>
<logentry
   revision="240774">
<author>gwl</author>
<date>2015-10-21T07:50:34.038716Z</date>
<msg>reviewid: 13320
Reviewed by：fxw
BUGID:32520
问题分析：修改vs序列号检查的未知，打印操作日志</msg>
</logentry>
<logentry
   revision="240744">
<author>chenlei</author>
<date>2015-10-21T06:26:44.798530Z</date>
<msg>reviewid:13314
review by:fxw
TD: null 
现象：null

改动说明：
修改grub.cfg，VMP4.6beta版将crashkernel打开

测试：
自测通过</msg>
</logentry>
<logentry
   revision="240741">
<author>fxw</author>
<date>2015-10-21T06:21:35.082360Z</date>
<msg>noreview
代码已更新，更新so库</msg>
</logentry>
<logentry
   revision="240733">
<author>ssl</author>
<date>2015-10-21T05:15:06.682023Z</date>
<msg>noreview 肖俊修改：
【修改原因】解决VDI4.7 X86盒子开启MD压缩后不正常工作的问题。
【如何修改】MD压缩处理后，重新分配消息空间（包括消息头），非mini_header要记录旧头部的serial和sub_list值，并且填入新分配的头部。之前只有安卓盒子使用这一流程，但是安卓使用的是SpiceMiniDataHeader，所以一直没有出现问题。</msg>
</logentry>
<logentry
   revision="240725">
<author>gwl</author>
<date>2015-10-21T04:39:32.639331Z</date>
<msg>reviewid: 13307
Reviewed by：fxw
BUGID:32072
问题分析："查看更多历史告警"，没有标记已读
合入4.2代码，做了一点点润色</msg>
</logentry>
<logentry
   revision="240723">
<author>zhangxin</author>
<date>2015-10-21T03:56:49.207883Z</date>
<msg>noreview
更新模板窗口、删除计划时 添加提示窗口</msg>
</logentry>
<logentry
   revision="240721">
<author>chenlei</author>
<date>2015-10-21T03:55:57.580077Z</date>
<msg>reviewid:13311
review by:gwl
TD: null 
现象：null

改动说明：
解决模板计划更新前台操作日志操作人为空的问题

测试：
自测通过</msg>
</logentry>
<logentry
   revision="240681">
<author>chenlei</author>
<date>2015-10-20T14:35:17.736166Z</date>
<msg>reviewid:13241
review by:gwl
TD: null 
现象：
【VMP4.6需求】模板更新——计划更新后台代码

改动说明：
1. 创建或者删除模板更新计划任务即创建或删除相应的配置文件，
（配置文件路径位于/cfs/.tpl_update_plans/下，以相应的模板id为文件名）。
2. 设计了一个定时脚本，每5分钟去扫描一次/cfs/.tpl_update_plans/目录下的
配置文件，如果有计划时间到了的模板更新计划则首先删除对应的配置文件，
然后才去执行模板更新操作。

做了哪些测试：
1.测试了创建删除计划更新任务，正常
2.测试了定时脚本在配置文件正常、为空、被损坏等情况下的执行情况，
异常都能正确处理。</msg>
</logentry>
<logentry
   revision="240675">
<author>lcy</author>
<date>2015-10-20T14:02:47.843299Z</date>
<msg>reviewid:13299
review by:gwl
TD: 32335
现象：TD32229,adesk版vmp设置集群通信口，卡主了，实际应该已经成功
改动说明：当在从节点上更换集群通信口的时候，做一下规避方法，先打log，再去更新，防止从节点更新处于离线的状态，主控得不到日志的完成状态。
测试：
自测通过</msg>
</logentry>
<logentry
   revision="240650">
<author>qifei</author>
<date>2015-10-20T12:33:06.657110Z</date>
<msg>reviewid 13285
TD 32432
克隆vdc派生虚拟机的时候，去掉cpuid，否则克隆后的虚拟机ip无法修改</msg>
</logentry>
<logentry
   revision="240644">
<author>gwl</author>
<date>2015-10-20T12:03:41.866712Z</date>
<msg>reviewid: 13290
Reviewed by：fxw
BUGID:32501
问题分析：编辑虚拟交换机的API，少考虑了iface为undef的情况，系改动引发</msg>
</logentry>
<logentry
   revision="240641">
<author>zhangxin</author>
<date>2015-10-20T11:49:32.594915Z</date>
<msg>noreview
模板支持配置更新时间、取消更新任务操作
</msg>
</logentry>
<logentry
   revision="240627">
<author>fxw</author>
<date>2015-10-20T11:10:36.001674Z</date>
<msg>noreview
更改打包Makefile，支持UPDATE环境变量</msg>
</logentry>
<logentry
   revision="240618">
<author>yangwei</author>
<date>2015-10-20T09:41:39.134860Z</date>
<msg>reviewid 13273
Reviewed by: gwl
BUG ID: 32473
问题分析：【bug跟踪】序列号工具修改问题集合
改动说明：
当key在从节点注册失败时，应该返回从节点记录的错误id到主控。
测试：代码测试可以取回其他节点的文件。测试ok。</msg>
</logentry>
<logentry
   revision="240612">
<author>lcy</author>
<date>2015-10-20T09:18:06.971505Z</date>
<msg>reviewid:13278
review by:lifan
TD: 32335
现象：需合入文件系统参数的修改
改动说明：合入4.2的文件系统的修改，修改ext4文件系统增加nodelalloc选项，防止重启文件丢失
测试：
打包验证
</msg>
</logentry>
<logentry
   revision="240566">
<author>yangwei</author>
<date>2015-10-20T06:48:32.682404Z</date>
<msg>reviewid 13270
Reviewed by: gwl
BUG ID: 32473
问题分析：【bug跟踪】序列号工具修改问题集合
改动说明：
1、合入4.2libusb插拔响应usb key事件
2、在检查其他节点是否插入key时，检查host是否能够ping通，作为一个检查条件。
3、修复其他代码走读小问题。
测试：测试ok。</msg>
</logentry>
<logentry
   revision="240541">
<author>gwl</author>
<date>2015-10-20T03:45:58.906940Z</date>
<msg>reviewid: 13259
Reviewed by：fxw
BUGID:32456

①和普通网口名称重复，会导致聚合网口状态被普通网口覆盖。
②编辑虚拟机交换机的错误提示显示的是sf_bond，而不是聚合网口的名称。
③有几个api：
vtpsh get /nodes/{node}/status
vtpsh get /nodes/{node}/interfaces
vtpsh get /nodes/{node}/console_iface_list

和ssl初步确认，管理页面不会用这几个API，其VDC服务端用了status，但确认，没有影响</msg>
</logentry>
<logentry
   revision="240540">
<author>yangwei</author>
<date>2015-10-20T03:43:36.683830Z</date>
<msg>reviewid 13264
Reviewed by: gwl
BUG ID: 
问题分析：修改perl语法错误
改动说明：操作符优先级问题</msg>
</logentry>
<logentry
   revision="240519">
<author>fxw</author>
<date>2015-10-20T02:26:02.427944Z</date>
<msg>reviewid 13255
Reviewed by: zhangxin
BUG ID: 30959
改动说明：
原来屏蔽的系统有些会用在共享桌面和远程应用
测试：
无</msg>
</logentry>
<logentry
   revision="240516">
<author>hyq</author>
<date>2015-10-20T02:15:17.915337Z</date>
<msg>Merged revision(s) 240255-240280 from Personal/hyq/vmp4.6/Trunk/source/app:
模板第一次部署在模板虚拟机原存储：
1、先把模板虚拟机镜像mv到原存储template目录
2、镜像往回拷的过程中给模板虚拟机加个锁 locked

........
QemuDerive.pm:
1、修改锁住时的提示
2、模板第一次本地原存储派生创建一个单独的函数（不需要抛异常）
3、备份的时候检查锁
........
模板虚拟机导出、克隆、迁移操作加上镜像检查
........
reviewid : 13254
reviewed by: gwl,fxw,chenlei






</msg>
</logentry>
<logentry
   revision="240467">
<author>gwl</author>
<date>2015-10-19T12:57:20.961646Z</date>
<msg>reviewid: 13239
Reviewed by：fxw
BUGID:30620
问题分析：网口速率低于100Mb/s告警
直接判断网口速率，低于或等于100M则告警，不论网口最大速率是否超过100M
自测通过，目测无逻辑bug</msg>
</logentry>
<logentry
   revision="240433">
<author>lcy</author>
<date>2015-10-19T11:02:27.671186Z</date>
<msg>reviewid:13237
review by:fxw
TD: 32043
现象：TD32160,【密码修改】【体验性】修改vmp密码为admin123成功，修改为admin1234提示密码强度太低
改动说明：
在后台的弱密码库上加上admin123
测试：
自测通过</msg>
</logentry>
<logentry
   revision="240362">
<author>yangwei</author>
<date>2015-10-19T04:21:11.168837Z</date>
<msg>reviewid 13217
Reviewed by: gwl
BUG ID: 32433
问题分析：虚拟机编辑添加双屏支持
改动说明：
新增虚拟机双屏支持功能。
测试：
1、新建、编辑虚拟机，在高级页面有勾选框支持选择是否启用双屏显示。测试ok
2、编辑虚拟机，在高级页面的启用双屏显示和配置文件的状态一致。测试ok
3、非关机状态不允许修改双屏支持选项。测试ok
4、批量编辑虚拟机有修改双屏支持选项，且开机状态下的虚拟机修改该选项失败。测试ok</msg>
</logentry>
<logentry
   revision="240328">
<author>yangwei</author>
<date>2015-10-19T02:10:34.804633Z</date>
<msg>reviewid 13220
reviewed by: zx
BUG ID: 32433
问题分析：虚拟机编辑添加双屏支持
改动说明：开机状态虚拟机不允许编辑该项。
测试：测试ok</msg>
</logentry>
<logentry
   revision="240324">
<author>yangwei</author>
<date>2015-10-19T01:58:47.483523Z</date>
<msg>reviewid 13210
reviewid 13210
reviewed by: zx
BUG ID: 32433
问题分析：虚拟机编辑添加双屏支持
改动说明：添加双屏支持UI
测试：测试ok
</msg>
</logentry>
<logentry
   revision="240216">
<author>yangwei</author>
<date>2015-10-17T06:55:12.588432Z</date>
<msg>reviewid 13192
bug id: 30959
reviewed by: zx
问题分析：【新需求】【体验性】VMP新建独享桌面不支持的操作系统不要显示[vdi]-
测试：测试ok</msg>
</logentry>
<logentry
   revision="240214">
<author>fxw</author>
<date>2015-10-17T06:39:40.308839Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="240209">
<author>yangwei</author>
<date>2015-10-17T06:24:39.089581Z</date>
<msg>reviewid 13186
Reviewed by: hyq
BUG ID: 32378
问题分析：更换主机失败
改动说明：
VMP标准版，虚拟化平台主机上限2台，集群中已有两台主机，选择其中一台，更换主机，失败.
忽略替换主机的host数量检查错误。
测试：
集群2台主机，标准版，配置vs，从节点离线。更换主机成功。测试ok。</msg>
</logentry>
<logentry
   revision="240203">
<author>yangwei</author>
<date>2015-10-17T04:43:16.813203Z</date>
<msg>reviewid 13148

32222 adesk备份策略里面，按天备份，指定了备份时间，但要过指定时间半个小时才能备份【体验性】
</msg>
</logentry>
<logentry
   revision="240069">
<author>yangwei</author>
<date>2015-10-16T06:24:29.289192Z</date>
<msg>reviewid 13144
Reviewed by: hyq
BUG ID: 32215
问题分析：【TD32215】【老功能】主机详情最大内存显示不对
改动说明：
计算可用内存时，剔除原始占用内存，可能导致可用内存为负数。加一个判断条件
测试：
dd大文件到根目录，模拟100%内存使用率。内存剩余显示为0，比例为1.00，显示正确。测试ok。</msg>
</logentry>
<logentry
   revision="240028">
<author>hyq</author>
<date>2015-10-15T14:02:11.065305Z</date>
<msg>reviewid 13131
reviewed by: gwl
Bug ID：32111
原因：qemu-server 下的目录被删除后创建vdc集群虚拟机时不会自动创建
改动说明：
td32111:新建VDC虚拟机到虚拟机存储失败，报错如附件--非必现【需要重现】




</msg>
</logentry>
<logentry
   revision="239914">
<author>fxw</author>
<date>2015-10-15T07:13:42.461433Z</date>
<msg>noreview
合入至VMP4.5正式发布的代码</msg>
</logentry>
<logentry
   revision="239892">
<author>yangwei</author>
<date>2015-10-15T04:52:21.473412Z</date>
<msg>reviewid 13110
Reviewed by: gwl
BUG ID: 31340
问题分析：【内部反馈】序列号设置问题,失败了，老是要进后台看退出码。能否不进入后台看啊，在前台页面显示吧
改动说明：
将飞天key的读写失败的错误，进行详细描述
测试：
1、有key状态能够读写成功；测试ok。
2、无key状态，在后台执行/usr/bin/vtpsh set /cluster/sn -sn XXXXX-......，报错信息为“序列号读写操作失败：没有找到任何的Rockey-ARM”，证明编码是生效的。测试ok</msg>
</logentry>
<logentry
   revision="239868">
<author>gwl</author>
<date>2015-10-15T01:53:28.272942Z</date>
<msg>reviewid: 13060
Reviewed by：fxw
BUGID:
问题分析：启用虚拟机休眠
测试了win7-x86, win7-x64, xp-x86 ，xp尚未成功使用休眠，原因待查</msg>
</logentry>
<logentry
   revision="239835">
<author>yangwei</author>
<date>2015-10-14T10:55:36.826447Z</date>
<msg>reviewid 13090
Reviewed by: hyq
BUG ID: 32217
问题分析：恢复出厂设置修改密码
改动说明：
重新给15天的默认密码使用，不需要改密码
测试：测试通过</msg>
</logentry>
<logentry
   revision="239804">
<author>yangwei</author>
<date>2015-10-14T07:23:58.554161Z</date>
<msg>reviewid 13074
Reviewed by: hyq
BUG ID: 
问题分析：修改【svn239739】错误
改动说明：
修改语法错误</msg>
</logentry>
<logentry
   revision="239801">
<author>yangwei</author>
<date>2015-10-14T06:58:47.860819Z</date>
<msg>reviewid 13070
Reviewed by: hyq
BUG ID: 32252
问题分析：飞天key授权用户显示
改动说明：
飞天key带授权用户名，但序列号页面授权用户名时有时无
测试：每隔5s检查一次用户名，持续10分钟。测试通过。</msg>
</logentry>
<logentry
   revision="239786">
<author>yangwei</author>
<date>2015-10-14T06:11:24.423228Z</date>
<msg>reviewid 13067
Reviewed by: xhz
BUG ID: 32304
问题分析：合入TD32233--开机备份失败后，虚拟机变成paused状态。
改动说明：
开机备份失败后，虚拟机变成paused状态。
</msg>
</logentry>
<logentry
   revision="239739">
<author>fxw</author>
<date>2015-10-13T12:51:28.814157Z</date>
<msg>noreview
qemu加入双显卡参数，支持双屏</msg>
</logentry>
<logentry
   revision="239720">
<author>fxw</author>
<date>2015-10-13T11:22:33.229206Z</date>
<msg>noreview
合入VMP4.5至239650</msg>
</logentry>
<logentry
   revision="239716">
<author>chenlei</author>
<date>2015-10-13T10:04:41.942864Z</date>
<msg>reviewid:13040
review by:fxw
TD: null 
现象：
付帅兵更新的libredirect2.so文件及MD5值</msg>
</logentry>
<logentry
   revision="239710">
<author>chenlei</author>
<date>2015-10-13T09:51:44.335868Z</date>
<msg>reviewid:13032
review by:fxw
TD: null 
现象：
更新初次搭建打包环境脚本</msg>
</logentry>
<logentry
   revision="239639">
<author>chenlei</author>
<date>2015-10-12T12:47:50.462286Z</date>
<msg>reviewid:12980
review by:fxw
TD: null 
现象：
打包环境搭建优化</msg>
</logentry>
<logentry
   revision="239259">
<author>fxw</author>
<date>2015-10-09T07:00:39.930317Z</date>
<msg>创建VMP4.6</msg>
</logentry>
<logentry
   revision="239241">
<author>fxw</author>
<date>2015-10-09T04:53:15.762322Z</date>
<msg>noreview
Merged revision(s) 238589-239239 from Personal/fxw/VMP4.5/Trunk:
1、修改 一体机与非一体机组件集群，非一体机未显示系统盘问题
2、合入vs td 30368 未初始化虚拟存储时删除主机
........
提交vs最新代码
........
noreview 改动说明：aDesk版本不支持将没有磁盘的新主机添加到虚拟存储

........
更新到主干代码svn 238738
........
判断一体机的函数加上了主机参数，参数为空的情况会有问题，修改一下
........
更新vs代码到7626
........

</msg>
</logentry>
<logentry
   revision="239227">
<author>yangwei</author>
<date>2015-10-09T03:07:58.222146Z</date>
<msg>reviewid 12845
Reviewed by: gwl fxw
BUG ID: 32188
问题分析：TD32188 [bug跟踪]adesk标准版升级ut重置0，未生效【必改】
改动说明：
修改了获取版本目录
vtsn_tool加入日志，加强修改ut条件判断。
测试：打包测试
****打包验证，测试ok</msg>
</logentry>
<logentry
   revision="238738">
<author>yangwei</author>
<date>2015-10-08T11:27:39.332238Z</date>
<msg>reviewid 12824
Reviewed by: hyq
BUG ID: null
问题分析：优化飞天key数量获取
改动说明：使用grep -ci 正则表达式获取飞天key数量
测试：测试飞天key数量获取正确，测试ok


</msg>
</logentry>
<logentry
   revision="238715">
<author>yangwei</author>
<date>2015-10-08T07:15:32.579195Z</date>
<msg>reviewid 12812
Reviewed by: hyq
BUG ID: null
问题分析：去掉vtsn_tool的修改客户名称功能。
改动说明：删除vtsn_tool -w命令
测试：测试ok


</msg>
</logentry>
<logentry
   revision="238707">
<author>yangwei</author>
<date>2015-10-08T06:40:56.133913Z</date>
<msg>reviewid 12809
Reviewed by: hyq
BUG ID: 32104
问题分析：
软件vdc新建完成后，填写申请的序列号无效
改动说明：
注册随机数，会将"/cfs/priv/sn/vrs/"."$RandStr"文件在当前目录拷贝一份临时文件，方法是先创建临时文件，然后拷贝数据。
创建文件的时候失败了，因此随机数注册失败，程序终止，/tmp/vdcsn_reg_randstr_$vmid 文件就不会创建，导致vdc死等，直到超时，因此vdc出错[checksn]499 1003。
创建失败的原因可能是/cfs不稳定，具体原因根据日志无法查明。
现有做法是捕获整个操作流程出现的异常，如果异常出现，注册失败，向/tmp/vdcsn_reg_randstr_$vmid 文件写入-1，不让vdc超时等待.
测试：


</msg>
</logentry>
<logentry
   revision="238698">
<author>hyq</author>
<date>2015-10-08T03:59:43.480026Z</date>
<msg>reviewid 12804
reviewed by: gwl
BUG ID: 31816  
改动说明：
存储和业务口掉线后虚拟机重启拉起的速度太慢
放开HA拉起一体机一台一台启动的限制，先检测能够拉起多少台，一次性拉起
用户同时手动拉起的没有办法，不管




</msg>
</logentry>
<logentry
   revision="238681">
<author>chenlei</author>
<date>2015-10-08T02:50:34.236545Z</date>
<msg>reviewid 12794
Reviewed by: hyq
BUG ID：31964
问题分析:【200.200.195.182】给虚拟机批量备份时虚拟机都被重启了
改动说明：    
异常重启的时候要判断虚拟机是否正在克隆、备份、挂起，如果是的话就不重启。</msg>
</logentry>
<logentry
   revision="238676">
<author>hyq</author>
<date>2015-10-08T02:01:10.562266Z</date>
<msg>reviewid 12792
reviewed by: gwl
BUG ID:   
改动说明：
vdi新建虚拟机报错无法识别的参数uuid，参数中包含换行符




</msg>
</logentry>
<logentry
   revision="238615">
<author>ssl</author>
<date>2015-09-30T10:06:43.948549Z</date>
<msg>noreview 肖俊修改：非mini_header记录旧的头部，解决VDI4.7 X86盒子不正常工作的问题，该修改对之前版本不会有影响（老版本不会走到这个流程）</msg>
</logentry>
<logentry
   revision="238585">
<author>ssl</author>
<date>2015-09-30T08:19:16.483046Z</date>
<msg>noreview
1.合入mcc修改：代码添加注释
2.合入mcc修改：代码整理，名称命名规范化
3.合入mcc修改：积分图校验位数从16位调整到19位
4.合入mcc修改：修改验证步长为7，解决AutoCAD 红黑线冲突的问题</msg>
</logentry>
<logentry
   revision="238583">
<author>chenlei</author>
<date>2015-09-30T08:03:30.489397Z</date>
<msg>reviewid:12747
bugid: 32107
review by:fxw
改动说明:
fix bug32107 修改正式发布包的版本号和包名</msg>
</logentry>
<logentry
   revision="238575">
<author>lcy</author>
<date>2015-09-30T07:27:54.780406Z</date>
<msg>reviewid:12741
review by fxw
TD:32016
现象：【STT】虚拟机出core，vs开发已查明需要vt修改
改动说明：
vmp4.5使用的qemu-2.0.1 qemu_gluster_init这个函数没有处理errno=0的情况
而aSV版本的qemu-2.2.1是处理了这种情况的，所以需要合入一下这个函数
测试：
编译qemu通过。自测通过。</msg>
</logentry>
<logentry
   revision="238546">
<author>fxw</author>
<date>2015-09-30T00:39:34.457847Z</date>
<msg>noreview
合入VS分支238435</msg>
</logentry>
<logentry
   revision="238518">
<author>chenlei</author>
<date>2015-09-29T11:09:58.352530Z</date>
<msg>reviewid:12719
bugid: 31921
review by:fxw
改动说明:
fix bug31921 释放内核crashkernel的内存占用</msg>
</logentry>
<logentry
   revision="238501">
<author>hyq</author>
<date>2015-09-29T09:49:46.647598Z</date>
<msg>reviewid 12710
Merged revision(s) 46862 from VTP/ASV3.7/Trunk/source/app/vtp-manager/VTP/VAPI/Hosts.pm:

Reviewed by: gzyMerged revision(s) 46779 from VTP/ASV3.7/Trunk/source/app/vtp-manager/VTP/VAPI/Hosts.pm:
reviewid 10554
Reviewed by: gzy
BUG ID: 30032
问题分析：主控掉线或挂掉，有用集群IP的主机在判断自己是否拥有集群IP时，由于该IP设置在虚拟交换机网口上，导致判断错误
改动说明：考虑到4.0后可能还有网口聚合的场景，因此不判断网口，直接判断是否拥有该集群IP即可
做了哪些测试：1.两台主机，未改前拔掉主控的网线，登陆集群IP不会自动切换
2.修改后拔掉主控的网线，能自动切换，可以登陆进入vmp管理页面
........


BUG ID: 30074
问题分析：集群主控离线后，由于删除主机流程判断主机离线，没有继续删除splithosts.ini，导致主机上线后自动添加回来
改动说明：将删除splithosts.ini的流程提取到判断IP和是否在线之前
做了哪些测试：测试主控离线，删除原主控后，没有自动添加回来。
手动添加主机能添加回来。
........

VMP4.5合入3.7改动
TD32062：【自动切换主控】主控离线后，被删除，然后恢复主控，发现原主控被加回集群-需合入30074</msg>
</logentry>
<logentry
   revision="238499">
<author>yangwei</author>
<date>2015-09-29T09:47:06.418255Z</date>
<msg>reviewid 12714
Reviewed by: fxw
BUG ID: 31967
问题分析：
拔掉key，修改系统时间，不影响剩余使用时间
改动说明：
设置nk_ut字段记录拔掉key的时间，不再依赖修改时间和插key时间
测试：
修改系统时间，30天的过期时间按实际使用的时间累积。修改时间不会导致立即过期。测试ok


</msg>
</logentry>
<logentry
   revision="238489">
<author>hyq</author>
<date>2015-09-29T09:03:37.997253Z</date>
<msg>reviewid 12711
reviewed by: fxw
BUG ID:     31942
改动说明：
虚拟机增加uuid，某些软件需要使用
支持老接口




</msg>
</logentry>
<logentry
   revision="238436">
<author>lcy</author>
<date>2015-09-29T02:04:19.610423Z</date>
<msg>reviewid:12690
review by:chengtao
TD: 32043
现象：TD32043,ISO中文安装界面格式化磁盘的时候选择的按钮也是需要汉化的
改动说明：
加上中文的按钮
测试：
打包验证</msg>
</logentry>
<logentry
   revision="238415">
<author>yangwei</author>
<date>2015-09-28T13:05:29.195346Z</date>
<msg>reviewid 12679
Reviewed by: lcy
BUG ID:
问题分析：
位于vs的虚拟机启动判断
改动说明：
更改获取vs信息的函数调用，原有接口已经移除vs信息获取。
测试：

</msg>
</logentry>
<logentry
   revision="238392">
<author>yangwei</author>
<date>2015-09-28T10:29:06.244994Z</date>
<msg>reviewid 12660
Reviewed by: gwl
BUG ID:
问题分析：优化授权信息获取
改动说明：
1、vs授权信息只有序列号页面才会使用，将vs授权信息分离出来。
2、其他函数中重复的授权函数调用，使用参数，减少函数调用。
测试：
序列号页面显示正常，虚拟机能够正常开机。测试ok。

</msg>
</logentry>
<logentry
   revision="238365">
<author>yangwei</author>
<date>2015-09-28T07:37:46.368387Z</date>
<msg>reviewid 12645
Reviewed by: gwl
BUG ID: 31967 31335
问题分析：修改vtsn工具
改动说明：修改时间计算方式：剩余时间仅适用ut进行判断。修改时间对剩余时间没有影响。
测试：
对标准版和有期限的企业版进行改时间测试，改时间对授权剩余使用时间没有影响。</msg>
</logentry>
<logentry
   revision="238238">
<author>yangwei</author>
<date>2015-09-25T10:04:52.749511Z</date>
<msg>reviewid 12592
Reviewed by: fxw
BUG ID: 31545
问题分析：对飞天key的读写添加锁
改动说明：解决vs和vt访问飞天key相互释放登陆状态的情况，对读写进行加锁。
测试：
和vs的修改进行联合测试，对飞天key进行大量的读写测试，双方都没有发现F0000009错误，说明不会相互释放飞天key的登陆状态，测试ok。
</msg>
</logentry>
<logentry
   revision="238235">
<author>fxw</author>
<date>2015-09-25T09:50:53.299775Z</date>
<msg>noreview
合入VS代码
vs td30174 修改热插拔磁盘无热插拔事件问题</msg>
</logentry>
<logentry
   revision="238234">
<author>fxw</author>
<date>2015-09-25T09:48:42.483097Z</date>
<msg>noreview
增加原始文件</msg>
</logentry>
<logentry
   revision="238233">
<author>hyq</author>
<date>2015-09-25T09:38:04.399582Z</date>
<msg>reviewid: 12597
Merged revision(s) 238187-238188 from Personal/hyq/VMP4.5_copy/Trunk:
Merged revision(s) 46562 from VTP/ASV3.7:
reviewid: 10454
BUG ID: 
Reviewed by: zxq
TD:  
现象：
主控离线，手动切换主控失败
改动说明：
返回值status页面需要是整型，后台返回字符串导致失败；
测试：
测试了两个返回res的地方，status均是数字
........

........
Merged revision(s) 47482 from VTP/ASV3.7:
reviewid: 12597
BUG ID: 
Reviewed by: zxq
TD:  31297
现象：
TD 30334 【集群】升级新包集群分裂了
改动说明：
由于未获取到离线节点的ip地址，导致切换主控后主机没有加回来
测试：
将主控离线；
后台到重节点，重启pmxcfs:/sf/etc/init.d/pmxcfs restart;
查看/cfs/.members，离线主机的ip地址已经不在了；
页面登入集群ip，此时会将从节点设置为主控，将离线的主控写入配置文件
查看配置文件：/sf/cfg/vtp-cluster/splithosts.ini 已经写入了离线节点的ip地址；
将离线节点上线后，自动加回来了
........

........
</msg>
</logentry>
<logentry
   revision="238214">
<author>fxw</author>
<date>2015-09-25T07:57:12.887155Z</date>
<msg>Merged revision(s) 238035, 238038 from Personal/fxw/VMP4.5/Trunk:

........
SSD磁盘邮件告警格式美化
........
noreview 
改动说明：初始化虚拟存储，添加磁盘时，未勾选使用热备盘，在添加磁盘页面仍默认将某磁盘设置为热备盘
........
</msg>
</logentry>
<logentry
   revision="238208">
<author>fxw</author>
<date>2015-09-25T07:40:05.822743Z</date>
<msg>reviewid: 12530
Reviewed : lzl
BUGID: 31891
问题分析：
我们环境没有tape设备，bsdtar在没指定-f参数时，会默认用/dev/st0，导致/dev/目录被写满，系统出现问题。
禁止不指定-f参数
改动说明:
验证通过，出问题的命令报错说缺少filename。正常命令不受影响
</msg>
</logentry>
<logentry
   revision="238196">
<author>hyq</author>
<date>2015-09-25T07:01:02.421551Z</date>
<msg>reviewid 12576
reviewed by: fxw
BUG ID:     31942
改动说明：
虚拟机增加uuid，某些软件需要使用


</msg>
</logentry>
<logentry
   revision="238169">
<author>zhangqian</author>
<date>2015-09-25T01:28:25.463386Z</date>
<msg>reviewid 12553
Reviewed by: fxw
BUG ID: 31881
问题分析：
1.基于PS/2 Protocol，键盘输出缓冲区大小应该是16bytes，但qemu在很久之前设置成了256；
2.可能会导致guest在加载i8042驱动时，初始化i8042驱动失败，导致guest机不再响应按键中断。
http://git.qemu.org/?p=qemu.git;a=commitdiff;h=2858ab09e6f708e381fc1a1cc87e747a690c4884

测试：编译通过。</msg>
</logentry>
<logentry
   revision="238108">
<author>fxw</author>
<date>2015-09-24T06:38:02.834296Z</date>
<msg>noreview
预发布截止
回滚这次修改，预发布后在解决
Merged revision(s) 238101 from VTP/VMP4.5/Trunk/source/lib:
问题分析：对飞天key的读写添加锁
改动说明：解决vs和vt访问飞天key相互释放登陆状态的情况，对读写进行加锁。
测试：
和vs的修改进行联合测试，对飞天key进行大量的读写测试，双方都没有发现F0000009错误，说明不会相互释放飞天key的登陆状态，测试ok。

........
</msg>
</logentry>
<logentry
   revision="238105">
<author>fxw</author>
<date>2015-09-24T06:29:56.644669Z</date>
<msg>noreview
Merged revision(s) 238104 from Personal/fxw/VMP4.5/Trunk:
更新vs包到7511，优化vs验证过程，获取ukeyid完全从ukeyid文件读取，不再从key里读取
........
</msg>
</logentry>
<logentry
   revision="238101">
<author>fxw</author>
<date>2015-09-24T06:16:09.190461Z</date>
<msg>reviewid 12531
Reviewed by: fxw
BUG ID: 31545
问题分析：对飞天key的读写添加锁
改动说明：解决vs和vt访问飞天key相互释放登陆状态的情况，对读写进行加锁。
测试：
和vs的修改进行联合测试，对飞天key进行大量的读写测试，双方都没有发现F0000009错误，说明不会相互释放飞天key的登陆状态，测试ok。
</msg>
</logentry>
<logentry
   revision="238100">
<author>fxw</author>
<date>2015-09-24T06:14:31.634522Z</date>
<msg>reviewid 12529
Reviewed by: xhz
BUG ID: 31888
问题分析：vmp虚拟机批量开启优化
改动说明：将授权信息获取提到开机前，虚拟机开机公用一份授权信息。
测试：
批量开机自测通过，100台时间5分半。
</msg>
</logentry>
<logentry
   revision="238088">
<author>fxw</author>
<date>2015-09-24T03:16:53.696897Z</date>
<msg>noreview
回滚上次修改吗，预发布包不支持正式包升级</msg>
</logentry>
<logentry
   revision="238044">
<author>fxw</author>
<date>2015-09-23T08:41:02.088059Z</date>
<msg>noreview
更新vs 分支至237997</msg>
</logentry>
<logentry
   revision="238039">
<author>fxw</author>
<date>2015-09-23T08:17:16.029921Z</date>
<msg>reviewid:  12498
BUG ID: 31816
Reviewed by: wzt
现象：
TD 31816 【STT】【200.200.195.182】存储和业务口掉线后虚拟机重启拉起的速度太慢【影响业务】
改动说明：
1.之前针对页面开机支持选择未插网线的主机，vtprgm中未改到，导致认为有主机可拉起vm，但实际无节点可拉起；
2.优化获取可访问主机，获取网口不需要获取虚拟机，检测可访问主机，只需有节点可访问即退出，避免多余的查询；
3.优化离线主机上的vm，无运行位置也去拉起，重试25此后超时后，环境恢复后无法拉起；
测试：
1.断开所有主机的虚拟机的存储口和业务口，虚拟机不关机，也不拉起；
2.虚拟机用了未插线的网口，kill掉此虚拟机，虚拟机无主机可拉起，看后台日志，有尝试找主机，电源文件cnt未修改；
3.看日志，查找是否有节点运行异常的虚拟机，检查到有节点即返回了；</msg>
</logentry>
<logentry
   revision="237967">
<author>fxw</author>
<date>2015-09-22T12:16:34.602067Z</date>
<msg>reviewid: 12455
Reviewed by：zyj
BUGID: 31677
问题分析：
没有把size传出来。用一个指针把对齐后的size传出来。
</msg>
</logentry>
<logentry
   revision="237958">
<author>fxw</author>
<date>2015-09-22T10:02:05.416869Z</date>
<msg>noreview
更新VDI4.6.qcow2 预发布版
</msg>
</logentry>
<logentry
   revision="237957">
<author>fxw</author>
<date>2015-09-22T09:47:19.001251Z</date>
<msg>noreview
上传镜像失败，把这个删了重新上传</msg>
</logentry>
<logentry
   revision="237954">
<author>fxw</author>
<date>2015-09-22T09:44:07.843886Z</date>
<msg>noreview
更新VDI镜像到VDI4.6 预发布版</msg>
</logentry>
<logentry
   revision="237953">
<author>fxw</author>
<date>2015-09-22T09:33:17.620067Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="237949">
<author>fxw</author>
<date>2015-09-22T09:15:23.199857Z</date>
<msg>noreview
重命名文档</msg>
</logentry>
<logentry
   revision="237899">
<author>fxw</author>
<date>2015-09-21T13:09:21.877981Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="237895">
<author>fxw</author>
<date>2015-09-21T12:56:52.647246Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="237888">
<author>fxw</author>
<date>2015-09-21T12:26:16.701817Z</date>
<msg>noreview
预发布提交文档</msg>
</logentry>
<logentry
   revision="237884">
<author>lcy</author>
<date>2015-09-21T12:07:17.572349Z</date>
<msg>reviewid:12432
review by yangwei
TD:31812
现象：序列号添加主机组件集群，组建成功了，报错组建失败，必改
改动说明：
把$@置为空
测试：
自测通过</msg>
</logentry>
<logentry
   revision="237874">
<author>gwl</author>
<date>2015-09-21T11:27:07.850736Z</date>
<msg>reviewid: 12428
Reviewed by：fxw
BUGID: 
问题分析：合入asv4.2 31818
写入vma头部时，使用清空方式&gt; 而以前是&gt;&gt;
</msg>
</logentry>
<logentry
   revision="237863">
<author>gwl</author>
<date>2015-09-21T09:19:02.593993Z</date>
<msg>reviewid: 12417
Reviewed by：hyq
BUGID: 
问题分析：
如果qcow2磁盘被占用，无法执行qemu-img info，获取size会失败。
使用du -B1 获取磁盘，避免这种情况。
</msg>
</logentry>
<logentry
   revision="237853">
<author>fxw</author>
<date>2015-09-21T07:38:53.370359Z</date>
<msg>reviewid 12408
reviewed by: fxw
BUG ID:     31430
改动说明：
vdc虚拟机不设置为开机强制启动




</msg>
</logentry>
<logentry
   revision="237849">
<author>jcy</author>
<date>2015-09-21T07:05:05.400027Z</date>
<msg>no review：
bug31430，编辑VDC虚拟机时，支持HA与开机自启动共存</msg>
</logentry>
<logentry
   revision="237845">
<author>xzk</author>
<date>2015-09-21T06:44:39.917758Z</date>
<msg>noreview改动说明：TD31807 【导入导出虚拟机】导出任务失败后，后台一直在打印日志</msg>
</logentry>
<logentry
   revision="237839">
<author>xiehz</author>
<date>2015-09-21T05:06:07.195025Z</date>
<msg>reviewid:  12401
BUG ID: 31822
Reviewed by: chengtao
现象：
单台主机，不能ha，因此无需关机
改动说明：
单台主机，不能ha，因此无需关机
测试：
单台主机，断开管理口，虚拟机不关机</msg>
</logentry>
<logentry
   revision="237838">
<author>fxw</author>
<date>2015-09-21T04:41:12.559053Z</date>
<msg>noreview
Merged revision(s) 237837 from Personal/fxw/VMP4.5/Trunk:
放开一体机不能试用的限制
........

</msg>
</logentry>
<logentry
   revision="237836">
<author>jcy</author>
<date>2015-09-21T04:01:10.280497Z</date>
<msg>no review：
bug31802，“btn-back”的css类冲突</msg>
</logentry>
<logentry
   revision="237835">
<author>lcy</author>
<date>2015-09-21T03:58:58.850846Z</date>
<msg>reviewid:12398
review by zyj
TD:31677
现象：kvm进程内存占用超过配置大小可能内存泄露
改动说明：
不用4K额外的空间存储size，把buffer的size放在cache结构体里面
测试：
编译qemu通过。自测通过。</msg>
</logentry>
<logentry
   revision="237833">
<author>jcy</author>
<date>2015-09-21T03:50:57.840681Z</date>
<msg>no review：
bug31802，存储页面的css类冲突</msg>
</logentry>
<logentry
   revision="237831">
<author>fxw</author>
<date>2015-09-21T03:42:56.077204Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="237827">
<author>fxw</author>
<date>2015-09-21T03:23:09.248338Z</date>
<msg>noreview
move folders
</msg>
</logentry>
<logentry
   revision="237822">
<author>fxw</author>
<date>2015-09-21T03:03:32.663513Z</date>
<msg>reviewid 12399
reviewed by: fxw
BUG ID:     31767
改动说明：
31767：4.3.21R2版本vm_proxyd CPU 100%，虚拟机CPU及内存等数据显示不准




</msg>
</logentry>
<logentry
   revision="237816">
<author>fxw</author>
<date>2015-09-21T02:19:25.540602Z</date>
<msg>reviewid 12396
reviewed by: gwl
BUG ID:     31430
改动说明：
编辑启用vdc HA虚拟机开机自启动失效




</msg>
</logentry>
<logentry
   revision="237808">
<author>fxw</author>
<date>2015-09-20T10:03:53.541176Z</date>
<msg>no review
Merged revision(s) 237775 from Personal/fxw/VMP4.5/Trunk/source/app/vtp-storage/VTP/VS/VsConfig.pm:
TD30346 替换主机时过滤掉不能供vs使用的盘
........
</msg>
</logentry>
<logentry
   revision="237807">
<author>fxw</author>
<date>2015-09-20T09:55:07.689549Z</date>
<msg>no review
Merged revision(s) 237800 from Personal/fxw/VMP4.5/Trunk/source/app/vs-code:
//更新到vs的7432，解决vs在非一体机场景校验失败的问题
........
</msg>
</logentry>
<logentry
   revision="237806">
<author>yangwei</author>
<date>2015-09-20T09:24:32.040793Z</date>
<msg>reviewid 12392
Reviewed by: hyq
BUG ID: 31619
问题分析：vtsn_tool修改
改动说明：
ini文件值为空时，未关闭文件，导致文件锁没有被释放，出现死锁。
确保任何时候释放文件锁
测试：
当存在ini文件键值为空时更新或者写key（例如username为空），数据能保存成功。测试ok
在序列号页面注册，不会出现死锁而导致的超时。测试ok。</msg>
</logentry>
<logentry
   revision="237803">
<author>xiehz</author>
<date>2015-09-20T08:57:16.759777Z</date>
<msg>reviewid:  12391
BUG ID: 31798
Reviewed by: chengtao
现象：
TD 31798 【虚拟机】虚拟机启动失败提示报表错误，日志见附件，原因待定【阻塞】[优先
改动说明：
rrd数据库文件时间是未来时间，获取不到数据；
在定时任务中，执行出错时执行下rrdfix.sh；
修改系统时间回调处，增加调用check_rrdcache_ok
测试：
手动执行两个脚本，执行成功</msg>
</logentry>
<logentry
   revision="237799">
<author>fxw</author>
<date>2015-09-20T07:13:21.867080Z</date>
<msg>no review
BUG ID:     31430
改动说明：
改动如下：
vdc ha虚拟机开机自启动检查存储上线时间修改为20分钟
</msg>
</logentry>
<logentry
   revision="237798">
<author>fxw</author>
<date>2015-09-20T02:58:22.519567Z</date>
<msg>no review
BUG ID:     31430
改动说明：
改动如下：
vdc ha虚拟机在主机启动时每个主机都会检查，如果没有拉起，则将其拉起</msg>
</logentry>
<logentry
   revision="237797">
<author>fxw</author>
<date>2015-09-20T02:54:35.417615Z</date>
<msg>no review
BUG ID:     31533
改动说明：
改动如下：
修改版本号为带下划线B</msg>
</logentry>
<logentry
   revision="237796">
<author>fxw</author>
<date>2015-09-20T02:39:55.236861Z</date>
<msg>no review
BUG ID:     31533
改动说明：
改动如下：
</msg>
</logentry>
<logentry
   revision="237792">
<author>yangwei</author>
<date>2015-09-19T13:05:57.697469Z</date>
<msg>reviewid 12387
Reviewed by: gwl
BUG ID: 31774
问题分析：vmp企业版，位于vs上虚拟机开机提示
改动说明：【bug31774】[序列号]vmp企业版未过期，vs企业版过期，启动虚拟机失败报启动虚拟机失败，报错不详细
1、vs企业版不会过期，bug概述有问题；
2、vmp企业版永不过期，vs未激活，已经验证会提示：“虚拟机（****）启动失败， 虚拟存储序列号检查失败，永不过期的虚拟化平台序列号不支持虚拟存储试用”。
3、vmp有期限，vs未激活，vs的试用期和vmp剩余天数一致。
测试：vmp企业版无限期，vs未激活，虚拟机不能开机，提示ok。测试ok。</msg>
</logentry>
<logentry
   revision="237791">
<author>gwl</author>
<date>2015-09-19T13:05:38.859620Z</date>
<msg>reviewid: 12388
Reviewed by：yangwei
BUGID: 31781
问题分析：
支持vs导入导出
</msg>
</logentry>
<logentry
   revision="237789">
<author>jcy</author>
<date>2015-09-19T12:51:38.902988Z</date>
<msg>no review：
bug31566，虚拟机配置去掉“动态分配”</msg>
</logentry>
<logentry
   revision="237788">
<author>jcy</author>
<date>2015-09-19T12:47:49.735624Z</date>
<msg>no review：
bug31397，在主控离线时，在跳到主控和集群IP前先检查IP是否可以访问</msg>
</logentry>
<logentry
   revision="237787">
<author>xiehz</author>
<date>2015-09-19T12:46:06.378608Z</date>
<msg>reviewid:  12386
BUG ID: 31397
Reviewed by: lzl
现象：
TD 31397 主控离线登入从节点卡住一两分钟
改动说明：
增加判断ip是否能通的接口
测试：
联调通过</msg>
</logentry>
<logentry
   revision="237783">
<author>gwl</author>
<date>2015-09-19T11:22:31.856207Z</date>
<msg>reviewid: 12383
Reviewed by：fxw
BUGID: 31630
问题分析：
vs存储导出虚拟机，导入非vs存储报错。
</msg>
</logentry>
<logentry
   revision="237781">
<author>yangwei</author>
<date>2015-09-19T11:13:16.229873Z</date>
<msg>reviewid 12380
Reviewed by: gwl fxw
BUG ID: 
问题分析：vmp防破解
改动说明：合入asv4.2 authkeyid文件保护代码
测试：打包验证</msg>
</logentry>
<logentry
   revision="237779">
<author>jcy</author>
<date>2015-09-19T10:43:41.296404Z</date>
<msg>no review：
bug31787，[新需求]不支持ova的文件导入</msg>
</logentry>
<logentry
   revision="237778">
<author>lcy</author>
<date>2015-09-19T10:42:28.619599Z</date>
<msg>reviewid:12375
review by myq
TD:31749
现象：kvm进程内存占用超过配置大小可能内存泄露
改动说明：
写缓存的时候，每次写多少，用mmap分配多少内存,写完之后，马上调用munmap释放内存
测试：
编译qemu通过。自测通过。</msg>
</logentry>
<logentry
   revision="237776">
<author>yangwei</author>
<date>2015-09-19T10:30:34.646492Z</date>
<msg>reviewid 12371
Reviewed by: gwl
BUG ID: 
问题分析：vmp参数限制
改动说明：限制标准版虚拟机2核4G
测试：</msg>
</logentry>
<logentry
   revision="237771">
<author>xiehz</author>
<date>2015-09-19T10:01:16.359199Z</date>
<msg>reviewid:  12369
BUG ID: 31771
Reviewed by: wzt
现象：
虚拟机状态有可能更新了，使用之前的状态可能导致虚拟机电源状态未off
改动说明：
虚拟机在A主机执行开机，又在B主机执行开机；B主机开机失败，会设置电源为off；
启动失败后，应该重新读一下配置文件
测试：
集群虚拟机，在A主机执行开机，后台在B主机执行开机；
开机成功后，电源文件为on</msg>
</logentry>
<logentry
   revision="237761">
<author>chenlei</author>
<date>2015-09-19T09:22:13.026134Z</date>
<msg>reviewid: 12370
Reviewed by：fxw
bugid: 31780
改动说明：
fix bug 31780 解决内存使用临界点启动虚拟机的提示信息看不懂的问题</msg>
</logentry>
<logentry
   revision="237748">
<author>chenlei</author>
<date>2015-09-19T08:10:09.971858Z</date>
<msg>reviewid: 12362
Reviewed by：fxw
bugid: null
改动说明：
由于SSL在spice中采用了tcmalloc库，
需要更新libspice-server.so.1和make.sh文件</msg>
</logentry>
<logentry
   revision="237746">
<author>fxw</author>
<date>2015-09-19T08:06:14.266921Z</date>
<msg>Merged revision(s) 237577-237601 from Personal/fxw/VMP4.5/Trunk:
优化vs序列号检查失败时的提示，提示更加具体
........
noreview 
改动说明：修正css文件未打包压缩的问题
........
</msg>
</logentry>
<logentry
   revision="237743">
<author>fxw</author>
<date>2015-09-19T07:54:06.430139Z</date>
<msg>noreview
237738</msg>
</logentry>
<logentry
   revision="237735">
<author>chenlei</author>
<date>2015-09-19T06:46:55.597203Z</date>
<msg>reviewid:12355
bugid: 31533 
review by:gwl
现象：null
改动说明：
fix bug 31533 修改预发布包命名。</msg>
</logentry>
<logentry
   revision="237733">
<author>yangwei</author>
<date>2015-09-19T06:36:03.587335Z</date>
<msg>reviewid 12354
Reviewed by: gwl, hyq 
BUG ID: 
问题分析：vdc获取keyid优化
改动说明：vdc为了获取keyid调用了3次vtsn_tool -i。目前发现vdc请求keyid很容易出现超时的情况。优化只调用一次vtsn_tool -i。
测试：</msg>
</logentry>
<logentry
   revision="237730">
<author>ssl</author>
<date>2015-09-19T05:17:40.657384Z</date>
<msg>noreview,修正极域缓存清除问题。
停止广播时，需要在服务端和客户端同时清除pixmap、cache_build、pallete缓存。
否则会导致客户端内存失控
</msg>
</logentry>
<logentry
   revision="237727">
<author>xiehz</author>
<date>2015-09-19T05:08:24.971861Z</date>
<msg>reviewid:  12351
BUG ID: 31771
Reviewed by: wzt
现象：
TD 31771 【ha优化】ha虚拟机启动优先启动到网线连接的主机上
改动说明：
启动HA虚拟机，优先选择插了网线的主机；
测试：
虚拟机连的交换机，两台主机插了网线，一台主机未插网线；
编辑虚拟机，优先启动位置为未插网线主机；
启动虚拟机，到插入网线的主机启动；</msg>
</logentry>
<logentry
   revision="237720">
<author>jcy</author>
<date>2015-09-19T03:55:11.982394Z</date>
<msg>no review：
bug31781，导入虚拟机支持选vs</msg>
</logentry>
<logentry
   revision="237714">
<author>jcy</author>
<date>2015-09-19T03:06:21.712536Z</date>
<msg>no review：
bug31769，去掉更换主机页面的下载链接
bug31316，切换全局备份开关时，禁止新增策略</msg>
</logentry>
<logentry
   revision="237707">
<author>yangwei</author>
<date>2015-09-19T02:23:54.424614Z</date>
<msg>reviewid 12346
Reviewed by: fxw, gwl, hyq 
BUG ID: 31775
问题分析：vdc开机检查
改动说明：vdc开机检查时，只有没设置过企业版过期的vmp才返回过期，其余情况输出cpuid，返回0.
测试：源码已经让zxq看过，测试打包和ssl联调验证</msg>
</logentry>
<logentry
   revision="237695">
<author>yangwei</author>
<date>2015-09-19T01:09:08.492727Z</date>
<msg>reviewid 12344
Reviewed by: fxw 
BUG ID: 
问题分析：修改c语法错误
改动说明：不能再for循环里面声明变量
测试：</msg>
</logentry>
<logentry
   revision="237689">
<author>yangwei</author>
<date>2015-09-18T14:09:48.981761Z</date>
<msg>reviewid 12341
Reviewed by: fxw gwl
BUG ID: 31652
问题分析：企业版过期，vdc要能够开机
改动说明：检查虚拟机时，如果设置过企业版，虚拟机是vdc，允许开机
测试：企业版过期，开启vdc，，开机成功，测试ok</msg>
</logentry>
<logentry
   revision="237685">
<author>jcy</author>
<date>2015-09-18T13:13:17.593337Z</date>
<msg>no review：
bug31768，非vdc的ha虚拟机禁止勾选主机启动自动启动了</msg>
</logentry>
<logentry
   revision="237680">
<author>yangwei</author>
<date>2015-09-18T13:06:58.907788Z</date>
<msg>reviewid 12328
Reviewed by: fxw
BUG ID: null
问题分析：将用户名配置到authkeyid文件中，和asv4.2保持一致
改动说明：
测试：打包验证</msg>
</logentry>
<logentry
   revision="237678">
<author>fxw</author>
<date>2015-09-18T12:38:14.057576Z</date>
<msg>reviewid 12335
reviewed by: gwl
BUG ID:     31624
改动说明：
改动如下：上库lsscsi工具

</msg>
</logentry>
<logentry
   revision="237671">
<author>xiehz</author>
<date>2015-09-18T11:48:18.690636Z</date>
<msg>reviewid:  12323
BUG ID: 31747
Reviewed by: wzt
现象：
TD 31747 在VDC上批量开机发现一台VMP主机卡死了
改动说明：
批量开机没有排队，内存耗尽导致vmp卡死；
小于10G空闲内存的主机，在启动虚拟机时，排队等锁；
测试：
主机空闲内存少于10G，在同一个主机上同时启动3台虚拟机；
后台看日志，已加锁执行启动
虚拟机启动失败，与之前一致，提示错误信息；
</msg>
</logentry>
<logentry
   revision="237666">
<author>yangwei</author>
<date>2015-09-18T11:37:32.265670Z</date>
<msg>reviewid 12325
Reviewed by: fxw
BUG ID: null
问题分析：修改cpuid接口
改动说明：将飞天keyid进行转换，返回位数小于等于10的字符串
测试：本地测试转换函数，结果和ssl 周照对比，测试ok。对接结果打包测试。</msg>
</logentry>
<logentry
   revision="237662">
<author>jcy</author>
<date>2015-09-18T11:08:26.782012Z</date>
<msg>no review：
bug31759，序列号页面，过期时，标红</msg>
</logentry>
<logentry
   revision="237657">
<author>jcy</author>
<date>2015-09-18T09:54:08.279224Z</date>
<msg>no review：
bug31686，导入虚拟机隐藏掉虚拟存储</msg>
</logentry>
<logentry
   revision="237648">
<author>jcy</author>
<date>2015-09-18T09:04:19.176414Z</date>
<msg>no review：
bug31448，设置为主控成功后应跳到首页</msg>
</logentry>
<logentry
   revision="237646">
<author>gwl</author>
<date>2015-09-18T08:40:04.139566Z</date>
<msg>reviewid: 12316
Reviewed by：fxw
BUGID: 
问题分析：
去掉index.pl上的逗号
</msg>
</logentry>
<logentry
   revision="237636">
<author>gwl</author>
<date>2015-09-18T07:33:47.381414Z</date>
<msg>reviewid: 12311
Reviewed by：hyq,yangwei
BUGID: 
问题分析：
对cpu_cores理解错误，判断虚拟机cpu核数应该用vm_cpu_cores
</msg>
</logentry>
<logentry
   revision="237630">
<author>fxw</author>
<date>2015-09-18T07:21:37.614220Z</date>
<msg>noreview
更新签名</msg>
</logentry>
<logentry
   revision="237623">
<author>fxw</author>
<date>2015-09-18T06:54:10.044611Z</date>
<msg>noreview
windows格式转成unix格式</msg>
</logentry>
<logentry
   revision="237608">
<author>lcy</author>
<date>2015-09-18T06:01:06.089571Z</date>
<msg>reviewid:12305
review by gwl
TD:31749
现象：新建虚拟机获取虚拟交换机接口返回信息VDC不兼容
改动说明：
保留老接口给VDC用，vmp用新接口。
测试：
自测通过</msg>
</logentry>
<logentry
   revision="237607">
<author>jcy</author>
<date>2015-09-18T05:52:15.976859Z</date>
<msg>no review：
bug31749，修改添加虚拟机处获取交换机列表的API路径</msg>
</logentry>
<logentry
   revision="237606">
<author>gwl</author>
<date>2015-09-18T05:16:22.291321Z</date>
<msg>reviewid: 12303
Reviewed by：fxw
BUGID: 31686
问题分析：
导入导出，vs存储上禁用，判断不应该用!，可能出问题
</msg>
</logentry>
<logentry
   revision="237579">
<author>gwl</author>
<date>2015-09-18T01:38:00.234561Z</date>
<msg>reviewid: 12289
Reviewed by：hyq
BUGID: 31686
问题分析：
导入导出，vs存储上禁用
</msg>
</logentry>
<logentry
   revision="237578">
<author>lcy</author>
<date>2015-09-18T00:59:45.383815Z</date>
<msg>reviewid:12260
review by xhz
TD:31556
现象：多台主机组建集群，ha虚拟机的连接的虚拟交换机未接线，ha虚拟机启动失败
还有一个reviewid在12270(编码不一样，提了两个review)
改动说明：
允许在交换机的所连的物理网口没有插上网线的情况下，启动虚拟机，在启动虚拟机的时候，在Log中打印提示信息：虚拟机桥接的虚拟交换机不能正常使用，HA功能可能失效，请检查对应物理网口。
如果是HA功能拉起虚拟机，则过滤物理网卡不通的主机
测试：
自测通过</msg>
</logentry>
<logentry
   revision="237573">
<author>fxw</author>
<date>2015-09-17T14:18:28.794104Z</date>
<msg>noreview
更新vs 至237559</msg>
</logentry>
<logentry
   revision="237567">
<author>yangwei</author>
<date>2015-09-17T13:51:26.316561Z</date>
<msg>reviewid 12281
Reviewed by: fxw
BUG ID: 31619
问题分析：vtsn_tool工具修改
改动说明：增加打印飞天操作中出错的错误码
测试：打包验证</msg>
</logentry>
<logentry
   revision="237561">
<author>yangwei</author>
<date>2015-09-17T13:14:24.504163Z</date>
<msg>reviewid 12278
Reviewed by: fxw
BUG ID: null
问题分析：企业版vmp vdc可以开启
修改cpuid返回错误bug
改动说明：无效的企业版vdc也可以开机
测试：
打包验证</msg>
</logentry>
<logentry
   revision="237560">
<author>yangwei</author>
<date>2015-09-17T13:11:45.704963Z</date>
<msg>reviewid 12275
Reviewed by: gwl
BUG ID: null
问题分析：序列号模块修改
修改cpuid返回错误bug
改动说明：
1、试用版vs，剩余计算修改；
2、修改adesk企业版cpu核数无限制时虚拟机无法开机bug，防止序列号开成无限制而出错。</msg>
</logentry>
<logentry
   revision="237557">
<author>jcy</author>
<date>2015-09-17T12:57:23.476192Z</date>
<msg>no review：
bug31583，上传文件的地方加上支持文件类型的提示</msg>
</logentry>
<logentry
   revision="237555">
<author>jcy</author>
<date>2015-09-17T12:48:59.767976Z</date>
<msg>no review：
bug31430，VDC虚拟机支持“HA与开机自启动”共存</msg>
</logentry>
<logentry
   revision="237551">
<author>lcy</author>
<date>2015-09-17T12:24:48.401165Z</date>
<msg>reviewid:12277
review by chengtao
TD:31684
现象：【汉化合入】测速读速度低于标准速度，报错有误
改动说明：
少了两个$符号。
测试：
自测通过
</msg>
</logentry>
<logentry
   revision="237549">
<author>xiehz</author>
<date>2015-09-17T12:20:40.688119Z</date>
<msg>reviewid:  12265
BUG ID: 31480
Reviewed by: wzt
现象：
TD 31480 【技术支持】【上海捷奇网络设备有限公司----李定均同事】【VDI4.3R2】两台主机，HA虚拟机分布问题
改动说明：
集群虚拟机，重启电源，重新选择运行位置
修改脚本，重启电源不打启动日志
测试：
1.重启ha虚拟机电源，启动成功后只有重置电源日志
2.后台重命名ha虚拟机镜像文件，启动虚拟机，启动失败有日志
3.启动虚拟机后，kill 虚拟机，同时重命名虚拟机镜像文件，HA拉起失败后有日志
</msg>
</logentry>
<logentry
   revision="237547">
<author>jcy</author>
<date>2015-09-17T12:18:45.694557Z</date>
<msg>no review：
bug31448，主控离线时，修改切主控的提示</msg>
</logentry>
<logentry
   revision="237541">
<author>fxw</author>
<date>2015-09-17T11:41:02.330225Z</date>
<msg>reviewid 12266
reviewed by: gwl
BUG ID:     31430
改动说明：【VDI46】【VMP问题】软件vdc关机状态下重启VMP，开机后vdc不会自动启动 [halt]【延后处理】
改动如下：
开机启动api放开vdc ha虚拟机的限制
每个主机会判断该vdc ha虚拟机是否由自己启动
如果由自己启动，则将vdc ha虚拟机拉起，否则由其它主机拉起
</msg>
</logentry>
<logentry
   revision="237539">
<author>chenlei</author>
<date>2015-09-17T11:37:17.095735Z</date>
<msg>reviewid: 12267
Reviewed by：fxw
改动说明：
合入SSL的malloc优化，仅作用于spice</msg>
</logentry>
<logentry
   revision="237526">
<author>ssl</author>
<date>2015-09-17T10:51:38.766757Z</date>
<msg>修正图片DUMP逻辑,noreview</msg>
</logentry>
<logentry
   revision="237525">
<author>ssl</author>
<date>2015-09-17T10:50:47.609190Z</date>
<msg>SPICE的缓存部分增加TCMALLOC优化。
增加原因：频繁的malloc/free，在不添加tcmalloc时，自动化跑一天，标配2G，内存会占到3.3G以上。添加后，内存可以控制在2.3~2.5左右。
且spice的display也是单线程的，契合tcmalloc的优化。
但是，上述测试结果是针对整个QEMU都使用TCMALLOC的情况。当前只针对SPICE的缓存部分，优化效果会略差一些。
noreview
</msg>
</logentry>
<logentry
   revision="237522">
<author>gwl</author>
<date>2015-09-17T10:07:14.780409Z</date>
<msg>reviewid: 12262
Reviewed by：fxw
BUGID: 31656
问题分析：
之前修改过这个问题，vs后续修改代码，漏掉了我们这边的部分修改。
上库打包验证</msg>
</logentry>
<logentry
   revision="237520">
<author>fxw</author>
<date>2015-09-17T09:57:02.734798Z</date>
<msg>noreview
VS升级脚本，要删除虚拟存储里面的 ova vma qcow2文件</msg>
</logentry>
<logentry
   revision="237513">
<author>gwl</author>
<date>2015-09-17T09:21:43.032640Z</date>
<msg>reviewid: 12254
Reviewed by：hyq
BUGID: 31686
问题分析：
导入导出，vs存储上禁用
分步骤实现，本次修改：导出虚拟机，禁止导出vs存储的虚拟机，直接报错。 如果只有vs存储，禁用导出功能，直接隐藏。</msg>
</logentry>
<logentry
   revision="237508">
<author>yangwei</author>
<date>2015-09-17T09:00:50.158486Z</date>
<msg>reviewid 12257
Reviewed by: fxw
BUG ID: null
问题分析：
修改cpuid返回错误bug
改动说明：
cpudi请求是否是试用期和剩余天数时，返回剩余天数。无限期返回0
测试：打包测试</msg>
</logentry>
<logentry
   revision="237507">
<author>yangwei</author>
<date>2015-09-17T08:52:34.783829Z</date>
<msg>reviewid 12231
Reviewed by: gwl
BUG ID: 31447 31511 31652
问题分析：
三个bug都需要修改vtsn_tool因此一次性编译上库  后两个bug只关联头文件和vtsn工具
1、31447 在试用模式期间，互相添加集群，拆散集群，剩余试用期有问题
2、31511 有dog情况下，插入key，拔掉dog，很久也不生效[10分钟]
3、31652 企业版过期，vdc要能够开机
改动说明：
1、主控为试用版时，如果对方也是试用版，需要合并授权信息：
对方过期，不允许添加；对方为未过期试用版，取剩余时间最小者为当前集群的剩余时间。
2、可以响应多个飞天的插拔，并立即更新
3、如果是企业版，直接允许vdc开机，跳过检查
测试：
1、将其他主机的授权文件拷贝到本地，在后台通过执行vtsn_tool -m测试，执行测试成功。前台测试ok。
2、测试ok
3、打包验证</msg>
</logentry>
<logentry
   revision="237495">
<author>fxw</author>
<date>2015-09-17T07:38:11.621561Z</date>
<msg>reviewid 12247
reviewed by: gwl
BUG ID:     31660
改动说明：
td31660:【STT】新建虚拟机，无故失败，后来又都成功了，提示虚拟机所在主机核心数为1
改动如下：
获取cpu信息修改为尝试3次
修改提示信息：
如果最大cpu数返回为1，认为报表数据获取失败

</msg>
</logentry>
<logentry
   revision="237481">
<author>fxw</author>
<date>2015-09-17T06:58:45.292056Z</date>
<msg>reviewid 12242
reviewed by: gwl
BUG ID:     31642
改动说明：
td31624:通过smartctl判断磁盘是否是ssd在某些服务器上会失败[必改]
改动如下：
获取SSD卡用命令 lsscsi -d | grep SSD 获取
并添加相应的错误日志
</msg>
</logentry>
<logentry
   revision="237478">
<author>jcy</author>
<date>2015-09-17T06:17:16.368078Z</date>
<msg>no review：
bug31432，管理员描述信息存在Xss漏洞,管理员描述信息中填写aaa&lt;script&gt;&lt;/script&gt;,导致整个页面为空白显示</msg>
</logentry>
<logentry
   revision="237475">
<author>jcy</author>
<date>2015-09-17T03:40:33.659700Z</date>
<msg>no review：
bug31686，导入导出，限制虚拟存储</msg>
</logentry>
<logentry
   revision="237474">
<author>jcy</author>
<date>2015-09-17T03:30:21.730026Z</date>
<msg>no review：
bug31652，问题2，试用版提醒改为30天</msg>
</logentry>
<logentry
   revision="237467">
<author>gwl</author>
<date>2015-09-17T02:15:08.331618Z</date>
<msg>reviewid: 12232
Reviewed by：hyq
BUGID: 31580
问题分析：
1.序列号给出的限制cpu核数，与创建虚拟机时判断的cpu核数上限不一致。adesk版本，后台限制死了4核，序列号却开了8核，所以错误。

fxw: 按照序列号信息来确定支持的核数，不要写死。出问题说明序列号开

2.导入ova时，遍历ova中的磁盘信息，VMware导出的ova的磁盘配置信息可以排序后
即为磁盘index顺序，而Xen的不一样，排序后index也是乱序。之前的做法，是将磁盘
index直接作为VMP这边磁盘的index，这样可能出问题：当ova中的磁盘index不是连续的时候，或者不是0开始的时候，VMP这边的磁盘顺序校验出错。
本次修改，兼容VMware和Xen的ova磁盘index排序。

</msg>
</logentry>
<logentry
   revision="237451">
<author>fxw</author>
<date>2015-09-17T00:45:16.971471Z</date>
<msg>noreview
更新vs代码 至237406</msg>
</logentry>
<logentry
   revision="237404">
<author>jcy</author>
<date>2015-09-16T08:48:06.460823Z</date>
<msg>no review：
bug31643，添加虚拟机-选交换机：交换机连接的主机网口聚合口应显示名称</msg>
</logentry>
<logentry
   revision="237392">
<author>gwl</author>
<date>2015-09-16T08:10:29.242379Z</date>
<msg>reviewid: 12210
Reviewed by：fxw
BUGID: 31602
问题分析：
导入导出虚拟机，存储空间管理页面显示导出目录</msg>
</logentry>
<logentry
   revision="237391">
<author>fxw</author>
<date>2015-09-16T08:08:28.496345Z</date>
<msg>noreview
原来的提示不准确</msg>
</logentry>
<logentry
   revision="237368">
<author>chenlei</author>
<date>2015-09-16T07:39:35.342369Z</date>
<msg>reviewid:12217
bugid: 31252
review by:fxw
TD: null 
改动说明：
fix bug31252 模板更新时，部署虚拟机，提示有误
测试：
自测通过</msg>
</logentry>
<logentry
   revision="237342">
<author>lcy</author>
<date>2015-09-16T04:56:39.172053Z</date>
<msg>reviewid:12154
review by:chengtao
TD: 31589,31601
现象：TD31589,使用ISO进行安装，没有出现软件声明页面.TD31601,安装过程有参数未消除.
改动说明：
重新合入3.7的中文安装界面代码。
解决的问题包括：
完全中文，包括按钮为OK的也修改为中文；
安装前有中文软件声明
去掉安装过程中遗留的参数问题
测试：
打包验证</msg>
</logentry>
<logentry
   revision="237340">
<author>fxw</author>
<date>2015-09-16T03:53:59.932430Z</date>
<msg>reviewid 12212
reviewed by: gwl
BUG ID:     31501
改动说明：
td31501:页面中实体机的cpu核数显示错误
改动如下：返回cpu插槽数、单个cpu核数、单个cpu超线程数
页面显示为 单个cpu核数 * 单个cpu超线程数 * cpu插槽数

</msg>
</logentry>
<logentry
   revision="237337">
<author>jcy</author>
<date>2015-09-16T03:46:16.022974Z</date>
<msg>no review：
bug31501，主机详情页面的CPU核数显示有问题</msg>
</logentry>
<logentry
   revision="237336">
<author>xiehz</author>
<date>2015-09-16T03:39:18.439719Z</date>
<msg>reviewid:  12206
BUG ID: 31517
Reviewed by: wzt
现象：
TD31517 合入3.7两处修改
改动说明：
1.集群虚拟机备份，需要或能访问主机
2.不管是否恢复到备份位置，都要处理不存在的快照问题
测试：
备份集群虚拟机，备份成功；
恢复虚拟机到其他位置，原来的快照配置被清除</msg>
</logentry>
<logentry
   revision="237333">
<author>chenlei</author>
<date>2015-09-16T03:08:03.447108Z</date>
<msg>reviewid:12209
bugid: 31633
review by:fxw
TD: null 
现象：
合入31603解决bug31633 VS导致VMP内存使用率过高的问题。

问题分析：
vs存储上用fcntl设置O_DIRECT标识没效果，会产生大量的buffer，
open时加O_DIRECT有效果，不会产生buffer。
已叫vs的后续版本支持标准，我们先修改代码规避。

改动说明：先尝试以O_DIRECT打开，失败后再用非O_DIRECT打开

做了哪些测试：
1.测试过不支持directio的samba，能正常运行，strace跟踪返回值如期望。
2.测试过问题场景，不再产生大量buffer</msg>
</logentry>
<logentry
   revision="237332">
<author>jcy</author>
<date>2015-09-16T02:53:19.315050Z</date>
<msg>no review：
bug31275，【模板优化】下次启动的更新提示有问题，挂起状态的虚拟机也会立即更新</msg>
</logentry>
<logentry
   revision="237326">
<author>yangwei</author>
<date>2015-09-16T02:20:39.348249Z</date>
<msg>reviewid 12208
Reviewed by: fxw
BUG ID: null
问题分析：修改vtsn_tool工具
改动说明：
做了一下修改：
1、vs使用的剩余时间和vmp同步。
2、试用版集群添加主机，合并配置接口。
3、修改有期限序列号，uptime判断失败导致主控过期情况。
测试：
1、vtsn_tool -U时间ok。
2、添加主机，合并配置文件，ut合并ok。
3、取消了uptime判断条件，该判断条件不合理。
测试ok</msg>
</logentry>
<logentry
   revision="237301">
<author>fxw</author>
<date>2015-09-15T13:19:35.051186Z</date>
<msg>no review
合入TCMALLOC可能对qemu的其他模块产生影响，存在风险。
暂时不合入。</msg>
</logentry>
<logentry
   revision="237299">
<author>fxw</author>
<date>2015-09-15T13:17:53.507466Z</date>
<msg>no review
合入TCMALLOC可能对qemu的其他模块产生影响，存在风险。
暂时不合入。</msg>
</logentry>
<logentry
   revision="237292">
<author>fxw</author>
<date>2015-09-15T12:53:58.865042Z</date>
<msg>noreview
更新VS代码 至23721</msg>
</logentry>
<logentry
   revision="237288">
<author>fxw</author>
<date>2015-09-15T12:44:17.064854Z</date>
<msg>no review
rename libtcmalloc.so.4 to libtcmalloc.so</msg>
</logentry>
<logentry
   revision="237284">
<author>xiehz</author>
<date>2015-09-15T12:26:01.180605Z</date>
<msg>reviewid:  12196
BUG ID: 31517
Reviewed by: wzt
现象：
TD 31517 [STT-OYHQ]镜像文件中备份信息丢失，恢复时日志提示成功，实际虚拟机里的数据没有恢复到备份时的数据 
改动说明：
删除快照配置，有异地备份的不删除（合入3.7代码）
测试：
1.开机备份虚拟机到位置1，再备份到位置2
2.恢复备份2到备份位置；恢复成功后查看快照列表，两个快照配置都在</msg>
</logentry>
<logentry
   revision="237255">
<author>chenlei</author>
<date>2015-09-15T09:35:44.344831Z</date>
<msg>reviewid:12183
review by:fxw
TD: null 
现象：null
改动说明：
合入SSL修改的spice代码(修改缓存参数未初始化为0的错误)，
并更新libspice-server.so.1文件
测试：</msg>
</logentry>
<logentry
   revision="237252">
<author>fxw</author>
<date>2015-09-15T09:25:23.323078Z</date>
<msg>noreview
去掉无用日志</msg>
</logentry>
<logentry
   revision="237247">
<author>fxw</author>
<date>2015-09-15T09:07:13.250505Z</date>
<msg>noreview
漏删老版本的vs代码</msg>
</logentry>
<logentry
   revision="237246">
<author>fxw</author>
<date>2015-09-15T09:07:06.558031Z</date>
<msg>reviewid:12181 
review by:fxw
TD: null 
现象：null
改动说明：
合入ssl的spice代码，更新libspice-server.so.1文件
测试：</msg>
</logentry>
<logentry
   revision="237244">
<author>fxw</author>
<date>2015-09-15T08:58:42.626812Z</date>
<msg>reviewid:12180
review by:fxw
现象：null
改动说明：
合入SSL对spice和qemu的修改
测试：
编译通过</msg>
</logentry>
<logentry
   revision="237235">
<author>lcy</author>
<date>2015-09-15T08:10:33.661931Z</date>
<msg>reviewid:12156
review by:xhz
TD: 31593
现象：编辑虚拟机，虚拟交换机处，物理口、vlan的值为空，如附件【必改】
改动说明：
编辑和新建虚拟机的时候，无论是HA还是普通虚拟机，统一用/cluster/clustervsw接口获取到虚拟交换机的信息
测试：
和界面联调，自测通过</msg>
</logentry>
<logentry
   revision="237231">
<author>jcy</author>
<date>2015-09-15T07:48:29.090941Z</date>
<msg>no review：
bug31593，编辑虚拟机，虚拟交换机处，物理口、vlan的值为空
</msg>
</logentry>
<logentry
   revision="237230">
<author>xiehz</author>
<date>2015-09-15T07:41:06.454027Z</date>
<msg>reviewid:  12175
BUG ID: 31590
Reviewed by: wzt
现象：
cfs下node_sheed.json残留导致启动虚拟机不均衡
改动说明：
nfs正常时，总是从报表服务查询结果；不正常时才从文件读取；
设定判断nfs超时时间2s，避免nfs异常是卡住很久
测试：
启动集群虚拟机，在失衡的环境上能获取到正确的报表数据</msg>
</logentry>
<logentry
   revision="237203">
<author>fxw</author>
<date>2015-09-15T03:40:19.053888Z</date>
<msg>reviewid: 12167
Reviewed by：fxw
BUGID: 31602
问题分析：
合入上库，代码简单，分析逻辑即可。
【漏合】虚拟机导入导出目录加入到管理空间的目录中去</msg>
</logentry>
<logentry
   revision="237186">
<author>chenlei</author>
<date>2015-09-15T03:25:19.276078Z</date>
<msg>reviewid:12164
review by:fxw
现象：null
改动说明：
合入asv4.2中对qemu的修改</msg>
</logentry>
<logentry
   revision="237135">
<author>xiehz</author>
<date>2015-09-15T01:32:24.019634Z</date>
<msg>reviewid:  12162
BUG ID: 31590
Reviewed by: wzt
现象：
TD 31590 备份虚拟机,备份失败，提示"拷贝磁盘文件失败"
改动说明：
修改错误提示，没必要将文件路径提示出来
测试：
修改错误提示</msg>
</logentry>
<logentry
   revision="237134">
<author>fxw</author>
<date>2015-09-15T01:04:40.456266Z</date>
<msg>noreview
合入VS代码至236803</msg>
</logentry>
<logentry
   revision="237028">
<author>jcy</author>
<date>2015-09-14T12:49:57.153387Z</date>
<msg>no review：
bug31569，VDC虚拟机的“重要虚拟机”选项强制勾选
</msg>
</logentry>
<logentry
   revision="237026">
<author>jcy</author>
<date>2015-09-14T12:43:32.981382Z</date>
<msg>no review：
bug31205，“派生”改为“部署”
</msg>
</logentry>
<logentry
   revision="237004">
<author>lcy</author>
<date>2015-09-14T11:38:53.254981Z</date>
<msg>reviewid:12153
review by:chengtao
TD: 31579
现象：中文版安装，10%的时候出现空白提示，安装完出现英文reboot
改动说明：
把iso-install.sh 文件编码格式改成UTF8 无BOM格式
在vmp_install_main.sh 添加中文“重启”
测试：
打包验证</msg>
</logentry>
<logentry
   revision="236995">
<author>chenlei</author>
<date>2015-09-14T11:16:05.610336Z</date>
<msg>reviewid:12149
bugid: 31569 
review by:gwl
现象：null
改动说明：
fix bug31569 标准版的VDC需要支持重要虚拟机</msg>
</logentry>
<logentry
   revision="236992">
<author>hyq</author>
<date>2015-09-14T11:12:20.388176Z</date>
<msg>reviewid 12144
reviewed by: gwl
BUG ID:     31576
改动说明：
前台页面告警主机内存使用超过100，
获取内存使用率超过100则截断为100

</msg>
</logentry>
<logentry
   revision="236985">
<author>lcy</author>
<date>2015-09-14T10:57:04.671387Z</date>
<msg>reviewid:12150
review by:zyj
TD: 31529
现象：备份虚拟机到windows共享目录，备份失败
改动说明：
qmeu-img info打开镜像文件的时候，删除DirectIO的打开方式。即删除BDRV_O_NOCACHE标志位
测试：
自测通过</msg>
</logentry>
<logentry
   revision="236961">
<author>yangwei</author>
<date>2015-09-14T10:17:41.102750Z</date>
<msg>reviewid 12148
Reviewed by: lifan
BUG ID: null
问题分析：vmp防破解
改动说明：精确匹配授权文件
测试：</msg>
</logentry>
<logentry
   revision="236944">
<author>fxw</author>
<date>2015-09-14T09:22:14.597372Z</date>
<msg>reviewid:  12143
BUG ID: 31556
Reviewed by: lcy
现象：
内存不足启动虚拟机失败提示：主机运行的虚拟机个数已经达到上限(14),不能再运行更多的虚拟机！
改动说明：
提示内存不足
测试：
无</msg>
</logentry>
<logentry
   revision="236938">
<author>xiehz</author>
<date>2015-09-14T08:48:17.821918Z</date>
<msg>reviewid:  12140
BUG ID: 31561
Reviewed by: wzt
现象：
TD 31561 新增备份策略失败，提示“字符串未定义，请先初始化再比较”
改动说明：
配置文件多了 tips字段，这个是3.7加的备份提示才有；需要过滤这个字段
测试：
backup.ini有tips字段；
新增备份策略成功；</msg>
</logentry>
<logentry
   revision="236931">
<author>chenlei</author>
<date>2015-09-14T07:54:05.972558Z</date>
<msg>reviewid:12134 
review by:xhz
现象：null
改动说明：
开机内存算法优化增加一个强制开关，先做在后台。
增加ssd磁盘的swap分区开启开关，默认关闭。
touch /cfs/.enable_ssd_swap，开启ssd磁盘的swap分区
rm -f /cfs/.enable_ssd_swap，关闭ssd磁盘的swap分区</msg>
</logentry>
<logentry
   revision="236924">
<author>xiehz</author>
<date>2015-09-14T07:42:40.284813Z</date>
<msg>reviewid:  12132
BUG ID: 31428
Reviewed by: wzt
现象：
TD 31428【VMP】后台误判ha虚拟机已经运行,实际上是没有运行的，导致虚拟机无法启动了
改动说明：
启动虚拟机过程中，判断有pid就不启动；再增加一个状态判断，若是有pid且不是starting则不允许启动；
测试：
iptable限制住主控不可访问HA虚拟机存储，
启动虚拟机，虚拟机启动失败，状态为starting，再次到另一个节点启动，启动成功；</msg>
</logentry>
<logentry
   revision="236896">
<author>jcy</author>
<date>2015-09-14T06:49:27.436932Z</date>
<msg>no review：
存储速率检查加上提示“受当前业务负载影响...”
</msg>
</logentry>
<logentry
   revision="236877">
<author>yangwei</author>
<date>2015-09-14T05:51:02.010804Z</date>
<msg>reviewid 12124
Reviewed by: fxw
BUG ID: null
问题分析：修改vtsn_tool工具
改动说明：
添加接口：
1、vs的时间单独计算，不再使用ut；
2、在过期检查时候，加大使用时间的误差
3、4.3R2升级过期问题
测试：
1、验证成功。
2、打包验证。
3、测试通过</msg>
</logentry>
<logentry
   revision="236845">
<author>jcy</author>
<date>2015-09-14T03:43:08.164587Z</date>
<msg>no review：
bug31546，未插key时不显示序列号
</msg>
</logentry>
<logentry
   revision="236836">
<author>jcy</author>
<date>2015-09-14T03:24:24.564037Z</date>
<msg>no review：
bug31307，添加主机的地方加上序列号检查
</msg>
</logentry>
<logentry
   revision="236823">
<author>chenlei</author>
<date>2015-09-14T02:44:24.459763Z</date>
<msg>reviewid:12119 
review by:xhz
bugid: 31517
现象：null
改动说明：
合入 bugid: 31359，
虚拟机恢复，判断一个快照本地磁盘镜像上是否存在时，派生虚拟机系统盘也应该判断</msg>
</logentry>
<logentry
   revision="236816">
<author>jcy</author>
<date>2015-09-14T02:02:46.780593Z</date>
<msg>no review：
bug31308，去掉p2v工具的下载链接
</msg>
</logentry>
<logentry
   revision="236804">
<author>fxw</author>
<date>2015-09-14T00:45:25.632105Z</date>
<msg>noreview
更新vs代码至236803</msg>
</logentry>
<logentry
   revision="236801">
<author>gwl</author>
<date>2015-09-13T11:17:52.489425Z</date>
<msg>reviewid: 12112
Reviewed by：fxw
BUGID: 31450
问题分析：
导入vdc虚拟机时，走新建虚拟机流程，有判断如果是vdc虚拟机，会解压qcow2，而导入的虚拟机不需要解压，则解压错误。
修改流程参数，判断如果是导入，则不解压。
</msg>
</logentry>
<logentry
   revision="236799">
<author>chenlei</author>
<date>2015-09-13T10:46:35.489937Z</date>
<msg>reviewid:12111 
review by:fxw
TD: null 
现象：null
改动说明：
注释掉block-cache.c文件中过多的日志</msg>
</logentry>
<logentry
   revision="236798">
<author>lcy</author>
<date>2015-09-13T10:44:57.385084Z</date>
<msg>reviewid:12110
review by:wzt
TD: 31307
现象：adesk版本标准版批量添加两台主机成功 [合入]
改动说明：
合入4.0的改动，TD28582
测试：
在后台测试通过</msg>
</logentry>
<logentry
   revision="236797">
<author>yangwei</author>
<date>2015-09-13T10:17:52.403613Z</date>
<msg>reviewid 12109
Reviewed by: fxw
BUG ID: null
问题分析：vtsn_tool修改
改动说明：
解决一下问题：
1、vs的使用时间单独计算；
2、4.3r2以前升级到4.5过期的问题；
3、没有key，前台注册页面显示了key信息
测试：打包验证</msg>
</logentry>
<logentry
   revision="236789">
<author>fxw</author>
<date>2015-09-13T08:25:05.819315Z</date>
<msg>noreview
TD31543
合入新的代码导致校验失败，跳过这个过程，不影响正常使用</msg>
</logentry>
<logentry
   revision="236781">
<author>gwl</author>
<date>2015-09-13T06:42:22.321248Z</date>
<msg>reviewid: 12108
Reviewed by：fxw
BUGID: 31520
问题分析：
虚拟机中文名的ova，导入失败

中文名称处理有问题，3.7已经解决该bug，漏合入
</msg>
</logentry>
<logentry
   revision="236780">
<author>xiehz</author>
<date>2015-09-13T06:42:13.416834Z</date>
<msg>reviewid:  12107
BUG ID: 31537
Reviewed by: wzt
现象：
TD 31537 vs环境vtprgm服务启动应该与startall接口一样等待vs稳定后再执行
改动说明：
vs环境，主机开机后可能存储还没准备好；vtprgm需要将开机启动虚拟机中的等待cfs可写，vs存储准备的代码调用一次；
测试：
后台查看日志，有等待cfs，vs存储准备日志；
后台kill 一个虚拟机，一会这个虚拟机重新被拉起</msg>
</logentry>
<logentry
   revision="236777">
<author>yangwei</author>
<date>2015-09-13T03:26:02.300637Z</date>
<msg>reviewid 12104
Reviewed by: fxw
BUG ID: null
问题分析：修该vdc请求vmp试用信息
改动说明：非试用版未过期。无限制使用返回0
测试：打包环境验证语法无误</msg>
</logentry>
<logentry
   revision="236776">
<author>lcy</author>
<date>2015-09-13T03:16:50.945871Z</date>
<msg>reviewid:12105
review by:xhz
TD: 31449
现象：单台主机，HA虚拟机接虚拟机交换，虚拟机交换机接的网口没有插网线，HA虚拟机都启动不了
改动说明：
在tools.pm的选择主机的函数中，即get_cvm_nodes函数中，增加判断，假如集群中只有一台主机，不判断虚拟机连接的网络的情况
测试：
自测通过</msg>
</logentry>
<logentry
   revision="236774">
<author>fxw</author>
<date>2015-09-12T13:19:01.965812Z</date>
<msg>noreview
合入VS代码 236747</msg>
</logentry>
<logentry
   revision="236771">
<author>fxw</author>
<date>2015-09-12T12:42:14.457395Z</date>
<msg>reviewid:12103 
review by:fxw
TD: null 
现象：null
改动说明：
合入SSL那边的广域网优化修改的spice代码，需要更新libspice.so文件
测试：</msg>
</logentry>
<logentry
   revision="236770">
<author>fxw</author>
<date>2015-09-12T12:35:26.206759Z</date>
<msg>reviewid:12102
review by:fxw
TD: null 
现象：null
改动说明：
合入马长春的广域网优化修改的代码（spice）
测试：
编译通过</msg>
</logentry>
<logentry
   revision="236765">
<author>xiehz</author>
<date>2015-09-12T11:58:53.495888Z</date>
<msg>reviewid:  12093
BUG ID: 30967
Reviewed by: wzt
现象：
TD 30967 [老功能]开启重启还原模式的虚拟机无法故障迁移
改动说明：
1.不影响虚拟机启动，虚拟机有快照也要能启动，配置中可以残留快照配置；（若配置中有template_update字段则不允许启动，否则会导致重复还原虚拟机）
2.镜像上不存在的快照，获取快照列表时隐藏起来不显示；
测试：
1.派生虚拟机有快照，和异地备份，勾上重启还原，主控离线后，ha到从节点
2.主控上线，查看虚拟机备份，只显示异地备份
3.查看后台日志，01update_tpl.pl.log中记录了主控离线，不删除快照配置的日志</msg>
</logentry>
<logentry
   revision="236763">
<author>lcy</author>
<date>2015-09-12T11:53:37.144068Z</date>
<msg>reviewid:12100
review by:fxw
TD: 31074
现象：修改HA虚拟机不能启动的提示信息
改动说明：
改为这个：没有主机能够启动这个虚拟机，可能的原因：\n1. 主机离线\n2. 主机内存不足\n3. 虚拟机所在存储离线\n4. 虚拟机所连网络断开
测试：
自测通过</msg>
</logentry>
<logentry
   revision="236760">
<author>yangwei</author>
<date>2015-09-12T11:40:13.944546Z</date>
<msg>reviewid 12098
Reviewed by: gwl
BUG ID: 30845
问题分析：TD30845编辑VDC出现，“无效的序列号”
改动说明：
测试：VDC虚拟机的后台配置文件里面添加secretkey这个字段，字段的值随便写，然后前台编辑保存能成功。测试ok</msg>
</logentry>
<logentry
   revision="236751">
<author>fxw</author>
<date>2015-09-12T10:54:02.341892Z</date>
<msg>noreview

合入ova compat相关文件（实际上是合入p2v代码目录及相关文件）</msg>
</logentry>
<logentry
   revision="236750">
<author>fxw</author>
<date>2015-09-12T10:53:05.650668Z</date>
<msg>noreview

合入ova compat相关文件（实际上是合入p2v代码目录及相关文件）</msg>
</logentry>
<logentry
   revision="236749">
<author>fxw</author>
<date>2015-09-12T10:51:19.101890Z</date>
<msg>noreview

合入ova compat相关文件（实际上是合入p2v代码目录及相关文件）</msg>
</logentry>
<logentry
   revision="236745">
<author>fxw</author>
<date>2015-09-12T10:25:48.717335Z</date>
<msg>noreview

合入ova compat相关文件（实际上是合入p2v代码目录及相关文件）</msg>
</logentry>
<logentry
   revision="236744">
<author>fxw</author>
<date>2015-09-12T10:25:24.853870Z</date>
<msg>noreview

合入ova compat相关文件（实际上是合入p2v代码目录及相关文件）</msg>
</logentry>
<logentry
   revision="236741">
<author>fxw</author>
<date>2015-09-12T10:14:21.512303Z</date>
<msg>noreview

合入zh_CN.yml</msg>
</logentry>
<logentry
   revision="236740">
<author>fxw</author>
<date>2015-09-12T10:14:01.427422Z</date>
<msg>noreview

合入zh_CN.yml</msg>
</logentry>
<logentry
   revision="236739">
<author>fxw</author>
<date>2015-09-12T10:12:14.633930Z</date>
<msg>noreview
合入vs包
</msg>
</logentry>
<logentry
   revision="236736">
<author>fxw</author>
<date>2015-09-12T10:09:10.638816Z</date>
<msg>noreview

删除vs包，接下来合入新包</msg>
</logentry>
<logentry
   revision="236723">
<author>fxw</author>
<date>2015-09-12T09:37:39.473158Z</date>
<msg>noreview

复制3.7的p2v到4.5</msg>
</logentry>
<logentry
   revision="236721">
<author>fxw</author>
<date>2015-09-12T09:36:17.527922Z</date>
<msg>noreview
删除4.5原来的p2v</msg>
</logentry>
<logentry
   revision="236713">
<author>hyq</author>
<date>2015-09-12T09:19:01.473582Z</date>
<msg>reviewid 12091
reviewed by: gwl
BUG ID:     31510
改动说明：
td31510：vdc派生虚拟机失败，提示获取存储（host-4c72b9d27d49_local）的类型信息失败！
</msg>
</logentry>
<logentry
   revision="236694">
<author>fxw</author>
<date>2015-09-12T07:05:29.895370Z</date>
<msg>noreview
合入VS代码 143157</msg>
</logentry>
<logentry
   revision="236689">
<author>chenlei</author>
<date>2015-09-12T04:56:32.682904Z</date>
<msg>reviewid:12085
bug id:31453
review by:gwl
TD: null 
现象：null
改动说明：
fix[bug id:31453] 【序列号】标准版编辑虚拟机为重要虚拟机，应该要报错
测试：
自测通过</msg>
</logentry>
<logentry
   revision="236687">
<author>yangwei</author>
<date>2015-09-12T04:09:46.821228Z</date>
<msg>reviewid 12084
Reviewed by: fxw
BUG ID: 31464
问题分析：注册页面卡
改动说明：解决飞天页面卡问题，使用配置文件进行更新
测试：</msg>
</logentry>
<logentry
   revision="236679">
<author>fxw</author>
<date>2015-09-12T02:35:50.728321Z</date>
<msg>reviewid: 12074
reviewd by: fxw
bugid: 
问题原因：
SangforVMSTools.iso里面的exe没有签名
改动说明：
重新签名</msg>
</logentry>
<logentry
   revision="236674">
<author>chenlei</author>
<date>2015-09-12T01:18:30.693032Z</date>
<msg>reviewid:12068
review by:fxw
TD: null 
现象：null
改动说明：
支持12个USB1.0设备去掉可配置功能，回滚前后台代码。
测试：</msg>
</logentry>
<logentry
   revision="236669">
<author>yangwei</author>
<date>2015-09-11T12:12:26.029792Z</date>
<msg>reviewid 12070
Reviewed by: hyq
BUG ID: 31463
问题分析：【试用模式】飞天key未烧写序列号，读取序列号会乱码
改动说明：判断读出的数据是否为脏数据，如果为脏数据，则将数据清零
测试：插入未写过数据的key，在序列号页面测试没有乱码，显示为空。测试ok。</msg>
</logentry>
<logentry
   revision="236652">
<author>yangwei</author>
<date>2015-09-11T09:02:51.064606Z</date>
<msg>reviewid 12065
Reviewed by: wzt
BUG ID: 31352
问题分析：NULL
改动说明：raid本地存储测速跟实际差距上千倍-合入31259 [合入]
测试：</msg>
</logentry>
<logentry
   revision="236643">
<author>yangwei</author>
<date>2015-09-11T08:14:19.504664Z</date>
<msg>reviewid 12062
Reviewed by: fxw
BUG ID: null
问题分析：插上飞天，拔掉，再插上dog，用户名此时应该被清空。
改动说明：
测试：</msg>
</logentry>
<logentry
   revision="236623">
<author>yangwei</author>
<date>2015-09-11T04:32:34.598916Z</date>
<msg>reviewid 12058
Reviewed by: gwl
BUG ID: null
问题分析：vtsn工具更新
改动说明：不存在授权文件时候，不拷贝文件进行修改
测试：</msg>
</logentry>
<logentry
   revision="236622">
<author>yangwei</author>
<date>2015-09-11T04:01:56.469436Z</date>
<msg>reviewid 12057
Reviewed by: gwl
BUG ID: 31446
问题分析：bug31446 试用期vm核数限制
改动说明：试用模式试用版限制为2核
测试：试用期新建虚拟机核数大于2，虚拟机启动失败没提示错误正确。测试ok</msg>
</logentry>
<logentry
   revision="236617">
<author>lcy</author>
<date>2015-09-11T03:07:13.741953Z</date>
<msg>reviewid:12056
review by:hyq
TD: 31442
现象：点击主机，存储，列表未列出本地存储
改动说明：
在接口storage_list中，增加一个获取本地存储的标志。
测试：
自测通过</msg>
</logentry>
<logentry
   revision="236616">
<author>yangwei</author>
<date>2015-09-11T02:52:51.621576Z</date>
<msg>reviewid 12051
Reviewed by: hyq
BUG ID: null
问题分析：vs信息获取
改动说明：修改剩余天数
测试：</msg>
</logentry>
<logentry
   revision="236609">
<author>yangwei</author>
<date>2015-09-11T01:32:06.760885Z</date>
<msg>reviewid 12047
Reviewed by: hyq
BUG ID: null
问题分析：vs信息获取
改动说明：修改剩余天数计算bug
测试：</msg>
</logentry>
<logentry
   revision="236607">
<author>fxw</author>
<date>2015-09-10T15:03:15.062017Z</date>
<msg>noreview
更新vs代码包</msg>
</logentry>
<logentry
   revision="236605">
<author>fxw</author>
<date>2015-09-10T15:01:03.648880Z</date>
<msg>noreview
Merged revision(s) 236578-236583 from Personal/fxw/VMP4.5/Trunk/source:
状态页面添加几副本显示
........
状态页面添加几副本显示
........

</msg>
</logentry>
<logentry
   revision="236604">
<author>fxw</author>
<date>2015-09-10T14:59:44.674892Z</date>
<msg>noreview
合入vs分支 236570</msg>
</logentry>
<logentry
   revision="236601">
<author>fxw</author>
<date>2015-09-10T14:44:30.861907Z</date>
<msg>noreview
Merged revision(s) 236510, 236515, 236551, 236563 from Personal/fxw/VMP4.5/Trunk/source:
序列号校验失败不允许点击下一步
........
aDesk版本试用版也可以使用vs
........
//修改vminfo_list接口，提供on_vs字段判断是否vm是否运行在vs上
........
初始化时进行CPU和内存检查页面代码
........
</msg>
</logentry>
<logentry
   revision="236600">
<author>fxw</author>
<date>2015-09-10T14:31:03.296970Z</date>
<msg>noreview
Merged revision(s) 236431 from Personal/fxw/VMP4.5/Trunk/source:
VMP4.1漏合入
........

</msg>
</logentry>
<logentry
   revision="236599">
<author>yangwei</author>
<date>2015-09-10T14:23:45.694622Z</date>
<msg>reviewid 12046
Reviewed by: fxw
BUG ID: null
问题分析：vtsn_tool创建文件失败
改动说明：open函数添加创建标记
测试：</msg>
</logentry>
<logentry
   revision="236574">
<author>jcy</author>
<date>2015-09-10T13:07:02.065521Z</date>
<msg>no review：
修改 VS序列号详情
</msg>
</logentry>
<logentry
   revision="236573">
<author>yangwei</author>
<date>2015-09-10T13:02:58.015375Z</date>
<msg>reviewid 12044
Reviewed by: gwl
BUG ID: null
问题分析：NULL
改动说明：vs 授权信息获取
测试：后天返回数据正确，测试ok</msg>
</logentry>
<logentry
   revision="236562">
<author>fxw</author>
<date>2015-09-10T11:08:15.686097Z</date>
<msg>reviewid:12039
bug id: 31253
review by:fxw
TD: null 
现象：null
改动说明：
合入30996(bugid) ，解决VMP前台页面告警提示数目显示的问题
测试：
自测通过</msg>
</logentry>
<logentry
   revision="236558">
<author>yangwei</author>
<date>2015-09-10T10:53:11.901549Z</date>
<msg>reviewid 12038
Reviewed by: gwl
BUG ID: null
问题分析：授权信息获取代码bug
改动说明：vs授权默认值为空，不支持vs的vmp，在填充vs支持字段出错。添加默认值
测试：</msg>
</logentry>
<logentry
   revision="236557">
<author>lifan</author>
<date>2015-09-10T10:27:46.260503Z</date>
<msg>noreview
序列号防破解相关修改

</msg>
</logentry>
<logentry
   revision="236552">
<author>jcy</author>
<date>2015-09-10T09:59:14.670634Z</date>
<msg>no review：
bug26962，迁移时虚拟交换机不存在添加提示
</msg>
</logentry>
<logentry
   revision="236549">
<author>hyq</author>
<date>2015-09-10T09:50:51.570934Z</date>
<msg>reviewid 12034
reviewed by: gwl
BUG ID:     28210
改动说明：
[老功能]虚拟机本地备份后进行恢复提示恢复失败【历史遗留，合入VMP4.5】
</msg>
</logentry>
<logentry
   revision="236548">
<author>yangwei</author>
<date>2015-09-10T09:48:23.898076Z</date>
<msg>reviewid 12033
Reviewed by: gwl
BUG ID: 31392
问题分析：VMP4.5 飞天key支持
改动说明：增加飞天key插拔响应，在更换key情况下，可以及时响应。
测试：有key状态，拔掉key，更换key，可以授权信息可以立即更新到新key。测试ok</msg>
</logentry>
<logentry
   revision="236547">
<author>fxw</author>
<date>2015-09-10T09:44:46.028052Z</date>
<msg>noreview
帮zxq上库
合入TD29460的修改</msg>
</logentry>
<logentry
   revision="236542">
<author>xiehz</author>
<date>2015-09-10T09:26:34.621651Z</date>
<msg>reviewid:  12026
BUG ID: 26962
Reviewed by: fxw
现象：
TD 26962 合入3.5 迁移虚拟机加上目的主机网络检查
改动说明：
TD 26962 合入3.5 迁移虚拟机加上目的主机网络检查
测试：
后台调用access_node接口，传入vmid，输出信息正确</msg>
</logentry>
<logentry
   revision="236541">
<author>hyq</author>
<date>2015-09-10T09:25:49.229870Z</date>
<msg>Merged revision(s) 40297 from VTP/VMP3.6/Trunk:
reviewid 12028
reviewed by: fxw
BUG ID:     29556

问题分析：
vnc 客户端发送 与 +时，查找先前加载的映射表，计算出keycode，对于 与 + ，keycode计算值无误，但是在key_event中进行&amp;0xff操作，
导致keycode与8和“=”号冲突

改动说明：
对于小键盘的*和+直接将其映射表键值翻译成common中定义的
........
</msg>
</logentry>
<logentry
   revision="236529">
<author>chenlei</author>
<date>2015-09-10T08:24:44.370990Z</date>
<msg>reviewid:12023
bug id: 31355
review by:xhz
TD: null 
现象：null
改动说明：
日志进度超过100%就用99%代替。
测试：</msg>
</logentry>
<logentry
   revision="236526">
<author>yangwei</author>
<date>2015-09-10T08:06:57.101768Z</date>
<msg>reviewid 12019
Reviewed by: lifan
BUG ID: null
问题分析：VMP防泄密
改动说明：
测试：</msg>
</logentry>
<logentry
   revision="236525">
<author>zhangxin</author>
<date>2015-09-10T08:01:49.288116Z</date>
<msg>reviewid 12022

回滚  28165 虚拟设备开机状态下恢复异地备份，备份快照丢失[合入3.6][老功能][fixed]【修改之后的提示语存在问题】【历史遗留，合入VMP4.5】</msg>
</logentry>
<logentry
   revision="236524">
<author>fxw</author>
<date>2015-09-10T07:58:39.426408Z</date>
<msg>noreview
合代码的时候
编码变了导致编译出错</msg>
</logentry>
<logentry
   revision="236517">
<author>wzt</author>
<date>2015-09-10T07:10:23.056032Z</date>
<msg>reviewid 12016
review by: wuyy
TD：30865
现象： bug 【老功能】在管理存储空间带特殊字符目录下上传ISO文件失败
改动说明：
添加对|线的处理
测试OK
</msg>
</logentry>
<logentry
   revision="236516">
<author>xiehz</author>
<date>2015-09-10T07:04:49.860052Z</date>
<msg>reviewid:  12012
BUG ID: 27883
Reviewed by: wzt
现象：
合入3.5 qemu-img check去掉-r参数
改动说明：
合入3.5 qemu-img check去掉-r参数
测试：
1.创建虚拟机，选择iso；在后台将iso重命名，创建虚拟机成功；
2.编辑虚拟机，选择iso；在后台将iso重命名，编辑失败，提示：指定的iso文件不存在</msg>
</logentry>
<logentry
   revision="236512">
<author>wzt</author>
<date>2015-09-10T06:49:51.716464Z</date>
<msg>reviewid 12011
review by: wuyy
TD：30866
现象：bug 30866 开启共享目录管理服务，windows无法访问存储目录
改动说明：
修改一下user.cfg的默认配置文件
测试OK


</msg>
</logentry>
<logentry
   revision="236508">
<author>fxw</author>
<date>2015-09-10T06:42:20.926926Z</date>
<msg>noreview
Merged revision(s) 40426 from VTP/VMP3.6/Trunk/source/app/vtp-cluster:
reviewed by: zhangqian
BUG ID:    28057

问题分析：
网卡不正常操作，就会导致获取信息有问题，所以一起对这些问题作一个处理

I.
系统重启-&gt; 网卡初始化延迟 --＞　corosync 捕捉不到正确的网络信息 --&gt; 按照原生流程assert退出

II.
在后台手动ifdown网卡，就有一定几率出现此断言错误。
当前最稳妥的修改方案，就是去掉断言，而是打日志后直接退出，让其自动恢复。

改动说明：[NULL]
........
</msg>
</logentry>
<logentry
   revision="236504">
<author>fxw</author>
<date>2015-09-10T06:33:52.018734Z</date>
<msg>noreview
合入VMP4.0 40413
reviewed by: zhangqian
BUG ID:      26720

问题分析：
signal信号处理函数中调用了不可重入函数exit（）
exit（）函数在调用exit系统之前要检查文件的打开情况，
把文件缓冲区的内容写回文件。 而系统正在调用syslog，而由于文件比得比较慢，
处在write时，被信号处理函数抢占，exit也把文件缓冲去的内容写回同文件，所以
就出问题了。 改用_exit，如数据还保存在缓冲区内，
这时用_exit()函数直接将进程关闭，缓冲区的数据就会丢失。
可能导致syslog日志没有输出到文件。但从代码来看，这个无影响。
在不过多改动代码逻辑的情况下，用此方式是相对合理的。

改动说明：
信号处理函数中用_exit取代exit+
</msg>
</logentry>
<logentry
   revision="236503">
<author>jcy</author>
<date>2015-09-10T06:32:58.028918Z</date>
<msg>no review：
bug31338，注册了企业版序列号后，隐藏掉“过期提醒”的提示</msg>
</logentry>
<logentry
   revision="236502">
<author>jcy</author>
<date>2015-09-10T06:30:18.980267Z</date>
<msg>no review：
bug31338，注册了企业版序列号后，隐藏掉“升级序列号”的提示</msg>
</logentry>
<logentry
   revision="236500">
<author>fxw</author>
<date>2015-09-10T06:26:09.291883Z</date>
<msg>noreview
Merged revision(s) 47790 from VTP/VMP4.1/Alternate/build/pkg/replace-root/sf/bin:
Reviewed by：jyz
问题分析：TD 30421，[VS2.0]在五舟的3500上面通过raidstat读取出来的值为no RAID controller exist in system(vstd29972)
改动：vs新设备的lspic信息输出比较特殊，修改了脚本的匹配方式。
测试：在vs的环境实际验证过
........
</msg>
</logentry>
<logentry
   revision="236497">
<author>jcy</author>
<date>2015-09-10T05:07:23.661251Z</date>
<msg>no review：
不合bug30975了，回滚掉“导入虚拟机支持配置HA”的代码
</msg>
</logentry>
<logentry
   revision="236495">
<author>zhangxin</author>
<date>2015-09-10T04:48:29.825380Z</date>
<msg>reviewid 12004

28165 虚拟设备开机状态下恢复异地备份，备份快照丢失[合入3.6][老功能][fixed]【修改之后的提示语存在问题】【历史遗留，合入VMP4.5】</msg>
</logentry>
<logentry
   revision="236490">
<author>chenlei</author>
<date>2015-09-10T03:58:03.293662Z</date>
<msg>reviewid:12005
bug id: 31369
review by:fxw
TD: null 
现象：null
改动说明：
合入31348代码，解决qcow2_snap_diff在低内存环境会出现备份失败(nbd问题)
测试：</msg>
</logentry>
<logentry
   revision="236489">
<author>gwl</author>
<date>2015-09-10T03:55:59.024414Z</date>
<msg>reviewid: 12009
Reviewed by：hyq
BUGID: 31398
问题分析：
支持从节点下载vma
合入，上库后验证。</msg>
</logentry>
<logentry
   revision="236488">
<author>wyy</author>
<date>2015-09-10T03:51:24.689027Z</date>
<msg>reviewid: 12008
reviewed by xhz
BUGID 30836
问题说明：【自动升级】前台升级补丁包有问题，需要手动重启--zyc回归通过【历史遗留，合入VMP4.5】
改动说明：【自动升级】前台升级补丁包有问题，需要手动重启--zyc回归通过【历史遗留，合入VMP4.5】
测试：</msg>
</logentry>
<logentry
   revision="236487">
<author>fxw</author>
<date>2015-09-10T03:47:08.953907Z</date>
<msg>reviewid: 12001
Reviewed by：hyq
BUGID: 
问题分析：
bug31393   导入导出虚拟机，支持导入到主控不可访问的共享存储上
合入，上库后验证。


</msg>
</logentry>
<logentry
   revision="236485">
<author>wyy</author>
<date>2015-09-10T03:44:06.802235Z</date>
<msg>reviewid: 12006
reviewed by wzt
BUGID 29482
问题说明：【内部反馈】升级失败，而且还提示升级完成，并出现重启按钮【历史遗留，合入VMP4.5】
改动说明：【内部反馈】升级失败，而且还提示升级完成，并出现重启按钮【历史遗留，合入VMP4.5】
测试：</msg>
</logentry>
<logentry
   revision="236480">
<author>wyy</author>
<date>2015-09-10T03:33:32.960242Z</date>
<msg>reviewid: 11999
reviewed by wzt
BUGID 29940
问题说明：[老功能]虚拟机开机自启动失败，没有打操作日志【cxh回归通过-可以closed】【历史遗留，合入VMP4.5】
改动说明：[老功能]虚拟机开机自启动失败，没有打操作日志【cxh回归通过-可以closed】【历史遗留，合入VMP4.5】
测试：</msg>
</logentry>
<logentry
   revision="236475">
<author>jcy</author>
<date>2015-09-10T03:23:07.464120Z</date>
<msg>no review：
bug31184，标准版 查看授权USB-KEY的购买方式，页面跳转问题。</msg>
</logentry>
<logentry
   revision="236473">
<author>chenzhuoyou</author>
<date>2015-09-10T03:11:02.855680Z</date>
<msg>reviewid 12000
Reviewed by: fxw
BUG ID: 29131
问题分析：合入vmp3.6的BUG改动：
Revision: 43374
Author: chenzhuoyou
Date: 2015年6月6日 11:27:13
Message:
reviewid 8823
Reviewded by: lixing
BUG ID: 29131
问题分析：qemu2.0中qemu-nbd默认不开启discard支持，导致某些备份场景有问题
改动说明：加入参数--discard=on
做了哪些测试：测试脚本测试发现的问题，改动后测试脚本结果正确
Modified : /VTP/VMP3.6/Trunk/source/app/vtp-qemu-server/VTP/QemuBackRecovery.pm</msg>
</logentry>
<logentry
   revision="236469">
<author>jcy</author>
<date>2015-09-10T03:08:05.380969Z</date>
<msg>no review：
bug30975，导入虚拟机支持配置HA</msg>
</logentry>
<logentry
   revision="236468">
<author>lzw</author>
<date>2015-09-10T03:05:44.567203Z</date>
<msg>reviewid 11995
Reviewed by :fxw
BUG ID :29737
问题分析：合入bug29737
改动说明：合入bug29737
做了哪些测试:
没有测试

</msg>
</logentry>
<logentry
   revision="236466">
<author>lzw</author>
<date>2015-09-10T02:50:33.407789Z</date>
<msg>reviewid 11993
Reviewed by :fxw
BUG ID :29725
问题分析：合入bug29725
改动说明：4.5没有这个文件，最开始添加这个文件是由于bug28761。考虑到这个脚本是每天去重启服务，觉得这两个问题都应该处理，直接添加没问题
做了哪些测试:
没有测试

</msg>
</logentry>
<logentry
   revision="236464">
<author>lmh</author>
<date>2015-09-10T02:40:05.434770Z</date>
<msg>reviewid : 11994
Reviewed by：czy,fxw
BUG ID：30327
问题分析:
在apache启动之前随机端口的应用，随机到apache服务端口，导致apache无法启动；
改动说明:
将apache的端口在sysctl.conf中设置为保留端口，端口随机分配时时会排除这些端口
</msg>
</logentry>
<logentry
   revision="236462">
<author>jcy</author>
<date>2015-09-10T02:36:30.560652Z</date>
<msg>no review：
bug28510，上传文件的名称限制空格</msg>
</logentry>
<logentry
   revision="236460">
<author>lmh</author>
<date>2015-09-10T02:34:48.425752Z</date>
<msg>reviewid : 11991
Reviewed by：czy
BUG ID：30690
问题分析:
序列号服务存在内存泄露，在关闭文件时，未释放与之相关的资源
导致内存泄露
改动说明:
在关闭文件时，释放相关的资源
</msg>
</logentry>
<logentry
   revision="236453">
<author>lcy</author>
<date>2015-09-10T01:27:00.078293Z</date>
<msg>reviewid:11986
review by:czy
TD: 31367
现象：日志查询任务多，导致页面卡死。
改动说明：
合入3.7的日志优化代码
测试：
打包验证</msg>
</logentry>
<logentry
   revision="236446">
<author>yangwei</author>
<date>2015-09-09T14:01:06.016882Z</date>
<msg>reviewid 11985
Reviewed by: fxw
BUG ID: TD31216 TD31225、TD31342
问题分析：解决一下问题：
1、没有用户名称，默认为空。【TD31216】
2、优化序列号页面慢的问题，读取用户名到文件，页面请求用户名，直接从文件读取。【TD31216、TD31342】
3、飞天插入从节点页面不能显示key信息。[31325]
4、合入zxq防破解代码。
改动说明：
测试：1-3测试ok</msg>
</logentry>
<logentry
   revision="236438">
<author>chenlei</author>
<date>2015-09-09T12:03:20.963911Z</date>
<msg>reviewid:11981
bugid: 29585
review by:fxw
TD: null 
现象：null
改动说明：
自动检测SQLite数据库是否损坏，
如果数据库文件损坏了，将其备份，并重启vtplogd服务
测试：
自测通过</msg>
</logentry>
<logentry
   revision="236427">
<author>xiehz</author>
<date>2015-09-09T10:20:10.125563Z</date>
<msg>reviewid: 11974
BUG ID: 31353
Reviewed by: wzt
现象：
TD 31353 【虚拟机】新建虚拟机，加载的ISO路径不离线/不存在会导致新建失败，见附件
改动说明：
页面选择iso时存储在线，真正创建时存储离线了，报镜像不存在；
1.创建虚拟机，iso不存在无需报错
2.编辑虚拟机，iso不存在报指定的iso文件不存在
测试：
1.创建虚拟机，选择iso；在后台将iso重命名，创建虚拟机成功；
2.编辑虚拟机，选择iso；在后台将iso重命名，编辑失败，提示：指定的iso文件不存在</msg>
</logentry>
<logentry
   revision="236423">
<author>jcy</author>
<date>2015-09-09T09:59:14.098271Z</date>
<msg>no review：
bug31343，更改序列号时的提示排版有问题</msg>
</logentry>
<logentry
   revision="236420">
<author>hyq</author>
<date>2015-09-09T09:41:21.892906Z</date>
<msg>reviewid: 11976
Reviewed by: gwl
改动说明：
【模板优化】
1、回滚模板优化相关代码</msg>
</logentry>
<logentry
   revision="236417">
<author>chenlei</author>
<date>2015-09-09T09:22:42.667427Z</date>
<msg>reviewid:11973 
review by:fxw
TD: null 
现象：null
改动说明：
合入SSL那边的广域网优化修改的spice代码，需要更新libspice.so文件
测试：</msg>
</logentry>
<logentry
   revision="236411">
<author>chenlei</author>
<date>2015-09-09T09:01:36.029113Z</date>
<msg>reviewid:11972
review by:fxw
TD: null 
现象：null
改动说明：
合入马长春的广域网优化修改的代码（spice）
测试：
编译通过</msg>
</logentry>
<logentry
   revision="236408">
<author>jcy</author>
<date>2015-09-09T08:48:49.583620Z</date>
<msg>no review：
bug31365，导入虚拟机时，js脚本错误</msg>
</logentry>
<logentry
   revision="236404">
<author>fxw</author>
<date>2015-09-09T08:41:38.554544Z</date>
<msg>noreview
路径写错了</msg>
</logentry>
<logentry
   revision="236403">
<author>xiehz</author>
<date>2015-09-09T08:25:21.476293Z</date>
<msg>reviewid: 11971
BUG ID: 31189
Reviewed by: wzt
现象：
TD 31189 [开机自启动]VDC虚拟机勾选了开机自启动，重启VMP，VDC虚拟机启动失败
改动说明：
开机后，虚拟机所在存储有5分钟左右一直处于离线状态，启动超时了；
在开机启动的地方，将存储离线的虚拟机分离出来，最长重试450s，判断存储是否上线，上线了则启动，否则超时退出
测试：
有1个vm在local存储上，有两个vm在iscsi上；
将iscsi存储离线；
1.后台调用startall接口：local存储上的vm立马启动了；iscsi上的vm一直未启动，过了2分钟，将iscsi存储上线，iscsi上的两个vm启动了；
2.后台调用startall接口：local存储上的vm立马启动了；iscsi上的vm一直未启动，超过450s后超时，startall接口退出，iscsi上的两个vm未启动；</msg>
</logentry>
<logentry
   revision="236401">
<author>jcy</author>
<date>2015-09-09T07:54:40.307279Z</date>
<msg>no review：
bug31080，集群主控离线时，且没有配集群IP，访问从节点时提示设置该节点为主控</msg>
</logentry>
<logentry
   revision="236383">
<author>fxw</author>
<date>2015-09-09T06:27:12.369856Z</date>
<msg>reviewid: 11967
reviewd by: lzw
bugid: 
问题原因：
证书更新之后，重新打包WinPE
改动说明：
</msg>
</logentry>
<logentry
   revision="236380">
<author>fxw</author>
<date>2015-09-09T04:05:08.417848Z</date>
<msg>noreview
上库 VS平滑升级脚本
</msg>
</logentry>
<logentry
   revision="236379">
<author>fxw</author>
<date>2015-09-09T04:04:26.982968Z</date>
<msg>noreview
合入vs代码 236361</msg>
</logentry>
<logentry
   revision="236378">
<author>gwl</author>
<date>2015-09-09T03:56:14.811115Z</date>
<msg>reviewid: 11962
Reviewed by：hyq
BUGID: 
问题分析：
解决bug31335

导入导入自测通过。


</msg>
</logentry>
<logentry
   revision="236362">
<author>fxw</author>
<date>2015-09-09T02:21:28.422202Z</date>
<msg>reviewid: 11956
reviewd by: fangfei
bugid: 
问题原因：
证书更新之后，重新生成iso
改动说明：
</msg>
</logentry>
<logentry
   revision="236358">
<author>fxw</author>
<date>2015-09-09T02:07:59.017023Z</date>
<msg>reviewid: 11953
reviewd by: lzw
bugid: 
问题原因：
更新证书之后，重新打包升级模块zip
改动说明：
</msg>
</logentry>
<logentry
   revision="236356">
<author>fxw</author>
<date>2015-09-09T01:47:39.804294Z</date>
<msg>reviewid: 11951
reviewd by: fangfei
bugid: 
问题原因：
更新驱动证书
改动说明：
</msg>
</logentry>
<logentry
   revision="236345">
<author>yangwei</author>
<date>2015-09-08T13:59:03.759350Z</date>
<msg>reviewid 11949
Reviewed by: gwl
BUG ID: null
问题分析：试用授权模式升级和飞天读写优化
改动说明：
试用授权模式：平滑升级设置标记文件，重启开机检测标记文件，调用vtsn_tool，重置ut，使用rutt字段确保ut只会被重置一次。
飞天读写优化：减少读写设备枚举
测试：</msg>
</logentry>
<logentry
   revision="236048">
<author>fxw</author>
<date>2015-09-08T13:45:20.351260Z</date>
<msg>reviewid: 11950
reviewd by: fxw
bugid: 
问题原因：
winpe有毒文件替换
改动说明：
</msg>
</logentry>
<logentry
   revision="235795">
<author>fxw</author>
<date>2015-09-08T13:32:13.530654Z</date>
<msg>reviewid: 11948
reviewd by: fxw
bugid: 
问题原因：
替换报表有毒文件
改动说明：
</msg>
</logentry>
<logentry
   revision="235484">
<author>fxw</author>
<date>2015-09-08T13:19:40.517685Z</date>
<msg>reviewid: 11946
reviewd by: lzw
bugid: 
问题原因：
升级模块有毒文件替换
改动说明：
</msg>
</logentry>
<logentry
   revision="234708">
<author>chengtao</author>
<date>2015-09-08T12:40:30.544969Z</date>
<msg>reviewid: 11942
reviewd by: fxw
bugid: 
问题原因：
从3.1替换4.5的svn库上有毒的exe文件（驱动）
改动说明：
</msg>
</logentry>
<logentry
   revision="234622">
<author>jcy</author>
<date>2015-09-08T12:36:27.738345Z</date>
<msg>no review：
bug31331，加上导出的图标</msg>
</logentry>
<logentry
   revision="233561">
<author>lcy</author>
<date>2015-09-08T11:43:00.443864Z</date>
<msg>reviewid:11937
review by:lbc
TD: 31083
现象：利尔高温材料 客户网络不稳定，导致虚拟机启动脚本误判，更新了模版
改动说明：
合入lbc修改的脚本代码。网络断线时，VS存储有个交叉同步的过程，这段时间存储内的文件是不可读的。此时有个临界点，拉起虚拟机回调了/sf/etc/hook.d/kvm/start.d/01update_tpl.sh脚本，脚本中下面这个语句读出value2为空，导致还原了虚拟机。
测试：
打包验证</msg>
</logentry>
<logentry
   revision="231049">
<author>yangwei</author>
<date>2015-09-08T08:44:52.060599Z</date>
<msg>reviewid 11933
Reviewed by: hyq
BUG ID: null
问题分析：试用模式-升级
改动说明：试用模式的升级需求。该脚本影响升级，删除该文件，并重新设计。
测试：</msg>
</logentry>
<logentry
   revision="230735">
<author>yangwei</author>
<date>2015-09-08T08:14:36.311004Z</date>
<msg>reviewid 11921
Reviewed by: hyq
BUG ID: 30905
问题分析：从节点测试虚拟磁盘速度：主控未将测速命令发到从节点而是自己测速，导致配置文件中没有从节点的测速信息而无法显示。
改动说明：增加对vs的判断，是哪一个节点测速
测试：从节点测试vs速度，前台显示正常，测试ok</msg>
</logentry>
<logentry
   revision="229589">
<author>gwl</author>
<date>2015-09-08T06:49:18.254793Z</date>
<msg>reviewid: 11925
Reviewed by：hyq
BUGID: 
问题分析：
配合模板优化代码回滚，修改部分代码，改为兼容两种模板格式。
跨主机导出模板失败，缺少部分脚本代码，补上。
</msg>
</logentry>
<logentry
   revision="229547">
<author>lcy</author>
<date>2015-09-08T06:47:47.524945Z</date>
<msg>reviewid:11918
review by:zyj
TD: 31117
现象：点击“关闭”虚拟机，提示关机超时
改动说明：
合入3.7定时强制关机的代码
测试：
qemu代码编译通过，自测通过</msg>
</logentry>
<logentry
   revision="229171">
<author>hyq</author>
<date>2015-09-08T06:26:45.267321Z</date>
<msg>reviewid: 11920
Reviewed by: gwl
改动说明：
【模板优化】
1、回滚模板优化相关代码</msg>
</logentry>
<logentry
   revision="225538">
<author>jcy</author>
<date>2015-09-08T03:33:04.554313Z</date>
<msg>no review：
bug30905，存储测速下发hostid</msg>
</logentry>
<logentry
   revision="224927">
<author>jcy</author>
<date>2015-09-08T02:57:37.973021Z</date>
<msg>no review：
bug31216，授权试用期的提醒判断及提示语修改</msg>
</logentry>
<logentry
   revision="223470">
<author>jcy</author>
<date>2015-09-08T02:29:52.067345Z</date>
<msg>no review：
bug31191，开机状态虚拟机详情页面的控制台置灰了。</msg>
</logentry>
<logentry
   revision="221823">
<author>lcy</author>
<date>2015-09-08T01:57:44.098701Z</date>
<msg>reviewid:11911
review by:hyq
TD: 31084
现象：[老功能]取消迁移模板到无基镜像的存储，用时9分多钟
改动说明：
在拷贝镜像的时候，增加检测任务取消的检测，如果有检测到任务取消，立即退出,可以减少任务取消的时间。
测试：
自测通过</msg>
</logentry>
<logentry
   revision="172529">
<author>fxw</author>
<date>2015-09-07T12:43:11.666928Z</date>
<msg>noreview
更新VS代码</msg>
</logentry>
<logentry
   revision="168094">
<author>chenlei</author>
<date>2015-09-07T10:44:04.076967Z</date>
<msg>reviewid:11898
bugid:31251
review by:fxw
TD: null 
现象：null
改动说明：
克隆模板虚拟机、派生虚拟机时，如果勾选了完成后启动虚拟机，需要将虚拟机启动。
测试：
自测通过</msg>
</logentry>
<logentry
   revision="165157">
<author>hyq</author>
<date>2015-09-07T08:08:37.446981Z</date>
<msg>reviewid: 11886
Reviewed by: gwl
改动说明：
【模板优化】
1、模板更新异常处理</msg>
</logentry>
<logentry
   revision="164422">
<author>gwl</author>
<date>2015-09-07T07:12:40.891661Z</date>
<msg>reviewid: 11882
Reviewed by：hyq
BUGID: 31170
问题分析：proxy_handler执行失败时，可能返回“200 ok”。
解决办法：处理返回值，判断是否为要求的ARRAY，不是则报错。
</msg>
</logentry>
<logentry
   revision="164366">
<author>lcy</author>
<date>2015-09-07T01:50:00.873665Z</date>
<msg>reviewid:11878
review by:hyq
TD: 31213
现象：VMP强杀从节点上的非HA虚拟机后没有自动重启。[遗留]
改动说明：
HA优化的时候，获取普通虚拟机电源状态为ON的返回值获取出错了，还有异常重启的时候，前台log显示一直为失败状态原因是后台传参数出问题了。
测试：
自测通过</msg>
</logentry>
<logentry
   revision="164365">
<author>yangwei</author>
<date>2015-09-07T01:40:17.002548Z</date>
<msg>reviewid 11877
Reviewed by: hyq
BUG ID: null
问题分析：VMP4.5 试用授权-升级
改动说明：代码回滚：已经将功能移到升级执行脚本中（4.5.00.up.d）
测试：</msg>
</logentry>
<logentry
   revision="164364">
<author>fxw</author>
<date>2015-09-07T01:33:19.287099Z</date>
<msg>reviewid:11869
bugid:31134
review by:fxw
TD: null 
现象：null
改动说明：
合入aSV4.2代码，解决VMP前台页面主机总内存和已用内存显示不准确的问题
测试：</msg>
</logentry>
<logentry
   revision="159585">
<author>fxw</author>
<date>2015-09-06T12:13:12.405045Z</date>
<msg>noreview
更新VS的代码</msg>
</logentry>
<logentry
   revision="159560">
<author>fxw</author>
<date>2015-09-06T12:10:21.028740Z</date>
<msg>noreview
Merged revision(s) 156862 from Personal/fxw/VMP4.5/Trunk:
合入VMP4.1 VS修改的bug到VMP4.1主干svn 50473
修改非一体机本地存储看不到的问题
热备盘重建时间改成30分钟
VsConfig.pm合入


</msg>
</logentry>
<logentry
   revision="159493">
<author>fxw</author>
<date>2015-09-06T12:06:06.652308Z</date>
<msg>reviewid:11875
review by:gwl
TD: null 
现象：使用已有磁盘创建虚拟机失败，显示：磁盘被占用。
改动说明：
加个日志帮助分析问题
测试：
无</msg>
</logentry>
<logentry
   revision="157190">
<author>yangwei</author>
<date>2015-09-06T09:16:33.420952Z</date>
<msg>reviewid 11852
Reviewed by: gwl
BUG ID: null
问题分析：VMP4.5 试用授权模式-升级版本试用天数修改
改动说明：
4.3R2及以前版本升级到4.5+，使用天数重设为0。此授权仅针对adesk试用期内的标准版。
1、添加一个升级执行脚本，判断版本信息，决定是否重置VMP使用天数。
2、修改vtsn_tool的修改时间接口：在授权信息文件中增加一个字段判断是否是第一次升级，仅允许利用升级使用一次该授权。
测试：
1、打包测试。
2、调用该接口，可以修改时间和添加字段。测试ok</msg>
</logentry>
<logentry
   revision="157170">
<author>yangwei</author>
<date>2015-09-06T09:10:06.316220Z</date>
<msg>reviewid 11857
Reviewed by: wzt
BUG ID: null
问题分析：VMP4.5 试用授权模式-试用模式下禁止导入储存中的虚拟机
改动说明：试用模式下禁止导入储存中的虚拟机
测试：在实体机储存页面，测试导入储存中的虚拟机镜像。试用模式内导入失败。测试ok</msg>
</logentry>
<logentry
   revision="157141">
<author>yangwei</author>
<date>2015-09-06T08:58:47.488900Z</date>
<msg>reviewid 11865
Reviewed by: hyq
BUG ID: null
问题分析：[试用授权模式]VMP4.5 飞天key中文乱码,解决中文用户名乱码问题
改动说明：
测试：测试中文用户名，测试前台显示ok。</msg>
</logentry>
<logentry
   revision="156277">
<author>lcy</author>
<date>2015-09-06T07:13:25.613663Z</date>
<msg>reviewid:11856
review by:hyq
TD: 31074
现象：HA虚拟机启动失败，报没有主机能够启动，资源不满足，原因不明确
改动说明：
把虚拟机因资源不足启动失败的提示改成：
没有主机能够启动这个虚拟机（资源不满足，或能使用的主机处于离线状态，或主机上虚拟机存储离线，或主机上CPU不足）
测试：
自测通过</msg>
</logentry>
<logentry
   revision="154017">
<author>whf</author>
<date>2015-09-06T02:40:16.518494Z</date>
<msg>规划评审
no review
</msg>
</logentry>
<logentry
   revision="154016">
<author>whf</author>
<date>2015-09-06T02:40:15.265913Z</date>
<msg>规划评审
no review
</msg>
</logentry>
<logentry
   revision="144187">
<author>lcy</author>
<date>2015-09-05T09:42:18.854978Z</date>
<msg>reviewid:11833
review by:hyq
TD: 31201
现象：带VS存储克隆模板或者派生虚拟机，不开启HA，克隆失败
改动说明：
在template_clone_param_check_and_make函数中，把非集群虚拟机当做集群虚拟机来使用了，导致后面scp的路径出错。
改动方法，修改$param-&gt;{ storagenode }的值的获取方式从而让scp的路径正确
测试：
自测通过</msg>
</logentry>
<logentry
   revision="143443">
<author>gwl</author>
<date>2015-09-05T09:24:15.744589Z</date>
<msg>reviewid: 11831
Reviewed by：hyq
BUGID: 
问题分析：
虚拟机导入导出功能完成，自测通过（普通虚拟机，模板虚拟机，派生虚拟机）；</msg>
</logentry>
<logentry
   revision="141206">
<author>yangwei</author>
<date>2015-09-05T08:19:48.161743Z</date>
<msg>reviewid 11828
Reviewed by: fxw
BUG ID: 31174(一起解决该bug)
问题分析：试用授权模式：飞天key支持和相关bug修改
改动说明：
1、添加了对飞天key的支持；
2、对默认adesk 试用版授权参数进行了修正；
3、修改了存在的部分问题。
测试：
1、在打包环境中测试，打包成功，无语法等其他错误。
2、修正adesk企业版虚拟机核数等于4无法开机问题，在测试环境中升级补丁，测试ok。
3、对飞天key的支持，通过vtsn_tool和序列号授权工具测试可进行对飞天key的读写，测试ok。
4、其他问题，打包验证。</msg>
</logentry>
<logentry
   revision="128990">
<author>chenlei</author>
<date>2015-09-05T02:52:41.517965Z</date>
<msg>reviewid:11823
review by:fxw
TD: null 
现象：null
改动说明：
合入SSL那边的广域网优化修改的spice代码，需要更新libspice.so文件
测试：</msg>
</logentry>
<logentry
   revision="128604">
<author>chenlei</author>
<date>2015-09-05T02:37:53.556369Z</date>
<msg>reviewid:11821
review by:fxw
TD: null 
现象：null
改动说明：
合入马长春的广域网优化修改的代码（spice）
测试：
编译通过</msg>
</logentry>
<logentry
   revision="128086">
<author>chenlei</author>
<date>2015-09-05T02:18:51.334579Z</date>
<msg>reviewid:11783
review by:fxw
TD: null 
现象：null
改动说明：
优化内存剩余空间判断算法，
系统可用的内存大小应该看的是free的第二行最后一个值。
测试：</msg>
</logentry>
<logentry
   revision="50506">
<author>fxw</author>
<date>2015-09-02T12:32:12.785867Z</date>
<msg>noreview
原来从3.7合过来的删了，现在从3.4恢复</msg>
</logentry>
<logentry
   revision="50505">
<author>fxw</author>
<date>2015-09-02T12:27:33.667405Z</date>
<msg>noreview
原来从3.7合过来的删了，现在从3.4恢复</msg>
</logentry>
<logentry
   revision="50504">
<author>fxw</author>
<date>2015-09-02T12:25:31.340733Z</date>
<msg>noreview
3.7合过来的代码，漏删了</msg>
</logentry>
<logentry
   revision="50503">
<author>fxw</author>
<date>2015-09-02T12:24:28.041709Z</date>
<msg>noreview
原来从3.7合过来的删了，现在从3.4恢复</msg>
</logentry>
<logentry
   revision="50502">
<author>fxw</author>
<date>2015-09-02T12:24:09.843100Z</date>
<msg>noreview
3.7合过来的代码，漏删了</msg>
</logentry>
<logentry
   revision="50501">
<author>fxw</author>
<date>2015-09-02T12:23:09.826120Z</date>
<msg>noreview
原来从3.7合过来的删了，现在从3.4恢复</msg>
</logentry>
<logentry
   revision="50499">
<author>fxw</author>
<date>2015-09-02T12:22:53.810611Z</date>
<msg>noreview
原来从3.7合过来的删了，现在从3.4恢复</msg>
</logentry>
<logentry
   revision="50498">
<author>fxw</author>
<date>2015-09-02T12:22:25.439846Z</date>
<msg>noreview
原来从3.7合过来的删了，现在从3.4恢复</msg>
</logentry>
<logentry
   revision="50497">
<author>fxw</author>
<date>2015-09-02T12:22:10.084640Z</date>
<msg>noreview
原来从3.7合过来的删了，现在从3.4恢复</msg>
</logentry>
<logentry
   revision="50496">
<author>fxw</author>
<date>2015-09-02T12:18:46.054704Z</date>
<msg>noreview
asV3.7的vm tools不兼容VDI场景，要回滚，先全部删掉，然后再从VMP3.4 copy过来
还回滚了软关机的代码</msg>
</logentry>
<logentry
   revision="50470">
<author>xzk</author>
<date>2015-09-02T09:05:50.831940Z</date>
<msg>noreview改动说明：增加虚拟机编辑字段：支持12个USB1.0（新增、编辑、模板部署、批量编辑）</msg>
</logentry>
<logentry
   revision="50469">
<author>chenlei</author>
<date>2015-09-02T09:02:14.938206Z</date>
<msg>reviewid:11809
review by:fxw
TD: null 
现象：null
改动说明：
support_usb_count需要传递整形数据，之前是字符串，现在修改过来
测试：</msg>
</logentry>
<logentry
   revision="50464">
<author>chenlei</author>
<date>2015-09-02T08:26:51.702128Z</date>
<msg>reviewid:11807
review by:fxw
TD: null 
现象：null
改动说明：
配合前台UI修改后台QemuServer
测试：
前后台调通</msg>
</logentry>
<logentry
   revision="50454">
<author>gwl</author>
<date>2015-09-02T07:15:59.940363Z</date>
<msg>reviewid: 11806
Reviewed by：fxw
BUGID: 
问题分析：
未在Makefile添加VMA_Operator.pm</msg>
</logentry>
<logentry
   revision="50436">
<author>fxw</author>
<date>2015-09-02T02:54:38.660160Z</date>
<msg>reviewid: 11794
Reviewed by: gwl
改动说明：
【模板优化】
1、添加由虚拟机镜像名称获取基镜像名称的接口
2、修改升级模板更新的代码流程
3、合并虚拟机镜像到基镜像操作两遍问题修改</msg>
</logentry>
<logentry
   revision="50434">
<author>fxw</author>
<date>2015-09-02T02:40:28.014111Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="50427">
<author>fxw</author>
<date>2015-09-02T02:06:32.647237Z</date>
<msg>noreview
从3.7合入的导入导出vma虚拟机的代码不小心弄错了</msg>
</logentry>
<logentry
   revision="50417">
<author>gwl</author>
<date>2015-09-01T14:09:06.702308Z</date>
<msg>reviewid: 11793
Reviewed by：fxw
BUGID: 
问题分析：
自测通过，待测试正常qcow2导入导出后是否正确，以及修改禁止导入vad、vaf。</msg>
</logentry>
<logentry
   revision="50414">
<author>jcy</author>
<date>2015-09-01T13:59:09.904807Z</date>
<msg>no review：
bug30934：序列号页面显示用户名称，试用期快结束的提示</msg>
</logentry>
<logentry
   revision="50412">
<author>gwl</author>
<date>2015-09-01T13:44:08.721566Z</date>
<msg>reviewid: 11792
Reviewed by：fxw
BUGID: 
问题分析：
直接上库从3.7合入的导入导出代码，在本版本修改后的代码等下上库</msg>
</logentry>
<logentry
   revision="50409">
<author>lcy</author>
<date>2015-09-01T13:24:10.703669Z</date>
<msg>reviewid:11790
review by gwl
TD:30970
改动说明：
修改方法，在判断模板虚拟机的状态的时候，多加一个deriving状态，虚拟机不一定是stopped状态。因为，有可能派生多台虚拟机的时候，修改了模板虚拟机的状态，还没有同步过来，就进行下一个虚拟机派生了，就会检测到虚拟机没有处于stopped状态，然后跑出异常。所以多加一个deriving状态判断。在锁住虚拟机后，只要处于stopped和deriving这两种状态都可以进行操作。
测试：
在后台vtpsh执行，测试通过。</msg>
</logentry>
<logentry
   revision="50405">
<author>fxw</author>
<date>2015-09-01T12:46:23.733483Z</date>
<msg>noreview
合入VS 分支reversion 50399
svn://200.200.0.10/vt/vt/Personal/fxw/VMP4.5/ </msg>
</logentry>
<logentry
   revision="50403">
<author>fxw</author>
<date>2015-09-01T12:41:13.922751Z</date>
<msg>noreview
合入VS代码出错</msg>
</logentry>
<logentry
   revision="50365">
<author>chenlei</author>
<date>2015-09-01T07:24:42.784249Z</date>
<msg>reviewid:11778 
review by:fxw
TD: null 
现象：null
改动说明：
QemuServer里面的usb1.0的代码被回滚了，需要改回去
测试：</msg>
</logentry>
<logentry
   revision="50301">
<author>fxw</author>
<date>2015-08-31T13:45:21.716692Z</date>
<msg>noreview

50124 合入的vtp-reportdata代码有问题，导致无法开机，先回滚</msg>
</logentry>
<logentry
   revision="50299">
<author>fxw</author>
<date>2015-08-31T13:23:12.206867Z</date>
<msg>noreview
合入VS 分支reversion 50234
svn://200.200.0.10/vt/vt/Personal/fxw/VMP4.5/ </msg>
</logentry>
<logentry
   revision="50288">
<author>fxw</author>
<date>2015-08-31T10:00:09.512292Z</date>
<msg>reviewid: 11760
Reviewed by: gwl
Bug id: 31108
改动说明：
【模板优化】模板转化成为普通虚拟机残留模板虚拟机镜像的备份</msg>
</logentry>
<logentry
   revision="50280">
<author>fxw</author>
<date>2015-08-31T09:34:14.825952Z</date>
<msg>reviewid: 11758
Reviewed by: gwl
改动说明：
1、新增一些公共接口
2、修改普通虚拟机转化为模板的流程，处理异常
3、修改创建模板增量镜像直接指定相对路径的backing_file,
4、模板转化为普通虚拟机异常处理
</msg>
</logentry>
<logentry
   revision="50265">
<author>chenlei</author>
<date>2015-08-31T08:18:39.689108Z</date>
<msg>reviewid:11753
review by:gwl
TD: null 
现象：null
改动说明：
应前台UI要求，将USB1.0设备支持个数的参数名称改为support_usb_count
前台传递参数-support_usb_count 6（12）
测试：
自测OK</msg>
</logentry>
<logentry
   revision="50257">
<author>lcy</author>
<date>2015-08-31T07:29:17.912397Z</date>
<msg>reviewid:11752
review by hyq
TD:31041
改动说明：
在获取存储的函数storage_info中增加一个变量判断是否获取的是本地local存储
测试：
自测通过</msg>
</logentry>
<logentry
   revision="50237">
<author>chenlei</author>
<date>2015-08-31T03:53:57.022435Z</date>
<msg>reviewid:11749
review by:fxw
TD: null 
现象：null
改动说明：
合入马长春的广域网优化修改的代码（spice），
更新libspice-server.so.1文件
测试：</msg>
</logentry>
<logentry
   revision="50226">
<author>chenlei</author>
<date>2015-08-31T03:41:24.698757Z</date>
<msg>reviewid:11747
review by:fxw
TD: null 
现象：null
改动说明：
合入马长春的广域网优化修改的代码（spice）
测试：
编译通过</msg>
</logentry>
<logentry
   revision="50160">
<author>lcy</author>
<date>2015-08-29T10:45:28.746849Z</date>
<msg>reviewid:11739
review by gwl
TD:30924
改动说明：
在创建聚合网口之前判断一些可以判断的参数值，出错直接返回或者提醒界面
测试：
自测通过</msg>
</logentry>
<logentry
   revision="50156">
<author>chenlei</author>
<date>2015-08-29T10:31:19.960933Z</date>
<msg>reviewid:11743
review by:gwl
TD: null 
现象：null
改动说明：
QemuServer.pm中的几行代码上库的时候错位了，现已修改过来了
测试：</msg>
</logentry>
<logentry
   revision="50152">
<author>yangwei</author>
<date>2015-08-29T10:14:19.926903Z</date>
<msg>reviewid 11742
Reviewed by: fxw
BUG ID: 31033
问题分析：[试用授权模式]新安装4.5标准版，查看序列号剩余使用天数，是已过期
改动说明：修改默认授权结构体的时间信息，重新编译vtsn工具
测试：将vtsn_tool和vtsn_server拷贝到出问题环境，测试，可正常显示剩余时间。</msg>
</logentry>
<logentry
   revision="50147">
<author>jcy</author>
<date>2015-08-29T09:30:54.387812Z</date>
<msg>no review：
合3.7的导入导出代码</msg>
</logentry>
<logentry
   revision="50146">
<author>fxw</author>
<date>2015-08-29T09:30:06.968461Z</date>
<msg>noreview
从到aSV3.7 49998 更新local/iso 相关二进制、代码
这些事新增文件</msg>
</logentry>
<logentry
   revision="50142">
<author>chenlei</author>
<date>2015-08-29T09:08:09.908752Z</date>
<msg>reviewid:11738 
review by:gwl
TD: null 
现象：null
改动说明：
USB1.0设备支持个数可配置的后台代码（6个或者12个，默认支持6个）
加上参数-support_12_usb10 yes(no)
1. 创建虚拟机时可配置USB1.0设备的支持个数 ;
2. 编辑虚拟机时（包括批量编辑虚拟机），可配置USB1.0设备的支持个数;
测试：
自测OK</msg>
</logentry>
<logentry
   revision="50140">
<author>fxw</author>
<date>2015-08-29T09:03:43.129509Z</date>
<msg>noreview
从到aSV3.7 49998 更新local/iso 相关二进制、代码
</msg>
</logentry>
<logentry
   revision="50133">
<author>fxw</author>
<date>2015-08-29T08:24:18.250831Z</date>
<msg>noreview
Merged revision(s) 49711, 49877-49878 from Personal/fxw/VMP4.5/Trunk:
抽取出公共逻辑到独立脚本，会被多个脚本调用
........
合入4.1的一个修改，调用vs_networking_mode.sh时传入一个网口名称的参数
........
合入4.1的一个修改，调用vs_networking_mode.sh时传入一个网口名称的参数
........
</msg>
</logentry>
<logentry
   revision="50132">
<author>fxw</author>
<date>2015-08-29T08:21:23.210600Z</date>
<msg>Merged revision(s) 49296 from Personal/fxw/VMP4.5/Trunk:
noreview

上库vs提交代码，配合vs2.1修改。

当前代码DoAlert.pm有问题，上库后再更正。
........
</msg>
</logentry>
<logentry
   revision="50128">
<author>fxw</author>
<date>2015-08-29T07:37:56.701492Z</date>
<msg>noreview
有病毒，先删掉，后面再上传</msg>
</logentry>
<logentry
   revision="50127">
<author>fxw</author>
<date>2015-08-29T07:37:10.881821Z</date>
<msg>noreview
删除空目录</msg>
</logentry>
<logentry
   revision="50124">
<author>fxw</author>
<date>2015-08-29T07:31:40.440767Z</date>
<msg>noreview
从到aSV3.7 49998 更新local/iso 相关二进制、代码</msg>
</logentry>
<logentry
   revision="49976">
<author>fxw</author>
<date>2015-08-28T06:48:14.373199Z</date>
<msg>noreview
Merged revision(s) 46865 from VTP/VMP4.1/Alternate:
升级补丁包区分adesk版和server版</msg>
</logentry>
<logentry
   revision="49972">
<author>fxw</author>
<date>2015-08-28T06:14:19.088097Z</date>
<msg>reviewid: 11712
reviewed by: xhz
bug id:  31042
问题分析：
如果是单机环境，从来没组过集群，默认是没有/cfs/cfgmaster.ini，没有这个文件时默认本地就是主控
task_data_proxy 脚本有漏洞，没有这个文件的时候会导致出错
自测：
自测通过</msg>
</logentry>
<logentry
   revision="49949">
<author>fxw</author>
<date>2015-08-28T01:48:57.319698Z</date>
<msg>noreview
更新vs包
关闭分片功能</msg>
</logentry>
<logentry
   revision="49934">
<author>lcy</author>
<date>2015-08-27T13:04:24.161196Z</date>
<msg>reviewid:11703
review by gwl
TD:30989
改动说明：
合入3.7的代码，具体是增加新增文件的写权限
测试：
自测通过</msg>
</logentry>
<logentry
   revision="49920">
<author>fxw</author>
<date>2015-08-27T11:39:39.239277Z</date>
<msg>noreview
合入VS分支代码 svn://200.200.0.10/vt/vt/Personal/fxw/VMP4.5
到49889
</msg>
</logentry>
<logentry
   revision="49918">
<author>yangwei</author>
<date>2015-08-27T11:26:48.551544Z</date>
<msg>reviewid 11698
Reviewed by: gwl
BUG ID: 30905
问题分析：虚拟存储加上后，虚拟存储显示速度是空的，没有显示出来
改动说明：添加对虚拟存储的判断并设置测速值
测试：
1、新建虚拟机虚拟磁盘测速；
2、克隆虚拟机虚拟磁盘测速；
3、迁移虚拟机虚拟磁盘测速；
4、ova上传虚拟磁盘测速；
5、iso文件上传虚拟磁盘测速；
6、派生虚拟机虚拟磁盘测速；
7、备份虚拟机虚拟磁盘测速。
测试ok</msg>
</logentry>
<logentry
   revision="49883">
<author>fxw</author>
<date>2015-08-27T08:09:51.628537Z</date>
<msg>noreview
增加会议纪要</msg>
</logentry>
<logentry
   revision="49864">
<author>fxw</author>
<date>2015-08-27T06:36:58.926075Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="49862">
<author>yangwei</author>
<date>2015-08-27T06:19:14.642175Z</date>
<msg>reviewid 11692
Reviewed by: fxw
BUG ID: null
问题分析：试用授权模式
改动说明：1、vtsn添加接口
2、修改kvm  cpuid处理函数
测试：打包验证</msg>
</logentry>
<logentry
   revision="49861">
<author>lcy</author>
<date>2015-08-27T06:12:29.384837Z</date>
<msg>reviewid:11690
review by gwl
TD:29699
改动说明：
在前台上传文件的时候，每次上传完或者中途取消上传操作的时候，手动释放系统的cache
测试：
自测通过</msg>
</logentry>
<logentry
   revision="49858">
<author>yangwei</author>
<date>2015-08-27T04:03:08.789554Z</date>
<msg>reviewid 11674
Reviewed by: fxw
BUG ID: null
问题分析：内存优化
改动说明：
1、cgroup预留内存要将vs的算上；
2、关闭位于ssd硬盘的swap分区。
3、格式化perl代码风格
测试：打包验证</msg>
</logentry>
<logentry
   revision="49849">
<author>yangwei</author>
<date>2015-08-27T03:03:53.477679Z</date>
<msg>reviewid 11688
Reviewed by: hyq
BUG ID: 30461
问题分析：core dump文件删除
改动说明：修改修改删除目录
</msg>
</logentry>
<logentry
   revision="49801">
<author>yangwei</author>
<date>2015-08-26T09:23:39.141646Z</date>
<msg>reviewid 11673
Reviewed by: fxw
BUG ID: null
问题分析：VMP4.5 使用授权模式
改动说明：1、添加cpuid接口，返回试用期以及使用天数信息，供VDC使用。
测试：合入VDC后，测试验证</msg>
</logentry>
<logentry
   revision="49794">
<author>chenlei</author>
<date>2015-08-26T08:55:38.519047Z</date>
<msg>reviewid:11667
review by:fxw
TD: null 
现象：null
改动说明：
1. 去掉前台的启用、禁用控制台的日志；
2. 将所有的tab换成4个空格
测试：
自测OK</msg>
</logentry>
<logentry
   revision="49790">
<author>jcy</author>
<date>2015-08-26T08:30:03.821535Z</date>
<msg>noreview
改动说明：
bug30934，试用版和标准版加上时间限制
</msg>
</logentry>
<logentry
   revision="49789">
<author>yangwei</author>
<date>2015-08-26T08:27:27.273023Z</date>
<msg>reviewid 11666
Reviewed by: gwl
BUG ID: null
问题分析：VMP4.5 试用授权模式
改动说明：
1、授权信息添加两个字段user_name、ever_enterprise（是否被激活过）；
2、修改vmpsn_is_free函数，VMP被激活过则不再走试用流程，被激活过的VMP，授权信息使用已有策略，当前试用限制不生效；
3、修改vmp试用结束关机脚本条件判断。
测试：
</msg>
</logentry>
<logentry
   revision="49784">
<author>jcy</author>
<date>2015-08-26T07:51:03.466804Z</date>
<msg>noreview
改动说明：
bug30910，MTU限制为1000-1500
</msg>
</logentry>
<logentry
   revision="49783">
<author>jcy</author>
<date>2015-08-26T07:48:14.013155Z</date>
<msg>noreview
改动说明：
bug30904，删除带网关的聚合口时，加上额外提示
</msg>
</logentry>
<logentry
   revision="49782">
<author>jcy</author>
<date>2015-08-26T07:34:17.210574Z</date>
<msg>noreview
改动说明：
bug30871，模板更新派生的虚拟机时的文案修改
</msg>
</logentry>
<logentry
   revision="49780">
<author>jcy</author>
<date>2015-08-26T07:20:42.042936Z</date>
<msg>noreview
改动说明：
bug30905，存储速度合入
</msg>
</logentry>
<logentry
   revision="49778">
<author>jcy</author>
<date>2015-08-26T06:59:41.369536Z</date>
<msg>noreview
改动说明：
bug30903，ie10报脚本错误
</msg>
</logentry>
<logentry
   revision="49777">
<author>yangwei</author>
<date>2015-08-26T06:50:02.437718Z</date>
<msg>reviewid 11661
Reviewed by: gwl
BUG ID: null
问题分析：VMP4.5 试用授权模式
改动说明：试用授权模式：升级版本对试用天数的实现（代码优化）
测试：打包验证
</msg>
</logentry>
<logentry
   revision="49775">
<author>yangwei</author>
<date>2015-08-26T06:15:56.018555Z</date>
<msg>reviewid 11655
Reviewed by: gwl
BUG ID: null
问题分析：VMP4.5 试用授权模式
改动说明：60天试用期结束不能开机
测试：试用期结束，开启虚拟机，虚拟机不能开机，测试ok
</msg>
</logentry>
<logentry
   revision="49741">
<author>yangwei</author>
<date>2015-08-25T12:48:51.720605Z</date>
<msg>reviewid 11654
Reviewed by: hyq
BUG ID: null
问题分析：core dump文件删除
改动说明：1、修改一体机判断方法 2、增加删除目录
测试：自测ok</msg>
</logentry>
<logentry
   revision="49724">
<author>yangwei</author>
<date>2015-08-25T10:46:19.052047Z</date>
<msg>reviewid 11648
Reviewed by: fxw
BUG ID: null
问题分析：VMP4.5 ssd硬盘swap分区采用合入优化前方式
改动说明：ssd硬盘swap分区采用合入优化前方式
测试：打包验证</msg>
</logentry>
<logentry
   revision="49722">
<author>chenlei</author>
<date>2015-08-25T10:01:18.345457Z</date>
<msg>reviewid:11652 
review by:fxw
TD: null 
现象：null
改动说明：
增加info write-cache all查看所有的磁盘的写缓存占用情况
测试：
自测OK</msg>
</logentry>
<logentry
   revision="49671">
<author>fxw</author>
<date>2015-08-25T03:20:08.125660Z</date>
<msg>noreview
修改打包的时候出错</msg>
</logentry>
<logentry
   revision="49657">
<author>fxw</author>
<date>2015-08-25T01:32:42.792658Z</date>
<msg>Merged revision(s) 49592 from VTP/ASV3.7/Trunk/source:
reviewid: 11632
BUG ID: 30907
Reviewed by: hjg
现象：
TD 30907 报表服务内存泄露
改动说明：
判断主控是否在线，配置解析后要在退出前要释放配置解析占用的内存
测试：
修改后替换报表服务，观察一段时间，内存未出现持续增长
（报表服务的内存跟业务相关，繁忙时内存会涨，空闲时会释放）
........
</msg>
</logentry>
<logentry
   revision="49611">
<author>yangwei</author>
<date>2015-08-24T09:23:40.199707Z</date>
<msg>reviewid 11619
Reviewed by: gwl
BUG ID: 30461
问题分析：core dump文件定期删除
改动说明：
1、删除冗余，修改代码逻辑，/sf/data/local小于5G删除15天前的core dump
2、删除/sf/data/local/kdump下core dump
3、修改文件路径，由每小时扫描改为每天扫描
测试：自测通过</msg>
</logentry>
<logentry
   revision="49602">
<author>fxw</author>
<date>2015-08-24T07:37:46.405072Z</date>
<msg>Merged revision(s) from VTP/ASV3.7/Trunk:
reviewid: 11518
BUG ID: no
Reviewed by: gwl
现象：
虚拟机HA功能优化
改动说明：自测基本功能没问题，先上库


</msg>
</logentry>
<logentry
   revision="49559">
<author>gwl</author>
<date>2015-08-22T11:32:15.999008Z</date>
<msg>reviewid: 11612
Reviewed by：fxw
BUGID: 
问题分析：
编译环境修改
后续修改在打包中调用这个脚本以保证第一次打包正确。
</msg>
</logentry>
<logentry
   revision="49558">
<author>gwl</author>
<date>2015-08-22T11:30:06.875149Z</date>
<msg>reviewid: 11611
Reviewed by：fxw
BUGID: 
问题分析：
编译环境修改，buildenv.sh
后续修改在打包中调用这个脚本以保证第一次打包正确。
</msg>
</logentry>
<logentry
   revision="49553">
<author>fxw</author>
<date>2015-08-22T07:22:59.052875Z</date>
<msg>noreview
修改打包的时候出错</msg>
</logentry>
<logentry
   revision="49552">
<author>fxw</author>
<date>2015-08-22T07:21:10.267293Z</date>
<msg>Merged revision(s) from VTP/ASV3.7/Trunk:
reviewid: 11610
BUG ID: 30902
Reviewed by: gwl
现象：
虚拟机HA功能优化
改动说明：以前没合入的一个API，新合入的ha优化调用到导致报错


</msg>
</logentry>
<logentry
   revision="49543">
<author>fxw</author>
<date>2015-08-22T06:30:38.461762Z</date>
<msg>noreview
修改打包的时候出错</msg>
</logentry>
<logentry
   revision="49433">
<author>lcy</author>
<date>2015-08-21T09:44:31.190641Z</date>
<msg>reviewid:11602
review by gwl
TD:30841
改动说明：
创建聚合网口和编辑网口的时候提示信息正常，log信息正常
测试：
自测通过</msg>
</logentry>
<logentry
   revision="49417">
<author>jcy</author>
<date>2015-08-21T08:36:56.901636Z</date>
<msg>noreview
改动说明：
bug30882，存储测速，单位显示不全
</msg>
</logentry>
<logentry
   revision="49409">
<author>fxw</author>
<date>2015-08-21T07:45:07.307709Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="49406">
<author>yangwei</author>
<date>2015-08-21T07:05:32.681249Z</date>
<msg>reviewid 11598
Reviewed by: hyq
BUG ID: null
问题分析：vmp4.5试用授权模式
改动说明：
1、不关闭VDC虚拟机；
2、间隔3分钟，强制关掉没有被软关机关闭的虚拟机

</msg>
</logentry>
<logentry
   revision="49405">
<author>chenlei</author>
<date>2015-08-21T07:03:33.742470Z</date>
<msg>reviewid:11601
review by:fxw
TD: null 
现象：null
改动说明：
添加编译spice需要的so文件
测试：</msg>
</logentry>
<logentry
   revision="49376">
<author>gwl</author>
<date>2015-08-21T01:59:36.402596Z</date>
<msg>reviewid: 11592
Reviewed by：hyq
BUGID: 30825
问题分析：修改VDI42.qcow2名称，上库打包验证。</msg>
</logentry>
<logentry
   revision="49375">
<author>yangwei</author>
<date>2015-08-21T01:49:18.252764Z</date>
<msg>reviewid 11588
Reviewed by: fxw
BUG ID: null
问题分析：VMP4.5 试用授权模式 序列号授权工具
改动说明：
1、修改默认参数；
2、添加-t -F测试接口，分别重置ut为0、测试当前vmp是否是试用版本。
测试：</msg>
</logentry>
<logentry
   revision="49372">
<author>fxw</author>
<date>2015-08-21T01:43:04.506669Z</date>
<msg>Merged revision(s) 49093 from VTP/ASV3.7/Trunk
reviewid: 11589
BUG ID: 
Reviewed by: gwl
TD:  
现象：
HA优化
改动说明：
1.集群虚拟机启动增加参数控制是否检查虚拟机状态
2.集群虚拟机关机，先判断是否当前节点运行；
3.集群虚拟机热迁移成功后，可能导致电源状态被设置为off
4.报表服务，增加判断主控是否在线，nfs目录不存在直接返回；
测试：
替换脚本，可执行文件

........
</msg>
</logentry>
<logentry
   revision="49309">
<author>chenlei</author>
<date>2015-08-20T11:32:19.139591Z</date>
<msg>reviewid:11587
review by:fxw
TD: null 
现象：null
改动说明：
打包环境搭建优化
编写了个脚本，可以快速方便地搭建好打包环境
测试：</msg>
</logentry>
<logentry
   revision="49300">
<author>chenlei</author>
<date>2015-08-20T11:15:19.115055Z</date>
<msg>reviewid:11586
review by:fxw
TD: null 
现象：null
改动说明：
添加编译spice需要用到的so文件：
libopencv_core.so libopencv_imgproc.so libspice_wordcheck.so
测试：</msg>
</logentry>
<logentry
   revision="49299">
<author>yangwei</author>
<date>2015-08-20T11:14:35.426946Z</date>
<msg>reviewid 11577
Reviewed by: gwl
BUG ID:  
问题分析：VMP4.5新增试用授权模式
改动说明：
1、19vmp_exceed_trial_time.pl每个一小时检测，如果是试用版且过期，关闭所有虚拟机
2、VMPSN.pm修改默认参数，并根据授权信息判断是否是试用版
3、Update.pm升级过程，加入vmp4.5试用时间授权新机制，4.3R2及以前的重置时间
测试：
1、测试ok。
2、打包验证
3、打包验证</msg>
</logentry>
<logentry
   revision="49245">
<author>fxw</author>
<date>2015-08-20T08:51:23.498776Z</date>
<msg>noreview
Merged revision(s) 42763 from VTP/VMP3.6/Trunk:
review by:gzy
TD:  26302
现象：
TD 26302 重启后还原的虚拟机，挂起后恢复报错
改动说明：
启用了重启还原，恢复时，启动回调脚本会重新生成增量镜像，导致恢复失败
启用了重启还原，不需要支持挂起；
测试：
启用了重启还原的虚拟机，挂起失败；提示：虚拟机（xxx0002）挂起失败 虚拟机启用了重启后自动还原功能，不支持挂起(编辑虚拟机-&gt;高级，可关闭该功能)
........
</msg>
</logentry>
<logentry
   revision="49224">
<author>jcy</author>
<date>2015-08-20T07:51:04.877468Z</date>
<msg>noreview
改动说明：
编辑网卡改为同步api，去掉监听upid的代码
</msg>
</logentry>
<logentry
   revision="49204">
<author>fxw</author>
<date>2015-08-20T07:03:41.149205Z</date>
<msg>noreview
Merged revision(s) 41191 from VTP/VMP3.5/Trunk:
现象：
IE10上传文件失败
改动说明：
部分IE10，上传文件时传入的文件名是完整的文件路径，而上传接口注册的是文件名，不支持路径
测试：
在必现的IE10上上传文件，上传成功；
用chrom上传文件，上传成功；
........

</msg>
</logentry>
<logentry
   revision="49203">
<author>fxw</author>
<date>2015-08-20T07:00:55.207142Z</date>
<msg>noreview
归档例会纪要</msg>
</logentry>
<logentry
   revision="49195">
<author>fxw</author>
<date>2015-08-20T04:53:17.111318Z</date>
<msg>noreview
Merged revision(s) 42347 from VTP/VMP3.5/Trunk:
改动说明：TD28868
新建虚拟机，cdrom选择本地存储上的iso，新建失败
........

</msg>
</logentry>
<logentry
   revision="49181">
<author>jcy</author>
<date>2015-08-20T03:17:23.572908Z</date>
<msg>noreview
改动说明：
bug30849：存储测速合入问题
bug30834：新建虚拟机，ha字段存在浏览器兼容问题
</msg>
</logentry>
<logentry
   revision="49164">
<author>jcy</author>
<date>2015-08-20T02:10:33.952634Z</date>
<msg>noreview
改动说明：
bug30839：UI乱码问题
</msg>
</logentry>
<logentry
   revision="49091">
<author>jcy</author>
<date>2015-08-19T02:39:50.935945Z</date>
<msg>noreview
改动说明：
磁盘测速文件
</msg>
</logentry>
<logentry
   revision="49068">
<author>fxw</author>
<date>2015-08-18T10:06:45.093309Z</date>
<msg>noreview
合入VMP3.5 41977
根据VMP4.1针对VS做了修改</msg>
</logentry>
<logentry
   revision="49039">
<author>chenlei</author>
<date>2015-08-18T06:28:53.704590Z</date>
<msg>reviewid:11540
review by:fxw
TD: null 
现象：null
改动说明：
VNC控制台防泄密增加开关功能。修改了spice，需要更新libspice-server.so.1
测试：</msg>
</logentry>
<logentry
   revision="49034">
<author>chenlei</author>
<date>2015-08-18T03:51:17.094066Z</date>
<msg>reviewid:11539
review by:fxw
TD: null 
现象：null
改动说明：
VNC控制台防泄密增加开关功能。
1.控制台防泄密功能默认为开启状态
2.若要关闭该功能,则需要创建开关文件/cfs/.disable_privacy_protection
3.若要重新开启该功能，只要将创建的开关文件删除即可
测试：
自测OK</msg>
</logentry>
<logentry
   revision="49028">
<author>gwl</author>
<date>2015-08-18T02:42:57.544743Z</date>
<msg>reviewid: 11536
Reviewed by：hyq
BUGID: 30488
问题分析：修改，强制修改网关的后台接口.</msg>
</logentry>
<logentry
   revision="48984">
<author>yangwei</author>
<date>2015-08-17T09:05:42.856490Z</date>
<msg>reviewid 11519
Reviewed by: fxw
BUG ID: null
问题分析：iso中文安装
改动说明： 修改合入错误
测试: 打包测试</msg>
</logentry>
<logentry
   revision="48980">
<author>gwl</author>
<date>2015-08-17T08:59:56.031814Z</date>
<msg>reviewid: 11491
Reviewed by：hyq
BUGID: 30488
问题分析：添加强制修改网关的后台接口，以及合入VMP4.4的一个改动：解决【网口聚合】balance-rr模式网络不通的情况。</msg>
</logentry>
<logentry
   revision="48978">
<author>fxw</author>
<date>2015-08-17T08:49:26.306286Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="48866">
<author>chenlei</author>
<date>2015-08-17T06:21:35.544187Z</date>
<msg>reviewid:11507
review by:fxw
TD: null 
现象：null
改动说明：
SSL合入的spice服务端代码，更新libspice-server.so.1文件
测试：</msg>
</logentry>
<logentry
   revision="48852">
<author>chenlei</author>
<date>2015-08-17T01:19:22.840788Z</date>
<msg>reviewid:11489
review by:fxw
TD: null 
现象：null
改动说明：
合入SSL更新的spice服务端代码
测试：</msg>
</logentry>
<logentry
   revision="48703">
<author>fxw</author>
<date>2015-08-14T09:11:21.076495Z</date>
<msg>noreview
增加VMP4.3R2正式包版本</msg>
</logentry>
<logentry
   revision="48322">
<author>chenlei</author>
<date>2015-08-14T02:40:38.546927Z</date>
<msg>reviewid:11477
review by:fxw
TD: null 
现象：null
改动说明：
SSL合入的spice代码，更新libspice-server.so.1文件，
作者陈楚明24308
测试：
</msg>
</logentry>
<logentry
   revision="48314">
<author>chenlei</author>
<date>2015-08-14T01:37:53.651808Z</date>
<msg>reviewid:11474
review by:fxw
TD: null 
现象：null
改动说明：
SSL合入的spice代码，作者陈楚明24308
测试：</msg>
</logentry>
<logentry
   revision="48289">
<author>hyq</author>
<date>2015-08-13T12:41:51.355442Z</date>
<msg>reviewid: 11456
BUG ID: 
Reviewed by: hjg
现象：
改动说明：【HA功能优化】qemuserver文件多合入了一次
</msg>
</logentry>
<logentry
   revision="48278">
<author>yangwei</author>
<date>2015-08-13T11:59:07.846966Z</date>
<msg>reviewid 11446
Reviewed by: fxw
BUG ID: null
问题分析：
改动说明：iso安装界面合入：修改bterm路径。
测试:待打包验证</msg>
</logentry>
<logentry
   revision="48277">
<author>chenlei</author>
<date>2015-08-13T11:57:07.500864Z</date>
<msg>reviewid:11450 
review by:fxw
TD: null 
现象：null
改动说明：
回滚掉SSL合入的代码，这个方案可能导致流量变化，暂时不合入
测试：
这个回滚后面又合入了</msg>
</logentry>
<logentry
   revision="48263">
<author>chenlei</author>
<date>2015-08-13T09:34:47.173074Z</date>
<msg>reviewid:11438
review by:fxw
TD: null 
现象：null
改动说明：
增加3个controller以支持12个USB1.0设备
测试：
自测OK</msg>
</logentry>
<logentry
   revision="48249">
<author>yangwei</author>
<date>2015-08-13T07:17:21.592799Z</date>
<msg>reviewid 11431
Reviewed by: fxw
BUG ID: null
问题分析：iso中文安装
改动说明：
测试:</msg>
</logentry>
<logentry
   revision="48247">
<author>chenlei</author>
<date>2015-08-13T07:12:49.448888Z</date>
<msg>reviewid:11430 
review by:fxw
TD: null 
现象：null
改动说明：
SSL合入代码
测试：</msg>
</logentry>
<logentry
   revision="48242">
<author>yangwei</author>
<date>2015-08-13T04:37:34.280861Z</date>
<msg>reviewid 11426
Reviewed by: fxw
BUG ID: null
问题分析：iso安装启动菜单中文
改动说明：
测试：打包验证</msg>
</logentry>
<logentry
   revision="48239">
<author>yangwei</author>
<date>2015-08-13T03:31:01.026897Z</date>
<msg>reviewid 11425
Reviewed by: fxw
BUG ID: null
问题分析：iso中文界面
改动说明：合入错误修改</msg>
</logentry>
<logentry
   revision="48209">
<author>yangwei</author>
<date>2015-08-12T09:58:29.205506Z</date>
<msg>reviewid 11410
Reviewed by: fxw
BUG ID: null
问题分析：iso中文安装界面
改动说明：合入asv3.7 45497-45499,46089、46104、46611、47126、47296、45818
测试：待打包验证</msg>
</logentry>
<logentry
   revision="48192">
<author>fxw</author>
<date>2015-08-12T06:23:48.725668Z</date>
<msg>reviewid 11399
Reviewed by: xhz
BUG ID: null
问题分析：解决页面无法正确显示虚拟存储最大io问题
改动说明：添加vs测速io速率保存以及从配置文件读取io速度
测试：能够正确显示vs最大io速度，自测ok。</msg>
</logentry>
<logentry
   revision="48191">
<author>fxw</author>
<date>2015-08-12T06:22:26.876390Z</date>
<msg>noreview
Merged revision(s) 48187 from VTP/VMP4.1/Alternate/src/app/vtp-qemu-kvm/qemu-2.2.1:
BUG ID: 30013  (vs)
问题分析：
开机克隆失败，问题原因已查明：
1. kvm打快照是通过glfs_api模式写入的数据
2. qemu-img info是通过fuse读取的数据，由于在读快照之前有过2次qemu-img info行为，所以第三次qemu-img info并没有将请求交给vs，而是在内核通用文件系统层就返回了（因为qemu-img info没有用direct打开文件，所以被缓存了）

修改：
qemu-img info默认以cache=writeback打开文件，改为以cache=none打开文件. 与qemu的命令行参数cache=none一致。

测试：编译通过，王正测试通过。
........

</msg>
</logentry>
<logentry
   revision="48184">
<author>jcy</author>
<date>2015-08-12T02:35:51.914867Z</date>
<msg>noreview
改动说明：
合入存储测速</msg>
</logentry>
<logentry
   revision="48178">
<author>fxw</author>
<date>2015-08-12T02:22:11.462735Z</date>
<msg>reviewid 11390
Reviewed by: xhz
BUG ID: null
问题分析：asv3.7磁盘测速方法无法测量vs。
改动说明：如果是虚拟磁盘使用fio测速，否则使用原来的测速方法。
做了哪些测试：对本地磁盘和虚拟磁盘测速，测试ok。</msg>
</logentry>
<logentry
   revision="48132">
<author>hyq</author>
<date>2015-08-11T08:00:01.729819Z</date>
<msg>Merged revision(s) from VTP/ASV3.7/Trunk:
reviewid: 11370
BUG ID: 
Reviewed by: gwl
现象：
虚拟机HA功能优化
改动说明：【HA功能优化】
</msg>
</logentry>
<logentry
   revision="48130">
<author>fxw</author>
<date>2015-08-11T07:44:35.087731Z</date>
<msg>reviewid 11369
Reviewed by: xhz
BUG ID: null
问题分析：代码合入
改动说明：合入asv3.7 47964：将内存和虚拟机使用的内存分割开</msg>
</logentry>
<logentry
   revision="48105">
<author>jcy</author>
<date>2015-08-11T03:53:52.747950Z</date>
<msg>noreview
改动说明：
bug30488问题2：
添加虚拟交换机，选主机网口的窗口，标识是否为聚合口</msg>
</logentry>
<logentry
   revision="48103">
<author>jcy</author>
<date>2015-08-11T03:37:51.738451Z</date>
<msg>noreview
改动说明：
bug30488问题3：
添加聚合口的地方，不可操作的网口名称加上浮显</msg>
</logentry>
<logentry
   revision="48074">
<author>hyq</author>
<date>2015-08-10T12:20:32.367691Z</date>
<msg>Merged revision(s) 47288 from VTP/ASV3.7/Trunk:

reviewid: 11350
BUG ID: 
Reviewed by: wzt
TD:  
现象：
虚拟机HA功能优化
改动说明：
1.虚拟机使用的存储离线了，需要切换运行位置
2.虚拟机使用的网络断线了，需要切换运行位置
3.虚拟机一异常挂掉了，需要重新拉起
测试：
1.HA虚拟机运行在A主机上，iptable限制A不可访问存储服务器，A上的虚拟机切换到B主机运行；
2.HA虚拟机运行在A主机上，使用了eth1口的两个交换机，将A上的eth1口线拔出，A上的虚拟机切换到B主机运行；
3.HA虚拟机运行在A主机，将A主机的管理口eth0断开，存储一起掉线，A上的虚拟机切换到B主机运行；
4.后台kill -9 杀掉虚拟机，虚拟机被重新拉起
........

</msg>
</logentry>
<logentry
   revision="48064">
<author>gwl</author>
<date>2015-08-10T11:19:21.586742Z</date>
<msg>reviewid: 11347
Reviewed by：hyq
BUGID: 30480
问题分析：不回滚，增加用户提示</msg>
</logentry>
<logentry
   revision="48029">
<author>yangwei</author>
<date>2015-08-10T03:35:23.455297Z</date>
<msg>reviewid 11322
Reviewed by: gwl
BUG ID: 30461
问题分析：写一个脚本，放到/sf/etc/cron.d/hourly.d 下面，定时扫描，将core dump删除
改动说明：根据空间和时间，删除一体机中的core dump文件
做了哪些测试： 测试ok</msg>
</logentry>
<logentry
   revision="48028">
<author>fxw</author>
<date>2015-08-10T03:07:52.382148Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="47840">
<author>chenlei</author>
<date>2015-08-06T08:42:44.639516Z</date>
<msg>no review
控制台被禁用时要给用户提示禁用原因</msg>
</logentry>
<logentry
   revision="47812">
<author>fxw</author>
<date>2015-08-06T02:37:27.380099Z</date>
<msg>noreview
合入VMP4.1 47334
TD29554 虚拟机运行位置编辑后改变的问题</msg>
</logentry>
<logentry
   revision="47809">
<author>fxw</author>
<date>2015-08-06T02:24:05.354312Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="47769">
<author>chenlei</author>
<date>2015-08-05T08:42:12.020073Z</date>
<msg>no review
禁用VNC控制台时要同时禁用VNC控制台的toolbar</msg>
</logentry>
<logentry
   revision="47755">
<author>fxw</author>
<date>2015-08-05T07:46:58.365702Z</date>
<msg>noreview
修改磁盘测速代码合入中问题</msg>
</logentry>
<logentry
   revision="47747">
<author>fxw</author>
<date>2015-08-05T06:25:48.932204Z</date>
<msg>reviewid 11135
Reviewed by: xhz
BUG ID: null
问题分析：存储页面磁盘测速
改动说明：vmp4.5合入vmp3.6  r43268、r43384</msg>
</logentry>
<logentry
   revision="47740">
<author>fxw</author>
<date>2015-08-05T03:11:13.101917Z</date>
<msg>reviewid 11129
Reviewed by: xhz
BUG ID: null
问题分析：NULL
改动说明：vmp4.5合入存储界面磁盘测速：vmp3.5 r42310</msg>
</logentry>
<logentry
   revision="47733">
<author>fxw</author>
<date>2015-08-05T02:25:16.430274Z</date>
<msg>reviewid 11126
Reviewed by: xhz
BUG ID: null
问题分析：NULL
改动说明：合入vmp3.5磁盘测速：41690、41782、41925、42011</msg>
</logentry>
<logentry
   revision="47712">
<author>fxw</author>
<date>2015-08-04T12:13:46.119237Z</date>
<msg>reviewid 11114
Reviewed by: xhz
BUG ID: null
问题分析：NULL
改动说明：vmp4.5合入vmp3.5主机存储界面磁盘测速;合入3.5 41308、41494.</msg>
</logentry>
<logentry
   revision="47707">
<author>fxw</author>
<date>2015-08-04T11:41:12.039590Z</date>
<msg>reviewid 11110
Reviewed by: xhz
BUG ID: null
问题分析：NULL
改动说明：vmp4.5合入vmp3.5主机存储界面磁盘测速;合入vmp3.5 41233.</msg>
</logentry>
<logentry
   revision="47706">
<author>fxw</author>
<date>2015-08-04T11:21:01.222375Z</date>
<msg>reviewid 11104
Reviewed by: xhz
BUG ID: null
问题分析：NULL
改动说明：vmp4.5合入vmp3.5主机存储界面磁盘测速;合入vmp3.5 41220.</msg>
</logentry>
<logentry
   revision="47656">
<author>yangwei</author>
<date>2015-08-04T01:08:52.488141Z</date>
<msg>reviewid 11065
Reviewed by: xhz
BUG ID: null
问题分析：swap合入
改动说明：合入asv3.7 r47035</msg>
</logentry>
<logentry
   revision="47649">
<author>yangwei</author>
<date>2015-08-03T12:44:40.143794Z</date>
<msg>reviewid 11055
Reviewed by: xhz
BUG ID: null
问题分析：NULL
改动说明：代码合入：asv3.7 r46806到vmp4.5</msg>
</logentry>
<logentry
   revision="47645">
<author>fxw</author>
<date>2015-08-03T12:26:16.225166Z</date>
<msg>noreview
升级VDI4.5</msg>
</logentry>
<logentry
   revision="47626">
<author>yangwei</author>
<date>2015-08-03T09:26:33.317385Z</date>
<msg>reviewid 11038
Reviewed by: xhz
BUG ID: null
问题分析：NULL
改动说明：代码合入： asv3.7的swap(r46626)合入到vmp4.5</msg>
</logentry>
<logentry
   revision="47581">
<author>fxw</author>
<date>2015-08-03T01:50:47.015028Z</date>
<msg>noreview

Merged revision(s) 47495-47555 from VTP/VMP4.4/Trunk:
Reviewed by：hyq
BUGID: 
问题分析：
改动：网口聚合，启动初始化聚合口问题，先上库，打包验证



........
Reviewed by：hyq
BUGID: 
问题分析：
改动：规避掉vs修改interfaces文件导致的网口ip信息丢失
bps显示页面，显示所有物理网口，去掉聚合口



........
</msg>
</logentry>
<logentry
   revision="47531">
<author>fxw</author>
<date>2015-08-01T03:37:03.040963Z</date>
<msg>noreview
完善spice make.sh</msg>
</logentry>
<logentry
   revision="47524">
<author>fxw</author>
<date>2015-08-01T02:25:04.604903Z</date>
<msg>noreview
根据最新的spice代码编译spice库更新</msg>
</logentry>
<logentry
   revision="47521">
<author>fxw</author>
<date>2015-08-01T02:17:26.304683Z</date>
<msg>noreview
更新VMP4.3R2使用的vs包</msg>
</logentry>
<logentry
   revision="47518">
<author>fxw</author>
<date>2015-08-01T02:06:33.936416Z</date>
<msg>noreview
Merged revision(s) 45382, 45839, 46449, 46497, 46603, 47362 from VTP/VMP3.4/Trunk:
解决视频流黑名单功能的一个BUG，会导致计算机管理工具列表显示的图标不正常
........
Revision: 39332
Author: lifan
Date: 2015年3月28日 20:26:15
Message:
Reviewed by： lixing
BUG ID：     TD27765
问题分析：libspice-server.so出现断言错误。
改动说明：
1.回滚之前对spicevmc_red_channel_client_on_disconnect()的修改。
2.合入如下patch
http://cgit.freedesktop.org/spice/spice/commit/?id=a434543eb1243db1e52ca6a4e0cdfb425c277e56
http://cgit.freedesktop.org/spice/spice/commit/?id=c9685014e73025df416674b4c039079f4fe73faf
做了那些测试：代码编译通过，实际功能验证过
........
spice-servers支持处理yuv格式的视屏
........
SSL张波修改掉有问题的代码
........
1.解决yuv图片，中u，v分量颠倒，导致颜色不正常问题
2.处理red_get_image中一处内存泄露
........
有损压缩质量级别改为90%
........
</msg>
</logentry>
<logentry
   revision="47517">
<author>fxw</author>
<date>2015-08-01T02:04:08.111762Z</date>
<msg>noreview
Merged revision(s) 46921 from VTP/VMP3.4/Trunk:
wzt修改代码错误
........
</msg>
</logentry>
<logentry
   revision="47516">
<author>fxw</author>
<date>2015-08-01T02:03:05.608081Z</date>
<msg>noreview
Merged revision(s) 46809-46913 from VTP/VMP3.4/Trunk:

增加安装过程磁盘测速功能
........

TD:  28653
改动说明：
1.从qlogic官网上下载了最新的bnx2x-1.710.71版本网卡驱动。
测试：
在客户那里实际测试过，可以解决网络不通的问题
........
</msg>
</logentry>
<logentry
   revision="47515">
<author>fxw</author>
<date>2015-08-01T02:01:32.972227Z</date>
<msg>noreview
gxy修改：
回滚掉vs添加的，当vs存储上的虚拟机镜像有副本掉线或修复中时，在页面虚拟机上显示告警提示
取消掉ui选项</msg>
</logentry>
<logentry
   revision="47514">
<author>fxw</author>
<date>2015-08-01T02:00:57.253974Z</date>
<msg>noreview
r46697
修改虚拟机异常重启不再有stopped状态
---------------------
r46606
摄像头通道放在USB后面，避免占用USB1.0的端口 
---------------------</msg>
</logentry>
<logentry
   revision="47513">
<author>fxw</author>
<date>2015-08-01T01:59:11.975928Z</date>
<msg>noreview
VMP3.4 r46455
添加：需求: 只有客户在页面选择了修复虚拟机副本要告警才告警
改动说明：将判断条件放在调用vs脚本之前，防止get_vms接口每次调用vs脚本导致前台卡慢</msg>
</logentry>
<logentry
   revision="47511">
<author>fxw</author>
<date>2015-08-01T01:56:57.207037Z</date>
<msg>noreview
r46455
添加：需求: 只有客户在页面选择了修复虚拟机副本要告警才告警 改动说明：将判断条件放在调用vs脚本之前，防止get_vms接口每次调用vs脚本导致前台卡慢
---------------------
r46329
没有给backfile加单引号，导致特殊字符有问题
---------------------
r46317
添加：需求: 只有客户在页面选择了修复虚拟机副本要告警才告警 /cfs/alert.conf alert.conf.bak  在页面中增加了修复告警的选项，后台配置文件中添加相应的字段 "svn://200.200.0.10/vt/vt/VTP/VMP3.4 /Trunk/source/app/vtp-manager/www/new_webui /src/home/mod-setting/alert/alert.js"   alert.js...
---------------------
</msg>
</logentry>
<logentry
   revision="47510">
<author>fxw</author>
<date>2015-08-01T01:46:59.108151Z</date>
<msg>noreview
Merged revision(s) 45788-45838 from VTP/VMP3.4/Trunk:
合入zyj新增调试代码，tap网口初始化失败，驱动中加入调试代码查问题
........
上一次tap释放不及时，导致本次tap口初始化失败，论加入重试
........
qxl: drop update_displaychangelistener call for secondary qxl devices*

Commit 3dcadce5076d4b42fa395c39662d65e050b77784 added three
update_displaychangelistener call sites:

Two for primary qxl cards, when entering/leaving vga mode, which are
correct.

One for secondary qxl cards, which is wrong because we don't register
a displaychangelistener in the first place for secondary cards.

Remove it.qxl: drop update_displaychangelistener call for secondary qxl devices
........
</msg>
</logentry>
<logentry
   revision="47483">
<author>fxw</author>
<date>2015-07-31T09:53:29.502937Z</date>
<msg>noreview
Merged revision(s) 45768 from VTP/VMP3.4/Trunk:
虚拟机名称不允许有空格
........
</msg>
</logentry>
<logentry
   revision="47476">
<author>fxw</author>
<date>2015-07-31T09:06:40.415850Z</date>
<msg>noreview
Merged revision(s) 45554 from VTP/VMP3.4/Trunk:
BUG ID: TD29470[null]
问题分析：VDI版本不支持p2v迁移了，所以不用在安装的时候选择p2v了
改动说明：VDI版本不支持p2v迁移了，所以不用在安装的时候选择p2v了
做了哪些测试：打包验证，没有P2V选项了，正常安装
........
</msg>
</logentry>
<logentry
   revision="47475">
<author>fxw</author>
<date>2015-07-31T09:04:57.965693Z</date>
<msg>Merged revision(s) 45441-45472 from VTP/VMP3.4/Trunk:
noreview
修改流量单位为B
........
noreview
修改虚拟机名称不能有空格（新建虚拟机，编辑虚拟机），已有的虚拟机不受影响
........

noreview
修改虚拟机详情流量单位为B
........
</msg>
</logentry>
<logentry
   revision="47474">
<author>fxw</author>
<date>2015-07-31T09:01:36.837605Z</date>
<msg>noreview

Merged revision(s) 45297-45299 from VTP/VMP3.4/Trunk:
VSTD29754修改：有的VS环境下，VDC解压时间要4分钟
........
TD：29368 
现象：bug 29368 增加强制修改密码
改动说明：
改成第一次登陆后15天开始强制修改密码
测试OK
........
</msg>
</logentry>
<logentry
   revision="47469">
<author>fxw</author>
<date>2015-07-31T08:03:40.166770Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="47468">
<author>fxw</author>
<date>2015-07-31T08:00:21.176104Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="47457">
<author>fxw</author>
<date>2015-07-31T07:06:11.051417Z</date>
<msg>更新版本信息</msg>
</logentry>
<logentry
   revision="47442">
<author>fxw</author>
<date>2015-07-31T02:00:37.218892Z</date>
<msg>将备份目录移动到上一级目录</msg>
</logentry>
<logentry
   revision="47440">
<author>fxw</author>
<date>2015-07-31T01:59:45.726169Z</date>
<msg>将个人目录移动到上一级目录</msg>
</logentry>
<logentry
   revision="47439">
<author>fxw</author>
<date>2015-07-31T01:58:31.765590Z</date>
<msg>创建VMP4.5 svn 目录，从VMP4.4 47414开始</msg>
</logentry>
<logentry
   revision="47414">
<author>gwl</author>
<date>2015-07-30T12:16:21.666717Z</date>
<msg>reviewid 10903
Reviewed by：fxw
BUGID: 30268 30292
问题分析：1.设置VDC口时，日志提示不对。
2.编辑网口时，时间太长。
改动：
1.改日志名称：SSL  ---&gt;  VDC
2.增加判断条件，在编辑vs相关的网口时，才执行vs提供的脚本


</msg>
</logentry>
<logentry
   revision="47373">
<author>hyq</author>
<date>2015-07-30T03:51:06.565790Z</date>
<msg>reviewid 10888
Reviewed by: xhz
BUG ID: 
问题分析：合入3.6上传文件前先检查存储空间是否足够
做了哪些测试：perl -c检测代码ok
........
Merged revision(s) 42219 from VTP/VMP3.6/Trunk/source/app/vtp-manager/VTP/VAPI/Restore.pm:
reviewid 8187
reviewid by gzy
no BUG ID  
问题分析：合入3.5的app目录下的修改到3.6
改动说明：合入3.5的app目录下的修改到3.6
测试：未自测
........

</msg>
</logentry>
<logentry
   revision="47365">
<author>jcy</author>
<date>2015-07-30T02:31:33.448390Z</date>
<msg>noreview
改动说明：
bug30268：
问题4、5：配置VS通信口，不让选聚合口，聚合口应显示名称</msg>
</logentry>
<logentry
   revision="47360">
<author>gwl</author>
<date>2015-07-30T01:25:09.738850Z</date>
<msg>reviewid 10854
Reviewed by：fxw
BUGID: 30268
问题分析：网口聚合，启动初始化问题。成员网口IP未清除。
改动：fixed


</msg>
</logentry>
<logentry
   revision="47341">
<author>jcy</author>
<date>2015-07-29T09:46:21.366704Z</date>
<msg>noreview
改动说明：
bug30268：问题2：编辑虚拟机选交换机的下拉框，“物理网口”列，聚合口应显示名称</msg>
</logentry>
<logentry
   revision="47331">
<author>fxw</author>
<date>2015-07-29T08:30:37.498022Z</date>
<msg>noreview
chenlei增加了控制台防泄密的功能，重新编译spice后更新</msg>
</logentry>
<logentry
   revision="47324">
<author>fxw</author>
<date>2015-07-29T07:39:42.565879Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="47323">
<author>fxw</author>
<date>2015-07-29T07:26:37.785117Z</date>
<msg>noreview
更改编译条件，解决qemu编译找不到spice库的问题</msg>
</logentry>
<logentry
   revision="47284">
<author>fxw</author>
<date>2015-07-28T11:31:26.108018Z</date>
<msg>noreview
合入VMP3.6 软关机代码</msg>
</logentry>
<logentry
   revision="47282">
<author>fxw</author>
<date>2015-07-28T11:23:07.061761Z</date>
<msg>noreview
合入VMP3.6 软关机代码</msg>
</logentry>
<logentry
   revision="47272">
<author>gwl</author>
<date>2015-07-28T09:58:35.706734Z</date>
<msg>reviewid 10820
Reviewed by：fxw
BUGID: 
问题分析：
改动：
网口聚合-与UI联调修改

</msg>
</logentry>
<logentry
   revision="47270">
<author>jcy</author>
<date>2015-07-28T09:50:36.390837Z</date>
<msg>noreview
改动说明：
VDc通信口改为可以使用聚合口</msg>
</logentry>
<logentry
   revision="47265">
<author>jcy</author>
<date>2015-07-28T09:07:30.651548Z</date>
<msg>noreview
改动说明：
1，聚合子网口限制选择VDC通信口和已使用的网口
2, 虚拟网络部分修改聚合口的问题</msg>
</logentry>
<logentry
   revision="47263">
<author>chenlei</author>
<date>2015-07-28T08:39:27.734202Z</date>
<msg>reviewid:10811 
review by:fxw
TD: null 
现象：null
改动说明：
修改spice安装说明，修改编译告警
测试：
编译无告警，自测OK</msg>
</logentry>
<logentry
   revision="47259">
<author>fxw</author>
<date>2015-07-28T08:05:19.882390Z</date>
<msg>noreview
delete personal folder
</msg>
</logentry>
<logentry
   revision="47258">
<author>fxw</author>
<date>2015-07-28T08:05:10.272154Z</date>
<msg>noreview
delete personal folder
</msg>
</logentry>
<logentry
   revision="47251">
<author>fxw</author>
<date>2015-07-28T06:57:29.427040Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="47247">
<author>jcy</author>
<date>2015-07-28T06:25:47.495840Z</date>
<msg>noreview
改动说明：
聚合口</msg>
</logentry>
<logentry
   revision="47158">
<author>fxw</author>
<date>2015-07-28T03:12:39.005474Z</date>
<msg>noreview
把VMP3.6的libvtsn copy 到VMP4.4</msg>
</logentry>
<logentry
   revision="47156">
<author>fxw</author>
<date>2015-07-28T03:11:19.689057Z</date>
<msg>noreview 准备更新aSV3.6的 libvtsn到VMP4.4，先把VMP4.4的备份</msg>
</logentry>
<logentry
   revision="47150">
<author>chenlei</author>
<date>2015-07-28T02:30:32.434051Z</date>
<msg>reviewid:10767 
review by:fxw
TD: null 
现象：
VNC控制台防泄密
改动说明：
1.当VDI客户端接入虚拟机时禁用VMP控制台。
2.当VDI客户端断开虚拟机连接时（包括主动断开连接和异常断开连接）,将虚拟机锁屏，VMP控制台可用。
测试：
自测OK</msg>
</logentry>
<logentry
   revision="47089">
<author>chenlei</author>
<date>2015-07-27T07:50:51.900118Z</date>
<msg>noreview
VMP控制台防泄密。
1.当VDI客户端接入虚拟机时禁用VMP控制台。
2.当VDI客户端断开虚拟机连接时（包括主动断开连接和异常断开连接）,将虚拟机锁屏。</msg>
</logentry>
<logentry
   revision="47064">
<author>fxw</author>
<date>2015-07-27T02:45:23.941817Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="47053">
<author>gwl</author>
<date>2015-07-27T00:56:51.376983Z</date>
<msg>reviewid 10727
Reviewed by：fxw
BUGID: 
问题分析：
改动：
回归vs版本到1.2,2.0后续合入，且需要测试

</msg>
</logentry>
<logentry
   revision="47032">
<author>gwl</author>
<date>2015-07-25T09:39:04.569385Z</date>
<msg>reviewid 10722
Reviewed by：fxw
BUGID: 
问题分析：
改动：
修改交换机连接了聚合口之后开机启动失败的问题
顺便修改了提示错误，与合入vs最新代码</msg>
</logentry>
<logentry
   revision="47028">
<author>fxw</author>
<date>2015-07-25T09:11:13.917399Z</date>
<msg>noreview
合入VMP3.5
Merged revision(s) 38550 from VTP/VMP3.5/Trunk:
问题分析：配合Ova导入改动，增减启动WinPE虚拟机做Ova导入兼容处理的流程
改动说明：复用原接口，通过判断最后一个参数是否OVA来走不同流程
做了哪些测试：手动调用名称起虚拟机正常，和lzl联调功能通过

</msg>
</logentry>
<logentry
   revision="47012">
<author>fxw</author>
<date>2015-07-25T08:08:30.814026Z</date>
<msg>noreview
合入VMP4.0 43262 43214

r43262
ID: 29116 问题分析： 关闭或重启虚拟机时等 磁盘都关闭了再调用外部脚本，防止IO出错 测试：编译通过，自测通过。
---------------------
r43214
ID: 29116 问题分析： 挂起时退出虚拟机，会用popen调用外部脚本，导致IO读出错 修改为等所有IO操作完成在调用 测试：编译通过，自测通过。
---------------------</msg>
</logentry>
<logentry
   revision="47000">
<author>fxw</author>
<date>2015-07-25T06:32:55.392636Z</date>
<msg>noreview
CGI.pm更新，跟VMP3.5使用同样的代码，解决上传大文件出错的问题</msg>
</logentry>
<logentry
   revision="46993">
<author>fxw</author>
<date>2015-07-25T03:37:58.869620Z</date>
<msg>noreview
合入VMP3.5 37253
问题分析：加入json和protobuf转换接口
</msg>
</logentry>
<logentry
   revision="46991">
<author>fxw</author>
<date>2015-07-25T02:42:55.333856Z</date>
<msg>no review
从VMP3.6 copy /VMP3.6/Trunk/source/app/vtp-windows-modules-update</msg>
</logentry>
<logentry
   revision="46990">
<author>fxw</author>
<date>2015-07-25T02:42:26.007860Z</date>
<msg>no review
从VMP3.6 copy /VMP3.6/Trunk/source/app/vtp-Virtio-guest-windows-driver</msg>
</logentry>
<logentry
   revision="46989">
<author>fxw</author>
<date>2015-07-25T02:42:04.209592Z</date>
<msg>no review
从VMP3.6 copy /VMP3.6/Trunk/source/app/vtp-reportdata-guest</msg>
</logentry>
<logentry
   revision="46988">
<author>fxw</author>
<date>2015-07-25T02:41:38.829155Z</date>
<msg>no review
从VMP3.6 copy /VMP3.6/Trunk/source/app/vtp-modules-update-server</msg>
</logentry>
<logentry
   revision="46987">
<author>fxw</author>
<date>2015-07-25T02:41:10.621284Z</date>
<msg>no review
从VMP3.6 copy /source/app/vtp-linux-modules-update</msg>
</logentry>
<logentry
   revision="46986">
<author>fxw</author>
<date>2015-07-25T02:39:56.972227Z</date>
<msg>no review
从VMP3.6 copy VMP3.6/Trunk/source/app/p2v</msg>
</logentry>
<logentry
   revision="46985">
<author>fxw</author>
<date>2015-07-25T02:38:31.232872Z</date>
<msg>no review
从VMP3.6 copy /Trunk/build/pkg/replace-boot/local/iso</msg>
</logentry>
<logentry
   revision="46983">
<author>fxw</author>
<date>2015-07-25T02:34:22.811031Z</date>
<msg>reviewid 10703
review by: twf
TD: 30075
现象：
准备从aSV3.6更新p2v，vm tools相关代码，先把VMP4.4的相关目录移到备份目录中
改动说明：
svn://200.200.0.10/vt/vt/VTP/VMP4.4/Trunk/build/pkg/replace-boot/local/iso
svn://200.200.0.10/vt/vt/VTP/VMP4.4/Trunk/source/app/p2v
svn://200.200.0.10/vt/vt/VTP/VMP4.4/Trunk/source/app/vtp-linux-modules-update
svn://200.200.0.10/vt/vt/VTP/VMP4.4/Trunk/source/app/vtp-modules-update-server
svn://200.200.0.10/vt/vt/VTP/VMP4.4/Trunk/source/app/vtp-reportdata-guest
svn://200.200.0.10/vt/vt/VTP/VMP4.4/Trunk/source/app/vtp-Virtio-guest-windows-driver
svn://200.200.0.10/vt/vt/VTP/VMP4.4/Trunk/source/app/vtp-windows-modules-update
移到backup目录中
测试：
无
</msg>
</logentry>
<logentry
   revision="46931">
<author>gwl</author>
<date>2015-07-24T02:25:37.940728Z</date>
<msg>reviewid 10669
Reviewed by：fxw
BUGID: 
问题分析：
改动：聚合口初始化脚本的路径写错了</msg>
</logentry>
<logentry
   revision="46912">
<author>fxw</author>
<date>2015-07-23T11:19:05.688586Z</date>
<msg>reviewid 10657
review by: gwl
TD: 无
现象：
合入VMP3.5 CGI.pm 关于上传文件的修改
改动说明：
合入VMP3.5 39452，40812,41362
测试：
无
</msg>
</logentry>
<logentry
   revision="46896">
<author>gwl</author>
<date>2015-07-23T07:48:13.372205Z</date>
<msg>reviewid 10641
Reviewed by：fxw
BUGID: 
问题分析：
改动：修改聚合口名称，太长超限</msg>
</logentry>
<logentry
   revision="46886">
<author>fxw</author>
<date>2015-07-23T06:53:03.653525Z</date>
<msg>noreview
test for noreview</msg>
</logentry>
<logentry
   revision="46885">
<author>fxw</author>
<date>2015-07-23T06:52:08.920409Z</date>
<msg>noreview
test for noreview</msg>
</logentry>
<logentry
   revision="46884">
<author>fxw</author>
<date>2015-07-23T06:49:08.182434Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="46851">
<author>fxw</author>
<date>2015-07-22T12:41:51.469094Z</date>
<msg>noreviewreviewid 10611
review by: gwl
TD: 30017
现象：
开机状态编辑虚拟机，导致运行位置被改
改动说明：
Merged revision(s) 46570 from VTP/VMP3.4/Trunk
增加权限
测试：
无


</msg>
</logentry>
<logentry
   revision="46849">
<author>fxw</author>
<date>2015-07-22T12:24:02.481413Z</date>
<msg>reviewid 10610
review by: gwl
TD: 30017
现象：
上传的文件权限不对，导致无法通过文件共享下载
改动说明：
增加权限
测试：
无
</msg>
</logentry>
<logentry
   revision="46847">
<author>fxw</author>
<date>2015-07-22T12:05:14.506695Z</date>
<msg>reviewid 10609
review by: gwl
TD: 30017
现象：
派生虚拟机全部删除后，模板虚拟机无法更新
改动说明：
更新模板不检查是否存在虚拟机
测试：
无
</msg>
</logentry>
<logentry
   revision="46842">
<author>fxw</author>
<date>2015-07-22T11:24:08.123747Z</date>
<msg>noreview
更新文档</msg>
</logentry>
<logentry
   revision="46792">
<author>gwl</author>
<date>2015-07-21T13:11:47.322607Z</date>
<msg>reviewid 10566
Reviewed by：fxw
BUGID: 
问题分析：
改动：创建聚合口API参数有错</msg>
</logentry>
<logentry
   revision="46789">
<author>gwl</author>
<date>2015-07-21T12:36:43.490404Z</date>
<msg>reviewid 10563
Reviewed by：fxw
BUGID: 
问题分析：
改动：修改makefile，增加bond.pm，打入包里</msg>
</logentry>
<logentry
   revision="46772">
<author>fxw</author>
<date>2015-07-21T11:06:22.704956Z</date>
<msg>新增文档《CAR》和《需求变更申请表》</msg>
</logentry>
<logentry
   revision="46763">
<author>gwl</author>
<date>2015-07-21T09:19:07.517151Z</date>
<msg>reviewid 10547
Reviewed by：fxw
BUGID: 
问题分析：
改动：添加网口聚合代码
测试：后台测试基本没问题，上库打包后自测集群环境。</msg>
</logentry>
<logentry
   revision="46668">
<author>fxw</author>
<date>2015-07-20T06:37:47.111043Z</date>
<msg>noreview
合入VMP3.6 45169
改动说明：
TD 29325，创建虚拟机-克隆-选择虚拟机、导入虚拟机页面，虚拟机分组顺序同步最新分组排序
store.js添加stop接口</msg>
</logentry>
<logentry
   revision="46666">
<author>fxw</author>
<date>2015-07-20T06:31:20.069663Z</date>
<msg>noreview
合入VMP3.6 44470
改动说明：
TD 29518，Merged revision(s) 41628 from VTP/VMP4.0/Alternate/src/app/vtp-manager/www/new_webui， 4.0 bug28648（问题2）：上传页面：选择文件时，第二次选择同一个问题未报错</msg>
</logentry>
<logentry
   revision="46665">
<author>fxw</author>
<date>2015-07-20T06:29:13.781752Z</date>
<msg>noreview
合入VMP3.6 44218
改动说明：
bug29373：ie限制上传4G以上的文件。</msg>
</logentry>
<logentry
   revision="46664">
<author>fxw</author>
<date>2015-07-20T06:24:51.072069Z</date>
<msg>noreview
合入VMP3.6 44171
改动说明：
bug29394：上传时，速度计算有问题。</msg>
</logentry>
<logentry
   revision="46663">
<author>fxw</author>
<date>2015-07-20T06:22:06.883390Z</date>
<msg>noreview
合入VMP3.6 44160
改动说明：
把上传的公共方法提出来。</msg>
</logentry>
<logentry
   revision="46662">
<author>fxw</author>
<date>2015-07-20T06:17:34.041614Z</date>
<msg>noreview
合入VMP3.6 43293
改动说明：TD28898
上传文件的那个页面是否应该添加提示用户上传到哪里去了</msg>
</logentry>
<logentry
   revision="46660">
<author>fxw</author>
<date>2015-07-20T06:14:46.681049Z</date>
<msg>noreview
合入VMP3.6 42963
reviewid 8631
BUG ID 28294
reviewid by xhz
问题分析：ova导入，增加存储判断过程
改动说明：ova导入出错时候，增加存储判断过程。
测试：自测通过</msg>
</logentry>
<logentry
   revision="46656">
<author>chenlei</author>
<date>2015-07-20T03:46:21.989827Z</date>
<msg>vnc防泄密，编译通过</msg>
</logentry>
<logentry
   revision="46650">
<author>chenlei</author>
<date>2015-07-20T03:09:52.496526Z</date>
<msg>revert to 46339</msg>
</logentry>
<logentry
   revision="46616">
<author>fxw</author>
<date>2015-07-18T06:56:30.294597Z</date>
<msg>noreview
导入界面删去存储的最大最小IO速率</msg>
</logentry>
<logentry
   revision="46609">
<author>fxw</author>
<date>2015-07-18T03:33:21.709506Z</date>
<msg>noreview
增加脚本，用于导入虚拟机启动盘判断</msg>
</logentry>
<logentry
   revision="46608">
<author>fxw</author>
<date>2015-07-18T03:32:11.122759Z</date>
<msg>noreview
OVA 导入虚拟机合入VMP3.5遗漏修改
1. forecast参数动态判断
2. 删去uefi bios配置</msg>
</logentry>
<logentry
   revision="46607">
<author>fxw</author>
<date>2015-07-18T03:25:56.059536Z</date>
<msg>noreview
删除无用日志</msg>
</logentry>
<logentry
   revision="46575">
<author>chenlei</author>
<date>2015-07-17T09:10:38.779495Z</date>
<msg>vnc防泄密</msg>
</logentry>
<logentry
   revision="46569">
<author>fxw</author>
<date>2015-07-17T07:17:27.502313Z</date>
<msg>noreview

合入VMP3.5
r39457
noreview 改动说明： TD 27667，39353改动引发，只有在创建虚拟机 克隆 的选择虚拟机窗口才不能选不能克隆的虚拟机
---------------------
r38895
noreview改动说明：TD27598 克隆新入口UI问题集合
---------------------
r38876
noreview改动说明;TD27586 虚拟机列表的新建需要与首页相同
---------------------
r38793
noreview改动说明：TD27599 克隆入口未选择虚拟机报错后回到了首页
---------------------
r38583
noreview 改动说明：在首页克隆虚拟机选择下一步后的可选择上一步
---------------------
r37119
noreview 改动说明:  修正点击X后，添加虚拟机窗口不能再次打开的问题
---------------------
r37024
noreview 改动说明:  增加虚拟机导入的链接
---------------------
r37020
noreview 改动说明:  修正克隆虚拟机提交后，未显示任务信息的问题 
---------------------
r37014
noreview 改动说明:  新需求：更改创建虚拟机的方式 
---------------------
</msg>
</logentry>
<logentry
   revision="46483">
<author>fxw</author>
<date>2015-07-15T13:16:14.770990Z</date>
<msg>noreview
复制VMP3.5 的mod-import-vm 覆盖原来的文件
</msg>
</logentry>
<logentry
   revision="46482">
<author>fxw</author>
<date>2015-07-15T13:10:37.176520Z</date>
<msg>noreview</msg>
</logentry>
<logentry
   revision="46481">
<author>fxw</author>
<date>2015-07-15T12:58:34.694631Z</date>
<msg>noreview
合入VMP3.5 41356
改动说明：
上传文件：加个参数，后台校验剩余空间大小。
存储详情：加上io速率趋势。</msg>
</logentry>
<logentry
   revision="46480">
<author>fxw</author>
<date>2015-07-15T12:56:42.603914Z</date>
<msg>noreview
合入VMP3.5 41356
改动说明：
上传文件：加个参数，后台校验剩余空间大小。
存储详情：加上io速率趋势。</msg>
</logentry>
<logentry
   revision="46478">
<author>fxw</author>
<date>2015-07-15T12:48:47.562385Z</date>
<msg>r42209
noreview改动说明：TD28527 上传iso的时候，从不同的入口进入上传页面，存储列表不一致
---------------------
r41849
noreview改动说明：TD28620 文件上传的字符限制90个太少了 --5.15
---------------------
r41716
noreview改动说明：TD28620 文件上传的字符限制90个太少了
---------------------
r41282
noreview 改动说明： bug28510：上传iso限制带有空格的文件
---------------------
r41227
noreview 改动说明： 1：上传iso：加上传速度提示 2：修改上传速度和剩余时间计算错误。
---------------------
r41229
noreview 改动说明： 存储管理页面：目录重命名：名称限制输入空格。
---------------------
r40863
noreview 改动说明： 存储管理页面：添加目录：名称限制输入空格。</msg>
</logentry>
<logentry
   revision="46476">
<author>fxw</author>
<date>2015-07-15T12:04:39.767958Z</date>
<msg>noreview
合入VMP3.5 40158
改动说明：
TD 27965，vmp导入ova时剩余时间太敏感</msg>
</logentry>
<logentry
   revision="46475">
<author>fxw</author>
<date>2015-07-15T11:57:46.165330Z</date>
<msg>noreview
合入VMP3.5 40729 40906 41357 41821 41828 41854 41859 41879 42483</msg>
</logentry>
<logentry
   revision="46473">
<author>fxw</author>
<date>2015-07-15T11:22:41.248235Z</date>
<msg>noreview
合代码合错了，删除</msg>
</logentry>
<logentry
   revision="46471">
<author>fxw</author>
<date>2015-07-15T11:00:30.896980Z</date>
<msg>更新、上传文档</msg>
</logentry>
<logentry
   revision="46339">
<author>fxw</author>
<date>2015-07-14T06:59:31.815814Z</date>
<msg>copy to chenlei</msg>
</logentry>
<logentry
   revision="46338">
<author>fxw</author>
<date>2015-07-14T06:58:44.539917Z</date>
<msg>delete</msg>
</logentry>
<logentry
   revision="46337">
<author>fxw</author>
<date>2015-07-14T06:58:12.455414Z</date>
<msg>copy to chenlei</msg>
</logentry>
<logentry
   revision="46336">
<author>fxw</author>
<date>2015-07-14T06:57:19.287732Z</date>
<msg>copy to chenlei</msg>
</logentry>
<logentry
   revision="46335">
<author>fxw</author>
<date>2015-07-14T06:56:52.947606Z</date>
<msg>copy to chenlei</msg>
</logentry>
<logentry
   revision="46334">
<author>fxw</author>
<date>2015-07-14T06:56:19.258510Z</date>
<msg>create chenlei</msg>
</logentry>
<logentry
   revision="45834">
<author>zhangning</author>
<date>2015-07-10T03:13:13.531827Z</date>
<msg>Fix core on blockdev.c line 494.</msg>
</logentry>
<logentry
   revision="45826">
<author>zhangning</author>
<date>2015-07-10T02:15:24.894276Z</date>
<msg>从快照启动VM的代码</msg>
</logentry>
<logentry
   revision="45825">
<author>zhangning</author>
<date>2015-07-10T02:15:20.992985Z</date>
<msg>从快照启动VM的代码</msg>
</logentry>
<logentry
   revision="45824">
<author>zhangning</author>
<date>2015-07-10T02:15:14.564056Z</date>
<msg>从快照启动VM的代码</msg>
</logentry>
<logentry
   revision="45809">
<author>fxw</author>
<date>2015-07-09T11:03:59.384829Z</date>
<msg>修改了模板部署的流程，第一次部署的时候直接把模板虚拟机的镜像移到template下面</msg>
</logentry>
<logentry
   revision="45765">
<author>qifei</author>
<date>2015-07-09T03:53:09.993432Z</date>
<msg>revert 45604</msg>
</logentry>
<logentry
   revision="45763">
<author>fxw</author>
<date>2015-07-09T03:19:01.600779Z</date>
<msg>delete useless edk2</msg>
</logentry>
<logentry
   revision="45762">
<author>fxw</author>
<date>2015-07-09T03:14:14.330726Z</date>
<msg>delete useless app</msg>
</logentry>
<logentry
   revision="45761">
<author>fxw</author>
<date>2015-07-09T03:13:51.575056Z</date>
<msg>delete useless p2v</msg>
</logentry>
<logentry
   revision="45760">
<author>fxw</author>
<date>2015-07-09T03:12:21.283835Z</date>
<msg>copy for improving template vm deploy and update speed</msg>
</logentry>
<logentry
   revision="45759">
<author>fxw</author>
<date>2015-07-09T03:11:03.958984Z</date>
<msg>fxw personal folder</msg>
</logentry>
<logentry
   revision="45721">
<author>qifei</author>
<date>2015-07-08T09:58:36.255305Z</date>
<msg>Revision: 39902
Author: zsb
Date: 2015年4月10日 20:42:21
Message:
noreview
改动说明：
TD 28036，[体验]ova上传界面，要加入上传速率显示
----
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-import-vm/index.css
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-import-vm/index.js

</msg>
</logentry>
<logentry
   revision="45635">
<author>qifei</author>
<date>2015-07-08T09:48:15.429405Z</date>
<msg>39269-39704</msg>
</logentry>
<logentry
   revision="45611">
<author>qifei</author>
<date>2015-07-08T09:46:10.200635Z</date>
<msg>Revision: 39202
Author: zsb
Date: 2015年3月27日 10:37:37
Message:
noreview
改动说明：
td 27556，[ova导入]ova导入的2012系统，添加光驱，进系统内部找不到光驱，光驱不分配到ide1
----
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-common/vm/add/window.js

</msg>
</logentry>
<logentry
   revision="45605">
<author>qifei</author>
<date>2015-07-08T09:35:14.610104Z</date>
<msg>Revision: 39198
Author: lzl
Date: 2015年3月27日 10:16:44
Message:
reviewid 6310
BUG ID 27613
Reviewed by: xhz
问题分析：ova导入问题：查询日志失败，但是虚拟机实际创建成功。
改动说明：创建虚拟机流程添加p2v参数。
测试：编译通过。




----
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/VTP/OVAOperate.pm

</msg>
</logentry>
<logentry
   revision="45604">
<author>qifei</author>
<date>2015-07-08T09:33:50.139430Z</date>
<msg>Revision: 39195
Author: zsb
Date: 2015年3月27日 9:57:29
Message:
noreview
改动说明：
td 27556，[ova导入]ova导入的2012系统，添加光驱，进系统内部找不到光驱，光驱不分配到ide1
----
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-common/vm/add/hard/detail/index.js

</msg>
</logentry>
<logentry
   revision="45603">
<author>qifei</author>
<date>2015-07-08T09:30:14.041329Z</date>
<msg>38908-39185</msg>
</logentry>
<logentry
   revision="45599">
<author>qifei</author>
<date>2015-07-08T08:58:14.042342Z</date>
<msg>Revision: 38887
Author: ljb
Date: 2015年3月23日 19:16:37
Message:
reviewid 6117
Reviewed by: gzy
BUG ID: 
问题分析：ge --&gt; &gt;=
改动说明：ge --&gt; &gt;=
做了哪些测试：使用perl -c 检查语法，语法OK
----
Modified : /VTP/VMP3.5/Trunk/build/pkg/replace-root/sf/etc/cron.d/hourly.d/17clean_ova_garbage.pl

</msg>
</logentry>
<logentry
   revision="45597">
<author>qifei</author>
<date>2015-07-08T08:33:57.360868Z</date>
<msg>Revision: 38846
Author: jcy
Date: 2015年3月23日 11:18:53
Message:
noreview
改动说明：
ova导入：修改文件存放位置。
----
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-import-vm/index.js

</msg>
</logentry>
<logentry
   revision="45596">
<author>qifei</author>
<date>2015-07-08T08:32:30.681353Z</date>
<msg>38822,38826</msg>
</logentry>
<logentry
   revision="45589">
<author>qifei</author>
<date>2015-07-08T07:28:42.237669Z</date>
<msg>Revision: 38808
Author: ljb
Date: 2015年3月21日 18:12:20
Message:
reviewid 6035
Reviewed by: gzy
BUG ID: 27520
问题分析：每个小时去检查上次ova目录，如果修改时间超过1天就删除
改动说明：每个小时去检查上次ova目录，如果修改时间超过1天就删除
做了哪些测试：使用perl -c 检查语法，语法OK

1.在/sf/data/local/ova/Unpack_ova_host-90e2ba2ad968/ 目录下创建1.ova 和test 目录

2.修改时间，修改时间推后23小时，执行脚本,不会清理1.ova和test

3.修改时间为24小时以后，执行脚本，1.ova和test 都被删除

4.只会清理/sf/data/{存储}/ova/Unpack_ova_host-90e2ba2ad968/下的东西
----
Added : /VTP/VMP3.5/Trunk/build/pkg/replace-root/sf/etc/cron.d/hourly.d/17clean_ova_garbage.pl

</msg>
</logentry>
<logentry
   revision="45587">
<author>qifei</author>
<date>2015-07-08T07:20:50.482433Z</date>
<msg>Revision: 38790
Author: lzl
Date: 2015年3月21日 16:20:47
Message:
reviewid 6057
BUG ID 27588
Reviewed by: gzy
问题分析：ova导入增加进度条。
改动说明：ova导入增加进度条。
测试：编译通过。




----
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/VTP/OVAOperate.pm

</msg>
</logentry>
<logentry
   revision="45586">
<author>qifei</author>
<date>2015-07-08T07:04:56.650815Z</date>
<msg>Revision: 38787
Author: jcy
Date: 2015年3月21日 16:10:07
Message:
noreview
改动说明：
ova导入：修改文件存放位置。
----
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-import-vm/index.js

</msg>
</logentry>
<logentry
   revision="45580">
<author>fxw</author>
<date>2015-07-08T03:21:53.692001Z</date>
<msg>新增文档《障碍列表》
修改《项目过程审计》</msg>
</logentry>
<logentry
   revision="45578">
<author>qifei</author>
<date>2015-07-08T03:20:59.380532Z</date>
<msg>38639,38640,38662</msg>
</logentry>
<logentry
   revision="45573">
<author>qifei</author>
<date>2015-07-08T02:40:13.138061Z</date>
<msg>Revision: 38600
Author: lzl
Date: 2015年3月19日 11:27:54
Message:
reviewid 5954
BUG ID 27514
Reviewed by: gzy
问题分析：虚拟机名称包含特殊字符处理。
改动说明：虚拟机名称包含特殊字符，这里会去掉特殊字符，如果处理后名称为空就重命名为Sangfor_OVA_vm。
测试：经过测试，正常。




----
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/VTP/OVAOperate.pm

</msg>
</logentry>
<logentry
   revision="45572">
<author>qifei</author>
<date>2015-07-08T02:39:15.753072Z</date>
<msg>Revision: 38573
Author: lzl
Date: 2015年3月18日 18:10:03
Message:
reviewid 5941
BUG ID 27360
Reviewed by: zxq
问题分析：内存最大值限制根据是否使用企业版还是试用版来限制，2；ova导入支持并发。
改动说明：1、内存最大值限制根据是否使用企业版还是试用版来限制，2；ova导入支持并发。
测试：经过测试，正常。




----
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/VTP/OVAOperate.pm

</msg>
</logentry>
<logentry
   revision="45544">
<author>qifei</author>
<date>2015-07-07T09:32:10.524075Z</date>
<msg>Revision: 38555
Author: tyy
Date: 2015年3月18日 15:38:32
Message:
noreview 
改动说明：TD27353 [OVA导入]上传文件过程中取消，不应进入报错页面。
----
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-import-vm/index.js

</msg>
</logentry>
<logentry
   revision="45543">
<author>qifei</author>
<date>2015-07-07T09:29:31.224075Z</date>
<msg>Revision: 38542
Author: lzl
Date: 2015年3月18日 12:57:57
Message:
reviewid 5922
BUG ID 27527
Reviewed by: gzy
问题分析：从vmware导出的OVA（磁盘是SCSI格式）导入VMP，有些windows系统蓝屏。
改动说明：原因是qemu不是很支持SCSI格式磁盘。
测试：经过测试，正常。




----
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/VTP/OVAOperate.pm

</msg>
</logentry>
<logentry
   revision="45542">
<author>qifei</author>
<date>2015-07-07T09:27:33.412993Z</date>
<msg>Revision: 38457
Author: lzl
Date: 2015年3月17日 10:49:36
Message:
reviewid 5872
no BUG ID
Reviewed by: xhz
问题分析：增加ovf版本信息获取，转为VMP版版本类型。
改动说明：识别ovf版本信息，匹配对应的VMP版版本类型，这里只对常用版本设置。
测试：经过测试，正常。




----
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/VTP/OVAOperate.pm

</msg>
</logentry>
<logentry
   revision="45538">
<author>qifei</author>
<date>2015-07-07T08:45:58.516206Z</date>
<msg>Revision: 38425
Author: lzl
Date: 2015年3月16日 18:12:50
Message:
reviewid 5843 
BUG ID 27317
Reviewed by: xhz
问题分析：本地存储和共享存储判断区分有问题。
改动说明：根据存储配置文件的shared字段来判断是否为共享存储。
测试：经过测试，正常。



----
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/VTP/OVAOperate.pm

</msg>
</logentry>
<logentry
   revision="45537">
<author>qifei</author>
<date>2015-07-07T08:44:25.444477Z</date>
<msg>Revision: 38407
Author: lzl
Date: 2015年3月16日 15:29:23
Message:
reviewid 5807 
BUG ID 27317
Reviewed by: gzy
问题分析：解决ova导入共享存储失败，跨主机失败，名称冲突的问题。
改动说明：解决ova导入共享存储失败，跨主机失败，名称冲突的问题。
测试：经过测试，正常。



----
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/VTP/OVAOperate.pm

</msg>
</logentry>
<logentry
   revision="45536">
<author>qifei</author>
<date>2015-07-07T08:43:06.217332Z</date>
<msg>Revision: 38326
Author: lzl
Date: 2015年3月14日 16:34:05
Message:
reviewid 5780 
Reviewed by: xhz
问题分析：如果ova导入其他主机，无法获取进度条问题。
改动说明：如果代理到其他主机，那么就返回代理后的puid。
测试：经过测试，正常。



----
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/VTP/VAPI/VMOperate.pm

</msg>
</logentry>
<logentry
   revision="45534">
<author>qifei</author>
<date>2015-07-07T08:38:09.435131Z</date>
<msg>Revision: 38207
Author: jcy
Date: 2015年3月13日 13:16:53
Message:
noreview
改动说明：
bug27362：
OVA导入界面的分组默认应为“默认组”。
----
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-import-vm/index.js

</msg>
</logentry>
<logentry
   revision="45533">
<author>qifei</author>
<date>2015-07-07T08:36:51.978085Z</date>
<msg>Revision: 37646
Author: lzl
Date: 2015年3月4日 20:47:02
Message:
reviewid 5321
no BUG ID
Reviewed by: gzy
问题分析：添加功能，以及重构代码。
改动说明：
1、gzy审核代码，改掉不规范的代码。
2、支持efi引导。
3、对导入虚拟机cpu或者内存超过限制，那么设置为限制的最大值。
测试：经过测试，正常。

----
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/VTP/OVAOperate.pm

</msg>
</logentry>
<logentry
   revision="45531">
<author>qifei</author>
<date>2015-07-07T08:35:50.808807Z</date>
<msg>Revision: 37079
Author: lzl
Date: 2015年2月10日 11:59:41
Message:
reviewid 5092
no BUG ID
Reviewed by: gzy
问题分析：增加ova导入虚拟机到非主控主机上。
改动说明： 增加ova导入虚拟机到非主控主机上
测试：经过测试，正常。

----
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/VTP/OVAOperate.pm
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/VTP/VAPI/VMOperate.pm

</msg>
</logentry>
<logentry
   revision="45529">
<author>qifei</author>
<date>2015-07-07T08:33:49.700512Z</date>
<msg>Revision: 37051
Author: lzl
Date: 2015年2月10日 9:04:24
Message:
reviewid 5079
Reviewed by: gzy
问题分析：Makefile添加OVAOperate脚本。
改动说明： Makefile添加OVAOperate脚本
测试：经过各种raid模拟测试，正常。

----
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/VTP/Makefile

</msg>
</logentry>
<logentry
   revision="45526">
<author>qifei</author>
<date>2015-07-07T08:30:38.886887Z</date>
<msg>Revision: 37046
Author: lzl
Date: 2015年2月9日 22:17:39
Message:
reviewid 5078
no BUG ID
Reviewed by: gzy
问题分析：增加ova导入虚拟机功能。
改动说明： 增加ova导入虚拟机功能，代码如果
测试：经过各种raid模拟测试，正常。

----
Added : /VTP/VMP3.5/Trunk/source/app/vtp-manager/VTP/OVAOperate.pm
Modified : /VTP/VMP3.5/Trunk/source/app/vtp-manager/VTP/VAPI/VMOperate.pm

</msg>
</logentry>
<logentry
   revision="45523">
<author>qifei</author>
<date>2015-07-07T08:06:25.026030Z</date>
<msg>Revision: 37022
Author: jcy
Date: 2015年2月9日 20:40:35
Message:
noreview
改动说明：
新增 导入本地文件 模块。
----
Added : /VTP/VMP3.5/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-import-vm
Added : /VTP/VMP3.5/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-import-vm/img
Added : /VTP/VMP3.5/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-import-vm/img/img_arrows.png
Added : /VTP/VMP3.5/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-import-vm/img/local-ova.png
Added : /VTP/VMP3.5/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-import-vm/img/logo_44_40.png
Added : /VTP/VMP3.5/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-import-vm/img/my-computer.png
Added : /VTP/VMP3.5/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-import-vm/img/vmp_cloud.png
Added : /VTP/VMP3.5/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-import-vm/index.css
Added : /VTP/VMP3.5/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-import-vm/index.js
Added : /VTP/VMP3.5/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-import-vm/index.tpl
Added : /VTP/VMP3.5/Trunk/source/app/vtp-manager/www/new_webui/src/home/mod-import-vm/vm-info.tpl

</msg>
</logentry>
<logentry
   revision="45522">
<author>qifei</author>
<date>2015-07-07T08:00:05.978338Z</date>
<msg>reviewid 10231
Reviewed by：lixing
加入OVMF开源代码

SHA-1: 49a228ca6980b197bb854dc88c909d712959cb47

Update SPI connection parameters for Microsoft RhProxy driver.

Contributed-under: TianoCore Contribution Agreement 1.0
Signed-off-by: David Wei david.wei@intel.com
Reviewed-by: Tim He tim.he@intel.com

git-svn-id: https://svn.code.sf.net/p/edk2/code/trunk/edk2@16679 6f19259b-4bc3-4df7-8a09-765794883524</msg>
</logentry>
<logentry
   revision="45488">
<author>fxw</author>
<date>2015-07-07T02:11:10.579489Z</date>
<msg>《VMP4.4需求》上库</msg>
</logentry>
<logentry
   revision="45481">
<author>fxw</author>
<date>2015-07-07T00:50:09.870619Z</date>
<msg>更新 《过程审计checklist》
</msg>
</logentry>
<logentry
   revision="45475">
<author>fxw</author>
<date>2015-07-06T12:07:25.744466Z</date>
<msg>更新 《过程审计checklist》</msg>
</logentry>
<logentry
   revision="45456">
<author>zhangning</author>
<date>2015-07-06T08:22:26.088531Z</date>
<msg>New create for 4.4.</msg>
</logentry>
<logentry
   revision="45444">
<author>fxw</author>
<date>2015-07-06T06:35:36.517356Z</date>
<msg>修改版本号，原来的不对</msg>
</logentry>
<logentry
   revision="45365">
<author>fxw</author>
<date>2015-07-02T11:18:08.519999Z</date>
<msg>noreview
上传打包需要的exe文件，从3.4复制而来</msg>
</logentry>
<logentry
   revision="45352">
<author>fxw</author>
<date>2015-07-02T09:01:13.716040Z</date>
<msg>测试修改</msg>
</logentry>
<logentry
   revision="45348">
<author>fxw</author>
<date>2015-07-02T08:51:47.657562Z</date>
<msg>修改打包版本号</msg>
</logentry>
<logentry
   revision="45314">
<author>fxw</author>
<date>2015-07-02T02:36:43.325197Z</date>
<msg>noreview 增加《沙盘计划》和《裁剪表》</msg>
</logentry>
<logentry
   revision="45289">
<author>fxw</author>
<date>2015-07-01T08:16:04.564924Z</date>
<msg>上传 《敏捷开发项目过程审计checklist》</msg>
</logentry>
<logentry
   revision="45286">
<author>fxw</author>
<date>2015-07-01T07:58:41.995727Z</date>
<msg>noreview
删除之前3.4的文档</msg>
</logentry>
<logentry
   revision="45284">
<author>fxw</author>
<date>2015-07-01T07:51:49.350090Z</date>
<msg>noreview
删除有病毒的文件</msg>
</logentry>
<logentry
   revision="45270">
<author>fxw</author>
<date>2015-07-01T04:02:23.746163Z</date>
<msg>merge VMP3.5 39720
修改分辨率导致缓冲区溢出</msg>
</logentry>
<logentry
   revision="45269">
<author>fxw</author>
<date>2015-07-01T03:57:35.508044Z</date>
<msg>合入VMP3.5 36483 
vhost user does not support LOG_ALL feature bit.
Generally, we should not try to set this bit without
checking that backend can support it first.
Detect and block migration.</msg>
</logentry>
<logentry
   revision="45268">
<author>fxw</author>
<date>2015-07-01T03:55:31.007567Z</date>
<msg>reviewid 4780
reviewed by: fxw
BUG ID:      [NULL]

问题分析：
virtio-net: announce self by guest
It's hard to track all mac addresses and their configurations (e.g
vlan or ipv6) in qemu. Without this information, it's impossible to
build proper garp packet after migration. The only possible solution
to this is let guest (who knows all configurations) to do this.
So, this patch introduces a new readonly config status bit of virtio-net,
VIRTIO_NET_S_ANNOUNCE which is used to notify guest to announce
presence of its link through config update interrupt.When guest has
done the announcement, it should ack the notification through
VIRTIO_NET_CTRL_ANNOUNCE_ACK cmd. This feature is negotiated by a new
feature bit VIRTIO_NET_F_ANNOUNCE (which has already been supported by
Linux guest).

During load, a counter of announcing rounds is set so that after the vm is
running it can trigger rounds of config interrupts to notify the guest to build
and send the correct garps.


改动说明：

1. backport commit f57fcf706342f8545d77a538c4319b752511f672
http://git.qemu.org/?p=qemu.git;a=commit;h=f57fcf706342f8545d77a538c4319b752511f672
2. 
backport commit 508e1180d3e8371a902ba721d2c9e1ee04c33a15
http://git.qemu.org/?p=qemu.git;a=commit;h=508e1180d3e8371a902ba721d2c9e1ee04c33a15
3. 
backport commit 110f463062d65487fdd0daaaa0df53a2ea9d6619
http://git.qemu.org/?p=qemu.git;a=commit;h=110f463062d65487fdd0daaaa0df53a2ea9d6619


迁移后，需要通告guest的mac地址，但是由于这个难以确定合适的定时发送间隔，所以通过配置状态位
VIRTIO_NET_S_ANNOUNCE来注入配置更新中断通知guest，guest announce完毕，会发送VIRTIO_NET_CTRL_ANNOUNCE_ACK


</msg>
</logentry>
<logentry
   revision="45265">
<author>fxw</author>
<date>2015-07-01T03:46:19.059744Z</date>
<msg>合入VMP3.5 36483 
vhost user does not support LOG_ALL feature bit.
Generally, we should not try to set this bit without
checking that backend can support it first.
Detect and block migration.</msg>
</logentry>
<logentry
   revision="45264">
<author>fxw</author>
<date>2015-07-01T03:37:29.732895Z</date>
<msg>合入VMP3.5 41733 </msg>
</logentry>
<logentry
   revision="45257">
<author>fxw</author>
<date>2015-07-01T02:57:51.850182Z</date>
<msg>noreview
修复有病毒的文件</msg>
</logentry>
<logentry
   revision="45243">
<author>fxw</author>
<date>2015-07-01T01:30:14.870409Z</date>
<msg>复制4.4原始代码到分支目录</msg>
</logentry>
<logentry
   revision="45242">
<author>fxw</author>
<date>2015-07-01T01:29:10.131080Z</date>
<msg>创建合代码分支目录</msg>
</logentry>
<logentry
   revision="45208">
<author>fxw</author>
<date>2015-06-30T09:05:41.250985Z</date>
<msg>copy VMP3.4 to VMP4.4</msg>
</logentry>
<logentry
   revision="45041">
<author>qifei</author>
<date>2015-06-26T01:34:09.699899Z</date>
<msg>reviewid 9929
更新tar包</msg>
</logentry>
<logentry
   revision="45004">
<author>qifei</author>
<date>2015-06-25T02:06:48.664783Z</date>
<msg>reviewid 9876
修改个标点问题，和文字问题</msg>
</logentry>
<logentry
   revision="44999">
<author>qifei</author>
<date>2015-06-25T01:38:39.973147Z</date>
<msg>reviewid 9873
更新tar包</msg>
</logentry>
<logentry
   revision="44981">
<author>qifei</author>
<date>2015-06-24T11:54:42.332251Z</date>
<msg>reviewid 9869
更新ssl库</msg>
</logentry>
<logentry
   revision="44978">
<author>qifei</author>
<date>2015-06-24T11:32:37.553843Z</date>
<msg>reviewid 9867
区分Guest还是Host修改分辨率
文字识别jpeg压缩质量改为80</msg>
</logentry>
<logentry
   revision="44729">
<author>qifei</author>
<date>2015-06-24T10:24:01.268919Z</date>
<msg>reviewid 9863
修改TD29733 新增一个关机执行的脚本 需要修改 </msg>
</logentry>
<logentry
   revision="44684">
<author>qifei</author>
<date>2015-06-24T06:26:34.565215Z</date>
<msg>reviewid 9817</msg>
</logentry>
<logentry
   revision="44681">
<author>ljb</author>
<date>2015-06-24T03:12:53.603016Z</date>
<msg>reviewid 9812
Reviewed by: xhz
BUG ID: 29606
问题分析：合入bug 29561
改动说明：合入bug 29561
做了哪些测试：perl -c 检查语法，语法OK
1、创建HA虚拟机，编辑不勾选HA，勾选主机启动时，自动运行此虚拟机，点击确定，配置生效。开机自启动虚拟机成功
2、创建普通虚拟机，编辑勾选主机启动时，自动运行此虚拟机，点击确定，配置生效。开机自启动虚拟机成功
3、创建HA虚拟机，编辑部勾选HA，点击确定，主机启动时，自动运行此虚拟机没有勾选上，开机虚拟机没有启动
4、创建虚拟机勾选主机启动时，自动运行此虚拟机，点击确定，配置生效。开机自启动虚拟机成功

</msg>
</logentry>
<logentry
   revision="44673">
<author>qifei</author>
<date>2015-06-24T02:19:33.545096Z</date>
<msg>reviewid 9805
页面漏改，添加热备盘</msg>
</logentry>
<logentry
   revision="44537">
<author>qifei</author>
<date>2015-06-23T06:32:47.690236Z</date>
<msg>reviewid 9687
更新tar包</msg>
</logentry>
<logentry
   revision="44440">
<author>qifei</author>
<date>2015-06-19T08:47:45.389299Z</date>
<msg>reviewid 9627
逻辑错误修改，少了一个变量定义，数组传参引用</msg>
</logentry>
<logentry
   revision="44402">
<author>qifei</author>
<date>2015-06-19T02:03:51.150622Z</date>
<msg>reviewid 9612</msg>
</logentry>
<logentry
   revision="44273">
<author>qifei</author>
<date>2015-06-18T08:12:09.223411Z</date>
<msg>reviewid 9531
修改，单副本禁用热备盘，错误修改</msg>
</logentry>
<logentry
   revision="44251">
<author>qifei</author>
<date>2015-06-18T04:00:12.549322Z</date>
<msg>reviewid 9493
更新tar包</msg>
</logentry>
<logentry
   revision="44212">
<author>qifei</author>
<date>2015-06-17T10:10:05.824551Z</date>
<msg>reviewid 8781
解决TD29081</msg>
</logentry>
<logentry
   revision="44207">
<author>qifei</author>
<date>2015-06-17T08:40:57.461200Z</date>
<msg>reviewid 9468
VSTD29700 内存使用问题，增加VS保留内存计算修改合入</msg>
</logentry>
<logentry
   revision="44199">
<author>qifei</author>
<date>2015-06-17T07:35:56.496700Z</date>
<msg>reviewid 8782
修改，在单副本或单主机情况下，禁用热备盘
</msg>
</logentry>
<logentry
   revision="44174">
<author>qifei</author>
<date>2015-06-17T02:08:58.220434Z</date>
<msg>reviewid 8783
更新tar包
</msg>
</logentry>
<logentry
   revision="44134">
<author>qifei</author>
<date>2015-06-16T07:09:43.846042Z</date>
<msg>reviewid 8784
修改TD29655、29659、29664</msg>
</logentry>
<logentry
   revision="44130">
<author>qifei</author>
<date>2015-06-16T04:01:27.456784Z</date>
<msg>reviewid 9426
TD29063非一体机环境不允许添加一体机</msg>
</logentry>
<logentry
   revision="44119">
<author>qifei</author>
<date>2015-06-16T02:28:16.457662Z</date>
<msg>reviewid 8785
更新vs的tar包</msg>
</logentry>
<logentry
   revision="44118">
<author>qifei</author>
<date>2015-06-16T02:23:24.937268Z</date>
<msg>reviewid 8786
修改目的：精简提示信息

改动文件：
Trunk/source/app/vtp-common/VMInfo.pm
精简提示信息

</msg>
</logentry>
<logentry
   revision="44110">
<author>qifei</author>
<date>2015-06-15T13:27:51.009459Z</date>
<msg>reviewid 8787
更新ssl库</msg>
</logentry>
<logentry
   revision="43842">
<author>qifei</author>
<date>2015-06-13T01:53:23.362250Z</date>
<msg>reviewid 9182
Reviewed by：lbc
BUGID: 29297
问题分析：[技术支持]3.4版本，虚拟机名称带空格，会重启后还原
改动：shell脚本中的变量都用双引号引起来
测试：3.4的环境，名称带空格的虚拟机，没有勾选重启后还原，重启后不会还原。
     派生虚拟机名称有空格，模板未更新，重启不会还原。
</msg>
</logentry>
<logentry
   revision="43838">
<author>qifei</author>
<date>2015-06-13T01:26:02.081871Z</date>
<msg>reviewid 8791
针对TD29703
[vs1.2]数据盘替换时，要求替换盘的大于等于被替换盘。但热备盘是不小于10%[热备盘]
统一热备盘替换和新盘替换两种模式下，替换盘大于被替换盘95%就可以替换的判断方式</msg>
</logentry>
<logentry
   revision="43797">
<author>qifei</author>
<date>2015-06-12T03:40:22.502316Z</date>
<msg>reviewid 8792
修改vs改动引发</msg>
</logentry>
<logentry
   revision="43789">
<author>qifei</author>
<date>2015-06-12T02:50:30.437358Z</date>
<msg>reviewid 8794
修改目的：当vs存储上的虚拟机镜像有副本掉线或修复中时，在页面虚拟机上显示告警提示，鼠标移到告警图标上时显示提示内容。</msg>
</logentry>
<logentry
   revision="43711">
<author>qifei</author>
<date>2015-06-11T06:40:28.928876Z</date>
<msg>reviewid 8798
提高挂起/迁移速度</msg>
</logentry>
<logentry
   revision="43676">
<author>qifei</author>
<date>2015-06-11T04:04:01.566291Z</date>
<msg>reviewid 8780
vs改动
TD29666
</msg>
</logentry>
<logentry
   revision="43670">
<author>qifei</author>
<date>2015-06-11T03:46:32.914065Z</date>
<msg>reviewid 8779
合入vs代码</msg>
</logentry>
<logentry
   revision="43569">
<author>qifei</author>
<date>2015-06-10T09:54:54.347928Z</date>
<msg>reviewid 8778
TD29664</msg>
</logentry>
<logentry
   revision="43555">
<author>qifei</author>
<date>2015-06-10T09:13:53.930473Z</date>
<msg>reviewid 8860
修改TD29664：单主机应不能配置数据重建</msg>
</logentry>
<logentry
   revision="43540">
<author>qifei</author>
<date>2015-06-10T08:44:17.366851Z</date>
<msg>reviewid 8870
修改版本号</msg>
</logentry>
<logentry
   revision="43515">
<author>qifei</author>
<date>2015-06-10T07:34:34.975349Z</date>
<msg>reviewid 8869
TD 29666
修改vs的bug
热备盘替换日志没有显示成中文</msg>
</logentry>
<logentry
   revision="43514">
<author>qifei</author>
<date>2015-06-10T07:33:27.905795Z</date>
<msg>reviewid 8868
TD 29603
改动说明：开机时/sf/bin/prenetworking.sh报找不到vs_networking_mode.sh脚本，当时还没进入RC2启动流程，环境变量未准备好。可以忽略这个错误，修改代码把错误重定向到/dev/null
测试建议：
1、启动时没有报 vs_networking_mode.sh 错误
2、验证组建、修改VS私网功能正常
3、修改VMP主机IP、网络配置后 /etc/hosts 的VS主机名正常</msg>
</logentry>
<logentry
   revision="43499">
<author>qifei</author>
<date>2015-06-10T06:36:33.173832Z</date>
<msg>reviewid 8867
更新vs</msg>
</logentry>
<logentry
   revision="43420">
<author>qifei</author>
<date>2015-06-08T10:57:45.028890Z</date>
<msg>reviewid 8926
Reviewed by: zsj
BUG ID: 无
问题分析：SSL usb限制改成15个
做了哪些测试：</msg>
</logentry>
<logentry
   revision="43419">
<author>qifei</author>
<date>2015-06-08T10:56:58.814192Z</date>
<msg>reviewid 8927
Reviewed by: zsj
BUG ID: 无
问题分析：SSL usb限制改成15个
做了哪些测试：</msg>
</logentry>
<logentry
   revision="43418">
<author>qifei</author>
<date>2015-06-08T10:55:13.500202Z</date>
<msg>reviewid 8925
Reviewed by: zsj
BUG ID: 无
问题分析：SSL usb限制改成15个。普通usb14个加上摄像头共15个
做了哪些测试：</msg>
</logentry>
<logentry
   revision="43411">
<author>qifei</author>
<date>2015-06-08T08:49:45.670787Z</date>
<msg>reviewid 8919
Reviewed by: lbc
BUG ID: 无
问题分析：合入ServerRender合并区域关闭缓存匹配方式
做了哪些测试：</msg>
</logentry>
<logentry
   revision="43407">
<author>qifei</author>
<date>2015-06-08T08:08:43.969680Z</date>
<msg>reviewid 8917
Reviewed by: zxq
BUG ID: 无
问题分析：vdc派生的虚拟机，磁盘分配方式从预分配改成动态分配
做了哪些测试：使用perl -c 检查语法，语法OK</msg>
</logentry>
<logentry
   revision="43326">
<author>qifei</author>
<date>2015-06-04T11:14:59.809561Z</date>
<msg>reviewid 8866
更新vs的前台改动</msg>
</logentry>
<logentry
   revision="43274">
<author>qifei</author>
<date>2015-06-03T15:12:14.783568Z</date>
<msg>reviewid 8774
回滚multipath，回滚磁盘序号</msg>
</logentry>
<logentry
   revision="43272">
<author>qifei</author>
<date>2015-06-03T13:45:23.544791Z</date>
<msg>reviewid 8742
回滚multipath-tools</msg>
</logentry>
<logentry
   revision="43238">
<author>qifei</author>
<date>2015-06-03T09:28:52.640640Z</date>
<msg>reviewid 8831
修改版本号+更新vdc镜像
</msg>
</logentry>
<logentry
   revision="43223">
<author>qifei</author>
<date>2015-06-03T04:08:41.906667Z</date>
<msg>reviewid 8821
修改版本号+回滚vdc虚拟机磁盘分配方式的修改</msg>
</logentry>
<logentry
   revision="43208">
<author>qifei</author>
<date>2015-06-03T01:21:22.358532Z</date>
<msg>reviewid 8817
更新vdc镜像</msg>
</logentry>
<logentry
   revision="43120">
<author>qifei</author>
<date>2015-06-02T03:04:49.869760Z</date>
<msg>reviewid 8677
回滚代码，去掉给ssl的usb改动</msg>
</logentry>
<logentry
   revision="43071">
<author>qifei</author>
<date>2015-06-01T09:15:04.170120Z</date>
<msg>reviewid 8669
修改版本号</msg>
</logentry>
<logentry
   revision="43048">
<author>qifei</author>
<date>2015-06-01T06:44:40.219479Z</date>
<msg>reviewid 8648
补上漏掉的文件</msg>
</logentry>
<logentry
   revision="43037">
<author>qifei</author>
<date>2015-06-01T03:05:13.937614Z</date>
<msg>Revision: 42752
Author: lixing
Date: 2015年5月28日 15:43:31
Message:
reviewid 8647
revert this change
Merged revision(s) 36888 from VTP/VMP3.5/Trunk:
reviewed by : lixing
BUG ID : 26380
问题分析: 将multipath-tools更新到最新的v0.5.0版本，并附带-g调试信息，方便排查后面的出core问题。
改动说明：将multipath-tools更新到最新的v0.5.0版本。
........

----
Modified : /VTP/VMP3.5/Trunk/build/pkg/replace-root/etc/multipath.conf
Modified : /VTP/VMP3.5/Trunk/source/lib/libmultipath/Makefile
Modified : /VTP/VMP3.5/Trunk/source/lib/libmultipath/bin/lib/libmultipath.so.0
Added : /VTP/VMP3.5/Trunk/source/lib/libmultipath/bin/libmultipath.so.0 (Copy from path: /VTP/VMP3.5/Trunk/source/lib/libmultipath/bin/libmultipath.so.0, Revision, 36887)
Deleted : /VTP/VMP3.5/Trunk/source/lib/libmultipath/bin/sbin
Modified : /VTP/VMP3.5/Trunk/source/lib/libmultipath/multipath-tools-5.0/libmultipath/blacklist.c
Modified : /VTP/VMP3.5/Trunk/source/lib/libmultipath/multipath-tools-5.0/libmultipath/defaults.h
Modified : /VTP/VMP3.5/Trunk/source/lib/libmultipath/multipath-tools-5.0/libmultipath/hwtable.c
Deleted : /VTP/VMP3.5/Trunk/source/lib/libmultipath/read.txt
Added : /VTP/VMP3.5/Trunk/source/lib/libmultipath/src (Copy from path: /VTP/VMP3.5/Trunk/source/lib/libmultipath/src, Revision, 36887)

</msg>
</logentry>
<logentry
   revision="42868">
<author>qifei</author>
<date>2015-05-29T08:07:37.462884Z</date>
<msg>Revision: 42773
Author: qifei
Date: 2015年5月28日 17:47:06
Message:
Author: xiehz
Date: 2015年5月27日 15:00:23
Message:
reviewid  8603
review by:gzy
TD:  28958
现象：
TD 28958 虚拟机内部查看磁盘信息：无磁盘序列号
改动说明：
给磁盘参数加上序列号；
序列号需要保证唯一，采用vmid + 磁盘编号组合方式
测试：
使用工具，在虚拟机内部查看硬件信息，磁盘序列号有值，且是vmid-磁盘编号形式
----
Modified : /VTP/VMP3.4R2/Trunk/source/app/vtp-qemu-server/VTP/QemuServer.pm

</msg>
</logentry>
<logentry
   revision="42866">
<author>qifei</author>
<date>2015-05-29T07:52:58.306167Z</date>
<msg>reviewid 8601
vdc派生的虚拟机，磁盘分配方式从预分配改成动态分配</msg>
</logentry>
<logentry
   revision="42856">
<author>qifei</author>
<date>2015-05-29T06:31:29.847241Z</date>
<msg>reviewid 8562
Author: dinghui
Date: 2015年5月19日 9:27:07
Message:
增加cache优先级算法，图像越大优先级越高，在LRU基础上优先淘汰低优先级缓存，防止大块缓存被冲掉，导致重传时的明显延迟</msg>
</logentry>
<logentry
   revision="42769">
<author>qifei</author>
<date>2015-05-28T09:23:23.403496Z</date>
<msg>reviewid 8537
解决默认ip问题</msg>
</logentry>
<logentry
   revision="42767">
<author>qifei</author>
<date>2015-05-28T09:17:25.673961Z</date>
<msg>reviewid 8536
修改网口交换判断条件，判断vs一体机型号为vds-1300</msg>
</logentry>
<logentry
   revision="42762">
<author>qifei</author>
<date>2015-05-28T09:06:56.923713Z</date>
<msg>reviewid 8377
修改ssl的usb端口数问题</msg>
</logentry>
<logentry
   revision="42574">
<author>qifei</author>
<date>2015-05-26T07:42:37.580498Z</date>
<msg>reviewid 8372
ssl解决PC端接入桌面会断线问题
</msg>
</logentry>
<logentry
   revision="42541">
<author>qifei</author>
<date>2015-05-26T02:52:50.942158Z</date>
<msg>reviewid 8399
ssl需求，能添加15个usb</msg>
</logentry>
<logentry
   revision="42458">
<author>qifei</author>
<date>2015-05-25T07:27:44.947774Z</date>
<msg>reviewid 8342
修改版本号+修改usb2.0设备支持正常使用15台</msg>
</logentry>
<logentry
   revision="42442">
<author>qifei</author>
<date>2015-05-25T03:38:51.327618Z</date>
<msg>从r2拷贝代码</msg>
</logentry>
<logentry
   revision="42425">
<author>qifei</author>
<date>2015-05-25T01:17:45.403947Z</date>
<msg>reviewid 8216
现在VDC镜像是VDI42.qcow2 更换其他版本镜像会创建VDC失败 暂时使用软连接解决</msg>
</logentry>
<logentry
   revision="42288">
<author>qifei</author>
<date>2015-05-22T09:27:10.282678Z</date>
<msg>谷智勇修改，爱屋及乌问题</msg>
</logentry>
<logentry
   revision="42261">
<author>zyj</author>
<date>2015-05-22T06:33:14.935218Z</date>
<msg>reviewid 8215
BUG ID no
Reviewed by: lifan
问题分析：魔数检查的功能回滚到qemu的原生代码
改动说明：
和李凡讨论，魔数检查的功能只用在服务器版本，3.4R2回滚到原生代码。
测试：
编译通过</msg>
</logentry>
<logentry
   revision="42228">
<author>qifei</author>
<date>2015-05-22T01:10:19.423221Z</date>
<msg>更新</msg>
</logentry>
<logentry
   revision="42173">
<author>qifei</author>
<date>2015-05-21T03:50:46.372732Z</date>
<msg>reviewid 8156
tar包更新</msg>
</logentry>
<logentry
   revision="42075">
<author>qifei</author>
<date>2015-05-20T01:20:02.701603Z</date>
<msg>reviewid 8043
问题说明 raidstat 这个命令把 /run/shm 被占满了，导致异常了
问题分析
VTP::Tools::run_command('raidstat', timeout =&gt; 3, outfunc =&gt; $parse);
perl5/VTP/Alert/DoAlert.pm 调用raidstat，3秒超时就kill了，导致没删除。
实际有的raid卡3秒执行不完命令。
修改为运行前先删掉可能遗漏的旧临时文件，由于可能存在并发运行，不能全删，保留最新10个。</msg>
</logentry>
<logentry
   revision="42043">
<author>qifei</author>
<date>2015-05-19T12:11:52.286328Z</date>
<msg>reviewid 8039
合入中天瑞和补丁</msg>
</logentry>
<logentry
   revision="42032">
<author>qifei</author>
<date>2015-05-19T11:13:21.138011Z</date>
<msg>reviewid 8033
合入中天瑞和补丁，更改版本号</msg>
</logentry>
<logentry
   revision="41994">
<author>qifei</author>
<date>2015-05-19T06:49:40.557273Z</date>
<msg>reviewid 8013
更新tar包</msg>
</logentry>
<logentry
   revision="41991">
<author>qifei</author>
<date>2015-05-19T06:36:05.045845Z</date>
<msg>noreivew
使用vdi4.3镜像</msg>
</logentry>
<logentry
   revision="41983">
<author>qifei</author>
<date>2015-05-19T03:33:36.824876Z</date>
<msg>去掉bate标记</msg>
</logentry>
<logentry
   revision="41974">
<author>qifei</author>
<date>2015-05-19T02:40:09.950855Z</date>
<msg>更新ssl库</msg>
</logentry>
<logentry
   revision="41888">
<author>qifei</author>
<date>2015-05-18T07:14:28.764372Z</date>
<msg>更新</msg>
</logentry>
<logentry
   revision="41886">
<author>qifei</author>
<date>2015-05-18T06:32:42.127072Z</date>
<msg>reviewid 7945
更新vs的tar包
</msg>
</logentry>
<logentry
   revision="41872">
<author>qifei</author>
<date>2015-05-18T02:44:41.921618Z</date>
<msg>reviewid 7936
从r1更新spice</msg>
</logentry>
<logentry
   revision="41688">
<author>fxw</author>
<date>2015-05-14T12:41:46.424619Z</date>
<msg>reviewid 7831
review by: lifan
TD: null
现象：
修复CVE-2015-3456
改动说明：
合入社区patch
测试：
无

</msg>
</logentry>
<logentry
   revision="41677">
<author>qifei</author>
<date>2015-05-14T11:25:58.894787Z</date>
<msg>reviewid 7820
更新</msg>
</logentry>
<logentry
   revision="41567">
<author>qifei</author>
<date>2015-05-13T10:32:12.991558Z</date>
<msg>reviewid 7731 
更新</msg>
</logentry>
<logentry
   revision="41561">
<author>qifei</author>
<date>2015-05-13T09:51:29.355459Z</date>
<msg>reviewid 7730
eth0始终有默认ip，去掉其他网口的默认ip,回滚代码</msg>
</logentry>
<logentry
   revision="41556">
<author>qifei</author>
<date>2015-05-13T09:42:47.654714Z</date>
<msg>reviewid 7727
eth0始终有默认ip，去掉其他网口的默认ip</msg>
</logentry>
<logentry
   revision="41543">
<author>qifei</author>
<date>2015-05-13T06:48:06.550527Z</date>
<msg>更新</msg>
</logentry>
<logentry
   revision="41531">
<author>qifei</author>
<date>2015-05-13T02:10:26.020621Z</date>
<msg>版本号加Bate标记</msg>
</logentry>
<logentry
   revision="41529">
<author>qifei</author>
<date>2015-05-13T02:09:03.225981Z</date>
<msg>noreview
支持bate版本号</msg>
</logentry>
<logentry
   revision="41490">
<author>qifei</author>
<date>2015-05-12T09:52:35.569238Z</date>
<msg>reviewid 7676
更新tar包</msg>
</logentry>
<logentry
   revision="41480">
<author>qifei</author>
<date>2015-05-12T08:25:32.436149Z</date>
<msg>reviewid 7662
给没签名的文件签名</msg>
</logentry>
<logentry
   revision="41478">
<author>qifei</author>
<date>2015-05-12T08:12:05.235892Z</date>
<msg>reviewid 7659
替换掉有毒文件</msg>
</logentry>
<logentry
   revision="41439">
<author>qifei</author>
<date>2015-05-11T11:41:20.609270Z</date>
<msg>reviewid 7634
替换掉有毒文件</msg>
</logentry>
<logentry
   revision="41428">
<author>qifei</author>
<date>2015-05-11T08:32:25.778594Z</date>
<msg>reviewid 7603
替换有病毒的文件</msg>
</logentry>
<logentry
   revision="41421">
<author>qifei</author>
<date>2015-05-11T06:56:57.354838Z</date>
<msg>更新</msg>
</logentry>
<logentry
   revision="41419">
<author>qifei</author>
<date>2015-05-11T06:42:43.434683Z</date>
<msg>noreview
新增支持版本号3.3.00</msg>
</logentry>
<logentry
   revision="41418">
<author>qifei</author>
<date>2015-05-11T06:37:18.851747Z</date>
<msg>reviewid 7591
解决“wait_for_vs_ready”不存在的错误。</msg>
</logentry>
<logentry
   revision="41405">
<author>qifei</author>
<date>2015-05-11T02:56:25.150200Z</date>
<msg>reviewid 7589</msg>
</logentry>
<logentry
   revision="41402">
<author>qifei</author>
<date>2015-05-11T02:09:20.449725Z</date>
<msg>reviewid 7605
存储告警服务，判断是vs存储就不提示</msg>
</logentry>
<logentry
   revision="41374">
<author>qifei</author>
<date>2015-05-10T11:56:50.259073Z</date>
<msg>reviewid 7585
TD29564</msg>
</logentry>
<logentry
   revision="41328">
<author>qifei</author>
<date>2015-05-09T01:56:08.962490Z</date>
<msg>更新</msg>
</logentry>
<logentry
   revision="41304">
<author>zyj</author>
<date>2015-05-08T11:11:12.814219Z</date>
<msg>reviewid 7523
BUG ID no
Reviewed by: qifei
问题分析：魔数检查暂时先注释掉
改动说明：
魔数检查暂时先注释掉
测试：
编译通过，测试通过</msg>
</logentry>
<logentry
   revision="41302">
<author>qifei</author>
<date>2015-05-08T10:09:04.847329Z</date>
<msg>reviewid 7521</msg>
</logentry>
<logentry
   revision="41301">
<author>qifei</author>
<date>2015-05-08T10:06:24.849501Z</date>
<msg>reviewid 7518
更新tar包</msg>
</logentry>
<logentry
   revision="41299">
<author>qifei</author>
<date>2015-05-08T09:49:51.764313Z</date>
<msg>reviewid 7515
修改判断已存在vdc</msg>
</logentry>
<logentry
   revision="41298">
<author>qifei</author>
<date>2015-05-08T09:49:02.488969Z</date>
<msg>reviewid 7494
给eth0添加默认ip</msg>
</logentry>
<logentry
   revision="41293">
<author>qifei</author>
<date>2015-05-08T09:31:59.460840Z</date>
<msg>noreview
扩容之后不应该再自动弹新建VDC窗口（集群中已经有VDC了）</msg>
</logentry>
<logentry
   revision="41291">
<author>qifei</author>
<date>2015-05-08T09:26:59.501510Z</date>
<msg>noreview
修改版本号
</msg>
</logentry>
<logentry
   revision="41280">
<author>qifei</author>
<date>2015-05-08T08:38:46.467010Z</date>
<msg>reviewid 7502
增加判断存储为vs存储时，判断此vs存储是否挂载</msg>
</logentry>
<logentry
   revision="41274">
<author>qifei</author>
<date>2015-05-08T07:52:04.138152Z</date>
<msg>noreview
改动描述：组建集群手动添加新主机修改</msg>
</logentry>
<logentry
   revision="41253">
<author>qifei</author>
<date>2015-05-08T02:17:41.843351Z</date>
<msg>更新</msg>
</logentry>
<logentry
   revision="41252">
<author>qifei</author>
<date>2015-05-08T02:14:41.040809Z</date>
<msg>更新</msg>
</logentry>
<logentry
   revision="41250">
<author>qifei</author>
<date>2015-05-08T02:10:47.691938Z</date>
<msg>更新</msg>
</logentry>
<logentry
   revision="41249">
<author>qifei</author>
<date>2015-05-08T02:09:24.863015Z</date>
<msg>更新</msg>
</logentry>
<logentry
   revision="41222">
<author>zyj</author>
<date>2015-05-07T11:13:10.413805Z</date>
<msg>reviewid 7446
BUG ID 28357
Reviewed by: qifei
问题分析：qcow2镜像损坏问题的预防修改，去掉虚拟机运行后的所有fork()调用。。
改动说明：
1.popen调用了fork导致所有内存变只读，此时如果有写内存操作, 容易导致页不对齐的内存分裂
block-cache保存连续扇区信息的函数不再调用popen
2.那个序列号定时检查会调用popen()的问题，找zxq确认过，这个代码是之前xujinchang加的，对qemu运行没有任何作用，仅仅是检测到序列号so库异常时打印日志，所以准备把这个定时检查去掉，避免虚拟机运行后仍然有fork()调用。
测试：
编译通过，测试通过</msg>
</logentry>
<logentry
   revision="41213">
<author>qifei</author>
<date>2015-05-07T09:06:38.333059Z</date>
<msg>reviewid 7443

</msg>
</logentry>
<logentry
   revision="41208">
<author>qifei</author>
<date>2015-05-07T08:48:17.720810Z</date>
<msg>reviewid 7441
sshpass的时候传的密码里多了个sangfornetwork</msg>
</logentry>
<logentry
   revision="41199">
<author>qifei</author>
<date>2015-05-07T07:16:57.969233Z</date>
<msg>Revision: 38016
Author: xiehz
Date: 2015年3月11日 15:24:54
Message:
reviewid 7429
review by: gzy
TD: 27328
现象：
虚拟机名称有特殊字符，无法新建磁盘
改动说明：
把路径加上 ""
以前的方法没办法处理空格
测试：
编译通过，自测通过


Modified : /VTP/VMP3.5/Trunk/source/app/vtp-prealloc/vtp-prealloc.c</msg>
</logentry>
<logentry
   revision="41198">
<author>qifei</author>
<date>2015-05-07T07:11:52.918456Z</date>
<msg>reviewid 7421
[VMP]主控离线，页面无法显示主机的名称或IP</msg>
</logentry>
<logentry
   revision="41171">
<author>qifei</author>
<date>2015-05-07T01:12:36.788695Z</date>
<msg>reviewid 7413
更新tar包</msg>
</logentry>
<logentry
   revision="41170">
<author>qifei</author>
<date>2015-05-07T01:02:32.312392Z</date>
<msg>reviewid 7407
修改内存不足导致开机失败时的提示</msg>
</logentry>
<logentry
   revision="41166">
<author>qifei</author>
<date>2015-05-06T11:25:08.110081Z</date>
<msg>reviewid 7404
当等待后台服务重启或网络问题导致的请求失败，修改提示为“网络错误，请尝试刷新页面后重试”</msg>
</logentry>
<logentry
   revision="41144">
<author>qifei</author>
<date>2015-05-06T07:56:56.861605Z</date>
<msg>reviewid 7376
合入VS改动：【单主机扩容】 集群添加主机时可以把 单主机集群添加进来</msg>
</logentry>
<logentry
   revision="41124">
<author>qifei</author>
<date>2015-05-06T02:26:52.386762Z</date>
<msg>更新spice库</msg>
</logentry>
<logentry
   revision="41123">
<author>qifei</author>
<date>2015-05-06T02:26:03.966196Z</date>
<msg>合入ssl改动</msg>
</logentry>
<logentry
   revision="41121">
<author>qifei</author>
<date>2015-05-06T02:04:31.095658Z</date>
<msg>更新tar包</msg>
</logentry>
<logentry
   revision="41072">
<author>qifei</author>
<date>2015-05-05T06:42:17.173611Z</date>
<msg>VStar包更新</msg>
</logentry>
<logentry
   revision="41071">
<author>qifei</author>
<date>2015-05-05T06:39:19.198329Z</date>
<msg>修改版本号</msg>
</logentry>
<logentry
   revision="41070">
<author>qifei</author>
<date>2015-05-05T06:31:53.190657Z</date>
<msg>修改版本号</msg>
</logentry>
<logentry
   revision="41067">
<author>qifei</author>
<date>2015-05-05T03:46:38.854066Z</date>
<msg>修改点：
	1）存储网络配置页面的后台返回的网口列表新增一个is_vdc属性，如果网口被配置为VDC通信口的话is_vdc=1,否则is_vdc=0
		页面判断is_vdc=1的话就不能配置为存储通信口
	2)
		VMP的网络高级配置页面判断网口是存储通信网口就不能被配置为VDC通信口
测试点：回归bug 29484</msg>
</logentry>
<logentry
   revision="41065">
<author>qifei</author>
<date>2015-05-05T03:38:39.760959Z</date>
<msg>更新vs</msg>
</logentry>
<logentry
   revision="41062">
<author>qifei</author>
<date>2015-05-05T03:06:16.617300Z</date>
<msg>ssl更新</msg>
</logentry>
<logentry
   revision="41059">
<author>qifei</author>
<date>2015-05-05T02:56:08.790417Z</date>
<msg>reviewid: 7327
reviewd by: lsh
改动说明：1、组建集群显示主机列表时，不要一次滚动一排，如果主机节点显示不全，点击时滚动到可视区域</msg>
</logentry>
<logentry
   revision="41042">
<author>qifei</author>
<date>2015-05-05T01:03:40.509868Z</date>
<msg>复制R1代码</msg>
</logentry>
<logentry
   revision="40935">
<author>qifei</author>
<date>2015-04-30T06:45:03.123092Z</date>
<msg>更新</msg>
</logentry>
<logentry
   revision="40931">
<author>qifei</author>
<date>2015-04-30T05:33:21.253147Z</date>
<msg>更新</msg>
</logentry>
<logentry
   revision="40922">
<author>qifei</author>
<date>2015-04-30T02:53:53.338987Z</date>
<msg>更新</msg>
</logentry>
<logentry
   revision="40880">
<author>qifei</author>
<date>2015-04-29T11:49:49.116591Z</date>
<msg>vs序列号无效导致启动vm失败，但是前台报错镜像文件不存在</msg>
</logentry>
<logentry
   revision="40878">
<author>qifei</author>
<date>2015-04-29T11:49:03.902360Z</date>
<msg>TD28348
vs序列号无效导致启动vm失败，但是前台报错镜像文件不存在</msg>
</logentry>
<logentry
   revision="40862">
<author>qifei</author>
<date>2015-04-29T08:18:12.294441Z</date>
<msg>修改版本号
</msg>
</logentry>
<logentry
   revision="40850">
<author>qifei</author>
<date>2015-04-29T07:17:02.003097Z</date>
<msg>修改版本号为3.4.10_R1</msg>
</logentry>
<logentry
   revision="40848">
<author>qifei</author>
<date>2015-04-29T07:12:53.627950Z</date>
<msg>更新版本号</msg>
</logentry>
<logentry
   revision="40847">
<author>qifei</author>
<date>2015-04-29T07:10:39.599334Z</date>
<msg>更新spice库</msg>
</logentry>
<logentry
   revision="40846">
<author>qifei</author>
<date>2015-04-29T06:46:55.743494Z</date>
<msg>ssl改动</msg>
</logentry>
<logentry
   revision="40824">
<author>qifei</author>
<date>2015-04-29T01:54:36.064782Z</date>
<msg>新增支持版本号</msg>
</logentry>
<logentry
   revision="40822">
<author>qifei</author>
<date>2015-04-29T01:53:37.659827Z</date>
<msg>修改版本号</msg>
</logentry>
<logentry
   revision="40821">
<author>qifei</author>
<date>2015-04-29T01:52:50.745424Z</date>
<msg>增加3.4.01_R1升级</msg>
</logentry>
<logentry
   revision="40808">
<author>qifei</author>
<date>2015-04-28T12:37:40.923261Z</date>
<msg>reviewid 7228
review by: lifan
TD: no
现象：
从vmp3.5中合入TD:28255/28247/28213修改的代码
改动说明：
1.将laio和paio的内存地址对齐，从512字节改为4096，暂时规避由于地址没有页对齐，而导致的数据漏读问题。
2.合入qemu2.2中的对元数据的地址簇对齐检查，方便后面调试分析。
3.合入qemu2.2的一些异常检查。
4.virtio-blk合并问题。
5.flush/discard操作加入bs-&gt;tracked_requests跟踪.
测试：
编译通过
</msg>
</logentry>
<logentry
   revision="40807">
<author>qifei</author>
<date>2015-04-28T11:07:02.217791Z</date>
<msg>用于修正第一批五舟1U设备的盘序显示问题。</msg>
</logentry>
<logentry
   revision="40799">
<author>qifei</author>
<date>2015-04-28T08:24:30.925844Z</date>
<msg>处理vs发货设备问题，当cpu型号为E3-1230且包含网卡型号为82579LM时，将eth0和eth1交换</msg>
</logentry>
<logentry
   revision="40665">
<author>qifei</author>
<date>2015-04-24T10:06:19.962480Z</date>
<msg>TD: 27875
现象：
TD 27875 启动虚拟机，提示启动成功，但实际上未启动
改动说明：
1.普通虚拟机，启动失败，但有pid时，会误报成功
2.集群虚拟机，启动失败，但有pid时，会误报成功，有可能遇到日志也不输出，虚拟机围起来（集群vm第二次拉起时判断到已经是running）
</msg>
</logentry>
<logentry
   revision="40638">
<author>qifei</author>
<date>2015-04-24T04:13:24.178819Z</date>
<msg>修改版本号为R1版本</msg>
</logentry>
<logentry
   revision="40592">
<author>qifei</author>
<date>2015-04-23T10:31:12.654519Z</date>
<msg>去掉之前的改动</msg>
</logentry>
<logentry
   revision="40591">
<author>qifei</author>
<date>2015-04-23T10:28:05.306292Z</date>
<msg>Author: xiehz
Date: 2015年4月22日 14:33:56
Message:
reviewid  7098
review by: gzy
TD: 28227
现象：
TD 28227 模板更新时卡住
改动说明：
判断是否要创建目录，都应该到指定的节点上去执行
</msg>
</logentry>
<logentry
   revision="40587">
<author>qifei</author>
<date>2015-04-23T09:06:18.065134Z</date>
<msg>修改小内存机情况下，前台显示的剩余内存为可分配内存</msg>
</logentry>
<logentry
   revision="40586">
<author>qifei</author>
<date>2015-04-23T09:06:01.595137Z</date>
<msg>修改小内存机情况下，前台显示的剩余内存为可分配内存</msg>
</logentry>
<logentry
   revision="40474">
<author>qifei</author>
<date>2015-04-21T06:37:36.440827Z</date>
<msg>bug ID: TD28229
问题分析: 一体机环境中，创建虚拟机，如果操作系统 由VDC切换为其他的系统，则需要去掉 VDC写死的磁盘文件</msg>
</logentry>
<logentry
   revision="40458">
<author>qifei</author>
<date>2015-04-21T04:10:08.894026Z</date>
<msg>修改错别字</msg>
</logentry>
<logentry
   revision="40420">
<author>qifei</author>
<date>2015-04-20T11:44:10.213624Z</date>
<msg>更新ssl代码
</msg>
</logentry>
<logentry
   revision="40400">
<author>qifei</author>
<date>2015-04-20T08:48:21.473777Z</date>
<msg>问题分析：更新vmp3.4改动
</msg>
</logentry>
<logentry
   revision="40395">
<author>qifei</author>
<date>2015-04-20T08:23:33.860095Z</date>
<msg>更新ssl代码
</msg>
</logentry>
<logentry
   revision="40346">
<author>qifei</author>
<date>2015-04-20T01:17:08.950239Z</date>
<msg>更新ssl代码
通过与客户端的协商，完成是否开启广域网优化，开启之后在原流程的基础上加入了有损压缩和文字识别
</msg>
</logentry>
<logentry
   revision="40223">
<author>qifei</author>
<date>2015-04-16T09:40:08.479223Z</date>
<msg>问题分析：更新vmp3.4改动
</msg>
</logentry>
<logentry
   revision="40222">
<author>qifei</author>
<date>2015-04-16T09:26:47.277656Z</date>
<msg>问题分析：更新vmp3.4改动
</msg>
</logentry>
<logentry
   revision="40219">
<author>qifei</author>
<date>2015-04-16T08:54:17.034796Z</date>
<msg>问题分析：更新vmp3.4改动
</msg>
</logentry>
<logentry
   revision="39906">
<author>qifei</author>
<date>2015-04-11T01:23:06.623975Z</date>
<msg>no review
bug id: 
问题分析：更新
改动说明：更新</msg>
</logentry>
<logentry
   revision="39894">
<author>qifei</author>
<date>2015-04-10T10:05:07.141894Z</date>
<msg>no review
bug id: 
问题分析：更新
改动说明：更新</msg>
</logentry>
<logentry
   revision="39882">
<author>qifei</author>
<date>2015-04-10T07:15:30.721646Z</date>
<msg>no review
bug id: 
问题分析：更新
改动说明：更新</msg>
</logentry>
<logentry
   revision="39841">
<author>qifei</author>
<date>2015-04-09T09:59:10.112852Z</date>
<msg>no review
bug id: 
问题分析：spice库更新
改动说明：spice库更新</msg>
</logentry>
<logentry
   revision="39840">
<author>qifei</author>
<date>2015-04-09T09:38:38.392774Z</date>
<msg>no review
bug id: 
问题分析：修改加密功能
改动说明：修改加密功能</msg>
</logentry>
<logentry
   revision="39838">
<author>qifei</author>
<date>2015-04-09T09:31:29.252062Z</date>
<msg>no review
bug id: 
问题分析：spice库更新
改动说明：spice库更新</msg>
</logentry>
<logentry
   revision="39744">
<author>qifei</author>
<date>2015-04-07T09:48:09.271745Z</date>
<msg>no review
bug id: 
问题分析：合入VDI4.3改动
改动说明：合入VDI4.3改动
视频流功能优化，让视频流支持可变大小帧的功能，以解决视频流播放不稳定的问题</msg>
</logentry>
<logentry
   revision="39738">
<author>qifei</author>
<date>2015-04-07T08:45:23.742739Z</date>
<msg>no review
bug id: 
问题分析：合入VDI4.3改动
改动说明：合入VDI4.3改动</msg>
</logentry>
<logentry
   revision="39724">
<author>whf</author>
<date>2015-04-07T06:24:03.602024Z</date>
<msg>从 VMP3.4拷贝代码 svn39716</msg>
</logentry>
<logentry
   revision="39716">
<author>hhx</author>
<date>2015-04-07T02:11:08.798013Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="39634">
<author>hyq</author>
<date>2015-04-03T06:50:21.036544Z</date>
<msg>reviewid: 6753
reviewd by: wzt
bug id: 27834
改动说明：
解决问题td27834：修复因vs改动 导致的iscsi磁盘扩容丢失</msg>
</logentry>
<logentry
   revision="39613">
<author>hyq</author>
<date>2015-04-03T02:10:29.248231Z</date>
<msg>reviewid: 6753
reviewd by: wzt
bug id: 27839
改动说明：
解决问题:fix bug27839:VMP3.4安全漏洞扫描，发现admin,admin明文可以登录
之前回滚过一次，现在重新加上
自测没问题</msg>
</logentry>
<logentry
   revision="39597">
<author>hhx</author>
<date>2015-04-02T13:50:58.424113Z</date>
<msg>newreviewid:6589,by gzy
解决问题:fix bug27839:VMP3.4安全漏洞扫描，发现admin,admin明文可以登录
做了那些测试:通过页面调用https://200.200.76.158/vapi/json/public_key获取到了公钥
</msg>
</logentry>
<logentry
   revision="39595">
<author>hhx</author>
<date>2015-04-02T13:43:07.839612Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="39587">
<author>hyq</author>
<date>2015-04-02T10:58:34.474504Z</date>
<msg>reviewid: 6753
reviewd by: hhx
bug id: 27904
改动说明：
修复bug27904：重置虚拟机电源失败，提示信息不友好；原因：1、脚本编码有问题，2、用的die 抛异常会带出异常所在行数信息
自测没问题</msg>
</logentry>
<logentry
   revision="39528">
<author>hhx</author>
<date>2015-04-01T10:27:47.677212Z</date>
<msg>noreview:合入vs的最新tar文件，解决在一体机的环境下修改主控的管理口IP导致所有从节点离线的问题</msg>
</logentry>
<logentry
   revision="39519">
<author>hhx</author>
<date>2015-04-01T09:29:51.175653Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="39508">
<author>hhx</author>
<date>2015-04-01T08:13:07.246725Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="39475">
<author>hhx</author>
<date>2015-04-01T00:56:53.702155Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="39456">
<author>hhx</author>
<date>2015-03-31T09:35:38.699888Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="39434">
<author>hhx</author>
<date>2015-03-31T04:02:49.049771Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="39433">
<author>hhx</author>
<date>2015-03-31T03:58:31.264633Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="39432">
<author>hhx</author>
<date>2015-03-31T03:58:00.038490Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="39431">
<author>hhx</author>
<date>2015-03-31T03:57:17.242447Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="39426">
<author>rhx</author>
<date>2015-03-31T03:13:42.295873Z</date>
<msg>添加正式发布</msg>
</logentry>
<logentry
   revision="39422">
<author>hhx</author>
<date>2015-03-31T02:12:40.143663Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="39421">
<author>hhx</author>
<date>2015-03-31T02:12:10.174694Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="39420">
<author>hhx</author>
<date>2015-03-31T02:05:20.773417Z</date>
<msg>noreview:回滚代码
解决问题:回滚bug27839所做的修改：
做了那些测试:/etc/init.d/vtpdaemon restart;/etc/init.d/apache2 restart; ok</msg>
</logentry>
<logentry
   revision="39417">
<author>hhx</author>
<date>2015-03-31T01:28:57.950896Z</date>
<msg>newreviewid:6490,by lsh
解决问题:fix bug27822:[等30号新包]3.4组件集群，出现告警主机，点击取消，此时没有添加成功任何主机，也进入下一步配置集群ip
做了那些测试:代码审查发现的问题
</msg>
</logentry>
<logentry
   revision="39398">
<author>hhx</author>
<date>2015-03-30T13:07:03.111176Z</date>
<msg>noreivew:合入vs最后一个tar包</msg>
</logentry>
<logentry
   revision="39395">
<author>hhx</author>
<date>2015-03-30T12:53:22.326760Z</date>
<msg>newreviewid:6474,by wzt,gzy
解决问题:fix bug29442:[代码审查]新增主机配置网络时需要支持不关闭虚拟机
做了那些测试:lrx和yinxin联调通过
</msg>
</logentry>
<logentry
   revision="39394">
<author>hhx</author>
<date>2015-03-30T12:51:30.191885Z</date>
<msg>newreviewid:6473,by lsh
解决问题:fix bug29442:[代码审查]新增主机配置网络时需要支持不关闭虚拟机
做了那些测试:lrx和yinxin联调通过
</msg>
</logentry>
<logentry
   revision="39393">
<author>hhx</author>
<date>2015-03-30T12:35:54.713919Z</date>
<msg>newreviewid:6472,by gzy,wzt,zxq
解决问题:fix bug29440:在一体机的环境下，单台主机最多只能同时启动13个虚拟机
做了那些测试:perl -c ok; /etc/init.d/vtpdaemon restart;/etc/init.d/apache2 restart
</msg>
</logentry>
<logentry
   revision="39391">
<author>hhx</author>
<date>2015-03-30T12:18:41.184945Z</date>
<msg>newreviewid:6468,by lsh
解决问题:fix bug27830:告警邮件设置保存配置后，未刷新数据。详情见附件
做了那些测试:lrx自测通过
</msg>
</logentry>
<logentry
   revision="39389">
<author>hhx</author>
<date>2015-03-30T12:00:49.095991Z</date>
<msg>newreviewid:6462,by hhx
解决问题:fix bug27840:【安全漏洞扫描】要关掉smb服务
做了那些测试:直接关掉服务
</msg>
</logentry>
<logentry
   revision="39383">
<author>hhx</author>
<date>2015-03-30T10:06:37.698935Z</date>
<msg>newreviewid:6461,by hhx
解决问题:fix bug27839:VMP3.4安全漏洞扫描，发现admin,admin明文可以登录
做了那些测试:vtpsh create access/ticket -username 'admin' -password 'admin'报错“密码解密失败”
</msg>
</logentry>
<logentry
   revision="39364">
<author>hhx</author>
<date>2015-03-30T06:27:13.388913Z</date>
<msg>newreviewid:6437,by hhx
解决问题:fix bug27812:multipathd出core(合入vmp3.5改动：出现内存重复释放，访问失效内存等问题)
做了那些测试:
</msg>
</logentry>
<logentry
   revision="39360">
<author>hhx</author>
<date>2015-03-30T04:59:07.646866Z</date>
<msg>noreivew:6435,by lsh
解决问题:fix bug27822:3.4组件集群，出现告警主机，点击取消，此时没有添加成功任何主机，也进入下一步配置集群ip
做了那些测试:lrx已经自测通过
</msg>
</logentry>
<logentry
   revision="39357">
<author>hhx</author>
<date>2015-03-30T04:34:17.655660Z</date>
<msg>newreviewid:6429,by hhx
解决问题:合入VMP3.5的bug27577:【qemu2.2升级】批量挂起恢复，虚拟机恢复失败--Error -22 while loading VM state。
改bug还没有fix，审核代码ok,且已经上库到了VMP3.5的svn
做了那些测试:perl -c ok
</msg>
</logentry>
<logentry
   revision="39343">
<author>hhx</author>
<date>2015-03-30T02:01:12.577690Z</date>
<msg>newreviewid:6422,by hhx
解决问题:fix 27561:没有添加头文件：use::plog 导致挂载本地磁盘失败后前台不是提示：挂载本地磁盘失败！请检查本地磁盘是否正常工作。而是提示：Undefined subroutine &amp;VTP::Storage::DirPlugin::linfo called at /usr/share/perl5/VTP/Storage/DirPlugin.pm line 66, line 48.
做了那些测试:perl -c ok
</msg>
</logentry>
<logentry
   revision="39342">
<author>hhx</author>
<date>2015-03-29T11:41:32.890221Z</date>
<msg>newreviewid:6420,by wzt
解决问题:fix bug27810:perl代码审查,发现了之前03restart.pl这个脚本有错误
做了那些测试:perl -c ok
</msg>
</logentry>
<logentry
   revision="39341">
<author>hhx</author>
<date>2015-03-29T11:07:04.407955Z</date>
<msg>newreviewid:6419,by hhx
解决问题:fix bug27086:代理的返回值问题
做了那些测试:perl -c ok
</msg>
</logentry>
<logentry
   revision="39340">
<author>hhx</author>
<date>2015-03-29T10:46:45.119535Z</date>
<msg>noreveiw:合入vs最新的tar包</msg>
</logentry>
<logentry
   revision="39339">
<author>hhx</author>
<date>2015-03-29T10:38:47.291239Z</date>
<msg>noreview: 上库vs的perl代码，改文件独立，fix29418:[vs1.0]3主机扩容到4主机，未保存网络配置，导致添加主机失败,yixin自测通过</msg>
</logentry>
<logentry
   revision="39338">
<author>hhx</author>
<date>2015-03-29T10:29:13.858292Z</date>
<msg>noreview:fix bug27085:[登录]输入正确用户名和密码登录失败，提示密码解密失败</msg>
</logentry>
<logentry
   revision="39337">
<author>hhx</author>
<date>2015-03-29T09:52:54.685957Z</date>
<msg>noreivew:lsh没有加班，lrx自测没有问题，代码先上库打包，
fix bug29418:[vs1.0]3主机扩容到4主机，未保存网络配置，和lzj确认添加主机成功，但是添加磁盘扩容失败</msg>
</logentry>
<logentry
   revision="39336">
<author>hhx</author>
<date>2015-03-29T03:47:55.835092Z</date>
<msg>newreviewid:6415,by wzt
解决问题:fix bug29424:新建VDC和根据向导建VDC配置不一致
做了那些测试:perl -c ok
</msg>
</logentry>
<logentry
   revision="39301">
<author>hhx</author>
<date>2015-03-28T09:15:55.190471Z</date>
<msg>newreviewid:6391,by lsh
解决问题:fix bug27782:[集群]实体机页面添加主机按钮灰掉不可用
做了那些测试:lrx测试通过
</msg>
</logentry>
<logentry
   revision="39294">
<author>hhx</author>
<date>2015-03-28T07:56:35.021214Z</date>
<msg>newreviewid:6387,by lsh
解决问题:fix bug29416:[验收BVT][UI] IOPS 统计页面频繁切换时容易导致最近1h页面显示最近10min的数据曲线，显示出错
做了那些测试:lrx测试通过
</msg>
</logentry>
<logentry
   revision="39278">
<author>hhx</author>
<date>2015-03-28T06:11:48.215644Z</date>
<msg>newreviewid:6374,by gzy,zxq,wzt
解决问题:fix bug27782:启动虚拟机，后台有必要的输出
做了那些测试:自测了启动虚拟机、关闭虚拟机均有没有提示：
flag_dir
host-000bab52fc78
host-fcaa14022be8
nfsdir_inode.id
task_request.id
flag_dir
host-000bab52fc78
host-fcaa14022be8
nfsdir_inode.id
task_request.id</msg>
</logentry>
<logentry
   revision="39266">
<author>hhx</author>
<date>2015-03-27T13:41:25.162529Z</date>
<msg>noreview:给代码加权限</msg>
</logentry>
<logentry
   revision="39265">
<author>hhx</author>
<date>2015-03-27T13:21:23.360456Z</date>
<msg>noreivew:合入vs的代码今天晚上最后一次打包</msg>
</logentry>
<logentry
   revision="39258">
<author>hhx</author>
<date>2015-03-27T12:31:19.701949Z</date>
<msg>newreviewid:6356,by gzy,wzt,hyq
解决问题:fix bug27134:【公司环境】一台虚拟机未执行自动备份策略 ---代码已经上库了;之前代码中有点问题，导致只是备份了之后一个策略
做了那些测试:测试了多个策略备份，均没有问题</msg>
</logentry>
<logentry
   revision="39249">
<author>ljb</author>
<date>2015-03-27T10:52:25.714411Z</date>
<msg>reviewid 6350
Reviewed by: wuyy
BUG ID: 27744
问题分析：合入window报表服务bug vmp3.5 version from 38814
改动说明：合入window报表服务bug
做了哪些测试: 正常获取虚拟机数据</msg>
</logentry>
<logentry
   revision="39244">
<author>zyj</author>
<date>2015-03-27T09:58:10.441192Z</date>
<msg>reviewid 6345
review by: hhx
TD: 29218
现象：
TD:29218,派生虚拟机有个别失败，提示“无法新建镜像文件
改动说明：
qemu-img close时，没解锁，一般文件系统没啥问题，close时锁就解掉了。但是gluster 在close是异步的，应用close返回后，gluster可能还在解锁和release描述符，如果此时应用再
来一次flock，上次的锁还没来得及解，于是就报错Resource temporarily unavailable。
测试：
编译通过
yinwei(尹巍) 17:20:39
验证完了，没啥问题
换之前必出，现在一切OK</msg>
</logentry>
<logentry
   revision="39243">
<author>hyq</author>
<date>2015-03-27T09:47:52.429808Z</date>
<msg>reviewid: 6325
reviewd by: zxq
bug id: 无
改动说明：
1、添加了对VsSn.pm的入口
2、原来无该文件，用于签名工具可以获取主机相关信息，上传签名信息
测试建议：无</msg>
</logentry>
<logentry
   revision="39242">
<author>zxq</author>
<date>2015-03-27T09:42:48.534973Z</date>
<msg>reviewid 6340
Reviewed by: hhx
BUG ID: 29412
问题分析: 快速新建VDC，进度一直卡在0
做了哪些测试： 自测ok</msg>
</logentry>
<logentry
   revision="39237">
<author>hyq</author>
<date>2015-03-27T09:04:10.411191Z</date>
<msg>reviewid: 6325
reviewd by: zxq
bug id: 29316,29413
改动说明：
VS更新：1、新增存储序列号及授权信息的获取和保存逻辑；td29316（author yinxin）测试建议：回归这个bug，测试存储序列号页面功能是否正常
2、修改点：改为判断是否是有运行在虚拟存储上的虚拟机  有的话不允许配置私网；  测试点:回归此bug即可
</msg>
</logentry>
<logentry
   revision="39236">
<author>lifan</author>
<date>2015-03-27T08:59:26.211430Z</date>
<msg>noreview
Reviewed by: lixing
BUG ID: 27713
问题分析：出现内存重复释放，访问失效内存等问题。 
改动说明：合入VMP3.5 revision 39137
做了哪些测试: 已实际验证过。</msg>
</logentry>
<logentry
   revision="39222">
<author>qifei</author>
<date>2015-03-27T07:12:42.016318Z</date>
<msg>no review
bug id: 
问题分析：VStar包更新
改动说明：VStar包更新</msg>
</logentry>
<logentry
   revision="39218">
<author>jcy</author>
<date>2015-03-27T06:47:59.087552Z</date>
<msg>noreview
改动说明：fix bug29404:编辑正常的VDC虚拟机,会报错.错误信息:请配置VDC的访问IP
VDC配置IP：只有添加时需要配置IP。</msg>
</logentry>
<logentry
   revision="39217">
<author>zyj</author>
<date>2015-03-27T06:43:18.682685Z</date>
<msg>reviewid 6321
review by: fxw
TD: 29406
现象：
非sffs文件系统，在创建镜像后，置0流程存在问题。
改动说明：
勇哥的意见是先把vtp_prealloc中的实际功能关掉。
测试：
编译通过</msg>
</logentry>
<logentry
   revision="39212">
<author>hyq</author>
<date>2015-03-27T06:23:04.731288Z</date>
<msg>reviewid: 6320
reviewd by: hhx
bug id: 29261
改动说明：
合入VS代码改动：密码加密处理，说明：以前密码没加密，现在前台传过来的是加密过的密码，校验密码要解密在判断密码是否正确；
测试建议：密码里面包含；查看能够初始化成功 td29261（author yzs）</msg>
</logentry>
<logentry
   revision="39211">
<author>zxq</author>
<date>2015-03-27T06:10:48.289636Z</date>
<msg>reviewid 6322
Reviewed by: hhx
BUG ID: 27660
问题分析: 共享存储部分主机不可访问时，新建、派生集群虚拟机有可能失败
做了哪些测试： 自测ok</msg>
</logentry>
<logentry
   revision="39205">
<author>lrx</author>
<date>2015-03-27T03:16:02.714664Z</date>
<msg>noreview
改动说明：1、初始化vs加入密码加密</msg>
</logentry>
<logentry
   revision="39203">
<author>hyq</author>
<date>2015-03-27T03:01:41.324181Z</date>
<msg>reviewid: 6283
reviewd by: hhx
bug id: 29358
改动说明：
加了替换磁盘时不允许再次替换的判断,修复bug 29358</msg>
</logentry>
<logentry
   revision="39194">
<author>ljb</author>
<date>2015-03-27T01:50:56.979645Z</date>
<msg>reviewid 6305
Reviewed by: hhx
BUG ID: 
问题分析：合入samba-CVE-2015-0240漏洞和弱密码上报功能
改动说明：合入samba-CVE-2015-0240漏洞和弱密码上报功能
做了哪些测试: 使用perl -c检查语法，bash -n 检查语法，语法都OK</msg>
</logentry>
<logentry
   revision="39182">
<author>lrx</author>
<date>2015-03-26T13:02:25.217641Z</date>
<msg>noreview
改动说明：1、单位修改，2、按下去的图，刷新不显示</msg>
</logentry>
<logentry
   revision="39178">
<author>qifei</author>
<date>2015-03-26T12:53:02.625529Z</date>
<msg>no review
bug id: 
问题分析：VStar包更新
改动说明：VStar包更新</msg>
</logentry>
<logentry
   revision="39174">
<author>rhx</author>
<date>2015-03-26T12:38:27.616288Z</date>
<msg>update</msg>
</logentry>
<logentry
   revision="39173">
<author>rhx</author>
<date>2015-03-26T12:29:10.305363Z</date>
<msg>update</msg>
</logentry>
<logentry
   revision="39171">
<author>hhx</author>
<date>2015-03-26T12:25:22.968398Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="39170">
<author>zyj</author>
<date>2015-03-26T12:09:03.470957Z</date>
<msg>reviewid 6295
review by: hhx
TD: 36806
现象：
ssl上次合入的qemu uhci代码还存在一点问题，需再改一下
改动说明：
ssl上次合入的qemu uhci代码还存在一点问题，需再改一下
测试：
编译通过</msg>
</logentry>
<logentry
   revision="39168">
<author>qifei</author>
<date>2015-03-26T11:49:34.550744Z</date>
<msg>no review
bug id: 
问题分析：更新
改动说明：更新</msg>
</logentry>
<logentry
   revision="39167">
<author>qifei</author>
<date>2015-03-26T11:44:57.937258Z</date>
<msg>no review
bug id: 
问题分析：更新
改动说明：更新</msg>
</logentry>
<logentry
   revision="39163">
<author>hhx</author>
<date>2015-03-26T11:23:22.485650Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="39162">
<author>hhx</author>
<date>2015-03-26T11:21:21.605639Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="39161">
<author>qifei</author>
<date>2015-03-26T11:09:33.488292Z</date>
<msg>no review
bug id: 
问题分析：VStar包更新
改动说明：VStar包更新</msg>
</logentry>
<logentry
   revision="39160">
<author>hhx</author>
<date>2015-03-26T11:00:33.018407Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="39158">
<author>hyq</author>
<date>2015-03-26T10:15:41.926485Z</date>
<msg>reviewid: 6283
reviewd by: hhx
bug id: no
改动说明：
1、替换ssl vdi镜像文件。2、当qemu异常退出后，检查VS序列号是否有效，如果无效就提示到前台。 据qifei说，3.4没有合入qemu退出码，而4.0有合入退出码。因此不能通过增加qemu退出码判断，否则未来会出现冲突</msg>
</logentry>
<logentry
   revision="39138">
<author>hyq</author>
<date>2015-03-26T07:46:45.160661Z</date>
<msg>reviewid: 6272
reviewd by: hhx
bug id: 29374;28101;29335;29363;29348
改动说明：
1. 修改私网ip是否同网段的判断 2.my_die的时候需要删除临时文件 3.不是分布式卷时不能设置平衡 4.td28101 29335 29363 替换主机时需要支持不关闭虚拟机 5.td29139，改成用vs_update_disk_info.sh更新disk.info文件 6.td29348 删掉失败返回，让页面有错误提示;td 29391 修改: 获取不到离线主机的ip信息或者是获取不到被替换出去的主机的ip信息都忽略掉这台主机 不再报错(yinxin,wangzheng)</msg>
</logentry>
<logentry
   revision="39130">
<author>lbc</author>
<date>2015-03-26T06:56:03.886104Z</date>
<msg>reviewid 6267
review by: hhx
TD 29315。
1u的设备boot 目录才有5g 大小，用户升级vmp，两次以上就会找出空间不够。页面没有清理功能。</msg>
</logentry>
<logentry
   revision="39125">
<author>qifei</author>
<date>2015-03-26T06:30:42.521629Z</date>
<msg>no review
bug id: 
问题分析：VStar包更新
改动说明：VStar包更新</msg>
</logentry>
<logentry
   revision="39124">
<author>hyq</author>
<date>2015-03-26T06:27:52.390445Z</date>
<msg>reviewid: 6249
reviewd by: hhx
bug id: 29378
改动说明：
改成用vs_update_disk_info.sh更新disk.info文件，修复虚拟存储在本地存储位置显示出来的bug。2、删除临时文件</msg>
</logentry>
<logentry
   revision="39123">
<author>hhx</author>
<date>2015-03-26T05:41:37.022376Z</date>
<msg>newreviewid:6263,by gzy,wzt,hyq
解决问题:fix bug29235:VT问题，主控断电关机，主控运行的虚拟机不能迁移到其他的主机上运行（问题必现）done
做了那些测试:perl -c ok,vs的ygh已经确认了，测试通过</msg>
</logentry>
<logentry
   revision="39119">
<author>hyq</author>
<date>2015-03-26T03:47:16.232455Z</date>
<msg>reviewid: 6257
reviewd by: hhx
bug id: 29360
改动说明：
1、修改告警信息，如果是虚拟存储容量超过阈值，不打印存储属于哪个主机。2、Cluster.pm 去掉英文的 my_die 输出.3、删除虚拟机后，不再检查目录是否已删除并报错到前台。即即使VS后台无法删除虚拟机实体文件，前台也能删除虚拟机的列表；会有垃圾文件存在。1.0暂时先支持，以后再做垃圾回收支持</msg>
</logentry>
<logentry
   revision="39116">
<author>qifei</author>
<date>2015-03-26T03:36:20.799459Z</date>
<msg>reviewid 6258
reviewed by :hhx
bug id: 
问题分析：Hosts.pm精简日志
改动说明：注释掉多余的日志
做了哪些测试：代码编译通过，基本功能规范</msg>
</logentry>
<logentry
   revision="39112">
<author>zyj</author>
<date>2015-03-26T03:04:37.547838Z</date>
<msg>reviewid 6254
Reviewed by: hhx
BUG ID: no
问题分析：
vmp3.3与vmp3.4并行开发，vmp3.3后面的部分修改，没有同步合入到vmp3.4

改动说明：
vmp3.3与vmp3.4并行开发，vmp3.3后面的部分修改，没有同步合入到vmp3.4
测试：
对比合入。</msg>
</logentry>
<logentry
   revision="39108">
<author>qifei</author>
<date>2015-03-26T02:37:50.799851Z</date>
<msg>no review
bug id: 
问题分析：VStar包更新
改动说明：VStar包更新</msg>
</logentry>
<logentry
   revision="39099">
<author>hhx</author>
<date>2015-03-26T01:00:54.978621Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="39097">
<author>qifei</author>
<date>2015-03-25T13:51:42.185204Z</date>
<msg>no review
bug id: 
问题分析：VStar包更新
改动说明：VStar包更新</msg>
</logentry>
<logentry
   revision="39096">
<author>hhx</author>
<date>2015-03-25T12:51:58.816605Z</date>
<msg>newreviewid:6246,by wzt
解决问题:fix bug29135:VDC连接控制台要进入web界面
做了那些测试:/etc/init.d/vtpdaemon restart;/etc/init.d/apache2 restart</msg>
</logentry>
<logentry
   revision="39095">
<author>lrx</author>
<date>2015-03-25T12:39:22.200904Z</date>
<msg>noreview
改动说明：1、sslvpn虚拟机不允许进入控制台</msg>
</logentry>
<logentry
   revision="39089">
<author>hhx</author>
<date>2015-03-25T11:36:56.194951Z</date>
<msg>newreviewid:6242,by lifan
解决问题:fix bug29135:VDC连接控制台要进入web界面
做了那些测试:编译通过了，且/cfs/.vmlist中有了ostype字段</msg>
</logentry>
<logentry
   revision="39079">
<author>lrx</author>
<date>2015-03-25T09:50:47.777896Z</date>
<msg>noreview
改动说明：1、倒换vs初始化和配置网络按钮位置</msg>
</logentry>
<logentry
   revision="39076">
<author>hhx</author>
<date>2015-03-25T09:38:28.371273Z</date>
<msg>newreviewid:6236,by gzy
解决问题:发现了相对3.3少合入的代码，现在合入到VMP3.4
做了那些测试:这个需要windows手动编译，合入不合入影响不大，ship
</msg>
</logentry>
<logentry
   revision="39074">
<author>hyq</author>
<date>2015-03-25T09:33:32.649357Z</date>
<msg>reviewid: 6221
reviewd by: hhx
bug id: no
改动说明：
1、排除小图标上其他磁盘错误告警的影响。
2、添加对一些函数的异常捕获(zdg提交的代码)
3、更新VDI42.qcow2 镜像
        </msg>
</logentry>
<logentry
   revision="39072">
<author>qifei</author>
<date>2015-03-25T09:31:46.423715Z</date>
<msg>no review
bug id: 
问题分析：VStar包更新
改动说明：VStar包更新</msg>
</logentry>
<logentry
   revision="39071">
<author>hhx</author>
<date>2015-03-25T09:22:11.834991Z</date>
<msg>newreviewid:6235,by czy
解决问题:发现了相对3.3少合入的代码，现在合入到VMP3.4
做了那些测试:这个需要windows手动编译，合入不合入影响不大，ship
</msg>
</logentry>
<logentry
   revision="39065">
<author>qifei</author>
<date>2015-03-25T08:39:28.612684Z</date>
<msg>no review
bug id: 
问题分析：VStar包更新
改动说明：VStar包更新</msg>
</logentry>
<logentry
   revision="39062">
<author>zyj</author>
<date>2015-03-25T08:32:11.719660Z</date>
<msg>reviewid 4802
reviewed by: lifan
BUG ID:      [NULL]

问题分析：
1. virtio-blk: fix reference a pointer which might be freed
In function virtio_blk_handle_request, it may freed memory pointed by req,
So do not access member of req after calling this function.

2. migration: Add missing 'static' attribute

改动说明：
backport commit 1bdb176ac5add5dc9d54a230da7511b66851f1e7
http://git.qemu.org/?p=qemu.git;a=commit;h=1bdb176ac5add5dc9d54a230da7511b66851f1e7
virtio_blk_handle_request(req, &amp;mrb);函数中对req有可能释放,然后按原有流程,
在virtio_blk_dma_restart_bh中会对释放了的req再次引用(req-&gt;next)从而导致出core

backport commit 7a46d042e02e87157c13424df56dd06e9da77e89
http://git.qemu.org/?p=qemu.git;a=commit;h=7a46d042e02e87157c13424df56dd06e9da77e89
</msg>
</logentry>
<logentry
   revision="39051">
<author>zyj</author>
<date>2015-03-25T07:40:23.007942Z</date>
<msg>reviewid 6222
Reviewed by: lifan
BUG ID: no
问题分析：
qmp命令中多加入一点调试信息，用于查看协程排队情况

改动说明：
qmp命令中多加入一点调试信息，用于查看协程排队情况
测试：
编译通过，测试通过。</msg>
</logentry>
<logentry
   revision="39048">
<author>hhx</author>
<date>2015-03-25T07:03:33.234238Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="39046">
<author>zyj</author>
<date>2015-03-25T06:47:07.715808Z</date>
<msg>reviewid 6214
Reviewed by: lifan
BUG ID: 27589
问题分析：
1.此问题，在不进行热迁移，仅仅在发送qmp stop和qmp cont后，就会发生；
2.迁移后，在虚拟机恢复运行后，vhost_net的第一个vhost_signal通知qemu， qemu没有接收到这个信号，结果没有调用 virtio_queue_guest_notifier_read
来更新AVAIL_EVENT_IDX，导致后面的收包处理中，在vring_need_event函数中判断得出不需要再触发时间来给虚拟机注入中断；

改动说明：
此处，在qemu的vhost_net_start中，补充注入一个中断来解决问题，经验证有效。
测试：已验证通过。</msg>
</logentry>
<logentry
   revision="39041">
<author>lifan</author>
<date>2015-03-25T04:10:23.877579Z</date>
<msg>noreview
BUG ID:27695
问题分析：解决multipathd服务第一次崩溃时无法保存core的问题。
改动说明：修改/etc/init.d/multipath-tools，设置ulimit -c</msg>
</logentry>
<logentry
   revision="39030">
<author>qifei</author>
<date>2015-03-25T03:28:50.194424Z</date>
<msg>no review
bug id: 
问题分析：VStar包更新
改动说明：VStar包更新</msg>
</logentry>
<logentry
   revision="39021">
<author>zyj</author>
<date>2015-03-25T02:41:53.377126Z</date>
<msg>reviewid 6199
review by: hhx
TD: no
现象：
上次合入的qemu uhci代码还存在一点问题，需再改一下(合入ssl修改)
改动说明：
上次合入的qemu uhci代码还存在一点问题，需再改一下(合入ssl修改)
测试：
编译通过</msg>
</logentry>
<logentry
   revision="39004">
<author>hhx</author>
<date>2015-03-24T13:42:15.666475Z</date>
<msg>newreviewid:6192,by hyq
解决问题:发现了相对3.3少合入的代码，现在合入到VMP3.4
做了那些测试:</msg>
</logentry>
<logentry
   revision="39001">
<author>hhx</author>
<date>2015-03-24T13:17:02.108647Z</date>
<msg>newreviewid:6190,by gzy,wzt
解决问题:fix bug27671:vs的所有shell脚本执行前需要判断虚拟存储是否初始化
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="39000">
<author>qifei</author>
<date>2015-03-24T13:04:59.448917Z</date>
<msg>no review
bug id: 
问题分析：VStar包更新
改动说明：VStar包更新</msg>
</logentry>
<logentry
   revision="38998">
<author>hyq</author>
<date>2015-03-24T12:54:55.206018Z</date>
<msg>reviewid: 6174
reviewd by: hhx
bug id: 29303;29360
改动说明：
1、去掉回滚单点登录漏掉的一个字段use_vmch。
2、VsStatus.pm 修改点：td 29303 主机命中率时间显示错误修改。
3、修复bug：虚拟存储空间满了，提示本地存储空间不够
        
        </msg>
</logentry>
<logentry
   revision="38983">
<author>qifei</author>
<date>2015-03-24T11:38:56.912911Z</date>
<msg>no review
bug id: 
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38942">
<author>zxq</author>
<date>2015-03-24T06:11:56.233794Z</date>
<msg>reviewid 6137
Reviewed by: hhx
BUG ID: null
问题分析: 快速新建VDC，支持cpuid参数
做了哪些测试： 联调ok</msg>
</logentry>
<logentry
   revision="38938">
<author>qifei</author>
<date>2015-03-24T03:59:03.772652Z</date>
<msg>no review
bug id: 
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38937">
<author>hyq</author>
<date>2015-03-24T03:57:05.892491Z</date>
<msg>reviewid: 6089
reviewd by: hhx
bug id: 6142
改动说明：1、Time range cannot be the same: "执行的起止时间不能相等"。
2、 判断虚拟磁盘是否存在和转换path前先判断是否为一体机。
3、 虚拟机开机直接引导，不进入bios menu。
4、 添加 vs 磁盘警告选项 修改更新模板界面提示 td26935 。5、合入VS Vsconfig.pm 改动 
6、把版本号改为3.4.00_B td27651

        
        </msg>
</logentry>
<logentry
   revision="38932">
<author>hhx</author>
<date>2015-03-24T03:24:15.799641Z</date>
<msg>noreview:上次上库代码，忘记了将文件名以数字开头，现在改一下文件的名称，遵循以数字开头的原则</msg>
</logentry>
<logentry
   revision="38931">
<author>hhx</author>
<date>2015-03-24T03:22:26.475310Z</date>
<msg>newreviewid:6139,by gzy,wzt
解决问题:fix bug29235:主控断电关机，主控运行的虚拟机不能迁移到其他的主机上运行（问题必现）don
做了那些测试:自测了主控上的nfs服务挂掉后，集群虚拟机能够正常启动</msg>
</logentry>
<logentry
   revision="38927">
<author>lrx</author>
<date>2015-03-24T02:57:11.908759Z</date>
<msg>noreview
改动说明：1、添加完主机，只有一体机，才会显示添加过程，vmp原处理流程不变</msg>
</logentry>
<logentry
   revision="38925">
<author>jcy</author>
<date>2015-03-24T02:46:38.949123Z</date>
<msg>noreview
改动说明：
1，添加虚拟机-vdc：增加配置IP。
2，虚拟存储初始化：加上Ip等网络参数。</msg>
</logentry>
<logentry
   revision="38923">
<author>hhx</author>
<date>2015-03-24T02:14:54.892073Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="38922">
<author>hhx</author>
<date>2015-03-24T02:14:21.957198Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="38920">
<author>hhx</author>
<date>2015-03-24T02:07:53.078156Z</date>
<msg>newreviewid:6130,by gzy,wzt
解决问题:fix bug29235:主控断电关机，主控运行的虚拟机不能迁移到其他的主机上运行（问题必现）don
做了那些测试:自测了主控上的nfs服务挂掉后，集群虚拟机能够正常启动</msg>
</logentry>
<logentry
   revision="38919">
<author>hhx</author>
<date>2015-03-24T02:07:04.887629Z</date>
<msg>newreviewid:6132,by gzy,wzt
解决问题:fix bug29235:主控断电关机，主控运行的虚拟机不能迁移到其他的主机上运行（问题必现）don
做了那些测试:自测了主控上的nfs服务挂掉后，集群虚拟机能够正常启动</msg>
</logentry>
<logentry
   revision="38914">
<author>lifan</author>
<date>2015-03-24T01:44:39.684525Z</date>
<msg>reviewid 6124
Reviewed by: zyj
BUG ID：     TD 27625
问题分析：【备份超时】公司环境升级后，导致虚拟机启动失败
改动说明：虚拟机启动时最多只预加载两个自动快照的元数据
测试：已实际验证过</msg>
</logentry>
<logentry
   revision="38912">
<author>hhx</author>
<date>2015-03-24T01:05:48.431753Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="38910">
<author>qifei</author>
<date>2015-03-24T01:00:12.241587Z</date>
<msg>no review
bug id: 
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38903">
<author>hhx</author>
<date>2015-03-23T13:21:05.639954Z</date>
<msg>newreviewid:6115,by gzy,wzt
解决问题:fix bug29135:[外部体验] VDC的IP要进WEBUI去修改 done
做了那些测试:perl -c ok
</msg>
</logentry>
<logentry
   revision="38883">
<author>hyq</author>
<date>2015-03-23T10:57:52.012749Z</date>
<msg>reviewid: 6089
reviewd by: hhx
bug id: 29198
改动说明：主机离线后添加主机的提示信息缺少离线主机的IP地址【与VT关联】done

        
        </msg>
</logentry>
<logentry
   revision="38882">
<author>lrx</author>
<date>2015-03-23T09:59:53.375362Z</date>
<msg>noreview
改动说明：1、vs序列号不检查合法性</msg>
</logentry>
<logentry
   revision="38880">
<author>lrx</author>
<date>2015-03-23T09:49:27.908724Z</date>
<msg>noreview
改动说明：1、图表加单位</msg>
</logentry>
<logentry
   revision="38878">
<author>hyq</author>
<date>2015-03-23T09:34:37.231154Z</date>
<msg>reviewid: 6107
reviewd by: hhx
bug id: 
改动说明：派生虚拟机，在ssl使用情况下，如果是一体机磁盘分配方式改为精简分配，非一体机磁盘分配方式为动态分配

        
        </msg>
</logentry>
<logentry
   revision="38872">
<author>qifei</author>
<date>2015-03-23T08:43:52.772125Z</date>
<msg>no review
bug id: 
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38865">
<author>lrx</author>
<date>2015-03-23T07:56:53.368413Z</date>
<msg>noreview
改动说明：1、所有默认精简分配的地方，只对一体机生效</msg>
</logentry>
<logentry
   revision="38857">
<author>hhx</author>
<date>2015-03-23T06:45:35.732407Z</date>
<msg>newreviewid:6094,by lifan
解决问题:fix 27134:【公司环境】一台虚拟机未执行自动备份策略 ---代码已经上库了
做了那些测试:perl -c ok
</msg>
</logentry>
<logentry
   revision="38843">
<author>qifei</author>
<date>2015-03-23T03:03:12.755690Z</date>
<msg>no review
bug id: 
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38842">
<author>lrx</author>
<date>2015-03-23T02:49:49.343527Z</date>
<msg>noreview
改动说明：1、动态显示脚部年份，最小2015</msg>
</logentry>
<logentry
   revision="38841">
<author>lrx</author>
<date>2015-03-23T02:49:12.404291Z</date>
<msg>noreview
改动说明：1、一体机批量编辑vm默认精简分配</msg>
</logentry>
<logentry
   revision="38840">
<author>lrx</author>
<date>2015-03-23T02:32:15.572334Z</date>
<msg>noreview
改动说明：1、新版替换主机</msg>
</logentry>
<logentry
   revision="38839">
<author>zyj</author>
<date>2015-03-23T02:27:59.165120Z</date>
<msg>reviewid 6066
review by: lifan
TD: 29253/29273
现象：
虚拟机中跑磁盘测试工具，内存耗尽，导致宕机的问题，作了内存超限修改
改动说明：
限制inflight cache个数，从而限制cache内存超限。
测试：
编译通过</msg>
</logentry>
<logentry
   revision="38837">
<author>hhx</author>
<date>2015-03-23T02:07:56.085808Z</date>
<msg>newreviewid:6083,by lifan
解决问题:fix bug27618:要支持从VMP3.3.01升级到VMp3.4
做了那些测试:perl -c ok
</msg>
</logentry>
<logentry
   revision="38832">
<author>qifei</author>
<date>2015-03-23T00:59:51.891100Z</date>
<msg>no review
bug id: 
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38828">
<author>lrx</author>
<date>2015-03-22T04:15:45.926604Z</date>
<msg>noreview
改动说明：1、图表下标统一为虚拟机详情样式</msg>
</logentry>
<logentry
   revision="38827">
<author>lrx</author>
<date>2015-03-22T03:42:55.387506Z</date>
<msg>noreview
改动说明：1、新版替换磁盘</msg>
</logentry>
<logentry
   revision="38818">
<author>zxq</author>
<date>2015-03-21T11:00:13.104756Z</date>
<msg>reviewid 6077
Reviewed by: lifan
BUG ID: null
问题分析: VDC虚拟机可以通过CPUID查询IP信息
做了哪些测试： 与SSL联调ok</msg>
</logentry>
<logentry
   revision="38817">
<author>hhx</author>
<date>2015-03-21T10:53:58.081483Z</date>
<msg>newreviewid:6076,by lifan
解决问题:fix bug29135:[外部体验] VDC的IP要进WEBUI去修改 done
做了那些测试:perl -c ok
</msg>
</logentry>
<logentry
   revision="38813">
<author>hhx</author>
<date>2015-03-21T10:23:53.573888Z</date>
<msg>newreviewid:6073,by lifan
解决问题:合入vs的smartctl文件
做了那些测试:二进制文件无法测试
perl -c ok
</msg>
</logentry>
<logentry
   revision="38811">
<author>lrx</author>
<date>2015-03-21T10:18:45.358756Z</date>
<msg>noreview
改动说明：1、去掉几处热备盘</msg>
</logentry>
<logentry
   revision="38809">
<author>lrx</author>
<date>2015-03-21T10:14:52.244206Z</date>
<msg>noreview
改动说明：1、序列号</msg>
</logentry>
<logentry
   revision="38805">
<author>lrx</author>
<date>2015-03-21T10:05:47.626953Z</date>
<msg>noreview
改动说明：1、VMP访问参数改成集群ip</msg>
</logentry>
<logentry
   revision="38803">
<author>lrx</author>
<date>2015-03-21T10:03:19.185655Z</date>
<msg>noreview
改动说明：1、恢复出厂设置输入密码</msg>
</logentry>
<logentry
   revision="38796">
<author>hyq</author>
<date>2015-03-21T08:50:28.632183Z</date>
<msg>reviewid: 6064
reviewd by: hhx
bug id: 29067
改动说明：1、改小图标上无法显示详细告警信息的bug

        
        </msg>
</logentry>
<logentry
   revision="38795">
<author>hhx</author>
<date>2015-03-21T08:40:34.899672Z</date>
<msg>newreviewid:6060,by lifan
解决问题:合入vs的smartctl文件
做了那些测试:二进制文件无法测试
perl -c ok
</msg>
</logentry>
<logentry
   revision="38789">
<author>hhx</author>
<date>2015-03-21T08:14:43.676636Z</date>
<msg>noreview:合入vs的tar文件</msg>
</logentry>
<logentry
   revision="38788">
<author>hyq</author>
<date>2015-03-21T08:14:04.076167Z</date>
<msg>reviewid: 6052
reviewd by: hhx
bug id: 29232
改动说明：修复bug：[vs1.0]跑断网操作后host_proxy进程出core done。
回滚单点登录合入：回滚修改的文件
虚拟机反向代理暂时不合入，回滚
        </msg>
</logentry>
<logentry
   revision="38786">
<author>lbc</author>
<date>2015-03-21T07:57:48.077288Z</date>
<msg>reviewid 6051
review by: hhx
TD 29315。
判断若是vs一体机的升级，则解压到内存目录。</msg>
</logentry>
<logentry
   revision="38783">
<author>lbc</author>
<date>2015-03-21T07:52:41.328147Z</date>
<msg>reviewid 6051
review by: hhx
TD 29315。
判断若是vs一体机的升级，则解压到内存目录。</msg>
</logentry>
<logentry
   revision="38771">
<author>hyq</author>
<date>2015-03-21T06:55:00.147054Z</date>
<msg>reviewid: 6046
reviewd by: hhx
bug id: 29232
改动说明：修复bug：[vs1.0]跑断网操作后host_proxy进程出core done。
回滚单点登录合入：回滚修改的文件
虚拟机反向代理暂时不合入，回滚
        </msg>
</logentry>
<logentry
   revision="38752">
<author>qifei</author>
<date>2015-03-21T03:30:24.171081Z</date>
<msg>no review
bug id: 
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38751">
<author>qifei</author>
<date>2015-03-21T03:28:21.209607Z</date>
<msg>no review
bug id: 
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38750">
<author>qifei</author>
<date>2015-03-21T03:28:13.712140Z</date>
<msg>no review
bug id: 
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38749">
<author>lrx</author>
<date>2015-03-21T03:28:04.638948Z</date>
<msg>noreview
改动说明：1、设置主机通信口禁用vs的私网口</msg>
</logentry>
<logentry
   revision="38746">
<author>qifei</author>
<date>2015-03-21T03:10:38.189004Z</date>
<msg>no review
bug id: 
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38745">
<author>hyq</author>
<date>2015-03-21T03:06:19.237329Z</date>
<msg>reviewid: 6039
reviewd by: hhx
bug id: no
改动说明：替换主机过程显示添加主机和删除主机操作日志
        
        </msg>
</logentry>
<logentry
   revision="38744">
<author>hyq</author>
<date>2015-03-21T02:55:43.980292Z</date>
<msg>reviewid: 6037
reviewd by: hhx
bug id: no
改动说明：改动磁盘坏道告警的中文描述信息
        
        </msg>
</logentry>
<logentry
   revision="38742">
<author>lrx</author>
<date>2015-03-21T02:35:01.381958Z</date>
<msg>noreview
改动说明：1、数据平衡取消，2、数据重建可以关闭</msg>
</logentry>
<logentry
   revision="38739">
<author>lrx</author>
<date>2015-03-21T02:20:57.218347Z</date>
<msg>noreview
改动说明：1、获取磁盘物理块大小失败，不能向下进行</msg>
</logentry>
<logentry
   revision="38733">
<author>hyq</author>
<date>2015-03-20T12:25:16.334265Z</date>
<msg>reviewid: 6029
reviewd by: hhx
bug id: no
改动说明：如果是一体机去掉派生虚拟机强制转换磁盘分配方式
        
        </msg>
</logentry>
<logentry
   revision="38732">
<author>hhx</author>
<date>2015-03-20T11:48:20.834435Z</date>
<msg>noreview:按照vs的要求删除掉sbin 和 lib文件，制作一个tar包，打临时包给vs验证问题，</msg>
</logentry>
<logentry
   revision="38713">
<author>zyj</author>
<date>2015-03-20T08:56:37.033645Z</date>
<msg>reviewid 6026
review by: lifan
TD: 26835
现象：
windows停在启动画面
改动说明：
kvm在做hyper-v TSC page数据清零初始化的时候，数据地址没有取对，第一字节有时候非0，guest进入混乱状态
测试：
编译通过</msg>
</logentry>
<logentry
   revision="38705">
<author>zyj</author>
<date>2015-03-20T07:49:11.169256Z</date>
<msg>reviewid 6023
review by: lifan,fxw
TD: 27213
现象：
bios开启DMA后无法使用ghost安装系统
改动说明：
guest下发的读取寄存器的size大小没有通过检测
根据手册，guest下发的size可以不是1，所以去掉检查
测试：
编译通过，替换bios.bin和qemu自测通过</msg>
</logentry>
<logentry
   revision="38701">
<author>zyj</author>
<date>2015-03-20T07:16:21.456729Z</date>
<msg>svn resivion: 38618
现象：
合入老版本 seabios的修改
改动说明：
1.改了seabios的.config，开启了DMA,用ghost安装还可以提高速度，这个修改需要和Qemu的修改一起合入，否则无法使用ghost
2.当IO不返回会一直死等
测试：
编译通过，自测通过</msg>
</logentry>
<logentry
   revision="38699">
<author>zyj</author>
<date>2015-03-20T06:35:00.647481Z</date>
<msg>现象：
上传seabios默认.config
改动说明：
上传seabios默认.config
测试：
编译通过</msg>
</logentry>
<logentry
   revision="38698">
<author>qifei</author>
<date>2015-03-20T06:23:32.139228Z</date>
<msg>no review
bug id: 
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38697">
<author>hyq</author>
<date>2015-03-20T06:03:51.978433Z</date>
<msg>reviewid: 6018
reviewd by: hhx
bug id: no
改动说明：改为判断是否是虚拟存储
        
        </msg>
</logentry>
<logentry
   revision="38678">
<author>lifan</author>
<date>2015-03-20T02:34:43.917174Z</date>
<msg>reviewid 6016
Reviewed by: hhx
BUG ID: 29282
问题分析：解决重启fw.sh脚本，会导致VS的iptables规则丢失的问题。
改动说明：1.在input.ini中加入vs的iptables规则；2.修改fw.sh支持源端口配置。
测试：已实际测试过</msg>
</logentry>
<logentry
   revision="38676">
<author>hyq</author>
<date>2015-03-20T02:16:03.953393Z</date>
<msg>reviewid: 6014
reviewd by: hhx
bug id: no
改动说明：在发送邮件项中加入vs_disk_warn项
        
        </msg>
</logentry>
<logentry
   revision="38675">
<author>jcy</author>
<date>2015-03-20T02:03:27.993333Z</date>
<msg>noreview
改动说明：
管理-虚拟机备份与恢复：选择虚拟机窗口表格分组名的data-hint错误。
</msg>
</logentry>
<logentry
   revision="38671">
<author>lbc</author>
<date>2015-03-20T01:38:19.820285Z</date>
<msg>reviewid 6015
review by: qifei
TD 29271。
修改打包编译顺序不对导致不通过的问题。</msg>
</logentry>
<logentry
   revision="38670">
<author>hyq</author>
<date>2015-03-20T01:31:33.481220Z</date>
<msg>reviewid: 5964
reviewd by: lifan,wtd
bug id: 29124
改动说明：因为发货设备磁盘是不组raid的，造成raidstat获得的磁盘state字段不是online而是System造成误判报错
        
        </msg>
</logentry>
<logentry
   revision="38669">
<author>qifei</author>
<date>2015-03-20T01:12:17.761884Z</date>
<msg>no review
bug id: 
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38667">
<author>lbc</author>
<date>2015-03-20T01:03:53.409662Z</date>
<msg>reviewid 6013
review by: hhx
TD 29271。
增加打包的adesk项。</msg>
</logentry>
<logentry
   revision="38621">
<author>qifei</author>
<date>2015-03-19T08:00:18.100496Z</date>
<msg>no review
bug id: 
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38620">
<author>qifei</author>
<date>2015-03-19T07:59:31.663774Z</date>
<msg>no review
bug id: 
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38616">
<author>lbc</author>
<date>2015-03-19T07:29:40.738311Z</date>
<msg>reviewid 5976
review by: hhx
TD 29271。
修改编译不通过的问题。</msg>
</logentry>
<logentry
   revision="38614">
<author>lbc</author>
<date>2015-03-19T07:19:59.498687Z</date>
<msg>reviewid 5976
review by: hhx
TD 29271。
修改编译不通过的问题。</msg>
</logentry>
<logentry
   revision="38612">
<author>qifei</author>
<date>2015-03-19T06:41:25.191526Z</date>
<msg>no review
bug id: 
问题分析：更新
改动说明：更新</msg>
</logentry>
<logentry
   revision="38611">
<author>qifei</author>
<date>2015-03-19T06:38:14.254807Z</date>
<msg>no review
bug id: 
问题分析：更新
改动说明：更新</msg>
</logentry>
<logentry
   revision="38609">
<author>hhx</author>
<date>2015-03-19T06:26:02.235946Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="38605">
<author>qifei</author>
<date>2015-03-19T04:00:56.516008Z</date>
<msg>no review
reviewed by :hyq
bug id: no
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38594">
<author>qifei</author>
<date>2015-03-19T02:43:58.749258Z</date>
<msg>no review
reviewed by :hyq
bug id: no
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38590">
<author>qifei</author>
<date>2015-03-19T02:24:28.996213Z</date>
<msg>no review
reviewed by :hyq
bug id: no
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38589">
<author>hyq</author>
<date>2015-03-19T02:17:41.558878Z</date>
<msg>reviewid: 5959
reviewd by: lifan
bug id: no
改动说明：走读改动发现的问题
        
        </msg>
</logentry>
<logentry
   revision="38587">
<author>lrx</author>
<date>2015-03-19T01:45:16.313759Z</date>
<msg>noreview
改动说明：1、处理主机详情页面的vs私网网口编辑功能</msg>
</logentry>
<logentry
   revision="38586">
<author>hyq</author>
<date>2015-03-19T01:32:20.457002Z</date>
<msg>reviewid: 5944
reviewd by: lifan
bug id: 29124
改动说明：因为发货设备磁盘是不组raid的，造成raidstat获得的磁盘state字段不是online而是System造成误判报错
测试建议: 使用发货2u设备(带megaraid卡，
查看页面前台是否会报raid卡磁盘异常)
        
        </msg>
</logentry>
<logentry
   revision="38580">
<author>lrx</author>
<date>2015-03-19T00:52:50.016341Z</date>
<msg>noreview
改动说明：1、非集群ip非主控ip但isMaster是1，也认为是主控</msg>
</logentry>
<logentry
   revision="38565">
<author>hyq</author>
<date>2015-03-18T09:30:28.088270Z</date>
<msg>reviewid: 5944
reviewd by: wzt
bug id: 29279
改动说明：改动引发：非一体机本地存储被过滤掉
测试建议vmp3.4非一体机版本，新建虚拟机--&gt;加载ISO镜像--&gt;浏览--&gt;页面应该显示本地存储        
        </msg>
</logentry>
<logentry
   revision="38554">
<author>zxq</author>
<date>2015-03-18T07:36:38.777891Z</date>
<msg>reviewid 5937
Reviewed by: hhx
BUG ID: null
问题分析: 快速新建VDC，将VDC强制修改为重要虚拟机
做了哪些测试： 自测ok</msg>
</logentry>
<logentry
   revision="38546">
<author>hyq</author>
<date>2015-03-18T06:51:27.320418Z</date>
<msg>reviewid: 5936
reviewd by: qifei
bug id: no
改动说明：解决重启apache2 服务器警告问题： ... waiting Warning: DocumentRoot [/boot/proxy/] does not exist---&gt;去掉调试选项
        
        </msg>
</logentry>
<logentry
   revision="38545">
<author>hyq</author>
<date>2015-03-18T06:36:24.811742Z</date>
<msg>reviewid: 5934
reviewd by: qifei
bug id: no
改动说明：合入3.3改动：1、[VDI优化合入]合入功能：ServerRender支持有损压缩模式，测试开启JPEG场景下的命令合并优化。
                       2、合入ssl对于Photoshop选框工具残影问题的修改
        
        </msg>
</logentry>
<logentry
   revision="38543">
<author>jcy</author>
<date>2015-03-18T06:20:05.109187Z</date>
<msg>noreview
改动说明：
一体机环境新建VDC时，也要设为重要虚拟机
</msg>
</logentry>
<logentry
   revision="38536">
<author>qifei</author>
<date>2015-03-18T03:57:51.803768Z</date>
<msg>no review
reviewed by :hyq
bug id: no
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38535">
<author>hyq</author>
<date>2015-03-18T03:54:18.165190Z</date>
<msg>reviewid: 5930
reviewd by: qifei,wzt
bug id: 无
改动说明：合入vs改动
        
        </msg>
</logentry>
<logentry
   revision="38534">
<author>hyq</author>
<date>2015-03-18T03:23:55.118597Z</date>
<msg>reviewid: 5929
reviewd by: qifei
bug id: 无
改动说明：合入vs改动
        
        </msg>
</logentry>
<logentry
   revision="38533">
<author>hyq</author>
<date>2015-03-18T03:11:19.062159Z</date>
<msg>reviewid: 5928
reviewd by: qifei
bug id: 无
改动说明：合入vs改动
        
        </msg>
</logentry>
<logentry
   revision="38532">
<author>hyq</author>
<date>2015-03-18T03:04:26.241697Z</date>
<msg>reviewid: 5926
reviewd by: wzt,qifei
bug id: 29265
改动说明：一体机标配内存改为2G
        
        </msg>
</logentry>
<logentry
   revision="38523">
<author>zhangqian</author>
<date>2015-03-18T02:03:50.071925Z</date>
<msg>reviewid 5888
Reviewed by: lifan
BUG ID: 27289
问题分析：
Windows server系统，开机后会让输入ctrl+alt+delete三个键，此处ctrl + alt会导致ctrl按钮没有产生 key up events，相当于ctrl一直按着，所以其它按键都失效。
改动说明：
按键按下后，也要同时处理按键up的事件。
合入VMP3.5的改动。
测试：已验证通过。</msg>
</logentry>
<logentry
   revision="38522">
<author>lifan</author>
<date>2015-03-18T02:02:43.970119Z</date>
<msg>reviewid 5912
reviewed by: hhx
问题：
处理一体机设备中存在故障硬盘会干扰正常系统盘挂载的问题。
改动说明：
1.在rcS.d的udev驱动加载之后，增加一个检测机制，要等待vmp系统盘被成功初始化后，才继续下面的流程。这样就可以避免系统分区挂载失败的情况。</msg>
</logentry>
<logentry
   revision="38511">
<author>hyq</author>
<date>2015-03-17T12:47:35.951392Z</date>
<msg>reviewid: 5899
reviewd by: wzt,qifei
bug id: 无
改动说明：修改vs版本的标志文件为/sf/cfg/vs/sf_fm_sign
        
        </msg>
</logentry>
<logentry
   revision="38510">
<author>qifei</author>
<date>2015-03-17T12:38:53.030211Z</date>
<msg>no review
reviewed by :hyq
bug id: 无
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38493">
<author>zyj</author>
<date>2015-03-17T09:48:00.694184Z</date>
<msg>reviewid 5894
review by: hhx
TD: no
现象：
合入vmp4.0中的对挂起“失败”不完善的处理。
改动说明：
合入vmp4.0中的对挂起“失败”不完善的处理。
测试：
编译通过</msg>
</logentry>
<logentry
   revision="38491">
<author>qifei</author>
<date>2015-03-17T09:41:35.991193Z</date>
<msg>reviewid 5896
reviewed by :hyq
bug id: 
问题分析：替换blackbox配置文件
改动说明：写入频率从120秒改为300秒</msg>
</logentry>
<logentry
   revision="38488">
<author>hyq</author>
<date>2015-03-17T09:36:11.237032Z</date>
<msg>reviewid: 5895
reviewd by: wzt
bug id: no
改动说明：去掉编译选项 --vs
        
        </msg>
</logentry>
<logentry
   revision="38485">
<author>hyq</author>
<date>2015-03-17T09:11:28.785119Z</date>
<msg>reviewid: 5886
reviewd by: wzt
bug id: 无
改动说明：合入vs改动
        
        </msg>
</logentry>
<logentry
   revision="38482">
<author>zxq</author>
<date>2015-03-17T08:25:47.158917Z</date>
<msg>reviewid 5884
Reviewed by: hhx
BUG ID: null
问题分析: 新建VDC修改、提供主控是否在线API
做了哪些测试： 自测ok</msg>
</logentry>
<logentry
   revision="38479">
<author>lrx</author>
<date>2015-03-17T07:31:15.775670Z</date>
<msg>noreview
改动说明：1、提示主控离线，2、主控离线也能查看页面</msg>
</logentry>
<logentry
   revision="38478">
<author>lrx</author>
<date>2015-03-17T07:29:12.183762Z</date>
<msg>noreview
改动说明：1、加入集群ip字段，2、修改muster为master</msg>
</logentry>
<logentry
   revision="38471">
<author>hhx</author>
<date>2015-03-17T06:30:47.955346Z</date>
<msg>newreviewid:5819,by gzy,wzt
解决问题:fix bug27134:【公司环境】一台虚拟机未执行自动备份策略5
做了那些测试:自测了一下基本场景，没有问题，先帮忙做代码走读
perl -c ok
</msg>
</logentry>
<logentry
   revision="38468">
<author>hhx</author>
<date>2015-03-17T05:54:46.403015Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="38461">
<author>hyq</author>
<date>2015-03-17T03:05:39.341515Z</date>
<msg>reviewid: 5875
reviewd by: qifei
bug id: 无
改动说明：合入vmp4.0 对include/sf/list.h的更改
        
        </msg>
</logentry>
<logentry
   revision="38443">
<author>hyq</author>
<date>2015-03-16T13:57:03.490560Z</date>
<msg>reviewid: 5865
reviewd by: qifei
bug id: 无
改动说明：回滚代码
        
        </msg>
</logentry>
<logentry
   revision="38442">
<author>hyq</author>
<date>2015-03-16T13:45:20.726046Z</date>
<msg>reviewid: 5863
reviewd by: qifei
bug id: 无
改动说明：回滚部分从4.0合入的代码
        
        </msg>
</logentry>
<logentry
   revision="38440">
<author>qifei</author>
<date>2015-03-16T12:40:51.327798Z</date>
<msg>reviewid 5860
reviewed by :hyq
bug id: 无
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38438">
<author>qifei</author>
<date>2015-03-16T12:17:33.825420Z</date>
<msg>reviewid 5856
reviewed by :hyq
bug id: 无
问题分析：tar转tgz以节省空间
改动说明：tar转tgz以节省空间</msg>
</logentry>
<logentry
   revision="38436">
<author>hyq</author>
<date>2015-03-16T12:09:46.144611Z</date>
<msg>reviewid: 5854
reviewd by: qifei
bug id: 29198
改动说明：修复bug：主机离线后添加主机的提示信息缺少离线主机的ip地址
        
        </msg>
</logentry>
<logentry
   revision="38435">
<author>zyj</author>
<date>2015-03-16T12:05:49.861968Z</date>
<msg>reviewid 5846
review by: lifan
TD: no
现象：
合入李凡对qemu的快照相关操作进行的优化。
改动说明：
1.虚拟机启动时对所有的快照元数据进行预加载，将快照阶段的耗时前移到虚拟机启动时。
2.增加cache查找表，并改为hash查找算法。
3.对cache entry内存进行动态分配，并且在删除快照时，对已失效的cache entry进行释放。
测试：
编译通过</msg>
</logentry>
<logentry
   revision="38432">
<author>hyq</author>
<date>2015-03-16T11:53:52.261158Z</date>
<msg>reviewid: 5842
reviewd by: wzt,qifei
bug id: 无
改动说明：合入vmp4.0 host proxy 的改动
        
        </msg>
</logentry>
<logentry
   revision="38418">
<author>zyj</author>
<date>2015-03-16T09:15:26.962578Z</date>
<msg>reviewid 5833
review by: wangzheng,hhx
TD: no
现象：
glusterfs中加入aio重传机制。
改动说明：
glusterfs中加入aio重传机制。
测试：
编译通过</msg>
</logentry>
<logentry
   revision="38416">
<author>hyq</author>
<date>2015-03-16T09:02:02.764454Z</date>
<msg>reviewid: 5824
reviewd by: xhz
bug id: 无
改动说明：回滚之前做的把替换主机中的添加主机那个步骤为同步的
        
        </msg>
</logentry>
<logentry
   revision="38410">
<author>qifei</author>
<date>2015-03-16T08:05:50.587228Z</date>
<msg>reviewid 5826
reviewed by :hyq
bug id: 无
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38406">
<author>lrx</author>
<date>2015-03-16T07:23:46.287483Z</date>
<msg>noreview
改动说明：1、vmp不编辑vs使用的网口</msg>
</logentry>
<logentry
   revision="38405">
<author>lrx</author>
<date>2015-03-16T07:23:09.085121Z</date>
<msg>noreview
改动说明：1、显示盘位</msg>
</logentry>
<logentry
   revision="38403">
<author>lrx</author>
<date>2015-03-16T07:22:38.388469Z</date>
<msg>noreview
改动说明：1、磁盘加入错误显示，2、信息刷新异常</msg>
</logentry>
<logentry
   revision="38398">
<author>qifei</author>
<date>2015-03-16T04:02:06.514559Z</date>
<msg>reviewid 5818
reviewed by :hyq
bug id: 无
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38394">
<author>hhx</author>
<date>2015-03-16T03:42:31.361225Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="38393">
<author>hhx</author>
<date>2015-03-16T03:37:45.845681Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="38391">
<author>qifei</author>
<date>2015-03-16T03:36:46.604795Z</date>
<msg>reviewid 5812
reviewed by :zyj
bug id: 
问题分析：关掉qemu中统计优化效果的日志
改动说明：
将相关的宏注释掉</msg>
</logentry>
<logentry
   revision="38382">
<author>hyq</author>
<date>2015-03-16T02:44:50.082502Z</date>
<msg>reviewid: 5805
reviewd by: wzt
bug id: 无
改动说明：如果是虚拟存储，修改页面显示的名称为【虚拟存储（一副本卷）】等
        
        </msg>
</logentry>
<logentry
   revision="38379">
<author>qifei</author>
<date>2015-03-16T02:38:41.646256Z</date>
<msg>reviewid 5438
reviewed by :wzt,xhz
bug id: 
问题分析：精简perl，blackbox日志
改动说明：
去掉xhz的日志：
将以下日志中出现频率高且意义不大的条目去掉：
修改blackbox.xml配置文件：
将打日志频率为120秒的日志文件改为300秒，优化ps文件只打印执行ps命令的最后200行
修改build.sh，在一体机情况下使用修改后的blackbox.xml配置文件。</msg>
</logentry>
<logentry
   revision="38373">
<author>hyq</author>
<date>2015-03-16T01:50:24.982747Z</date>
<msg>reviewid: 5791
reviewd by: wzt
bug id: 无
改动说明：合入VS改动
        
        </msg>
</logentry>
<logentry
   revision="38371">
<author>qifei</author>
<date>2015-03-16T00:55:58.373839Z</date>
<msg>reviewid 5802
reviewed by :hyq
bug id: 无
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38352">
<author>lbc</author>
<date>2015-03-14T12:00:38.074795Z</date>
<msg>reviewid 5793
review by: lixing
TD 27302。
修改自动升级不需要读取升级时间。</msg>
</logentry>
<logentry
   revision="38343">
<author>jcy</author>
<date>2015-03-14T10:05:53.751027Z</date>
<msg>noreview
改动说明：
bug27428：合入VMP3.5回滚补丁包重启的bug27315
</msg>
</logentry>
<logentry
   revision="38341">
<author>hhx</author>
<date>2015-03-14T09:52:59.576155Z</date>
<msg>newreviewid:5787,by xhz
解决问题:合入VMP3.5升级的bug27315
做了那些测试:/etc/init.d/vtpdaemon restart;/etc/init.d/apache2 restart ok
perl -c ok
</msg>
</logentry>
<logentry
   revision="38339">
<author>ljb</author>
<date>2015-03-14T09:46:38.416537Z</date>
<msg>reviewid 5790
Reviewed by: wzt
BUG ID: 无
问题分析：加载虚拟机配置文件前，先update一下
改动说明：加载虚拟机配置文件前，先update一下
做了哪些测试：使用perl -c 检查语法，语法ＯＫ</msg>
</logentry>
<logentry
   revision="38313">
<author>hhx</author>
<date>2015-03-14T06:49:55.897268Z</date>
<msg>newreviewid:5767,by gzy
解决问题:fix bug29200:备份还能备份到本地存储，得要隐藏掉本地存储【与VT关联】 done
做了那些测试:/etc/init.d/vtpdaemon restart;/etc/init.d/apache2 restart ok
perl -c ok
</msg>
</logentry>
<logentry
   revision="38307">
<author>hyq</author>
<date>2015-03-14T06:15:00.506828Z</date>
<msg>reviewid: 5765
reviewd by: qifei
bug id: 无
改动说明：修改VDI镜像名称为VDI42.qcow2
        
        </msg>
</logentry>
<logentry
   revision="38306">
<author>hhx</author>
<date>2015-03-14T05:39:27.952744Z</date>
<msg>newreviewid:5764,by hyq
解决问题:fix bug27359:先合入VMP3.5快照的perl层的修改
做了那些测试:/etc/init.d/vtpdaemon restart;/etc/init.d/apache2 restart ok
perl -c ok
</msg>
</logentry>
<logentry
   revision="38304">
<author>hyq</author>
<date>2015-03-14T04:12:19.302792Z</date>
<msg>reviewid: 5762
reviewd by: qifei
bug id: 无
改动说明：合入vs代码更新
        
        </msg>
</logentry>
<logentry
   revision="38302">
<author>qifei</author>
<date>2015-03-14T03:53:08.844746Z</date>
<msg>reviewid 5760
reviewed by :hyq
bug id: 无
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38292">
<author>hhx</author>
<date>2015-03-14T03:25:14.542056Z</date>
<msg>newreviewid:5755,by xhz
解决问题:fix bug27359:先合入VMP3.5快照的perl层的修改
做了那些测试:/etc/init.d/vtpdaemon restart;/etc/init.d/apache2 restart ok
perl -c ok</msg>
</logentry>
<logentry
   revision="38272">
<author>lrx</author>
<date>2015-03-14T01:58:43.880923Z</date>
<msg>noreview
改动说明：1、合入vs的修改</msg>
</logentry>
<logentry
   revision="38271">
<author>zxq</author>
<date>2015-03-14T01:56:40.203311Z</date>
<msg>reviewid 5743
Reviewed by: hhx
BUG ID: null
问题分析: 新建VDC功能特殊处理
做了哪些测试： 单机新建普通VDC和集群VDC通过。没有集群环境，没有测试代理到其他节点的情况</msg>
</logentry>
<logentry
   revision="38268">
<author>hyq</author>
<date>2015-03-14T01:34:02.039469Z</date>
<msg>reviewid: 5721
reviewd by: xhz
bug id: 无
改动说明：合入vs改动
        
        </msg>
</logentry>
<logentry
   revision="38267">
<author>hyq</author>
<date>2015-03-14T01:33:05.991594Z</date>
<msg>reviewid: 5727
reviewd by: xhz
bug id: 无
改动说明：vs对cluvmadm
        
        </msg>
</logentry>
<logentry
   revision="38259">
<author>lrx</author>
<date>2015-03-13T12:38:47.056240Z</date>
<msg>noreview
改动说明：1、错别字修改</msg>
</logentry>
<logentry
   revision="38254">
<author>qifei</author>
<date>2015-03-13T11:59:09.832384Z</date>
<msg>reviewid 5732
reviewed by :hyq
bug id: 无
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38241">
<author>hhx</author>
<date>2015-03-13T10:13:12.821251Z</date>
<msg>update</msg>
</logentry>
<logentry
   revision="38239">
<author>hhx</author>
<date>2015-03-13T10:07:44.943717Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="38238">
<author>hhx</author>
<date>2015-03-13T10:05:09.865949Z</date>
<msg>update</msg>
</logentry>
<logentry
   revision="38235">
<author>hhx</author>
<date>2015-03-13T09:54:34.668962Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="38225">
<author>hhx</author>
<date>2015-03-13T09:09:50.476722Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="38221">
<author>qifei</author>
<date>2015-03-13T08:54:53.022397Z</date>
<msg>reviewid 5704
reviewed by :fxw
bug id: 
问题分析：解决qemu不能分别打日志的问题
改动说明：移动vl.c中的一处ldebug</msg>
</logentry>
<logentry
   revision="38216">
<author>hyq</author>
<date>2015-03-13T08:34:06.307324Z</date>
<msg>reviewid: 5702
reviewd by: lzl
bug id: 无
改动说明：合入反向代理配置文件及修改的Makefile
        
        </msg>
</logentry>
<logentry
   revision="38201">
<author>qifei</author>
<date>2015-03-13T03:45:23.767814Z</date>
<msg>reviewid 5693
reviewed by :hyq
bug id: 无
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38189">
<author>hhx</author>
<date>2015-03-13T03:01:20.090202Z</date>
<msg>newreviewid:5687,by gzy
解决问题:fix bug27359:先合入VMP3.5快照的perl层的修改
做了那些测试:/etc/init.d/vtpdaemon restart;/etc/init.d/apache2 restart ok
perl -c ok
</msg>
</logentry>
<logentry
   revision="38184">
<author>rhx</author>
<date>2015-03-13T02:31:28.788647Z</date>
<msg>更新</msg>
</logentry>
<logentry
   revision="38170">
<author>hhx</author>
<date>2015-03-12T14:04:18.980554Z</date>
<msg>newreviewid:5680,by hyq
解决问题:fix bug27388:合入ssl摄像头功能的perl代码
做了那些测试:/etc/init.d/vtpdaemon restart;/etc/init.d/apache2 restart ok
perl -c ok</msg>
</logentry>
<logentry
   revision="38167">
<author>hhx</author>
<date>2015-03-12T13:43:20.093903Z</date>
<msg>noreveiw:合入ssl usb设想头功能的.so模块，目前已经联调通过了，可以上库了</msg>
</logentry>
<logentry
   revision="38161">
<author>hyq</author>
<date>2015-03-12T12:45:15.344611Z</date>
<msg>reviewid: 5673
reviewd by: wzt
bug id: 27092
改动说明：1、修复一个添加主机同步问题。2、修复IP冲突问题。3，,合入VS的一些改动
        
        </msg>
</logentry>
<logentry
   revision="38158">
<author>qifei</author>
<date>2015-03-12T12:40:45.182098Z</date>
<msg>reviewid 5674
reviewed by :hyq
bug id: 无
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38154">
<author>hyq</author>
<date>2015-03-12T11:59:11.921245Z</date>
<msg>reviewid: 5669
reviewd by: wtd
bug id: 无
改动说明：添加打一体机包的选项
        
        </msg>
</logentry>
<logentry
   revision="38108">
<author>jcy</author>
<date>2015-03-12T06:34:56.031187Z</date>
<msg>noreview
改动说明：
VS：新增VDC，磁盘文件写成默认值并不允许修改。</msg>
</logentry>
<logentry
   revision="38103">
<author>hhx</author>
<date>2015-03-12T04:05:54.786635Z</date>
<msg>newreviewid:5631,by lifan,wzt
解决问题:fix bug27359:先合入VMP3.5快照的perl层的修改
做了那些测试:/etc/init.d/vtpdaemon restart;/etc/init.d/apache2 restart
 vtpcm verifyapi</msg>
</logentry>
<logentry
   revision="38102">
<author>lrx</author>
<date>2015-03-12T04:00:44.801068Z</date>
<msg>noreview
改动说明：1、错别字</msg>
</logentry>
<logentry
   revision="38095">
<author>lrx</author>
<date>2015-03-12T03:26:54.500970Z</date>
<msg>noreview
改动说明：1、添加磁盘（包括新增和编辑虚拟机）改成精简分配或预分频</msg>
</logentry>
<logentry
   revision="38094">
<author>qifei</author>
<date>2015-03-12T03:25:57.156889Z</date>
<msg>reviewid 5634
reviewed by :hyq
bug id: 无
问题分析：VS代码更新
改动说明：VS代码更新</msg>
</logentry>
<logentry
   revision="38091">
<author>hyq</author>
<date>2015-03-12T02:52:11.233519Z</date>
<msg>reviewid: 5632
reviewd by: qifei
bug id: 无
改动说明：把第三方库头文件等路径加入环境变量
        
        </msg>
</logentry>
<logentry
   revision="38067">
<author>hyq</author>
<date>2015-03-11T14:23:49.301310Z</date>
<msg>reviewid: 5623
reviewd by: hjg
bug id: 无
改动说明：添加3party，都是so文件
        
        </msg>
</logentry>
<logentry
   revision="38066">
<author>hyq</author>
<date>2015-03-11T14:03:24.540795Z</date>
<msg>reviewid: 5622
reviewd by: hjg
bug id: 无
改动说明：vs_mktemp 封装创建临时文件，仍需主动删除，以后改进成自动删除临时文件
        
        </msg>
</logentry>
<logentry
   revision="38056">
<author>hyq</author>
<date>2015-03-11T13:35:59.778585Z</date>
<msg>reviewid: 5619
reviewd by: hjg
bug id: 无
问题分析：从vmp3.5合入单点登录功能。
改动说明：修改devenvrc指向第三方库的头文件和头文件目录。
        
        </msg>
</logentry>
<logentry
   revision="38055">
<author>hyq</author>
<date>2015-03-11T13:29:06.855728Z</date>
<msg>reviewid: 5618
reviewd by: hjg
bug id: 无
问题分析：从vmp3.5合入单点登录功能。
改动说明：从vmp3.5合入单点登录功能，归档perl修改部分，还有一部分apach配置（sso_proxy.conf）
        
        </msg>
</logentry>
<logentry
   revision="38050">
<author>hyq</author>
<date>2015-03-11T12:41:10.545702Z</date>
<msg>reviewid: 5616
reviewd by: hjg
bug id: 无
问题分析：从vmp3.5合入单点登录功能。
改动说明：从vmp3.5合入单点登录功能，归档apach修改部分
        
        </msg>
</logentry>
<logentry
   revision="38043">
<author>hyq</author>
<date>2015-03-11T12:19:57.198441Z</date>
<msg>reviewid: 5613
reviewd by: hjg
bug id: 无
问题分析：从vmp3.5合入单点登录功能。
改动说明：从3.5合入单点登录:主机和虚拟机实现串口通信的程序能够开机自启动、修改防火墙规则
        
        </msg>
</logentry>
<logentry
   revision="38040">
<author>hyq</author>
<date>2015-03-11T11:48:49.980251Z</date>
<msg>reviewid: 5608
reviewd by: lzl
bug id: 无
问题分析：从vmp3.5合入单点登录功能。
改动说明：从vmp3.5合入单点登录功能:主机和虚拟机实现串口通信合入源代码，实现主机和虚拟机实现通信。
        
        </msg>
</logentry>
<logentry
   revision="38035">
<author>hyq</author>
<date>2015-03-11T11:21:21.338910Z</date>
<msg>reviewid: 5606
reviewd by: lzl
bug id: 无
问题分析：从vmp3.5合入单点登录功能。
改动说明：从vmp3.5合入单点登录功能所有要的库。1、添加库libch 、、jsonrpc 、libqb-event、 proc_debug对应的库源码。2、添加库3party，都是so文件。

        
        </msg>
</logentry>
<logentry
   revision="38033">
<author>hyq</author>
<date>2015-03-11T10:48:07.167369Z</date>
<msg>reviewid: 5598
reviewd by: qifei
bug id: 无
问题分析：从vmp3.5合入单点登录功能。
改动说明：添加库libch 、3party 、jsonrpc 、libqb-event、 proc_debug对应的头文件。

        
        </msg>
</logentry>
<logentry
   revision="38007">
<author>zyj</author>
<date>2015-03-11T05:10:46.335592Z</date>
<msg>reviewid 5589
review by: zsj,hhx
TD: no
现象：
ssl部门招行UKey与录音盒的问题已基本查明,合入到vmp3.4
改动说明：
ssl部门招行UKey与录音盒的问题已基本查明,合入到vmp3.4
测试：
编译通过</msg>
</logentry>
<logentry
   revision="38003">
<author>hyq</author>
<date>2015-03-11T04:44:09.423060Z</date>
<msg>reviewid: 5576
reviewd by: wzt
bug id: 无
改动说明:合入VS改动
        
        </msg>
</logentry>
<logentry
   revision="37991">
<author>lifan</author>
<date>2015-03-11T01:58:46.327082Z</date>
<msg>noreview
增加键盘中断注入抑制功能的调试开关，方便后面排查问题</msg>
</logentry>
<logentry
   revision="37987">
<author>hhx</author>
<date>2015-03-10T13:50:07.364600Z</date>
<msg>noreview:此脚本很危险，出了客户问题，统一删除掉，vmp所有的版本均要删除掉这个问题</msg>
</logentry>
<logentry
   revision="37986">
<author>hyq</author>
<date>2015-03-10T13:42:46.963795Z</date>
<msg>reviewid: 5570
reviewd by: wzt
bug id: 无
改动说明:1、合入VS tar 包；2、调整添加usb设备的顺序
        
        </msg>
</logentry>
<logentry
   revision="37968">
<author>rhx</author>
<date>2015-03-10T10:34:51.290963Z</date>
<msg>更新</msg>
</logentry>
<logentry
   revision="37959">
<author>hhx</author>
<date>2015-03-10T08:58:45.844261Z</date>
<msg>newreviewid:5556,by gzy
解决问题:fix bug29137:[外部体验] 一体机存储位置选项中不要显示“本地磁盘”了;谨慎点，再加一个判断
做了那些测试:perl -c ok
UI界面新建虚拟机下拉列表没有显示出local存储来</msg>
</logentry>
<logentry
   revision="37958">
<author>hyq</author>
<date>2015-03-10T08:44:20.420136Z</date>
<msg>reviewid: 5553
reviewd by: zhangqian
bug id: 无
改动说明:1、回滚之前屏蔽掉的摄像头功能的代码。2、删除USB模块的两个文件， 已经包含到动态库里了
        
        </msg>
</logentry>
<logentry
   revision="37949">
<author>hhx</author>
<date>2015-03-10T07:51:26.826365Z</date>
<msg>newreviewid:5546,by gzy
解决问题:fix bug29137:[外部体验] 一体机存储位置选项中不要显示“本地磁盘”了
做了那些测试:perl -c ok
UI界面新建虚拟机下拉列表没有显示出local存储来</msg>
</logentry>
<logentry
   revision="37942">
<author>cfq</author>
<date>2015-03-10T06:31:53.927818Z</date>
<msg>当读写VS存储的时候，如果返回0就abort，方便定位问题</msg>
</logentry>
<logentry
   revision="37924">
<author>lrx</author>
<date>2015-03-10T01:46:50.886923Z</date>
<msg>noreview
改动说明：1、样式修改</msg>
</logentry>
<logentry
   revision="37923">
<author>lrx</author>
<date>2015-03-10T01:46:43.026784Z</date>
<msg>noreview
改动说明：1、组件集群没有取消，没有上一步，2、一体机组件集群检查vs副本</msg>
</logentry>
<logentry
   revision="37908">
<author>hyq</author>
<date>2015-03-09T12:33:49.866009Z</date>
<msg>reviewid: 5453
reviewd by: wzt
bug id: 无
改动说明: VS perl 代码部分 去污染
        
        </msg>
</logentry>
<logentry
   revision="37907">
<author>hyq</author>
<date>2015-03-09T12:01:03.924062Z</date>
<msg>reviewid: 5525
reviewd by: wzt
bug id: 29086
改动说明: 1、合入VS的tar包。2、修复bug：29086[VMP] 已有lvm分区的盘，添加到本地存储失败。3、zh_CN.yml添加项
        
        </msg>
</logentry>
<logentry
   revision="37905">
<author>hyq</author>
<date>2015-03-09T11:50:13.705285Z</date>
<msg>reviewid: 5525
reviewd by: zhangqian
bug id: 无
改动说明: 合入付帅兵改动代码
        
        </msg>
</logentry>
<logentry
   revision="37898">
<author>jcy</author>
<date>2015-03-09T09:28:28.542617Z</date>
<msg>noreview
改动说明：
安装VDC：在初始化虚拟存储后弹出窗口 提示安装。</msg>
</logentry>
<logentry
   revision="37896">
<author>hyq</author>
<date>2015-03-09T09:15:33.291670Z</date>
<msg>reviewid: 5518
reviewd by: wzt
bug id: 无
改动说明: vs 替换主机过程中将添加主机改为同步
        
        </msg>
</logentry>
<logentry
   revision="37879">
<author>hyq</author>
<date>2015-03-09T06:19:32.036930Z</date>
<msg>reviewid: 5450
reviewd by: wzt
bug id: 无
改动说明: 合入VS改动
        
        </msg>
</logentry>
<logentry
   revision="37869">
<author>hhx</author>
<date>2015-03-09T02:58:33.494745Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="37867">
<author>jcy</author>
<date>2015-03-09T02:17:31.068993Z</date>
<msg>noreview
改动说明：
解决IE10下不能上传ISO。</msg>
</logentry>
<logentry
   revision="37865">
<author>zxq</author>
<date>2015-03-09T01:53:28.593352Z</date>
<msg>reviewid 5498
Reviewed by: hhx
BUG ID: null
问题分析: 快速新建VDC功能
做了哪些测试： 测试ok</msg>
</logentry>
<logentry
   revision="37864">
<author>hhx</author>
<date>2015-03-09T01:46:43.781827Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="37863">
<author>jcy</author>
<date>2015-03-09T01:46:39.282913Z</date>
<msg>noreview
改动说明：
新增功能：安装VDC。</msg>
</logentry>
<logentry
   revision="37858">
<author>hhx</author>
<date>2015-03-08T07:22:06.492345Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="37843">
<author>lrx</author>
<date>2015-03-07T11:37:08.945091Z</date>
<msg>noreview
改动说明：1、样式修改</msg>
</logentry>
<logentry
   revision="37841">
<author>lrx</author>
<date>2015-03-07T10:22:46.103377Z</date>
<msg>noreview
改动说明：1、加入vs初始化进度显示</msg>
</logentry>
<logentry
   revision="37836">
<author>lrx</author>
<date>2015-03-07T10:05:47.124630Z</date>
<msg>noreview
改动说明：1、样式修改</msg>
</logentry>
<logentry
   revision="37825">
<author>lrx</author>
<date>2015-03-07T08:37:42.882874Z</date>
<msg>noreview
改动说明：1、添加主机的限制只在一体机版本生效</msg>
</logentry>
<logentry
   revision="37823">
<author>lrx</author>
<date>2015-03-07T08:23:58.595592Z</date>
<msg>noreview
改动说明：1、数据平衡计划刷新，2、字段名称错误</msg>
</logentry>
<logentry
   revision="37812">
<author>qifei</author>
<date>2015-03-07T07:36:23.773030Z</date>
<msg>reviewid 5455
reviewed by :zhangqian
bug id: 
问题分析：vmp安装时找不到sd卡分区脚本
改动说明：将sd卡分区脚本相对路径改为绝对路径
做了哪些测试：代码编译通过，基本功能规范</msg>
</logentry>
<logentry
   revision="37808">
<author>lrx</author>
<date>2015-03-07T07:17:17.745994Z</date>
<msg>noreview
改动说明：1、函数名错误</msg>
</logentry>
<logentry
   revision="37806">
<author>lrx</author>
<date>2015-03-07T07:09:39.787210Z</date>
<msg>noreview
改动说明：1、虚拟存储状态页面添加管理存储空间入口</msg>
</logentry>
<logentry
   revision="37799">
<author>lrx</author>
<date>2015-03-07T05:14:00.758848Z</date>
<msg>noreview
改动说明：1、错误字段修改</msg>
</logentry>
<logentry
   revision="37798">
<author>lrx</author>
<date>2015-03-07T05:12:38.972127Z</date>
<msg>noreview
改动说明：1、添加磁盘加入个数限制</msg>
</logentry>
<logentry
   revision="37797">
<author>hhx</author>
<date>2015-03-07T04:18:33.885138Z</date>
<msg>noreview</msg>
</logentry>
<logentry
   revision="37792">
<author>hyq</author>
<date>2015-03-07T03:39:20.542880Z</date>
<msg>reviewid: 5450
reviewd by: wzt
bug id: 无
改动说明: 合入VS改动
        
        </msg>
</logentry>
<logentry
   revision="37791">
<author>hhx</author>
<date>2015-03-07T03:29:55.641887Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="37787">
<author>lrx</author>
<date>2015-03-07T03:28:19.336468Z</date>
<msg>noreview
改动说明：1、存储没有替换主机，2、vs有替换主机，没有删除主机</msg>
</logentry>
<logentry
   revision="37784">
<author>hhx</author>
<date>2015-03-07T02:30:22.289929Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="37769">
<author>hyq</author>
<date>2015-03-06T12:46:05.109995Z</date>
<msg>reviewid: 5444
reviewd by: wzt
bug id: 29071
改动说明: 【和 vt 关联】 添加本地存储能操作已加入虚拟机存储的磁盘
        
        </msg>
</logentry>
<logentry
   revision="37767">
<author>hyq</author>
<date>2015-03-06T11:21:26.631499Z</date>
<msg>reviewid: 5442
reviewd by: hhx
bug id: 29037
改动说明:修复bug：【20150226】[过年稳写性]跑断网场景后虚拟机蓝屏0X0000007b（vt bug）
        
        </msg>
</logentry>
<logentry
   revision="37748">
<author>hhx</author>
<date>2015-03-06T09:50:40.214726Z</date>
<msg>Merged revision(s) 37577 from VTP/VMP3.5/Trunk:
reviewid 5434
Reviewed by :zzp
BUG ID :27197
问题分析：windows升级 修改升级安装文件丢失的bug
改动说明：通过一些手段防止文件丢失后安装失败,主要改两处，一个是通过一个文件来判断文件的完整性，这个文件缺失表示文件不完整，安装程序直接退出。而是安装程序在安装目录下运行时不删除和拷贝文件。其他一个修改是删除临时目录下的文件时，如果SangforUpdateServer.exe存在，那么会再次卸载这个服务然后删掉文件，之后还是存在就只是打印日志，继续走流程退出
做了哪些测试:打zip包测试通过，放到后台升级成功
........
</msg>
</logentry>
<logentry
   revision="37732">
<author>hhx</author>
<date>2015-03-06T06:34:25.755459Z</date>
<msg>newreviewid:5429,by gzu,wzt
解决问题:一体机的版本，暂时关闭掉对虚拟机磁盘状态的检查
做了那些测试:perl -c ok
/sf/etc/init.d/vtpalerd restart ok</msg>
</logentry>
<logentry
   revision="37726">
<author>zyj</author>
<date>2015-03-06T02:58:35.954981Z</date>
<msg>reviewid 5420
review by: fxw
TD: 29075
现象：
TD29075: 挂起虚拟机，虚拟存储需要的时间是本地存储的8到10倍
改动说明：
原因是挂起时有很多小包，小包交互导致慢。与勇哥/邱亮等讨论，缓存区大小和IOV个数调整，速度与本地一样了。

测试：
编译通过，给周茂青替换程序测试通过。</msg>
</logentry>
<logentry
   revision="37723">
<author>lrx</author>
<date>2015-03-06T02:18:35.165311Z</date>
<msg>noreview
改动说明：1、磁盘详情图表单位修正</msg>
</logentry>
<logentry
   revision="37711">
<author>zyj</author>
<date>2015-03-06T01:22:51.065910Z</date>
<msg>reviewid 5419
review by: lifan
TD: no
现象：
限制bdrv_close中打日志的数量
改动说明：
此日志用于查看缓存中的数据是否刷完，但如果没有开启缓存功能，就不必打日志

测试：
编译通过</msg>
</logentry>
<logentry
   revision="37707">
<author>hhx</author>
<date>2015-03-05T12:19:54.832139Z</date>
<msg>newreviewid:5417,by hyq
解决问题:合入vs对cluvmadm的修改
做了那些测试:与UI联调ok</msg>
</logentry>
<logentry
   revision="37705">
<author>hyq</author>
<date>2015-03-05T10:58:19.113176Z</date>
<msg>reviewid: 5416
reviewd by: hhx
bug id:无
改动说明:1,解决虚拟机启动失败
        
        </msg>
</logentry>
<logentry
   revision="37704">
<author>hhx</author>
<date>2015-03-05T10:49:39.880476Z</date>
<msg>newreviewid:5415,by hyq
解决问题:合入vs对cluvmadm的修改
做了那些测试:与UI联调ok</msg>
</logentry>
<logentry
   revision="37702">
<author>wyy</author>
<date>2015-03-05T10:22:48.286155Z</date>
<msg>reviewid 5406
Reviewed by：lifan
问题分析：虚拟机启动回调/sf/etc/hook.d/kvm/start.d/目录中的脚步，加载perl的一些库，导致启动很慢
改动：虚拟机启动时先回调shell脚本，通过shell脚本判断是否需要调用perl脚本后，再视情况去调用perl脚本</msg>
</logentry>
<logentry
   revision="37696">
<author>qifei</author>
<date>2015-03-05T09:40:37.993617Z</date>
<msg>reviewid 5404
reviewed by :lbc
bug id: 
问题分析：修改vmp可以安装在大于25G的磁盘
改动说明：考虑到32G的sdcard实际大小远远不到32G，讨论之后将vmp安装磁盘最小容量定位25G；
只保留3个分区，boot 5G,local 5G，剩余给log；
在实现上，重新写了给sdcard分区的脚本，当检测到磁盘容量小于55G并大于25G时，就会调sdcard的分区脚本
做了哪些测试：代码编译通过，基本功能规范</msg>
</logentry>
<logentry
   revision="37688">
<author>lrx</author>
<date>2015-03-05T07:26:38.914643Z</date>
<msg>noreview
改动说明：1、主机离线用0表示</msg>
</logentry>
<logentry
   revision="37675">
<author>hyq</author>
<date>2015-03-05T05:44:23.833243Z</date>
<msg>reviewid: 5394
reviewd by: hhx
bug id:
改动说明:1,合入3.3改动
        
        </msg>
</logentry>
<logentry
   revision="37671">
<author>lrx</author>
<date>2015-03-05T03:51:28.575123Z</date>
<msg>noreview
改动说明：1、根据vs标识显示vs选项卡或引导</msg>
</logentry>
<logentry
   revision="37669">
<author>lifan</author>
<date>2015-03-05T03:20:48.492611Z</date>
<msg>noreview
合入VMP4.0 TD27226，集群的主控节点直接连接127.0.0.1的ip，这样就可以避免受到网络故障的干扰。</msg>
</logentry>
<logentry
   revision="37667">
<author>hyq</author>
<date>2015-03-05T03:16:46.289588Z</date>
<msg>reviewid: 5401
reviewd by: qifei
bug id:
改动说明:1,合入VS 代码改动
        
        </msg>
</logentry>
<logentry
   revision="37665">
<author>hhx</author>
<date>2015-03-05T03:01:39.812838Z</date>
<msg>newreviewid:5396,by wzt,gzy
解决问题:解决一体机才能显示虚拟存储的问题，非一体机不能显示出虚拟机存储
做了那些测试:与UI联调ok</msg>
</logentry>
<logentry
   revision="37654">
<author>hyq</author>
<date>2015-03-05T01:27:42.490292Z</date>
<msg>reviewid: 5389
reviewd by: hhx
bug id:
改动说明:1,合入VS tar包，
        
        </msg>
</logentry>
<logentry
   revision="37636">
<author>hhx</author>
<date>2015-03-04T09:53:02.451355Z</date>
<msg>newreviewid:5364,by wzt,gzy
解决问题:合入vs对QemuClone.pm的代码
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="37629">
<author>zyj</author>
<date>2015-03-04T08:38:54.946805Z</date>
<msg>reviewid 5375
review by: lifan
TD: no
现象：
系统盘不会出现除0，但数据盘潜在可能会出现, 所以还是+1
改动说明：
除数+1

测试：
编译通过,测试通过</msg>
</logentry>
<logentry
   revision="37622">
<author>lrx</author>
<date>2015-03-04T07:34:01.875229Z</date>
<msg>noreview
改动说明：1、判断管理口字段错误</msg>
</logentry>
<logentry
   revision="37606">
<author>zyj</author>
<date>2015-03-04T06:12:31.995553Z</date>
<msg>reviewid 5366
review by: fxw
TD: no
现象：
block-cache中有一处错误，没出问题，是因为判断时，预留了64个项的空间
改动说明：
少了一个加号。修改为
size += MAX_LOG_CNT * sizeof(sector_record);

测试：
编译通过,测试通过</msg>
</logentry>
<logentry
   revision="37605">
<author>lrx</author>
<date>2015-03-04T04:02:16.330112Z</date>
<msg>noreview
改动说明：1、删除一个无用的类</msg>
</logentry>
<logentry
   revision="37603">
<author>hhx</author>
<date>2015-03-04T03:51:10.541138Z</date>
<msg>newreviewid:5363,by wzt,gzy
解决问题:合入vs对QemuServer.pm的代码
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="37601">
<author>lrx</author>
<date>2015-03-04T03:45:23.797046Z</date>
<msg>noreview
改动说明：1、替换主机时，旧主机传id</msg>
</logentry>
<logentry
   revision="37597">
<author>hhx</author>
<date>2015-03-04T03:30:17.036500Z</date>
<msg>newreviewid:5358,by wzt,gzy
解决问题:合入vs对cluvmadm的修改
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="37568">
<author>hyq</author>
<date>2015-03-03T13:05:54.713774Z</date>
<msg>reviewid: 5350
reviewd by: hhx
bug id: 28822
改动说明:1,合入VS tar包，
         2,把VDC镜像文件移动到build/pkg/replace-boot/local/vdc-img目录
        </msg>
</logentry>
<logentry
   revision="37566">
<author>hyq</author>
<date>2015-03-03T12:51:48.115970Z</date>
<msg>reviewid: 5347
reviewd by: hhx
bug id: 28822
改动说明:
         1,修改bug 28822：在虚拟机的详情页面里面，需要显示虚拟机存储在哪些主机上面。</msg>
</logentry>
<logentry
   revision="37553">
<author>lifan</author>
<date>2015-03-03T11:17:21.509946Z</date>
<msg>reviewid: 5339
reviewed by: zyj
bug id:  27207
问题分析：集群nfs客户端检测到共享目录的inode id发生改变后，会一直打印异常信息，这里需要处理下。
自测：场景测试通过</msg>
</logentry>
<logentry
   revision="37535">
<author>lrx</author>
<date>2015-03-03T08:00:41.526600Z</date>
<msg>noreview
改动说明：1、从配置页面回来时，刷新没开始</msg>
</logentry>
<logentry
   revision="37530">
<author>lrx</author>
<date>2015-03-03T06:58:00.963305Z</date>
<msg>noreview
改动说明：1、磁盘详情图表单位修正</msg>
</logentry>
<logentry
   revision="37526">
<author>lrx</author>
<date>2015-03-03T06:32:19.528210Z</date>
<msg>noreview
改动说明：1、磁盘详情图表单位修正</msg>
</logentry>
<logentry
   revision="37520">
<author>lrx</author>
<date>2015-03-03T04:05:57.668060Z</date>
<msg>noreview
改动说明：1、重构虚拟存储状态页面，2、修改磁盘详情图表</msg>
</logentry>
<logentry
   revision="37519">
<author>hyq</author>
<date>2015-03-03T04:05:56.397775Z</date>
<msg>reviewid: 5328
reviewd by: hhx
bug id: 无
改动说明:1,合入VS tar包，2合入VDC镜像文件</msg>
</logentry>
<logentry
   revision="37510">
<author>hyq</author>
<date>2015-03-03T03:10:27.019631Z</date>
<msg>reviewid: 5327
reviewd by: hhx
bug id: 无
改动说明:合入VS改动</msg>
</logentry>
<logentry
   revision="37508">
<author>lrx</author>
<date>2015-03-03T02:57:51.070218Z</date>
<msg>noreview
改动说明：1、按钮右对齐</msg>
</logentry>
<logentry
   revision="37502">
<author>zyj</author>
<date>2015-03-03T02:35:46.101392Z</date>
<msg>reviewid 5319
review by: lifan
TD: no
现象：
勇哥要求把ide虚拟磁盘调试打日志不及时的问题作修改。
改动说明：
fprintf这种方式打调试日志，日志刷新不及时，在现有的fprintf方式打日志代码后面，加入fflush来即时刷新. （顺便修改了一下vmp3.5发现的bdrv_swap导致的drive-mirror产生core的问题）
测试：
编译通过,测试通过(勇哥一起确认了测试结果)</msg>
</logentry>
<logentry
   revision="37501">
<author>lrx</author>
<date>2015-03-03T02:35:07.758839Z</date>
<msg>noreview
改动说明：1、修改错误</msg>
</logentry>
<logentry
   revision="37483">
<author>lrx</author>
<date>2015-03-02T13:29:11.208068Z</date>
<msg>noreview
改动说明：1、加入计算物理磁盘扇区大小</msg>
</logentry>
<logentry
   revision="37465">
<author>hyq</author>
<date>2015-03-02T10:47:08.620969Z</date>
<msg>reviewid: 5316
reviewd by: hhx
bug id: 无
改动说明:暂时注释掉摄像头的代码</msg>
</logentry>
<logentry
   revision="37459">
<author>hyq</author>
<date>2015-03-02T09:02:28.812700Z</date>
<msg>reviewid: 5311
reviewd by: qifei
bug id: 无
改动说明:合入VS tar包</msg>
</logentry>
<logentry
   revision="37438">
<author>hyq</author>
<date>2015-03-02T03:39:00.148042Z</date>
<msg>reviewid: 5302
reviewd by: hhx
bug id: 无
改动说明:合入VS tar包</msg>
</logentry>
<logentry
   revision="37398">
<author>hyq</author>
<date>2015-02-28T10:26:26.080452Z</date>
<msg>reviewid: 5293
reviewd by: hhx
bug id: 无
改动说明:usb设备改为默认的4个</msg>
</logentry>
<logentry
   revision="37383">
<author>hhx</author>
<date>2015-02-28T08:43:05.774958Z</date>
<msg>newreviewid:5287,by wzt
解决问题:fix bug29055:[可靠性]启动虚拟机卡住,界面显示正在启动中,持续七八个小时---sto
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="37382">
<author>hyq</author>
<date>2015-02-28T08:27:08.931721Z</date>
<msg>reviewid: 5286
reviewd by: hhx
bug id: 无
改动说明:合入vs的tar包</msg>
</logentry>
<logentry
   revision="37381">
<author>hyq</author>
<date>2015-02-28T08:13:29.386788Z</date>
<msg>reviewid: 5284
reviewd by: hhx
bug id: 无
改动说明:在 addnode 和delnode API添加一个用于判断是否是做主机替换的操作</msg>
</logentry>
<logentry
   revision="37376">
<author>hyq</author>
<date>2015-02-28T07:31:32.905006Z</date>
<msg>reviewid: 5281
reviewd by: hhx
bug id: 无
改动说明:合入VS 对raidstat脚本的改动</msg>
</logentry>
<logentry
   revision="37344">
<author>hyq</author>
<date>2015-02-28T01:59:10.593131Z</date>
<msg>reviewid: 5252
reviewd by: hhx
bug id: 无
改动说明:合入vs的glusterfs tar包</msg>
</logentry>
<logentry
   revision="37334">
<author>hyq</author>
<date>2015-02-27T10:55:13.840753Z</date>
<msg>reviewid: 5244
reviewd by: hhx
bug id: 无
改动说明:合入vs的tar包</msg>
</logentry>
<logentry
   revision="37333">
<author>hhx</author>
<date>2015-02-27T10:53:10.393765Z</date>
<msg>newreviewid:5245,by xhz
解决问题:合入vs对01update.pl脚本的修改
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="37329">
<author>lifan</author>
<date>2015-02-27T10:24:13.760148Z</date>
<msg>noreview
改动说明：
1.在主控节点修改ip后，nfs连接的恢复速度优化。</msg>
</logentry>
<logentry
   revision="37318">
<author>lrx</author>
<date>2015-02-27T09:43:47.594744Z</date>
<msg>noreview
改动说明：1、模板部署虚拟机非win server版，磁盘分配默认改成精简分配</msg>
</logentry>
<logentry
   revision="37273">
<author>hyq</author>
<date>2015-02-27T02:40:11.991553Z</date>
<msg>改动说明: 合入VS提供的tar包，放在svn://200.200.0.10/vt/vt/VTP/VMP3.4/Trunk/source/app 目录</msg>
</logentry>
<logentry
   revision="37265">
<author>lrx</author>
<date>2015-02-27T01:55:31.542973Z</date>
<msg>noreview
改动说明：1、正确替换主机获取新主机的ip和密码</msg>
</logentry>
<logentry
   revision="37250">
<author>lrx</author>
<date>2015-02-26T12:12:32.498825Z</date>
<msg>noreview
改动说明：1、替换主机加入告警情况处理</msg>
</logentry>
<logentry
   revision="37245">
<author>hhx</author>
<date>2015-02-26T10:03:14.827169Z</date>
<msg>newreviewid:5178,by xhz
解决问题:fix bug28959:[UI]存储位置视图显示有bug，每个主机的本地存储都显示了两次 见附件
做了那些测试:不存在2个本地存储的问题</msg>
</logentry>
<logentry
   revision="37240">
<author>hhx</author>
<date>2015-02-26T08:11:43.868264Z</date>
<msg>newreviewid:5175,by zxq
解决问题:fix bug28875:gfs 挂载点崩溃后, 通过 ui 界面打开挂载点内的文件会提示信息不准确
做了那些测试:perl -c ok
1、ps auxf | grep glusterfs | grep -v glusterfsd | grep 127.0.0.1  找出客户端进程
2、kill -9 把该进程干掉
3、在虚拟机页面，新建虚拟机，选中CD/DVD那一行，加载ISO镜像文件，点浏览文件，再点虚拟存储，没有出现如附件所示的现象</msg>
</logentry>
<logentry
   revision="37234">
<author>lifan</author>
<date>2015-02-26T06:22:19.343669Z</date>
<msg>noreview
改动说明: 
更新多路径配置文件，过滤掉nbd类型设备。</msg>
</logentry>
<logentry
   revision="37225">
<author>lrx</author>
<date>2015-02-26T03:25:26.300775Z</date>
<msg>noreview
改动说明：1、处理vs单主机双副本不允许添加主机的情况</msg>
</logentry>
<logentry
   revision="37200">
<author>hyq</author>
<date>2015-02-11T08:50:21.704208Z</date>
<msg>reviewid: 5150
reviewd by: hhx
bug id: 无
改动说明:1 cleanstorage 过滤掉本地存储和被vs使用的存储。2.合入vs改动</msg>
</logentry>
<logentry
   revision="37190">
<author>lrx</author>
<date>2015-02-11T08:14:47.310157Z</date>
<msg>noreview
改动说明：1、加入一个初始化中状态显示</msg>
</logentry>
<logentry
   revision="37189">
<author>lrx</author>
<date>2015-02-11T08:13:39.584649Z</date>
<msg>noreview
改动说明：1、失败后刷新方式改变</msg>
</logentry>
<logentry
   revision="37188">
<author>lrx</author>
<date>2015-02-11T08:12:16.441807Z</date>
<msg>noreview
改动说明：1、默认显示复用VMP方式</msg>
</logentry>
<logentry
   revision="37177">
<author>lifan</author>
<date>2015-02-11T07:27:16.045206Z</date>
<msg>noreview
官网上下载的最新LSI RAID卡驱动在联想服务器上有些问题，这里先不启用</msg>
</logentry>
<logentry
   revision="37164">
<author>lifan</author>
<date>2015-02-11T03:49:47.149158Z</date>
<msg>noreview
改动说明：
1.将multipath-tools更新到最新的v0.5.0版本，并附带-g调试信息，方便排查后面的出core问题。
2.解决0.5.0版本multipath不兼容宝德存储的问题</msg>
</logentry>
<logentry
   revision="37157">
<author>zzw</author>
<date>2015-02-11T02:41:52.059996Z</date>
<msg>no review hhx: 序列号使用VMP3.1的</msg>
</logentry>
<logentry
   revision="37156">
<author>zzw</author>
<date>2015-02-11T02:41:09.891051Z</date>
<msg>no review hhx: 序列号使用VMP3.1的，此目录删除掉</msg>
</logentry>
<logentry
   revision="37154">
<author>lrx</author>
<date>2015-02-11T02:18:51.191874Z</date>
<msg>noreview
改动说明：1、错别字</msg>
</logentry>
<logentry
   revision="37137">
<author>hyq</author>
<date>2015-02-10T12:56:50.227609Z</date>
<msg>reviewid: 5125
reviewd by: hhx
bug id: 无
改动说明:合入vs改动</msg>
</logentry>
<logentry
   revision="37135">
<author>hhx</author>
<date>2015-02-10T12:49:35.355875Z</date>
<msg>newreviewid:5122,by zxq
解决问题:合入ssl代码
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="37131">
<author>hyq</author>
<date>2015-02-10T12:41:00.626301Z</date>
<msg>reviewid: 5118
reviewd by: hhx
bug id: 29378
改动说明: 解决设置磁盘被VS使用标志在配置文件中被清除的问题</msg>
</logentry>
<logentry
   revision="37128">
<author>zyj</author>
<date>2015-02-10T12:20:44.672269Z</date>
<msg>reviewid 5112
review by: lifan
TD: no
现象：vs对bonding驱动的修改
改动说明：vs对bonding驱动的修改
测试：
vs对bonding驱动的修改</msg>
</logentry>
<logentry
   revision="37126">
<author>lifan</author>
<date>2015-02-10T11:21:23.653749Z</date>
<msg>noreview
改动说明：
完善nfs在udp模式下的访问权限控制。</msg>
</logentry>
<logentry
   revision="37125">
<author>lrx</author>
<date>2015-02-10T11:15:09.261684Z</date>
<msg>noreview
改动说明：1、单主机不用配置探测IP和网口</msg>
</logentry>
<logentry
   revision="37122">
<author>zyj</author>
<date>2015-02-10T10:57:27.103239Z</date>
<msg>reviewid 5106
review by: lifan
TD: no
现象：bonding orig code from linux-3.10.0-121.el7
改动说明：bonding orig code from linux-3.10.0-121.el7
测试：
bonding驱动原生代码check in到svn</msg>
</logentry>
<logentry
   revision="37118">
<author>lrx</author>
<date>2015-02-10T09:35:17.820430Z</date>
<msg>noreview
改动说明：1、显示探索IP配置</msg>
</logentry>
<logentry
   revision="37114">
<author>lrx</author>
<date>2015-02-10T08:58:58.038858Z</date>
<msg>noreview
改动说明：1、adesk版本的非server版的windows 磁盘改成精简分配 </msg>
</logentry>
<logentry
   revision="37106">
<author>lrx</author>
<date>2015-02-10T08:24:28.397489Z</date>
<msg>noreview
改动说明：1、修正vs配置向导，2、复用vmp管理口时可以点击完成</msg>
</logentry>
<logentry
   revision="37104">
<author>wzt</author>
<date>2015-02-10T08:11:57.680313Z</date>
<msg>reviewid 5097
review by: hhx
TD：无
现象：添加集群默认IP判断
改动说明：
（1）集群默认IP判断
（2）获取默认IP通信口
测试：
测试已经OK,可以使用</msg>
</logentry>
<logentry
   revision="37103">
<author>hhx</author>
<date>2015-02-10T08:11:39.520837Z</date>
<msg>newreviewid:5099,by wzt
解决问题:合入vs的告警代码
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="37098">
<author>hhx</author>
<date>2015-02-10T07:58:51.795821Z</date>
<msg>newreviewid:5098,by wzt
解决问题:合入vs的告警代码
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="37095">
<author>lifan</author>
<date>2015-02-10T07:36:03.689061Z</date>
<msg>noreview
改动说明：
TD26865 NFSv4 + tcp + umount方式会导致dentry的引用计数问题，这里改为NFSv3 + udp方式，避免在网络不稳定时的umount流程</msg>
</logentry>
<logentry
   revision="37083">
<author>hhx</author>
<date>2015-02-10T05:07:15.026677Z</date>
<msg>newreviewid:5093,by wzt
解决问题:解决网口预留的问题
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="37034">
<author>hyq</author>
<date>2015-02-09T13:21:25.811391Z</date>
<msg>reviewid: 5072
reviewd by: hhx
bug id: 无
改动说明: vs开机启动初始化脚本</msg>
</logentry>
<logentry
   revision="37026">
<author>hhx</author>
<date>2015-02-09T12:48:14.113674Z</date>
<msg>newreviewid:5070,by zxq
解决问题:合入vtp-manager代码，并fix bug28847:首页，主机离线也不能添加主机
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="37021">
<author>hhx</author>
<date>2015-02-09T12:37:28.082736Z</date>
<msg>newreviewid:5069,by zxq
解决问题:合入vtp-storage代码
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="37012">
<author>hhx</author>
<date>2015-02-09T12:08:38.058312Z</date>
<msg>newreviewid:5064,by zxq
解决问题:合入vtp-storage代码
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="37011">
<author>hhx</author>
<date>2015-02-09T12:00:00.250102Z</date>
<msg>newreviewid:5063,by zxq
解决问题:合入qemu-server目录代码
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="37005">
<author>hhx</author>
<date>2015-02-09T11:35:32.569615Z</date>
<msg>newreviewid:5062,by wzt
解决问题:合入vtp-common 2月4号以后的代码
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="37000">
<author>hhx</author>
<date>2015-02-09T10:46:50.962072Z</date>
<msg>newreviewid:5058,by zxq,wzt
解决问题:解决虚拟机做快照的流程不正确的问题
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="36996">
<author>lrx</author>
<date>2015-02-09T09:35:39.344244Z</date>
<msg>noreview
改动说明：1、vs替换主机，字段修改</msg>
</logentry>
<logentry
   revision="36995">
<author>lrx</author>
<date>2015-02-09T09:35:09.473998Z</date>
<msg>noreview
改动说明：1、虚拟机运行位置的cpu和内存在负数时，显示告警效果</msg>
</logentry>
<logentry
   revision="36990">
<author>hyq</author>
<date>2015-02-09T08:38:38.409265Z</date>
<msg>reviewid: 5051
reviewd by: hhx
bug id: 无
改动说明: 合入VS代码</msg>
</logentry>
<logentry
   revision="36978">
<author>zyj</author>
<date>2015-02-09T07:48:51.535437Z</date>
<msg>reviewid 5044
review by: lifan
TD: 28846
现象：
创建大于brick剩余空间的虚拟机，虚拟机状态一直在创建中
改动说明：
调试修改：VS预分配的代码被合入到vtp-prealloc了，但在VS创建镜像时，原生的qcow2-create2(qemu-img)在预分配metadate时，还是要truncate很多次，很耗时间。
测试：
编译通过</msg>
</logentry>
<logentry
   revision="36976">
<author>lrx</author>
<date>2015-02-09T07:39:27.293517Z</date>
<msg>noreview
改动说明：1、merge版本到3.3的36926</msg>
</logentry>
<logentry
   revision="36975">
<author>lrx</author>
<date>2015-02-09T07:34:05.443429Z</date>
<msg>noreview
改动说明：1、处理多个强制添加的情况，2、使用notify方式提示添加主机失败</msg>
</logentry>
<logentry
   revision="36972">
<author>lrx</author>
<date>2015-02-09T07:11:03.714186Z</date>
<msg>noreview
改动说明：1、能获取选择主机的ip</msg>
</logentry>
<logentry
   revision="36971">
<author>lrx</author>
<date>2015-02-09T07:09:42.282656Z</date>
<msg>noreview
改动说明：1、修复bug28982</msg>
</logentry>
<logentry
   revision="36970">
<author>lrx</author>
<date>2015-02-09T07:08:48.156036Z</date>
<msg>noreview
改动说明：1、加入配置集群引导，2、加入修改默认ip引导</msg>
</logentry>
<logentry
   revision="36966">
<author>hhx</author>
<date>2015-02-09T05:29:50.689123Z</date>
<msg>newreviewid:5041,by lsh
解决问题:fix bug26935:更新模板的界面提示不合理，详情见附件
做了那些测试:只是改了文字</msg>
</logentry>
<logentry
   revision="36962">
<author>hhx</author>
<date>2015-02-09T03:39:09.628891Z</date>
<msg>newreviewid:5038,by wzt
解决问题:合入qemu代码
做了那些测试:对比无问题</msg>
</logentry>
<logentry
   revision="36931">
<author>hhx</author>
<date>2015-02-09T01:50:40.754789Z</date>
<msg>newreviewid:5030,by wzt
解决问题:将/sf/vs_version替换为/sf/version
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="36930">
<author>zhangqian</author>
<date>2015-02-09T01:48:25.299507Z</date>
<msg>reviewid: 5027
Reviewed by: fxw
BUG ID: [NULL]
问题分析：
patch1:
vmware-vga: add vmsvga_verify_rect

Add verification function for rectangles, returning
true if verification passes and false otherwise.


patch2:
vmware-vga: use vmsvga_verify_rect in vmsvga_update_rect

Switch vmsvga_update_rect over to use vmsvga_verify_rect.  Slight change
in behavior:  We don't try to automatically fixup rectangles any more.
In case we find invalid update requests we'll do a full-screen update
instead.


patch3:
vmware-vga: use vmsvga_verify_rect in vmsvga_copy_rect

Add verification to vmsvga_copy_rect, re-enable HW_RECT_ACCEL.


patch4:
vmware-vga: use vmsvga_verify_rect in vmsvga_fill_rect

Add verification to vmsvga_fill_rect, re-enable HW_FILL_ACCEL.

改动说明：
backport from commit 
http://git.qemu.org/?p=qemu.git;a=commit;h=07258900fd45b646f5b69048d64c4490b3243e1b
http://git.qemu.org/?p=qemu.git;a=commit;h=1735fe1edba9cc86bc0f26937ed5a62d3cb47c9c
http://git.qemu.org/?p=qemu.git;a=commit;h=61b41b4c20eba08d2185297767e69153d7f3e09d
http://git.qemu.org/?p=qemu.git;a=commit;h=bd9ccd8517e83b7c33a9167815dbfffb30d70b13


少了两行代码。

测试动作： 编译通过。</msg>
</logentry>
<logentry
   revision="36876">
<author>zyj</author>
<date>2015-02-07T07:26:33.787906Z</date>
<msg>reviewid 4987
review by: hlc
TD: no
现象：
VS,调试修改：glusterfs的abort条件做一点修改, block-cache打一条日志，qemu-sockets去掉unlock的判断条件
改动说明：
调试修改：glusterfs的abort条件做一点修改, block-cache打一条日志，qemu-sockets去掉unlock的判断条件
测试：
编译通过</msg>
</logentry>
<logentry
   revision="36872">
<author>lrx</author>
<date>2015-02-07T06:51:34.820289Z</date>
<msg>noreview
改动说明：1、merge版本到3.3的36870</msg>
</logentry>
<logentry
   revision="36859">
<author>hyq</author>
<date>2015-02-06T14:25:56.877971Z</date>
<msg>reviewid: 4976
reviewd by: hjg
bug id: 无
改动说明: 合入VS代码</msg>
</logentry>
<logentry
   revision="36858">
<author>hyq</author>
<date>2015-02-06T14:24:24.743515Z</date>
<msg>reviewid: 4978
reviewd by: hjg
bug id: 无
改动说明: 翻译文件zh_CN.yml加入vs改动</msg>
</logentry>
<logentry
   revision="36855">
<author>hyq</author>
<date>2015-02-06T11:56:59.969403Z</date>
<msg>reviewid: 4974
reviewd by: hhx
bug id: 28939
改动说明: vs 去掉操作日志</msg>
</logentry>
<logentry
   revision="36854">
<author>hhx</author>
<date>2015-02-06T11:23:48.074910Z</date>
<msg>newreviewid:4973,by wzt
解决问题:如果虚拟机存储在300s内未初始化完成，则不自动启动虚拟机
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="36853">
<author>hhx</author>
<date>2015-02-06T11:18:52.049618Z</date>
<msg>newreviewid:4972,by wzt
解决问题:解决虚拟机自动启动前，先检查一下vs存储是否可用的问题
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="36843">
<author>hhx</author>
<date>2015-02-06T09:14:14.035144Z</date>
<msg>newreviewid:4969,by gzy
解决问题:支持从3.3升级到3.4
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="36840">
<author>lrx</author>
<date>2015-02-06T09:08:22.505338Z</date>
<msg>noreview
改动说明：1、vs的ui到3.4</msg>
</logentry>
<logentry
   revision="36837">
<author>lrx</author>
<date>2015-02-06T09:01:38.787937Z</date>
<msg>noreview
改动说明：1、merge版本到3.3的36830</msg>
</logentry>
<logentry
   revision="36815">
<author>zyj</author>
<date>2015-02-06T06:49:14.404464Z</date>
<msg>reviewid 4962
review by: fxw
TD: 28961
现象：
VS,TD:28961 kvm崩溃不出core，ulimit core大小被限制
改动说明：
从vmp3.0中合入过来.setrlimit(RLIMIT_CORE, &amp;limit)
测试：
编译通过</msg>
</logentry>
<logentry
   revision="36810">
<author>lrx</author>
<date>2015-02-06T06:22:22.363791Z</date>
<msg>noreview
改动说明：1、配置恢复失败时，提示错误</msg>
</logentry>
<logentry
   revision="36801">
<author>zyj</author>
<date>2015-02-06T05:08:37.224478Z</date>
<msg>reviewid 4959
review by: hlc
TD: 28909
现象：
VNC端口冲突,加锁需要加远一点。
改动说明：
在绑定VNC端口时加一个文件锁进行互斥
测试：
编译通过</msg>
</logentry>
<logentry
   revision="36800">
<author>zyj</author>
<date>2015-02-06T04:48:08.767530Z</date>
<msg>reviewid 4957
review by: hlc
TD: 28909
现象：
VNC端口冲突,加锁需要加远一点。
改动说明：
在绑定VNC端口时加一个文件锁进行互斥
测试：
编译通过
</msg>
</logentry>
<logentry
   revision="36798">
<author>zhangqian</author>
<date>2015-02-06T04:02:04.301313Z</date>
<msg>reviewid 4953
Reviewed by: lbc hhx
BUG ID: 28948
问题分析：
分区完后， 会执行 ls /dev/sda1 /dev/sda2 ....
这条命令，如果这条命令执行失败，就会提示(90)check part failed。
因为分区完后，这些设备文件还没来得及生成.
失败后，转入后台，ls命令看，这些设备文件都在，

改动说明：
假如失败，则sleep 10s，然后再试一次。
测试：已测试。</msg>
</logentry>
<logentry
   revision="36789">
<author>lrx</author>
<date>2015-02-06T03:45:44.679107Z</date>
<msg>noreview
改动说明：1、组件改动</msg>
</logentry>
<logentry
   revision="36776">
<author>lrx</author>
<date>2015-02-06T01:11:09.818446Z</date>
<msg>noreview
改动说明：1、合入一些可以兼容vs的内容，不影响vmp，2、合入一些组件改动</msg>
</logentry>
<logentry
   revision="36749">
<author>zhangqian</author>
<date>2015-02-05T11:50:28.278699Z</date>
<msg>reviewid: 4928
Reviewed by: fxw
BUG ID: [NULL]
问题分析： cirrus: Fix host CPU blits
Commit b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef
"CVE-2007-1320 - Cirrus LGD-54XX "bitblt" heap overflow" broke
cpu to video blits.

When the ROP function is called from cirrus_bitblt_cputovideo_next(),
we pass 0 for the pitch but only operate on one line at a time. The
added test was tripping because after the initial substraction, the
pitch becomes negative. Make the test only trip when the height is
larger than one (ie. the pitch is actually used).

This fixes HW cursor support in Windows NT4.0 (which otherwise was
a white rectangle) and general display of icons in that OS when using
8bpp mode.
改动说明：
backport from commit d16136d22af0fcf0d651de04c9e3cbc7137cc6f9
http://git.qemu.org/?p=qemu.git;a=commit;h=d16136d22af0fcf0d651de04c9e3cbc7137cc6f9
1.修复在使用cirrus显卡时，guest机是Windows NT4.0时，光标是白块的 问题；
测试动作： 编译通过。</msg>
</logentry>
<logentry
   revision="36748">
<author>zhangqian</author>
<date>2015-02-05T11:43:45.832493Z</date>
<msg>reviewid: 4925
Reviewed by: fxw
BUG ID: [NULL]
问题分析： spice: call qemu_spice_set_passwd() during init
Don't call SPICE API directly to set password given in command line, but
use the internal API, saving password for later calls.

This solves losing password when changing expiration in qemu monitor.

https://bugzilla.redhat.com/show_bug.cgi?id=1138639
改动说明：
backport from commit 07d49a53b6394941ed833486a3acb5c480d87db2
http://git.qemu.org/?p=qemu.git;a=commit;h=07d49a53b6394941ed833486a3acb5c480d87db2

1.在qemu命令行中带spice密码时,例如“spice port=5932,password=redhat”；
2.在qemu_spice_init中，直接调用spice_server_set_ticket设置密码了，没有将密码保存到全局变量auth_passwd中；
3.导致在通过qmp命令expire_password设置超时时间时，auth_passwd为空，从而又把密码设置成空了；
测试动作： 编译通过。</msg>
</logentry>
<logentry
   revision="36745">
<author>lrx</author>
<date>2015-02-05T11:20:55.066775Z</date>
<msg>noreview
改动说明：1、merge版本到3.3的36737</msg>
</logentry>
<logentry
   revision="36731">
<author>hyq</author>
<date>2015-02-05T09:18:31.764326Z</date>
<msg>reviewid: 4914
reviewd by: hhx
bug id: 28939
改动说明: 解决虚拟机磁盘状态误报(虚拟机磁盘没有损坏却报了损坏)</msg>
</logentry>
<logentry
   revision="36726">
<author>zhangqian</author>
<date>2015-02-05T08:57:22.007306Z</date>
<msg>reviewid: 4890
Reviewed by: fxw
BUG ID: [NULL]
问题分析： 
hw: vmware_vga: don't return cursorx when the driver asks for cursory register

hello qemu-*@nongnu.org, this is my first contribution. apologies if
something is incorrect.

this patch fixes vmware_vga.c so that it actually returns the cursory
register when asked for, instead of cursorx.
改动说明：
backport from commit e2bb4ae74687c06a256d8058e340295c7a084fe4
http://git.qemu.org/?p=qemu.git;a=commit;h=e2bb4ae74687c06a256d8058e340295c7a084fe4

1.guest机请求SVGA_REG_CURSOR_Y时，vmware_vga这边却返回了SVGA_REG_CURSOR_X；
测试动作： 编译通过。</msg>
</logentry>
<logentry
   revision="36716">
<author>hyq</author>
<date>2015-02-05T08:13:04.117817Z</date>
<msg>reviewid: 4904
reviewd by: hhx
bug id: 26860
改动说明: 添加一个关闭虚拟机的脚本</msg>
</logentry>
<logentry
   revision="36697">
<author>zyj</author>
<date>2015-02-05T03:39:14.650267Z</date>
<msg>reviewid 4877
review by: lifan
TD：26977
现象：主机断网时，出core了
改动说明：没有判断qemu-img没有获取到镜像大小的情况
测试：
编译通过。</msg>
</logentry>
<logentry
   revision="36696">
<author>zyj</author>
<date>2015-02-05T03:07:50.769451Z</date>
<msg>reviewid 4893
review by: lifan
TD: 28909
现象：
VNC端口冲突
改动说明：
在绑定VNC端口时加一个文件锁进行互斥
测试：
编译通过
</msg>
</logentry>
<logentry
   revision="36682">
<author>zhangqian</author>
<date>2015-02-05T01:16:18.858455Z</date>
<msg>reviewid: 4888
Reviewed by: fxw
BUG ID: [NULL]
问题分析： 
cirrus_vga: adding sanity check for vram size

when configure a invalid vram size for cirrus card, such as less
2 MB, which will crash qemu. Follow the real hardware, the cirrus
card has 4 MB video memory. Also for backward compatibility, accept
8 MB and 16 MB vram size.
改动说明：
backport from commit f61d82c2dfe02a60642a76e8f0034a0244eef2bf
http://git.qemu.org/?p=qemu.git;a=commit;h=f61d82c2dfe02a60642a76e8f0034a0244eef2bf

1.如果设置cirrus显卡的vram大小为无效的2MB时，qemu会崩溃；
2.真实的物理cirrus显卡的显存是4MB；
3.这个patch限制了显存的设置值只能是4MB，8MB，16MB.
测试动作： 编译通过。</msg>
</logentry>
<logentry
   revision="36670">
<author>hyq</author>
<date>2015-02-04T11:24:56.453443Z</date>
<msg>reviewid: 4870
reviewd by: hhx
bug id: 无
改动说明: 合入VMP3.3 include目录的改动</msg>
</logentry>
<logentry
   revision="36666">
<author>hyq</author>
<date>2015-02-04T10:55:56.060311Z</date>
<msg>reviewid: 4873
reviewd by: hhx
bug id: 无
改动说明: 合入VMP3.3 source目录的改动</msg>
</logentry>
<logentry
   revision="36665">
<author>hyq</author>
<date>2015-02-04T10:50:08.582794Z</date>
<msg>reviewid: 4868
reviewd by: hhx
bug id: 无
改动说明: 合入VMP3.3 build目录的改动</msg>
</logentry>
<logentry
   revision="36642">
<author>zhangqian</author>
<date>2015-02-04T08:09:56.991002Z</date>
<msg>reviewid: 4871
Reviewed by: fxw
BUG ID: [NULL]
问题分析： 
qxl: keep going if reaching guest bug on empty area

Xorg server hangs when using xfig and typing a text with space:
 #0  qxl_wait_for_io_command (qxl=&lt;value optimized out&gt;) at qxl_io.c:47
 #1  0x00007f826a49a299 in qxl_download_box (surface=0x221d030, x1=231, y1=259,
     x2=&lt;value optimized out&gt;, y2=&lt;value optimized out&gt;) at qxl_surface.c:143

   while (!(ram_header-&gt;int_pending &amp; QXL_INTERRUPT_IO_CMD))
     usleep (1);

The QXL driver is calling QXL_IO_UPDATE_AREA with an empty area. This
is a guest bug. The call is async and no ack is sent back on guest
bug, so the X server will hang. The driver should be improved to avoid
this situation and also to abort on QXL_INTERRUPT_ERROR. This will be
a different patch series for the driver. However, it is simple enough
to keep qemu running on empty areas update, which is what this patch
provides.

https://bugzilla.redhat.com/show_bug.cgi?id=1151363
改动说明：
backport from commit 9e5a25f1c209ff51e4b65124a3b76dd3f1b0fb49
http://git.qemu.org/?p=qemu.git;a=commit;h=9e5a25f1c209ff51e4b65124a3b76dd3f1b0fb49

1.guest机中旧的qxl驱动中，调用QXL_IO_UPDATE_AREA绘制一个空的区域，这是个异步调用，qemu没有回应，导致guest中X server被卡住；
2.qemu这段增加兼容性代码，出现guest中发生错误，可以继续运行下去；
测试动作： 编译通过。</msg>
</logentry>
<logentry
   revision="36640">
<author>zhangqian</author>
<date>2015-02-04T07:42:38.636528Z</date>
<msg>reviewid: 4867
Reviewed by: fxw
BUG ID: [NULL]
问题分析： 
ui/vnc: set TCP_NODELAY

we currently have the Nagle algorithm enabled for all outgoing VNC updates.
This may delay sensitive updates as mouse movements or typing in the console.
As we currently prepare all data in a buffer and then send as much as we can
disabling the Nagle algorithm should not cause big trouble. Well established
VNC servers like TightVNC set TCP_NODELAY as well.
A regular framebuffer update request generates exactly one framebuffer update
which should be pushed out as fast as possible.
改动说明：
backport from commit 86152436eb06a76e495425c1aa862833576fbc71
http://git.qemu.org/?p=qemu.git;a=commit;h=86152436eb06a76e495425c1aa862833576fbc71

1.Nagle算法把较小的包组装为更大的帧；
2.目前所有的vnc数据更新都用了默认的Nagle；
3.这对一些延迟敏感的数据传输会产生影响，比如鼠标移动，控制台输入等；
4.TightVNC作为vnc server，也设置了TCP_NODELAY，没有什么问题；
5.帧缓冲也需要快速的更新；
测试动作： 编译通过。</msg>
</logentry>
<logentry
   revision="36638">
<author>zhangqian</author>
<date>2015-02-04T07:40:45.259678Z</date>
<msg>reviewid: 4866
Reviewed by: zhy
BUG ID: [NULL]
问题分析： 
spice: reduce refresh rate in native mode

Now that cursor updates are out of the way qxl needs the refresh timer
only when when running in vga mode, for dirty bitmap checking.  In
native qxl mode the guest will notify us, so we don't need to poll and
can use the idle interval (one refresh wakeup every few seconds).
改动说明：
backport from commit 3dcadce5076d4b42fa395c39662d65e050b77784
http://git.qemu.org/?p=qemu.git;a=commit;h=3dcadce5076d4b42fa395c39662d65e050b77784

1.基于下面的patch("spice: use bottom half instead of refresh timer for...");
2.现在cursor的更新，在qxl native mode下已经不需要refresh timer了，因为native下，guest会通知我们，我们不需要轮询，所以增加refresh的频率，可以节省资源；
测试动作： 编译通过。</msg>
</logentry>
<logentry
   revision="36635">
<author>zhangqian</author>
<date>2015-02-04T07:24:42.327266Z</date>
<msg>reviewid: 4861
Reviewed by: zhy
BUG ID: [NULL]
问题分析： spice: use bottom half instead of refresh timer for cursor updates
Calling directly doesn't work due to the qxl-render code running in
spice server thread context.  Meanwhile bottom half scheduling is
thread-safe though, so we can use that to kick a cursor update in
main i/o thread context.
改动说明：
backport from commit 0b2824e5e48a787be3edbfc897244b4621e5bd61
http://git.qemu.org/?p=qemu.git;a=commitdiff;h=0b2824e5e48a787be3edbfc897244b4621e5bd61

1.在将refresh timer中的光标更新操作，改用bottom half来完成；
2.bottom half调度是线程安全的，所以可以用它在主I/O线程上下文中完成光标的更新。
测试动作： 编译通过。</msg>
</logentry>
<logentry
   revision="36612">
<author>hyq</author>
<date>2015-02-04T03:17:35.781380Z</date>
<msg>reviewid: 4857
reviewd by: hhx
bug id: 无
改动说明: 获取网桥能桥接的网卡时，过滤掉已被VS使用的网卡</msg>
</logentry>
<logentry
   revision="36608">
<author>zhangqian</author>
<date>2015-02-04T02:42:25.056467Z</date>
<msg>reviewid: 4848
Reviewed by: fxw zhy
BUG ID: [NULL]
问题分析： 
input: add support for kbd delays
----------------------------------------------------
input: use kbd delays for send_key monitor command
----------------------------------------------------
input/curses: add kbd delay between keydown and keyup...
----------------------------------------------------
input: add support for kbd delays
----------------------------------------------------

Little series of four input patches.  First patch adds support for
submitting keyboard delays, which will make the input layer setup a
timer, buffer the following keyboard events, send them to the guest
once the delay is over.  This should be used anywhere where we send
synthetic key events to the guest as injecting key events to the
guest without delays may cause problems with guests which are not
prepared to receive events faster than with human typing speed.

Second patch makes the send_key monitor command use the new service
instead of using its own timer.  Third patch inserts delays in
the curses ui.  Last patch adds kbd delays to the vnc press_key
function.

改动说明：
backport from commit 
http://git.qemu.org/?p=qemu.git;a=commit;h=be1a7176249ddf0be179d79e4f9c86b2ad42997b
http://git.qemu.org/?p=qemu.git;a=commit;h=2e377f1730d06deafb3e3ef6cf88792de4a6f4df
http://git.qemu.org/?p=qemu.git;a=commit;h=5a165668e70795de2665f18e3059dddd0059901f
http://git.qemu.org/?p=qemu.git;a=commit;h=2deb4acc7c7ee770a0e0e75fd321effd916ca7df

延迟按键按下和松开之间的时间，延迟10ms，避免发送太快，引发问题；

测试动作： 编译通过。</msg>
</logentry>
<logentry
   revision="36588">
<author>hhx</author>
<date>2015-02-03T12:48:39.326923Z</date>
<msg>newreviewid:4851,by wzt
解决问题:解决修改主机密码不退出的问题
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="36583">
<author>lifan</author>
<date>2015-02-03T12:25:02.129677Z</date>
<msg>noreview
qemu服务启动时增加一些调试日志，便于后面定位问题</msg>
</logentry>
<logentry
   revision="36580">
<author>zyj</author>
<date>2015-02-03T12:20:48.428826Z</date>
<msg>reviewid 4842
review by: lifan
TD: no
现象：加入预读命中率字段，方便看相关信息；日志文件名从pid换成vmid
改动说明：加入预读命中率字段，方便看相关信息；日志文件名从pid换成vmid
测试：
编译通过,自测通过</msg>
</logentry>
<logentry
   revision="36554">
<author>hyq</author>
<date>2015-02-03T09:06:20.912004Z</date>
<msg>reviewid: 4832
reviewd by: hhx
bug id: 无
改动说明: 合入LiFan supervise改动</msg>
</logentry>
<logentry
   revision="36513">
<author>zhangqian</author>
<date>2015-02-03T01:09:37.059066Z</date>
<msg>reviewid: 4789
Reviewed by: fxw
BUG ID: [NULL]
问题分析：
patch1:
vmware-vga: add vmsvga_verify_rect

Add verification function for rectangles, returning
true if verification passes and false otherwise.


patch2:
vmware-vga: use vmsvga_verify_rect in vmsvga_update_rect

Switch vmsvga_update_rect over to use vmsvga_verify_rect.  Slight change
in behavior:  We don't try to automatically fixup rectangles any more.
In case we find invalid update requests we'll do a full-screen update
instead.


patch3:
vmware-vga: use vmsvga_verify_rect in vmsvga_copy_rect

Add verification to vmsvga_copy_rect, re-enable HW_RECT_ACCEL.


patch4:
vmware-vga: use vmsvga_verify_rect in vmsvga_fill_rect

Add verification to vmsvga_fill_rect, re-enable HW_FILL_ACCEL.

改动说明：
backport from commit 
http://git.qemu.org/?p=qemu.git;a=commit;h=07258900fd45b646f5b69048d64c4490b3243e1b
http://git.qemu.org/?p=qemu.git;a=commit;h=1735fe1edba9cc86bc0f26937ed5a62d3cb47c9c
http://git.qemu.org/?p=qemu.git;a=commit;h=61b41b4c20eba08d2185297767e69153d7f3e09d
http://git.qemu.org/?p=qemu.git;a=commit;h=bd9ccd8517e83b7c33a9167815dbfffb30d70b13


1.新增对矩形的参数验证函数, 并使用上。

测试动作： 编译通过。</msg>
</logentry>
<logentry
   revision="36502">
<author>hyq</author>
<date>2015-02-02T12:58:01.428124Z</date>
<msg>reviewid: 4786
reviewd by: hhx
bug id: 无
改动说明: 合入vs改动</msg>
</logentry>
<logentry
   revision="36497">
<author>zhangqian</author>
<date>2015-02-02T12:05:57.763617Z</date>
<msg>reviewid: 4788
Reviewed by: fxw
BUG ID: [NULL]
问题分析： 
cirrus: fix blit region check

Issues:
 * Doesn't check pitches correctly in case it is negative.
 * Doesn't check width at all.

Turn macro into functions while being at it, also factor out the check
for one region which we then can simply call twice for src + dst.
This is CVE-2014-8106.


cirrus: don't overflow CirrusVGAState-&gt;cirrus_bltbuf
This is CVE-2014-8106.
改动说明：
backport from commit d3532a0db02296e687711b8cdc7791924efccea0  and bf25983345ca44aec3dd92c57142be45452bd38a
http://git.qemu.org/?p=qemu.git;a=commit;h=d3532a0db02296e687711b8cdc7791924efccea0
http://git.qemu.org/?p=qemu.git;a=commit;h=bf25983345ca44aec3dd92c57142be45452bd38a

CVE-2014-8106
1.QEMU在实现上存在Cirrus blit区域检查无效漏洞，攻击者可利用此漏洞绕过安全限制，执行未授权操作；
2.增加安全性检查，合入。
测试动作： 编译通过。</msg>
</logentry>
<logentry
   revision="36494">
<author>zhangqian</author>
<date>2015-02-02T11:39:48.615532Z</date>
<msg>reviewid: 4787
Reviewed by: fxw
BUG ID: [NULL]
问题分析： vnc-enc-tight: fix Arguments in wrong order
Arguments in wrong order (SWAPPED_ARGUMENTS)
The positions of arguments in the call to
tight_fill_palette do not match the ordering of the parameters:
 &amp;fg is passed to bg
 &amp;bg is passed to fg
改动说明：
backport from commit 525965b85dcd9e0d0359f1cdb04b3f25d754ffd9
http://git.qemu.org/?p=qemu.git;a=commitdiff;h=525965b85dcd9e0d0359f1cdb04b3f25d754ffd9

1.参数传错位置了；
2.-    colors = tight_fill_palette(vs, x, y, w * h, &amp;fg, &amp;bg, &amp;palette);
+    colors = tight_fill_palette(vs, x, y, w * h, &amp;bg, &amp;fg, &amp;palette);
测试动作： 编译通过。</msg>
</logentry>
<logentry
   revision="36493">
<author>lrx</author>
<date>2015-02-02T11:10:38.936043Z</date>
<msg>nonoreview
改动说明：1、存储详情多了个参数</msg>
</logentry>
<logentry
   revision="36492">
<author>lrx</author>
<date>2015-02-02T11:06:12.280336Z</date>
<msg>noreview
改动说明：合入以下文件3.3的改动到36488</msg>
</logentry>
<logentry
   revision="36481">
<author>zhangqian</author>
<date>2015-02-02T08:41:30.604031Z</date>
<msg>reviewid: 4719
Reviewed by: fxw
BUG ID: [NULL]
问题分析： vnc: refuse to set a password with VNC_AUTH_NONE
Current code silently changes the authentication settings
in case you try to set a password without password authentication
turned on.  This is bad.  Return an error instead.

If we want allow changing auth settings at runtime this should
be done explicitly using a separate monitor command, not as
side effect of set_passwd.
改动说明：
backport from commit cf864569cd9134ee503ad9eb6be2881001c0ed80
http://git.qemu.org/?p=qemu.git;a=commitdiff;h=cf864569cd9134ee503ad9eb6be2881001c0ed80

1.在没有给vnc设置password验证方式时，不应该允许用户设置vnc密码；
2.此种方式，假如后台通过qmp命令设置了vnc密码，则会导致控制台连接不上。

测试动作： 编译通过。</msg>
</logentry>
<logentry
   revision="36460">
<author>hhx</author>
<date>2015-02-02T03:53:20.643618Z</date>
<msg>newreviewid:4774,by wzt
解决问题:合入bug4613的修改
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="36451">
<author>hhx</author>
<date>2015-02-02T03:22:22.979734Z</date>
<msg>newreviewid:4766,by wzt
解决问题:解决非一体机，不能添加集群的问题
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="36447">
<author>zhangqian</author>
<date>2015-02-02T03:01:19.351411Z</date>
<msg>reviewid: 4725
Reviewed by: fxw
BUG ID: [NULL]
问题分析： "qxl-render: add sanity check "  "qxl-render: add more sanity checks"
Verify dirty rectangle is completely within the primary surface,
just ignore it in case it isn't.

Damn, the dirty rectangle values are signed integers.  So the checks
added by commit 788fbf042fc6d5aaeab56757e6dad622ac5f0c21 are not good
enough, we also have to make sure they are not negative.

[ Note: There must be something broken in spice-server so we get
  negative values in the first place.  Bug opened:
  https://bugzilla.redhat.com/show_bug.cgi?id=1135372 ]
改动说明：
backport from commit 788fbf042fc6d5aaeab56757e6dad622ac5f0c21  503b3b33feca818baa4459aba286e54a528e5567
http://git.qemu.org/?p=qemu.git;a=commitdiff;h=788fbf042fc6d5aaeab56757e6dad622ac5f0c21
http://git.qemu.org/?p=qemu.git;a=commitdiff;h=503b3b33feca818baa4459aba286e54a528e5567

1.第一个patch：变量合法性检测，确保dirty rectangle范围完全在primary surface中，如果不在，就忽略掉；
2.第二个patch：qxl-&gt;dirty[i].right &lt; 0 和
qxl-&gt;dirty[i].bottom &lt; 0 这两个条件应该也加上；
3.“Bug 1135372 - Machine type rhel6.0.0 &amp; -vga qxl &amp; vnc cause qemu-kvm core dump”，这个bug就是因为有值是负数，导致spice-server中处理异常，qemu出core。

测试动作： 编译通过。</msg>
</logentry>
<logentry
   revision="36445">
<author>zhangqian</author>
<date>2015-02-02T02:57:23.952999Z</date>
<msg>reviewid: 4722
Reviewed by: fxw
BUG ID: [NULL]
问题分析： vnc-enc-tight: Fix divide-by-zero in tight_detect_smooth_image{16,24,32}
Spotted by Coverity:

(1) Event assignment:  Assigning: "pixels" = "0".
(2) Event cond_true:  Condition "y &lt; h", taking true branch
(3) Event cond_false:  Condition "x &lt; w", taking false branch
(4) Event loop_end:  Reached end of loop
(5) Event divide_by_zero:  In expression "(stats[0] + stats[1]) * 100U / pixels",
division by expression "pixels" which may be zero has undefined behavior.

290     DEFINE_DETECT_FUNCTION(16)
291     DEFINE_DETECT_FUNCTION(32)

改动说明：
backport from commit b52991537c0efe27ee0c1955eb28a4584226d8b5
http://git.qemu.org/?p=qemu.git;a=commitdiff;h=b52991537c0efe27ee0c1955eb28a4584226d8b5


1.vnc client构造的异常数据，导致qemu这边产生除0问题；
2.在除以pixels前，判断是否为0.

测试动作： 编译通过。</msg>
</logentry>
<logentry
   revision="36412">
<author>hyq</author>
<date>2015-01-31T10:44:09.419056Z</date>
<msg>reviewid: 4759
reviewd by: wzt
bug id: 无
改动说明: 存储被vs使用，设置磁盘状态为被使用</msg>
</logentry>
<logentry
   revision="36403">
<author>hyq</author>
<date>2015-01-31T09:40:14.364826Z</date>
<msg>reviewid: 4750
reviewd by: wzt
bug id: 无
改动说明: 为vs保留两个网卡所做改动</msg>
</logentry>
<logentry
   revision="36377">
<author>lrx</author>
<date>2015-01-31T06:55:49.556761Z</date>
<msg>nonoreview
改动说明：1、vmp的IO趋势图，存储详情和虚拟机详情页面，单位和vs那边统一</msg>
</logentry>
<logentry
   revision="36321">
<author>zhangqian</author>
<date>2015-01-30T09:01:55.096546Z</date>
<msg>reviewid: 4714
Reviewed by: fxw
BUG ID: [NULL]
问题分析：
spice: rework mirror allocation, add no-resize fast path
Add fast path to qemu_spice_display_switch in case old and new
displaysurface have identical size (happens with display panning
and page flipping).  We just swap the backing store then and don't
go through the whole process of deleting and creating the primary
surface.

To simplify the code a bit move mirror surface allocation to
qemu_spice_display_switch().
改动说明：
backport from commit 555e72f2d02125766601db52c6380357b3820fcb
http://git.qemu.org/?p=qemu.git;a=commitdiff;h=555e72f2d02125766601db52c6380357b3820fcb

1.分两个修改，一个是把mirror的分配调用从qemu_spice_create_update移入qemu_spice_display_switch；
2.另一个是，在切换displaysurface时，相同尺寸的surface（一般是在surface平移或者页面发转的时候），就不再重新调用qemu_spice_create_host_primary了，直接用当前的。
测试动作： 编译通过。</msg>
</logentry>
<logentry
   revision="36320">
<author>zhangqian</author>
<date>2015-01-30T08:43:03.497763Z</date>
<msg>reviewid:4705
Reviewed by: fxw
BUG ID: [NULL]
问题分析： spice: fix memory leak
If errors happen for middle items of channel_list,
qmp_query_spice_channels() returns NULL, and the variable
cur_item going out of scope leaks the storage it points to.

The flag is a compatibility thing for older spice-server
versions. Meanwhile our minimum spice version requirement is
new enough that we should never ever see this error, and if we
do something went very seriously wrong. Let's using assert()
instead of returning NULL to avoid a memory leak.
改动说明：
backport from commit a41642708a5d1cbe8ad966227bbee1ed5eb421ad
http://git.qemu.org/?p=qemu.git;a=commitdiff;h=a41642708a5d1cbe8ad966227bbee1ed5eb421ad

1.如果channel_list中的中间item发送错误，qmp_query_spice_channels会返回NULL，结果cur_item没有被释放，产生了内存泄漏；
2.这个问题，主要是兼容旧版本的spice-server导致的，目前我们的spice-server足够新了，不会产生这种问题，也不应该发送这种错误；
3.所以把if（）return null去掉，直接改成assert.

测试动作： 编译通过。</msg>
</logentry>
<logentry
   revision="36313">
<author>zyj</author>
<date>2015-01-30T07:59:54.105872Z</date>
<msg>reviewid 4710
review by: lifan
TD: no
现象：在磁盘错误的流程中加入abort给VS部门调试用
改动说明：在磁盘错误的流程中加入abort给VS部门调试用
测试：
编译通过,自测通过
</msg>
</logentry>
<logentry
   revision="36296">
<author>lrx</author>
<date>2015-01-30T06:54:09.916053Z</date>
<msg>noreview
改动说明：1、3.4合入新版datetime画图组件，2、vmp所有趋势图不显示小数</msg>
</logentry>
<logentry
   revision="36263">
<author>hhx</author>
<date>2015-01-29T13:02:52.772859Z</date>
<msg>newreviewid:4679,by wzt
解决问题:修改3.4的版本号
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="36229">
<author>lrx</author>
<date>2015-01-29T09:10:37.482801Z</date>
<msg>noreview
改动说明：1、存储详情趋势图增加不显示小数配置</msg>
</logentry>
<logentry
   revision="36189">
<author>zyj</author>
<date>2015-01-29T06:44:37.087153Z</date>
<msg>reviewid 4668
review by: lifan
TD：no
现象：
改动说明：qemu支持glfs api、glfs api实现glfs_lock 、拦截15号信号、实现glfs_io_hold、使用glfs api导致的预读功能不生效、缓存优化彻底解决读IO与cache数据重叠的问题、VS要求的预分配，等等
测试：
编译通过，给VS部门替换程序测试通过。</msg>
</logentry>
<logentry
   revision="36184">
<author>hhx</author>
<date>2015-01-29T04:05:09.953905Z</date>
<msg>newreviewid:4665,by wzt,gzy
解决问题:合入VMPInfo文件的修改
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="36156">
<author>hhx</author>
<date>2015-01-28T10:25:01.293749Z</date>
<msg>newreviewid:4650,by wzt,gzy
解决问题:合入QemuServer.pm文件
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="36152">
<author>hhx</author>
<date>2015-01-28T09:52:32.068069Z</date>
<msg>newreviewid:4649,by wzt,gzy
解决问题:合入QemuBackRecovery.pm文件
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="36145">
<author>hhx</author>
<date>2015-01-28T09:39:28.119185Z</date>
<msg>newreviewid:4646,by wzt,gzy
解决问题:解决VTP::Tools::read_ini_conf文件的问题
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="36143">
<author>hhx</author>
<date>2015-01-28T09:26:23.709397Z</date>
<msg>newreviewid:4645,by wzt,gzy
解决问题:合入vtp-storage文件夹下的代码
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="36141">
<author>hhx</author>
<date>2015-01-28T09:16:14.149488Z</date>
<msg>newreviewid:4644,by wzt
解决问题:合入VS对VTP::Storage::Plugin文件的修改
做了那些测试:perl -c ok</msg>
</logentry>
<logentry
   revision="36126">
<author>lrx</author>
<date>2015-01-28T07:04:03.774294Z</date>
<msg>noreview
改动说明：1、btn-loading时不允许点击
</msg>
</logentry>
<logentry
   revision="36125">
<author>lrx</author>
<date>2015-01-28T06:59:45.410537Z</date>
<msg>noreview
改动说明：1、提示效果改变
</msg>
</logentry>
<logentry
   revision="36116">
<author>lrx</author>
<date>2015-01-28T04:00:07.744116Z</date>
<msg>noreview
改动说明：1、恢复出厂设置时，提示离线主机</msg>
</logentry>
<logentry
   revision="36084">
<author>zyj</author>
<date>2015-01-27T09:47:03.314541Z</date>
<msg>reviewid 4605
review by: lifan
TD：no
现象：gfapi方式预读功能不生效
改动说明：gfapi方式（file=glusterfs+tcp://127.0.0.1/***）找不.sector文件导致预读功能不生效，修改为通过fuse寻找.sector
测试：
编译通过，自测通过。</msg>
</logentry>
<logentry
   revision="36074">
<author>hyq</author>
<date>2015-01-27T07:52:39.505038Z</date>
<msg>reviewid: 4603
reviewd by: hhx
bug id: 无
改动说明: 修改包名版本号为3.4</msg>
</logentry>
<logentry
   revision="36067">
<author>hhx</author>
<date>2015-01-27T04:17:33.607976Z</date>
<msg>newreviewid:4578,by wzt
解决问题:fix bug26750:[体验]组建集群的后提示修改密码，不组建集群就不提示修改了
做了那些测试:
自测了以下场景：
测试了一下场景：
单机情况下密码为admin:
   首次登陆，没有提示需要改密码
   7天后登陆，提示需要改密码
集群环境下密码为admin:
   首次登陆，提示需要改密码
   7天后登陆，强制要求改密码</msg>
</logentry>
<logentry
   revision="36065">
<author>lixing</author>
<date>2015-01-27T04:14:31.290411Z</date>
<msg>Tag 3.4 Begin</msg>
</logentry>
<logentry
   revision="36064">
<author>lixing</author>
<date>2015-01-27T04:14:10.226673Z</date>
<msg>删除</msg>
</logentry>
<logentry
   revision="36060">
<author>hhx</author>
<date>2015-01-27T02:53:20.273597Z</date>
<msg>newname</msg>
</logentry>
<logentry
   revision="36059">
<author>hhx</author>
<date>2015-01-27T02:53:07.581451Z</date>
<msg>newname</msg>
</logentry>
<logentry
   revision="36058">
<author>hhx</author>
<date>2015-01-27T02:52:18.727728Z</date>
<msg>nouse</msg>
</logentry>
<logentry
   revision="36057">
<author>hhx</author>
<date>2015-01-27T02:52:09.320268Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="36056">
<author>hhx</author>
<date>2015-01-27T02:52:02.287954Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="36041">
<author>hyq</author>
<date>2015-01-26T09:36:42.594832Z</date>
<msg>reviewid: 4586
reviewd by: hhx
bug id: 无
改动说明: 修改内核svn路径为svn://200.200.0.10/vt/vt/VTP/VMP3.4/Trunk/Source/kernel.new</msg>
</logentry>
<logentry
   revision="36037">
<author>hhx</author>
<date>2015-01-26T09:06:23.871986Z</date>
<msg>newreviewid:4578,by wzt
解决问题:fix bug26750:[体验]组建集群的后提示修改密码，不组建集群就不提示修改了
做了那些测试:
自测了以下场景：
测试了一下场景：
单机情况下密码为admin:
   首次登陆，没有提示需要改密码
   7天后登陆，提示需要改密码
集群环境下密码为admin:
   首次登陆，提示需要改密码
   7天后登陆，强制要求改密码
</msg>
</logentry>
<logentry
   revision="36029">
<author>hhx</author>
<date>2015-01-26T07:30:16.881240Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="36021">
<author>hhx</author>
<date>2015-01-26T03:57:32.149271Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="36020">
<author>hhx</author>
<date>2015-01-26T03:57:22.382671Z</date>
<msg>new</msg>
</logentry>
<logentry
   revision="36019">
<author>hhx</author>
<date>2015-01-26T03:57:14.676095Z</date>
<msg>new
</msg>
</logentry>
<logentry
   revision="36018">
<author>hhx</author>
<date>2015-01-26T03:57:07.905535Z</date>
<msg>new</msg>
</logentry>
